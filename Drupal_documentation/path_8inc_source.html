<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Shopcart: includes/path.inc Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Shopcart
   &#160;<span id="projectnumber">version2.0</span>
   </div>
   <div id="projectbrief">Shoppingcart</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_5b89693129504707d608c5412e7b88d4.html">includes</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">path.inc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="path_8inc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00015"></a><a class="code" href="path_8inc_ad19e2051aeae309fbf3be8bd072e6fed.html#ad19e2051aeae309fbf3be8bd072e6fed">00015</a> <span class="keyword">function</span> <a class="code" href="path_8inc_ad19e2051aeae309fbf3be8bd072e6fed.html#ad19e2051aeae309fbf3be8bd072e6fed" title="Initialize the $_GET[&#39;q&#39;] variable to the proper normal path.">drupal_path_initialize</a>() {
<a name="l00016"></a>00016   <span class="comment">// Ensure $_GET[&#39;q&#39;] is set before calling drupal_normal_path(), to support</span>
<a name="l00017"></a>00017   <span class="comment">// path caching with hook_url_inbound_alter().</span>
<a name="l00018"></a>00018   <span class="keywordflow">if</span> (empty($_GET[<span class="charliteral">&#39;q&#39;</span>])) {
<a name="l00019"></a>00019     $_GET[<span class="charliteral">&#39;q&#39;</span>] = <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;site_frontpage&#39;</span>, <span class="stringliteral">&#39;node&#39;</span>);
<a name="l00020"></a>00020   }
<a name="l00021"></a>00021   $_GET[<span class="charliteral">&#39;q&#39;</span>] = <a class="code" href="path_8inc_a59781811cbcdef4c64ccd1d55e1ae9f8.html#a59781811cbcdef4c64ccd1d55e1ae9f8" title="Given a path alias, return the internal path it represents.">drupal_get_normal_path</a>($_GET[<span class="charliteral">&#39;q&#39;</span>]);
<a name="l00022"></a>00022 }
<a name="l00023"></a>00023 
<a name="l00045"></a><a class="code" href="path_8inc_a3c1a94088895986eedd4358367355e33.html#a3c1a94088895986eedd4358367355e33">00045</a> <span class="keyword">function</span> <a class="code" href="path_8inc_a3c1a94088895986eedd4358367355e33.html#a3c1a94088895986eedd4358367355e33" title="Given an alias, return its Drupal system URL if one exists.">drupal_lookup_path</a>($action, $path = <span class="stringliteral">&#39;&#39;</span>, $path_language = NULL) {
<a name="l00046"></a>00046   global $language_url;
<a name="l00047"></a>00047   <span class="comment">// Use the advanced drupal_static() pattern, since this is called very often.</span>
<a name="l00048"></a>00048   <span class="keyword">static</span> $drupal_static_fast;
<a name="l00049"></a>00049   <span class="keywordflow">if</span> (!isset($drupal_static_fast)) {
<a name="l00050"></a>00050     $drupal_static_fast[<span class="stringliteral">&#39;cache&#39;</span>] = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__);
<a name="l00051"></a>00051   }
<a name="l00052"></a>00052   $cache = &amp;$drupal_static_fast[<span class="stringliteral">&#39;cache&#39;</span>];
<a name="l00053"></a>00053 
<a name="l00054"></a>00054   <span class="keywordflow">if</span> (!isset($cache)) {
<a name="l00055"></a>00055     $cache = array(
<a name="l00056"></a>00056       <span class="stringliteral">&#39;map&#39;</span> =&gt; array(),
<a name="l00057"></a>00057       <span class="stringliteral">&#39;no_source&#39;</span> =&gt; array(),
<a name="l00058"></a>00058       <span class="stringliteral">&#39;whitelist&#39;</span> =&gt; NULL,
<a name="l00059"></a>00059       <span class="stringliteral">&#39;system_paths&#39;</span> =&gt; array(),
<a name="l00060"></a>00060       <span class="stringliteral">&#39;no_aliases&#39;</span> =&gt; array(),
<a name="l00061"></a>00061       <span class="stringliteral">&#39;first_call&#39;</span> =&gt; TRUE,
<a name="l00062"></a>00062     );
<a name="l00063"></a>00063   }
<a name="l00064"></a>00064 
<a name="l00065"></a>00065   <span class="comment">// Retrieve the path alias whitelist.</span>
<a name="l00066"></a>00066   <span class="keywordflow">if</span> (!isset($cache[<span class="stringliteral">&#39;whitelist&#39;</span>])) {
<a name="l00067"></a>00067     $cache[<span class="stringliteral">&#39;whitelist&#39;</span>] = <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;path_alias_whitelist&#39;</span>, NULL);
<a name="l00068"></a>00068     <span class="keywordflow">if</span> (!isset($cache[<span class="stringliteral">&#39;whitelist&#39;</span>])) {
<a name="l00069"></a>00069       $cache[<span class="stringliteral">&#39;whitelist&#39;</span>] = <a class="code" href="path_8inc_a98ce949c6766328b89a2b98f31359b14.html#a98ce949c6766328b89a2b98f31359b14" title="Rebuild the path alias white list.">drupal_path_alias_whitelist_rebuild</a>();
<a name="l00070"></a>00070     }
<a name="l00071"></a>00071   }
<a name="l00072"></a>00072 
<a name="l00073"></a>00073   <span class="comment">// If no language is explicitly specified we default to the current URL</span>
<a name="l00074"></a>00074   <span class="comment">// language. If we used a language different from the one conveyed by the</span>
<a name="l00075"></a>00075   <span class="comment">// requested URL, we might end up being unable to check if there is a path</span>
<a name="l00076"></a>00076   <span class="comment">// alias matching the URL path.</span>
<a name="l00077"></a>00077   $path_language = $path_language ? $path_language : $language_url-&gt;language;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079   <span class="keywordflow">if</span> ($action == <span class="stringliteral">&#39;wipe&#39;</span>) {
<a name="l00080"></a>00080     $cache = array();
<a name="l00081"></a>00081     $cache[<span class="stringliteral">&#39;whitelist&#39;</span>] = <a class="code" href="path_8inc_a98ce949c6766328b89a2b98f31359b14.html#a98ce949c6766328b89a2b98f31359b14" title="Rebuild the path alias white list.">drupal_path_alias_whitelist_rebuild</a>();
<a name="l00082"></a>00082   }
<a name="l00083"></a>00083   elseif ($cache[<span class="stringliteral">&#39;whitelist&#39;</span>] &amp;&amp; $path != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00084"></a>00084     <span class="keywordflow">if</span> ($action == <span class="stringliteral">&#39;alias&#39;</span>) {
<a name="l00085"></a>00085       <span class="comment">// During the first call to drupal_lookup_path() per language, load the</span>
<a name="l00086"></a>00086       <span class="comment">// expected system paths for the page from cache.</span>
<a name="l00087"></a>00087       <span class="keywordflow">if</span> (!empty($cache[<span class="stringliteral">&#39;first_call&#39;</span>])) {
<a name="l00088"></a>00088         $cache[<span class="stringliteral">&#39;first_call&#39;</span>] = FALSE;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090         $cache[<span class="stringliteral">&#39;map&#39;</span>][$path_language] = array();
<a name="l00091"></a>00091         <span class="comment">// Load system paths from cache.</span>
<a name="l00092"></a>00092         $cid = <a class="code" href="path_8inc_a97aaa03027cbf6f0ffdd9a4bf5c9a31c.html#a97aaa03027cbf6f0ffdd9a4bf5c9a31c" title="Return the current URL path of the page being viewed.">current_path</a>();
<a name="l00093"></a>00093         <span class="keywordflow">if</span> ($cached = <a class="code" href="cache_8inc_a9d873815c28909b61c3a6188b383f8a3.html#a9d873815c28909b61c3a6188b383f8a3" title="Returns data from the persistent cache.">cache_get</a>($cid, <span class="stringliteral">&#39;cache_path&#39;</span>)) {
<a name="l00094"></a>00094           $cache[<span class="stringliteral">&#39;system_paths&#39;</span>] = $cached-&gt;data;
<a name="l00095"></a>00095           <span class="comment">// Now fetch the aliases corresponding to these system paths.</span>
<a name="l00096"></a>00096           $args = array(
<a name="l00097"></a>00097             <span class="stringliteral">&#39;:system&#39;</span> =&gt; $cache[<span class="stringliteral">&#39;system_paths&#39;</span>],
<a name="l00098"></a>00098             <span class="stringliteral">&#39;:language&#39;</span> =&gt; $path_language,
<a name="l00099"></a>00099             <span class="stringliteral">&#39;:language_none&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a9e91e2136aa0ce5c5e80f06aa3ad8266.html#a9e91e2136aa0ce5c5e80f06aa3ad8266" title="The language code used when no language is explicitly assigned.">LANGUAGE_NONE</a>,
<a name="l00100"></a>00100           );
<a name="l00101"></a>00101           <span class="comment">// Always get the language-specific alias before the language-neutral</span>
<a name="l00102"></a>00102           <span class="comment">// one. For example &#39;de&#39; is less than &#39;und&#39; so the order needs to be</span>
<a name="l00103"></a>00103           <span class="comment">// ASC, while &#39;xx-lolspeak&#39; is more than &#39;und&#39; so the order needs to</span>
<a name="l00104"></a>00104           <span class="comment">// be DESC. We also order by pid ASC so that fetchAllKeyed() returns</span>
<a name="l00105"></a>00105           <span class="comment">// the most recently created alias for each source. Subsequent queries</span>
<a name="l00106"></a>00106           <span class="comment">// using fetchField() must use pid DESC to have the same effect.</span>
<a name="l00107"></a>00107           <span class="comment">// For performance reasons, the query builder is not used here.</span>
<a name="l00108"></a>00108           <span class="keywordflow">if</span> ($path_language == <a class="code" href="bootstrap_8inc_a9e91e2136aa0ce5c5e80f06aa3ad8266.html#a9e91e2136aa0ce5c5e80f06aa3ad8266" title="The language code used when no language is explicitly assigned.">LANGUAGE_NONE</a>) {
<a name="l00109"></a>00109             <span class="comment">// Prevent PDO from complaining about a token the query doesn&#39;t use.</span>
<a name="l00110"></a>00110             unset($args[<span class="stringliteral">&#39;:language&#39;</span>]);
<a name="l00111"></a>00111             $result = <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&#39;SELECT source, alias FROM {url_alias} WHERE source IN (:system) AND language = :language_none ORDER BY pid ASC&#39;</span>, $args);
<a name="l00112"></a>00112           }
<a name="l00113"></a>00113           elseif ($path_language &lt; <a class="code" href="bootstrap_8inc_a9e91e2136aa0ce5c5e80f06aa3ad8266.html#a9e91e2136aa0ce5c5e80f06aa3ad8266" title="The language code used when no language is explicitly assigned.">LANGUAGE_NONE</a>) {
<a name="l00114"></a>00114             $result = <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&#39;SELECT source, alias FROM {url_alias} WHERE source IN (:system) AND language IN (:language, :language_none) ORDER BY language ASC, pid ASC&#39;</span>, $args);
<a name="l00115"></a>00115           }
<a name="l00116"></a>00116           <span class="keywordflow">else</span> {
<a name="l00117"></a>00117             $result = <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&#39;SELECT source, alias FROM {url_alias} WHERE source IN (:system) AND language IN (:language, :language_none) ORDER BY language DESC, pid ASC&#39;</span>, $args);
<a name="l00118"></a>00118           }
<a name="l00119"></a>00119           $cache[<span class="stringliteral">&#39;map&#39;</span>][$path_language] = $result-&gt;fetchAllKeyed();
<a name="l00120"></a>00120           <span class="comment">// Keep a record of paths with no alias to avoid querying twice.</span>
<a name="l00121"></a>00121           $cache[<span class="stringliteral">&#39;no_aliases&#39;</span>][$path_language] = array_flip(array_diff_key($cache[<span class="stringliteral">&#39;system_paths&#39;</span>], array_keys($cache[<span class="stringliteral">&#39;map&#39;</span>][$path_language])));
<a name="l00122"></a>00122         }
<a name="l00123"></a>00123       }
<a name="l00124"></a>00124       <span class="comment">// If the alias has already been loaded, return it.</span>
<a name="l00125"></a>00125       <span class="keywordflow">if</span> (isset($cache[<span class="stringliteral">&#39;map&#39;</span>][$path_language][$path])) {
<a name="l00126"></a>00126         <span class="keywordflow">return</span> $cache[<span class="stringliteral">&#39;map&#39;</span>][$path_language][$path];
<a name="l00127"></a>00127       }
<a name="l00128"></a>00128       <span class="comment">// Check the path whitelist, if the top_level part before the first /</span>
<a name="l00129"></a>00129       <span class="comment">// is not in the list, then there is no need to do anything further,</span>
<a name="l00130"></a>00130       <span class="comment">// it is not in the database.</span>
<a name="l00131"></a>00131       elseif (!isset($cache[<span class="stringliteral">&#39;whitelist&#39;</span>][strtok($path, <span class="charliteral">&#39;/&#39;</span>)])) {
<a name="l00132"></a>00132         <span class="keywordflow">return</span> FALSE;
<a name="l00133"></a>00133       }
<a name="l00134"></a>00134       <span class="comment">// For system paths which were not cached, query aliases individually.</span>
<a name="l00135"></a>00135       elseif (!isset($cache[<span class="stringliteral">&#39;no_aliases&#39;</span>][$path_language][$path])) {
<a name="l00136"></a>00136         $args = array(
<a name="l00137"></a>00137           <span class="stringliteral">&#39;:source&#39;</span> =&gt; $path,
<a name="l00138"></a>00138           <span class="stringliteral">&#39;:language&#39;</span> =&gt; $path_language,
<a name="l00139"></a>00139           <span class="stringliteral">&#39;:language_none&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a9e91e2136aa0ce5c5e80f06aa3ad8266.html#a9e91e2136aa0ce5c5e80f06aa3ad8266" title="The language code used when no language is explicitly assigned.">LANGUAGE_NONE</a>,
<a name="l00140"></a>00140         );
<a name="l00141"></a>00141         <span class="comment">// See the queries above.</span>
<a name="l00142"></a>00142         <span class="keywordflow">if</span> ($path_language == <a class="code" href="bootstrap_8inc_a9e91e2136aa0ce5c5e80f06aa3ad8266.html#a9e91e2136aa0ce5c5e80f06aa3ad8266" title="The language code used when no language is explicitly assigned.">LANGUAGE_NONE</a>) {
<a name="l00143"></a>00143           unset($args[<span class="stringliteral">&#39;:language&#39;</span>]);
<a name="l00144"></a>00144           $alias = <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&quot;SELECT alias FROM {url_alias} WHERE source = :source AND language = :language_none ORDER BY pid DESC&quot;</span>, $args)-&gt;fetchField();
<a name="l00145"></a>00145         }
<a name="l00146"></a>00146         elseif ($path_language &gt; <a class="code" href="bootstrap_8inc_a9e91e2136aa0ce5c5e80f06aa3ad8266.html#a9e91e2136aa0ce5c5e80f06aa3ad8266" title="The language code used when no language is explicitly assigned.">LANGUAGE_NONE</a>) {
<a name="l00147"></a>00147           $alias = <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&quot;SELECT alias FROM {url_alias} WHERE source = :source AND language IN (:language, :language_none) ORDER BY language DESC, pid DESC&quot;</span>, $args)-&gt;fetchField();
<a name="l00148"></a>00148         }
<a name="l00149"></a>00149         <span class="keywordflow">else</span> {
<a name="l00150"></a>00150           $alias = <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&quot;SELECT alias FROM {url_alias} WHERE source = :source AND language IN (:language, :language_none) ORDER BY language ASC, pid DESC&quot;</span>, $args)-&gt;fetchField();
<a name="l00151"></a>00151         }
<a name="l00152"></a>00152         $cache[<span class="stringliteral">&#39;map&#39;</span>][$path_language][$path] = $alias;
<a name="l00153"></a>00153         <span class="keywordflow">return</span> $alias;
<a name="l00154"></a>00154       }
<a name="l00155"></a>00155     }
<a name="l00156"></a>00156     <span class="comment">// Check $no_source for this $path in case we&#39;ve already determined that there</span>
<a name="l00157"></a>00157     <span class="comment">// isn&#39;t a path that has this alias</span>
<a name="l00158"></a>00158     elseif ($action == <span class="stringliteral">&#39;source&#39;</span> &amp;&amp; !isset($cache[<span class="stringliteral">&#39;no_source&#39;</span>][$path_language][$path])) {
<a name="l00159"></a>00159       <span class="comment">// Look for the value $path within the cached $map</span>
<a name="l00160"></a>00160       $source = FALSE;
<a name="l00161"></a>00161       <span class="keywordflow">if</span> (!isset($cache[<span class="stringliteral">&#39;map&#39;</span>][$path_language]) || !($source = array_search($path, $cache[<span class="stringliteral">&#39;map&#39;</span>][$path_language]))) {
<a name="l00162"></a>00162         $args = array(
<a name="l00163"></a>00163           <span class="stringliteral">&#39;:alias&#39;</span> =&gt; $path,
<a name="l00164"></a>00164           <span class="stringliteral">&#39;:language&#39;</span> =&gt; $path_language,
<a name="l00165"></a>00165           <span class="stringliteral">&#39;:language_none&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a9e91e2136aa0ce5c5e80f06aa3ad8266.html#a9e91e2136aa0ce5c5e80f06aa3ad8266" title="The language code used when no language is explicitly assigned.">LANGUAGE_NONE</a>,
<a name="l00166"></a>00166         );
<a name="l00167"></a>00167         <span class="comment">// See the queries above.</span>
<a name="l00168"></a>00168         <span class="keywordflow">if</span> ($path_language == <a class="code" href="bootstrap_8inc_a9e91e2136aa0ce5c5e80f06aa3ad8266.html#a9e91e2136aa0ce5c5e80f06aa3ad8266" title="The language code used when no language is explicitly assigned.">LANGUAGE_NONE</a>) {
<a name="l00169"></a>00169           unset($args[<span class="stringliteral">&#39;:language&#39;</span>]);
<a name="l00170"></a>00170           $result = <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&quot;SELECT source FROM {url_alias} WHERE alias = :alias AND language = :language_none ORDER BY pid DESC&quot;</span>, $args);
<a name="l00171"></a>00171         }
<a name="l00172"></a>00172         elseif ($path_language &gt; <a class="code" href="bootstrap_8inc_a9e91e2136aa0ce5c5e80f06aa3ad8266.html#a9e91e2136aa0ce5c5e80f06aa3ad8266" title="The language code used when no language is explicitly assigned.">LANGUAGE_NONE</a>) {
<a name="l00173"></a>00173           $result = <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&quot;SELECT source FROM {url_alias} WHERE alias = :alias AND language IN (:language, :language_none) ORDER BY language DESC, pid DESC&quot;</span>, $args);
<a name="l00174"></a>00174         }
<a name="l00175"></a>00175         <span class="keywordflow">else</span> {
<a name="l00176"></a>00176           $result = <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&quot;SELECT source FROM {url_alias} WHERE alias = :alias AND language IN (:language, :language_none) ORDER BY language ASC, pid DESC&quot;</span>, $args);
<a name="l00177"></a>00177         }
<a name="l00178"></a>00178         <span class="keywordflow">if</span> ($source = $result-&gt;fetchField()) {
<a name="l00179"></a>00179           $cache[<span class="stringliteral">&#39;map&#39;</span>][$path_language][$source] = $path;
<a name="l00180"></a>00180         }
<a name="l00181"></a>00181         <span class="keywordflow">else</span> {
<a name="l00182"></a>00182           <span class="comment">// We can&#39;t record anything into $map because we do not have a valid</span>
<a name="l00183"></a>00183           <span class="comment">// index and there is no need because we have not learned anything</span>
<a name="l00184"></a>00184           <span class="comment">// about any Drupal path. Thus cache to $no_source.</span>
<a name="l00185"></a>00185           $cache[<span class="stringliteral">&#39;no_source&#39;</span>][$path_language][$path] = TRUE;
<a name="l00186"></a>00186         }
<a name="l00187"></a>00187       }
<a name="l00188"></a>00188       <span class="keywordflow">return</span> $source;
<a name="l00189"></a>00189     }
<a name="l00190"></a>00190   }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192   <span class="keywordflow">return</span> FALSE;
<a name="l00193"></a>00193 }
<a name="l00194"></a>00194 
<a name="l00203"></a><a class="code" href="path_8inc_a60e3f93b8388973df3e4f98788fd5388.html#a60e3f93b8388973df3e4f98788fd5388">00203</a> <span class="keyword">function</span> <a class="code" href="path_8inc_a60e3f93b8388973df3e4f98788fd5388.html#a60e3f93b8388973df3e4f98788fd5388" title="Cache system paths for a page.">drupal_cache_system_paths</a>() {
<a name="l00204"></a>00204   <span class="comment">// Check if the system paths for this page were loaded from cache in this</span>
<a name="l00205"></a>00205   <span class="comment">// request to avoid writing to cache on every request.</span>
<a name="l00206"></a>00206   $cache = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(<span class="stringliteral">&#39;drupal_lookup_path&#39;</span>, array());
<a name="l00207"></a>00207   <span class="keywordflow">if</span> (empty($cache[<span class="stringliteral">&#39;system_paths&#39;</span>]) &amp;&amp; !empty($cache[<span class="stringliteral">&#39;map&#39;</span>])) {
<a name="l00208"></a>00208     <span class="comment">// Generate a cache ID (cid) specifically for this page.</span>
<a name="l00209"></a>00209     $cid = <a class="code" href="path_8inc_a97aaa03027cbf6f0ffdd9a4bf5c9a31c.html#a97aaa03027cbf6f0ffdd9a4bf5c9a31c" title="Return the current URL path of the page being viewed.">current_path</a>();
<a name="l00210"></a>00210     <span class="comment">// The static $map array used by drupal_lookup_path() includes all</span>
<a name="l00211"></a>00211     <span class="comment">// system paths for the page request.</span>
<a name="l00212"></a>00212     <span class="keywordflow">if</span> ($paths = current($cache[<span class="stringliteral">&#39;map&#39;</span>])) {
<a name="l00213"></a>00213       $data = array_keys($paths);
<a name="l00214"></a>00214       $expire = <a class="code" href="bootstrap_8inc_a08bcd0b03e31c17fb7d58786bef2b7f4.html#a08bcd0b03e31c17fb7d58786bef2b7f4" title="Time of the current request in seconds elapsed since the Unix Epoch.">REQUEST_TIME</a> + (60 * 60 * 24);
<a name="l00215"></a>00215       <a class="code" href="cache_8inc_a48081f36334909f561ef4f538fa640d2.html#a48081f36334909f561ef4f538fa640d2" title="Stores data in the persistent cache.">cache_set</a>($cid, $data, <span class="stringliteral">&#39;cache_path&#39;</span>, $expire);
<a name="l00216"></a>00216     }
<a name="l00217"></a>00217   }
<a name="l00218"></a>00218 }
<a name="l00219"></a>00219 
<a name="l00235"></a><a class="code" href="path_8inc_a889ab7f9eebf37ac353abc264a290131.html#a889ab7f9eebf37ac353abc264a290131">00235</a> <span class="keyword">function</span> <a class="code" href="path_8inc_a889ab7f9eebf37ac353abc264a290131.html#a889ab7f9eebf37ac353abc264a290131" title="Given an internal Drupal path, return the alias set by the administrator.">drupal_get_path_alias</a>($path = NULL, $path_language = NULL) {
<a name="l00236"></a>00236   <span class="comment">// If no path is specified, use the current page&#39;s path.</span>
<a name="l00237"></a>00237   <span class="keywordflow">if</span> ($path == NULL) {
<a name="l00238"></a>00238     $path = $_GET[<span class="charliteral">&#39;q&#39;</span>];
<a name="l00239"></a>00239   }
<a name="l00240"></a>00240   $result = $path;
<a name="l00241"></a>00241   <span class="keywordflow">if</span> ($alias = <a class="code" href="path_8inc_a3c1a94088895986eedd4358367355e33.html#a3c1a94088895986eedd4358367355e33" title="Given an alias, return its Drupal system URL if one exists.">drupal_lookup_path</a>(<span class="stringliteral">&#39;alias&#39;</span>, $path, $path_language)) {
<a name="l00242"></a>00242     $result = $alias;
<a name="l00243"></a>00243   }
<a name="l00244"></a>00244   <span class="keywordflow">return</span> $result;
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 
<a name="l00259"></a><a class="code" href="path_8inc_a59781811cbcdef4c64ccd1d55e1ae9f8.html#a59781811cbcdef4c64ccd1d55e1ae9f8">00259</a> <span class="keyword">function</span> <a class="code" href="path_8inc_a59781811cbcdef4c64ccd1d55e1ae9f8.html#a59781811cbcdef4c64ccd1d55e1ae9f8" title="Given a path alias, return the internal path it represents.">drupal_get_normal_path</a>($path, $path_language = NULL) {
<a name="l00260"></a>00260   $original_path = $path;
<a name="l00261"></a>00261 
<a name="l00262"></a>00262   <span class="comment">// Lookup the path alias first.</span>
<a name="l00263"></a>00263   <span class="keywordflow">if</span> ($source = <a class="code" href="path_8inc_a3c1a94088895986eedd4358367355e33.html#a3c1a94088895986eedd4358367355e33" title="Given an alias, return its Drupal system URL if one exists.">drupal_lookup_path</a>(<span class="stringliteral">&#39;source&#39;</span>, $path, $path_language)) {
<a name="l00264"></a>00264     $path = $source;
<a name="l00265"></a>00265   }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267   <span class="comment">// Allow other modules to alter the inbound URL. We cannot use drupal_alter()</span>
<a name="l00268"></a>00268   <span class="comment">// here because we need to run hook_url_inbound_alter() in the reverse order</span>
<a name="l00269"></a>00269   <span class="comment">// of hook_url_outbound_alter().</span>
<a name="l00270"></a>00270   <span class="keywordflow">foreach</span> (array_reverse(<a class="code" href="group__hooks_ga9191200072f2a641829e9d3c2759561f.html#ga9191200072f2a641829e9d3c2759561f" title="Determine which modules are implementing a hook.">module_implements</a>(<span class="stringliteral">&#39;url_inbound_alter&#39;</span>)) as $module) {
<a name="l00271"></a>00271     $function = $module . <span class="stringliteral">&#39;_url_inbound_alter&#39;</span>;
<a name="l00272"></a>00272     $function($path, $original_path, $path_language);
<a name="l00273"></a>00273   }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275   <span class="keywordflow">return</span> $path;
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00284"></a><a class="code" href="path_8inc_a657eb4770879ad6f0dc19bfad2cd4a6d.html#a657eb4770879ad6f0dc19bfad2cd4a6d">00284</a> <span class="keyword">function</span> <a class="code" href="path_8inc_a657eb4770879ad6f0dc19bfad2cd4a6d.html#a657eb4770879ad6f0dc19bfad2cd4a6d" title="Check if the current page is the front page.">drupal_is_front_page</a>() {
<a name="l00285"></a>00285   <span class="comment">// Use the advanced drupal_static() pattern, since this is called very often.</span>
<a name="l00286"></a>00286   <span class="keyword">static</span> $drupal_static_fast;
<a name="l00287"></a>00287   <span class="keywordflow">if</span> (!isset($drupal_static_fast)) {
<a name="l00288"></a>00288     $drupal_static_fast[<span class="stringliteral">&#39;is_front_page&#39;</span>] = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__);
<a name="l00289"></a>00289   }
<a name="l00290"></a>00290   $is_front_page = &amp;$drupal_static_fast[<span class="stringliteral">&#39;is_front_page&#39;</span>];
<a name="l00291"></a>00291 
<a name="l00292"></a>00292   <span class="keywordflow">if</span> (!isset($is_front_page)) {
<a name="l00293"></a>00293     <span class="comment">// As drupal_path_initialize updates $_GET[&#39;q&#39;] with the &#39;site_frontpage&#39; path,</span>
<a name="l00294"></a>00294     <span class="comment">// we can check it against the &#39;site_frontpage&#39; variable.</span>
<a name="l00295"></a>00295     $is_front_page = ($_GET[<span class="charliteral">&#39;q&#39;</span>] == <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;site_frontpage&#39;</span>, <span class="stringliteral">&#39;node&#39;</span>));
<a name="l00296"></a>00296   }
<a name="l00297"></a>00297 
<a name="l00298"></a>00298   <span class="keywordflow">return</span> $is_front_page;
<a name="l00299"></a>00299 }
<a name="l00300"></a>00300 
<a name="l00312"></a><a class="code" href="path_8inc_a1299e390360982cc8fbebe06f0232e18.html#a1299e390360982cc8fbebe06f0232e18">00312</a> <span class="keyword">function</span> <a class="code" href="path_8inc_a1299e390360982cc8fbebe06f0232e18.html#a1299e390360982cc8fbebe06f0232e18" title="Check if a path matches any pattern in a set of patterns.">drupal_match_path</a>($path, $patterns) {
<a name="l00313"></a>00313   $regexps = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__);
<a name="l00314"></a>00314 
<a name="l00315"></a>00315   <span class="keywordflow">if</span> (!isset($regexps[$patterns])) {
<a name="l00316"></a>00316     <span class="comment">// Convert path settings to a regular expression.</span>
<a name="l00317"></a>00317     <span class="comment">// Therefore replace newlines with a logical or, /* with asterisks and the &lt;front&gt; with the frontpage.</span>
<a name="l00318"></a>00318     $to_replace = array(
<a name="l00319"></a>00319       <span class="stringliteral">&#39;/(\r\n?|\n)/&#39;</span>, <span class="comment">// newlines</span>
<a name="l00320"></a>00320       <span class="stringliteral">&#39;/\\\\\*/&#39;</span>,     <span class="comment">// asterisks</span>
<a name="l00321"></a>00321       <span class="stringliteral">&#39;/(^|\|)\\\\&lt;front\\\\&gt;($|\|)/&#39;</span> <span class="comment">// &lt;front&gt;</span>
<a name="l00322"></a>00322     );
<a name="l00323"></a>00323     $replacements = array(
<a name="l00324"></a>00324       <span class="charliteral">&#39;|&#39;</span>,
<a name="l00325"></a>00325       <span class="stringliteral">&#39;.*&#39;</span>,
<a name="l00326"></a>00326       <span class="charliteral">&#39;\1&#39;</span> . preg_quote(<a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;site_frontpage&#39;</span>, <span class="stringliteral">&#39;node&#39;</span>), <span class="charliteral">&#39;/&#39;</span>) . <span class="charliteral">&#39;\2&#39;</span>
<a name="l00327"></a>00327     );
<a name="l00328"></a>00328     $patterns_quoted = preg_quote($patterns, <span class="charliteral">&#39;/&#39;</span>);
<a name="l00329"></a>00329     $regexps[$patterns] = <span class="stringliteral">&#39;/^(&#39;</span> . preg_replace($to_replace, $replacements, $patterns_quoted) . <span class="stringliteral">&#39;)$/&#39;</span>;
<a name="l00330"></a>00330   }
<a name="l00331"></a>00331   <span class="keywordflow">return</span> (<span class="keywordtype">bool</span>)preg_match($regexps[$patterns], $path);
<a name="l00332"></a>00332 }
<a name="l00333"></a>00333 
<a name="l00354"></a><a class="code" href="path_8inc_a97aaa03027cbf6f0ffdd9a4bf5c9a31c.html#a97aaa03027cbf6f0ffdd9a4bf5c9a31c">00354</a> <span class="keyword">function</span> <a class="code" href="path_8inc_a97aaa03027cbf6f0ffdd9a4bf5c9a31c.html#a97aaa03027cbf6f0ffdd9a4bf5c9a31c" title="Return the current URL path of the page being viewed.">current_path</a>() {
<a name="l00355"></a>00355   <span class="keywordflow">return</span> $_GET[<span class="charliteral">&#39;q&#39;</span>];
<a name="l00356"></a>00356 }
<a name="l00357"></a>00357 
<a name="l00367"></a><a class="code" href="path_8inc_a98ce949c6766328b89a2b98f31359b14.html#a98ce949c6766328b89a2b98f31359b14">00367</a> <span class="keyword">function</span> <a class="code" href="path_8inc_a98ce949c6766328b89a2b98f31359b14.html#a98ce949c6766328b89a2b98f31359b14" title="Rebuild the path alias white list.">drupal_path_alias_whitelist_rebuild</a>($source = NULL) {
<a name="l00368"></a>00368   <span class="comment">// When paths are inserted, only rebuild the whitelist if the system path</span>
<a name="l00369"></a>00369   <span class="comment">// has a top level component which is not already in the whitelist.</span>
<a name="l00370"></a>00370   <span class="keywordflow">if</span> (!empty($source)) {
<a name="l00371"></a>00371     $whitelist = <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;path_alias_whitelist&#39;</span>, NULL);
<a name="l00372"></a>00372     <span class="keywordflow">if</span> (isset($whitelist[strtok($source, <span class="charliteral">&#39;/&#39;</span>)])) {
<a name="l00373"></a>00373       <span class="keywordflow">return</span> $whitelist;
<a name="l00374"></a>00374     }
<a name="l00375"></a>00375   }
<a name="l00376"></a>00376   <span class="comment">// For each alias in the database, get the top level component of the system</span>
<a name="l00377"></a>00377   <span class="comment">// path it corresponds to. This is the portion of the path before the first</span>
<a name="l00378"></a>00378   <span class="comment">// &#39;/&#39;, if present, otherwise the whole path itself.</span>
<a name="l00379"></a>00379   $whitelist = array();
<a name="l00380"></a>00380   $result = <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&quot;SELECT DISTINCT SUBSTRING_INDEX(source, &#39;/&#39;, 1) AS path FROM {url_alias}&quot;</span>);
<a name="l00381"></a>00381   <span class="keywordflow">foreach</span> ($result as $row) {
<a name="l00382"></a>00382     $whitelist[$row-&gt;path] = TRUE;
<a name="l00383"></a>00383   }
<a name="l00384"></a>00384   <a class="code" href="bootstrap_8inc_a9859faa6fcd56ca6048be93dace95999.html#a9859faa6fcd56ca6048be93dace95999" title="Sets a persistent variable.">variable_set</a>(<span class="stringliteral">&#39;path_alias_whitelist&#39;</span>, $whitelist);
<a name="l00385"></a>00385   <span class="keywordflow">return</span> $whitelist;
<a name="l00386"></a>00386 }
<a name="l00387"></a>00387 
<a name="l00403"></a><a class="code" href="path_8inc_ac1be3b94cdca2d9b6e9a9e78043500f2.html#ac1be3b94cdca2d9b6e9a9e78043500f2">00403</a> <span class="keyword">function</span> <a class="code" href="path_8inc_ac1be3b94cdca2d9b6e9a9e78043500f2.html#ac1be3b94cdca2d9b6e9a9e78043500f2" title="Fetch a specific URL alias from the database.">path_load</a>($conditions) {
<a name="l00404"></a>00404   <span class="keywordflow">if</span> (is_numeric($conditions)) {
<a name="l00405"></a>00405     $conditions = array(<span class="stringliteral">&#39;pid&#39;</span> =&gt; $conditions);
<a name="l00406"></a>00406   }
<a name="l00407"></a>00407   elseif (is_string($conditions)) {
<a name="l00408"></a>00408     $conditions = array(<span class="stringliteral">&#39;source&#39;</span> =&gt; $conditions);
<a name="l00409"></a>00409   }
<a name="l00410"></a>00410   elseif (!is_array($conditions)) {
<a name="l00411"></a>00411     <span class="keywordflow">return</span> FALSE;
<a name="l00412"></a>00412   }
<a name="l00413"></a>00413   $select = <a class="code" href="group__database_ga9e030cee657d64e3d8e524c65814cc9f.html#ga9e030cee657d64e3d8e524c65814cc9f" title="Returns a new SelectQuery object for the active database.">db_select</a>(<span class="stringliteral">&#39;url_alias&#39;</span>);
<a name="l00414"></a>00414   <span class="keywordflow">foreach</span> ($conditions as $field =&gt; $value) {
<a name="l00415"></a>00415     $select-&gt;condition($field, $value);
<a name="l00416"></a>00416   }
<a name="l00417"></a>00417   <span class="keywordflow">return</span> $select
<a name="l00418"></a>00418     -&gt;fields(<span class="stringliteral">&#39;url_alias&#39;</span>)
<a name="l00419"></a>00419     -&gt;execute()
<a name="l00420"></a>00420     -&gt;fetchAssoc();
<a name="l00421"></a>00421 }
<a name="l00422"></a>00422 
<a name="l00433"></a><a class="code" href="path_8inc_a2560e9e01e6d4f6b38c4e55c39715e25.html#a2560e9e01e6d4f6b38c4e55c39715e25">00433</a> <span class="keyword">function</span> <a class="code" href="path_8inc_a2560e9e01e6d4f6b38c4e55c39715e25.html#a2560e9e01e6d4f6b38c4e55c39715e25" title="Save a path alias to the database.">path_save</a>(&amp;$path) {
<a name="l00434"></a>00434   $path += array(<span class="stringliteral">&#39;language&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a9e91e2136aa0ce5c5e80f06aa3ad8266.html#a9e91e2136aa0ce5c5e80f06aa3ad8266" title="The language code used when no language is explicitly assigned.">LANGUAGE_NONE</a>);
<a name="l00435"></a>00435 
<a name="l00436"></a>00436   <span class="comment">// Load the stored alias, if any.</span>
<a name="l00437"></a>00437   <span class="keywordflow">if</span> (!empty($path[<span class="stringliteral">&#39;pid&#39;</span>]) &amp;&amp; !isset($path[<span class="stringliteral">&#39;original&#39;</span>])) {
<a name="l00438"></a>00438     $path[<span class="stringliteral">&#39;original&#39;</span>] = <a class="code" href="path_8inc_ac1be3b94cdca2d9b6e9a9e78043500f2.html#ac1be3b94cdca2d9b6e9a9e78043500f2" title="Fetch a specific URL alias from the database.">path_load</a>($path[<span class="stringliteral">&#39;pid&#39;</span>]);
<a name="l00439"></a>00439   }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441   <span class="keywordflow">if</span> (empty($path[<span class="stringliteral">&#39;pid&#39;</span>])) {
<a name="l00442"></a>00442     <a class="code" href="group__schemaapi_ga96f707de751a962bf21b6cb0cb4f2ae6.html#ga96f707de751a962bf21b6cb0cb4f2ae6" title="Saves (inserts or updates) a record to the database based upon the schema.">drupal_write_record</a>(<span class="stringliteral">&#39;url_alias&#39;</span>, $path);
<a name="l00443"></a>00443     <a class="code" href="group__hooks_gabedb5f566ef5faaa5768dd15125b111c.html#gabedb5f566ef5faaa5768dd15125b111c" title="Invoke a hook in all enabled modules that implement it.">module_invoke_all</a>(<span class="stringliteral">&#39;path_insert&#39;</span>, $path);
<a name="l00444"></a>00444   }
<a name="l00445"></a>00445   <span class="keywordflow">else</span> {
<a name="l00446"></a>00446     <a class="code" href="group__schemaapi_ga96f707de751a962bf21b6cb0cb4f2ae6.html#ga96f707de751a962bf21b6cb0cb4f2ae6" title="Saves (inserts or updates) a record to the database based upon the schema.">drupal_write_record</a>(<span class="stringliteral">&#39;url_alias&#39;</span>, $path, array(<span class="stringliteral">&#39;pid&#39;</span>));
<a name="l00447"></a>00447     <a class="code" href="group__hooks_gabedb5f566ef5faaa5768dd15125b111c.html#gabedb5f566ef5faaa5768dd15125b111c" title="Invoke a hook in all enabled modules that implement it.">module_invoke_all</a>(<span class="stringliteral">&#39;path_update&#39;</span>, $path);
<a name="l00448"></a>00448   }
<a name="l00449"></a>00449 
<a name="l00450"></a>00450   <span class="comment">// Clear internal properties.</span>
<a name="l00451"></a>00451   unset($path[<span class="stringliteral">&#39;original&#39;</span>]);
<a name="l00452"></a>00452 
<a name="l00453"></a>00453   <span class="comment">// Clear the static alias cache.</span>
<a name="l00454"></a>00454   <a class="code" href="path_8inc_ac2787f2b1d751f7c77e7ef3db2ff11e1.html#ac2787f2b1d751f7c77e7ef3db2ff11e1" title="Clear the path cache.">drupal_clear_path_cache</a>($path[<span class="stringliteral">&#39;source&#39;</span>]);
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 
<a name="l00463"></a><a class="code" href="path_8inc_adbe589627a12c7be338700a1df1bc357.html#adbe589627a12c7be338700a1df1bc357">00463</a> <span class="keyword">function</span> <a class="code" href="path_8inc_adbe589627a12c7be338700a1df1bc357.html#adbe589627a12c7be338700a1df1bc357" title="Delete a URL alias.">path_delete</a>($criteria) {
<a name="l00464"></a>00464   <span class="keywordflow">if</span> (!is_array($criteria)) {
<a name="l00465"></a>00465     $criteria = array(<span class="stringliteral">&#39;pid&#39;</span> =&gt; $criteria);
<a name="l00466"></a>00466   }
<a name="l00467"></a>00467   $path = <a class="code" href="path_8inc_ac1be3b94cdca2d9b6e9a9e78043500f2.html#ac1be3b94cdca2d9b6e9a9e78043500f2" title="Fetch a specific URL alias from the database.">path_load</a>($criteria);
<a name="l00468"></a>00468   $query = <a class="code" href="group__database_ga72f0ccecc0ba181de16c6e3451150f2c.html#ga72f0ccecc0ba181de16c6e3451150f2c" title="Returns a new DeleteQuery object for the active database.">db_delete</a>(<span class="stringliteral">&#39;url_alias&#39;</span>);
<a name="l00469"></a>00469   <span class="keywordflow">foreach</span> ($criteria as $field =&gt; $value) {
<a name="l00470"></a>00470     $query-&gt;condition($field, $value);
<a name="l00471"></a>00471   }
<a name="l00472"></a>00472   $query-&gt;execute();
<a name="l00473"></a>00473   <a class="code" href="group__hooks_gabedb5f566ef5faaa5768dd15125b111c.html#gabedb5f566ef5faaa5768dd15125b111c" title="Invoke a hook in all enabled modules that implement it.">module_invoke_all</a>(<span class="stringliteral">&#39;path_delete&#39;</span>, $path);
<a name="l00474"></a>00474   <a class="code" href="path_8inc_ac2787f2b1d751f7c77e7ef3db2ff11e1.html#ac2787f2b1d751f7c77e7ef3db2ff11e1" title="Clear the path cache.">drupal_clear_path_cache</a>($path[<span class="stringliteral">&#39;source&#39;</span>]);
<a name="l00475"></a>00475 }
<a name="l00476"></a>00476 
<a name="l00495"></a><a class="code" href="path_8inc_abf34fb440d7de9c9e8dfa0ec1a2ac72d.html#abf34fb440d7de9c9e8dfa0ec1a2ac72d">00495</a> <span class="keyword">function</span> <a class="code" href="path_8inc_abf34fb440d7de9c9e8dfa0ec1a2ac72d.html#abf34fb440d7de9c9e8dfa0ec1a2ac72d" title="Determine whether a path is in the administrative section of the site.">path_is_admin</a>($path) {
<a name="l00496"></a>00496   $path_map = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__);
<a name="l00497"></a>00497   <span class="keywordflow">if</span> (!isset($path_map[<span class="stringliteral">&#39;admin&#39;</span>][$path])) {
<a name="l00498"></a>00498     $patterns = <a class="code" href="path_8inc_acc77f0daab31d02be34e83a61ad3991c.html#acc77f0daab31d02be34e83a61ad3991c" title="Get a list of administrative and non-administrative paths.">path_get_admin_paths</a>();
<a name="l00499"></a>00499     $path_map[<span class="stringliteral">&#39;admin&#39;</span>][$path] = <a class="code" href="path_8inc_a1299e390360982cc8fbebe06f0232e18.html#a1299e390360982cc8fbebe06f0232e18" title="Check if a path matches any pattern in a set of patterns.">drupal_match_path</a>($path, $patterns[<span class="stringliteral">&#39;admin&#39;</span>]);
<a name="l00500"></a>00500     $path_map[<span class="stringliteral">&#39;non_admin&#39;</span>][$path] = <a class="code" href="path_8inc_a1299e390360982cc8fbebe06f0232e18.html#a1299e390360982cc8fbebe06f0232e18" title="Check if a path matches any pattern in a set of patterns.">drupal_match_path</a>($path, $patterns[<span class="stringliteral">&#39;non_admin&#39;</span>]);
<a name="l00501"></a>00501   }
<a name="l00502"></a>00502   <span class="keywordflow">return</span> $path_map[<span class="stringliteral">&#39;admin&#39;</span>][$path] &amp;&amp; !$path_map[<span class="stringliteral">&#39;non_admin&#39;</span>][$path];
<a name="l00503"></a>00503 }
<a name="l00504"></a>00504 
<a name="l00517"></a><a class="code" href="path_8inc_acc77f0daab31d02be34e83a61ad3991c.html#acc77f0daab31d02be34e83a61ad3991c">00517</a> <span class="keyword">function</span> <a class="code" href="path_8inc_acc77f0daab31d02be34e83a61ad3991c.html#acc77f0daab31d02be34e83a61ad3991c" title="Get a list of administrative and non-administrative paths.">path_get_admin_paths</a>() {
<a name="l00518"></a>00518   $patterns = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__);
<a name="l00519"></a>00519   <span class="keywordflow">if</span> (!isset($patterns)) {
<a name="l00520"></a>00520     $paths = <a class="code" href="group__hooks_gabedb5f566ef5faaa5768dd15125b111c.html#gabedb5f566ef5faaa5768dd15125b111c" title="Invoke a hook in all enabled modules that implement it.">module_invoke_all</a>(<span class="stringliteral">&#39;admin_paths&#39;</span>);
<a name="l00521"></a>00521     <a class="code" href="module_8inc_a9badfa1d68b90764aa160aee0e58b4ef.html#a9badfa1d68b90764aa160aee0e58b4ef" title="Hands off alterable variables to type-specific *_alter implementations.">drupal_alter</a>(<span class="stringliteral">&#39;admin_paths&#39;</span>, $paths);
<a name="l00522"></a>00522     <span class="comment">// Combine all admin paths into one array, and likewise for non-admin paths,</span>
<a name="l00523"></a>00523     <span class="comment">// for easier handling.</span>
<a name="l00524"></a>00524     $patterns = array();
<a name="l00525"></a>00525     $patterns[<span class="stringliteral">&#39;admin&#39;</span>] = array();
<a name="l00526"></a>00526     $patterns[<span class="stringliteral">&#39;non_admin&#39;</span>] = array();
<a name="l00527"></a>00527     <span class="keywordflow">foreach</span> ($paths as $path =&gt; $enabled) {
<a name="l00528"></a>00528       <span class="keywordflow">if</span> ($enabled) {
<a name="l00529"></a>00529         $patterns[<span class="stringliteral">&#39;admin&#39;</span>][] = $path;
<a name="l00530"></a>00530       }
<a name="l00531"></a>00531       <span class="keywordflow">else</span> {
<a name="l00532"></a>00532         $patterns[<span class="stringliteral">&#39;non_admin&#39;</span>][] = $path;
<a name="l00533"></a>00533       }
<a name="l00534"></a>00534     }
<a name="l00535"></a>00535     $patterns[<span class="stringliteral">&#39;admin&#39;</span>] = implode(<span class="stringliteral">&quot;\n&quot;</span>, $patterns[<span class="stringliteral">&#39;admin&#39;</span>]);
<a name="l00536"></a>00536     $patterns[<span class="stringliteral">&#39;non_admin&#39;</span>] = implode(<span class="stringliteral">&quot;\n&quot;</span>, $patterns[<span class="stringliteral">&#39;non_admin&#39;</span>]);
<a name="l00537"></a>00537   }
<a name="l00538"></a>00538   <span class="keywordflow">return</span> $patterns;
<a name="l00539"></a>00539 }
<a name="l00540"></a>00540 
<a name="l00553"></a><a class="code" href="path_8inc_a43d22f8b0e8644306276b7707378a33a.html#a43d22f8b0e8644306276b7707378a33a">00553</a> <span class="keyword">function</span> <a class="code" href="path_8inc_a43d22f8b0e8644306276b7707378a33a.html#a43d22f8b0e8644306276b7707378a33a" title="Checks a path exists and the current user has access to it.">drupal_valid_path</a>($path, $dynamic_allowed = FALSE) {
<a name="l00554"></a>00554   global $menu_admin;
<a name="l00555"></a>00555   <span class="comment">// We indicate that a menu administrator is running the menu access check.</span>
<a name="l00556"></a>00556   $menu_admin = TRUE;
<a name="l00557"></a>00557   <span class="keywordflow">if</span> ($path == <span class="stringliteral">&#39;&lt;front&gt;&#39;</span> || <a class="code" href="common_8inc_a64a2003ba42a719fc38a046a3507ad56.html#a64a2003ba42a719fc38a046a3507ad56" title="Returns TRUE if a path is external to Drupal (e.g.">url_is_external</a>($path)) {
<a name="l00558"></a>00558     $item = array(<span class="stringliteral">&#39;access&#39;</span> =&gt; TRUE);
<a name="l00559"></a>00559   }
<a name="l00560"></a>00560   elseif ($dynamic_allowed &amp;&amp; preg_match(<span class="stringliteral">&#39;/\/\%/&#39;</span>, $path)) {
<a name="l00561"></a>00561     <span class="comment">// Path is dynamic (ie &#39;user/%&#39;), so check directly against menu_router table.</span>
<a name="l00562"></a>00562     <span class="keywordflow">if</span> ($item = <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&quot;SELECT * FROM {menu_router} where path = :path&quot;</span>, array(<span class="stringliteral">&#39;:path&#39;</span> =&gt; $path))-&gt;fetchAssoc()) {
<a name="l00563"></a>00563       $item[<span class="stringliteral">&#39;link_path&#39;</span>]  = $form_item[<span class="stringliteral">&#39;link_path&#39;</span>];
<a name="l00564"></a>00564       $item[<span class="stringliteral">&#39;link_title&#39;</span>] = $form_item[<span class="stringliteral">&#39;link_title&#39;</span>];
<a name="l00565"></a>00565       $item[<span class="stringliteral">&#39;external&#39;</span>]   = FALSE;
<a name="l00566"></a>00566       $item[<span class="stringliteral">&#39;options&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00567"></a>00567       <a class="code" href="group__menu_ga75bf09f752589011fc9256b041cf7cc0.html#ga75bf09f752589011fc9256b041cf7cc0" title="This function is similar to _menu_translate() but does link-specific preparation such as always calli...">_menu_link_translate</a>($item);
<a name="l00568"></a>00568     }
<a name="l00569"></a>00569   }
<a name="l00570"></a>00570   <span class="keywordflow">else</span> {
<a name="l00571"></a>00571     $item = <a class="code" href="group__menu_ga855b1ca6ef9e44eb6107a2b9d0f581df.html#ga855b1ca6ef9e44eb6107a2b9d0f581df" title="Get a router item.">menu_get_item</a>($path);
<a name="l00572"></a>00572   }
<a name="l00573"></a>00573   $menu_admin = FALSE;
<a name="l00574"></a>00574   <span class="keywordflow">return</span> $item &amp;&amp; $item[<span class="stringliteral">&#39;access&#39;</span>];
<a name="l00575"></a>00575 }
<a name="l00576"></a>00576 
<a name="l00583"></a><a class="code" href="path_8inc_ac2787f2b1d751f7c77e7ef3db2ff11e1.html#ac2787f2b1d751f7c77e7ef3db2ff11e1">00583</a> <span class="keyword">function</span> <a class="code" href="path_8inc_ac2787f2b1d751f7c77e7ef3db2ff11e1.html#ac2787f2b1d751f7c77e7ef3db2ff11e1" title="Clear the path cache.">drupal_clear_path_cache</a>($source = NULL) {
<a name="l00584"></a>00584   <span class="comment">// Clear the drupal_lookup_path() static cache.</span>
<a name="l00585"></a>00585   <a class="code" href="group__schemaapi_ga714b5ed0b14c43b61eef0c895598c5c4.html#ga714b5ed0b14c43b61eef0c895598c5c4" title="Resets one or all centrally stored static variable(s).">drupal_static_reset</a>(<span class="stringliteral">&#39;drupal_lookup_path&#39;</span>);
<a name="l00586"></a>00586   <a class="code" href="path_8inc_a98ce949c6766328b89a2b98f31359b14.html#a98ce949c6766328b89a2b98f31359b14" title="Rebuild the path alias white list.">drupal_path_alias_whitelist_rebuild</a>($source);
<a name="l00587"></a>00587 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 22 2012 16:46:14 for Shopcart by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
