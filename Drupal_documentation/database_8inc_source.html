<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Shopcart: includes/database/database.inc Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Shopcart
   &#160;<span id="projectnumber">version2.0</span>
   </div>
   <div id="projectbrief">Shoppingcart</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_5b89693129504707d608c5412e7b88d4.html">includes</a>      </li>
      <li class="navelem"><a class="el" href="dir_ef0f8d4c5d0deb89b62e2aae86c9d2d2.html">database</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">database.inc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="database_8inc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00184"></a><a class="code" href="classDatabaseConnection.html">00184</a> <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="classDatabaseConnection.html" title="Base Database API class.">DatabaseConnection</a> <span class="keyword">extends</span> PDO {
<a name="l00185"></a>00185 
<a name="l00193"></a><a class="code" href="classDatabaseConnection_a9437bea57a47a6de0eef12b150fa253b.html#a9437bea57a47a6de0eef12b150fa253b">00193</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseConnection_a9437bea57a47a6de0eef12b150fa253b.html#a9437bea57a47a6de0eef12b150fa253b">$target</a> = NULL;
<a name="l00194"></a>00194 
<a name="l00204"></a><a class="code" href="classDatabaseConnection_a8e817a1024b6ecf5800dd6ad8b50a66d.html#a8e817a1024b6ecf5800dd6ad8b50a66d">00204</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseConnection_a8e817a1024b6ecf5800dd6ad8b50a66d.html#a8e817a1024b6ecf5800dd6ad8b50a66d">$key</a> = NULL;
<a name="l00205"></a>00205 
<a name="l00211"></a><a class="code" href="classDatabaseConnection_ad386591ee31049001e12539bca4e7fd8.html#ad386591ee31049001e12539bca4e7fd8">00211</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseConnection_ad386591ee31049001e12539bca4e7fd8.html#ad386591ee31049001e12539bca4e7fd8">$logger</a> = NULL;
<a name="l00212"></a>00212 
<a name="l00222"></a><a class="code" href="classDatabaseConnection_a7d2925e0d79e26cac1f63fdcaead83ff.html#a7d2925e0d79e26cac1f63fdcaead83ff">00222</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseConnection_a7d2925e0d79e26cac1f63fdcaead83ff.html#a7d2925e0d79e26cac1f63fdcaead83ff">$transactionLayers</a> = array();
<a name="l00223"></a>00223 
<a name="l00229"></a><a class="code" href="classDatabaseConnection_a21303107c83b6ac9e820cc03333ae8d5.html#a21303107c83b6ac9e820cc03333ae8d5">00229</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseConnection_a21303107c83b6ac9e820cc03333ae8d5.html#a21303107c83b6ac9e820cc03333ae8d5">$driverClasses</a> = array();
<a name="l00230"></a>00230 
<a name="l00236"></a><a class="code" href="classDatabaseConnection_a68f32d2857e06a7f07d5710de1c364b3.html#a68f32d2857e06a7f07d5710de1c364b3">00236</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseConnection_a68f32d2857e06a7f07d5710de1c364b3.html#a68f32d2857e06a7f07d5710de1c364b3">$statementClass</a> = <span class="stringliteral">&#39;DatabaseStatementBase&#39;</span>;
<a name="l00237"></a>00237 
<a name="l00243"></a><a class="code" href="classDatabaseConnection_a18cbb0b94d08d514c16bc676a5b15e8b.html#a18cbb0b94d08d514c16bc676a5b15e8b">00243</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseConnection_a18cbb0b94d08d514c16bc676a5b15e8b.html#a18cbb0b94d08d514c16bc676a5b15e8b">$transactionSupport</a> = TRUE;
<a name="l00244"></a>00244 
<a name="l00252"></a><a class="code" href="classDatabaseConnection_a96f82258fd4a0da57bfa1b030089c5ef.html#a96f82258fd4a0da57bfa1b030089c5ef">00252</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseConnection_a96f82258fd4a0da57bfa1b030089c5ef.html#a96f82258fd4a0da57bfa1b030089c5ef">$transactionalDDLSupport</a> = FALSE;
<a name="l00253"></a>00253 
<a name="l00259"></a><a class="code" href="classDatabaseConnection_ad8376cd6d63a46cf77e4f62a8780a4fb.html#ad8376cd6d63a46cf77e4f62a8780a4fb">00259</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseConnection_ad8376cd6d63a46cf77e4f62a8780a4fb.html#ad8376cd6d63a46cf77e4f62a8780a4fb">$temporaryNameIndex</a> = 0;
<a name="l00260"></a>00260 
<a name="l00266"></a><a class="code" href="classDatabaseConnection_adbd61bca7e83c54ec580801d1bca8b08.html#adbd61bca7e83c54ec580801d1bca8b08">00266</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseConnection_adbd61bca7e83c54ec580801d1bca8b08.html#adbd61bca7e83c54ec580801d1bca8b08">$connectionOptions</a> = array();
<a name="l00267"></a>00267 
<a name="l00273"></a><a class="code" href="classDatabaseConnection_ac51730013a465c8bd81db699b0a1bd59.html#ac51730013a465c8bd81db699b0a1bd59">00273</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseConnection_ac51730013a465c8bd81db699b0a1bd59.html#ac51730013a465c8bd81db699b0a1bd59">$schema</a> = NULL;
<a name="l00274"></a>00274 
<a name="l00280"></a><a class="code" href="classDatabaseConnection_a1a56735cc64b105ad7c8ee0c6ef4a7e1.html#a1a56735cc64b105ad7c8ee0c6ef4a7e1">00280</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseConnection_a1a56735cc64b105ad7c8ee0c6ef4a7e1.html#a1a56735cc64b105ad7c8ee0c6ef4a7e1">$prefixes</a> = array();
<a name="l00281"></a>00281 
<a name="l00287"></a><a class="code" href="classDatabaseConnection_aa18b2ac131d2556fa20705016158f2e2.html#aa18b2ac131d2556fa20705016158f2e2">00287</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseConnection_aa18b2ac131d2556fa20705016158f2e2.html#aa18b2ac131d2556fa20705016158f2e2">$prefixSearch</a> = array();
<a name="l00288"></a>00288 
<a name="l00294"></a><a class="code" href="classDatabaseConnection_a456ff1dc845f1803e0d6840f3ad50b7e.html#a456ff1dc845f1803e0d6840f3ad50b7e">00294</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseConnection_a456ff1dc845f1803e0d6840f3ad50b7e.html#a456ff1dc845f1803e0d6840f3ad50b7e">$prefixReplace</a> = array();
<a name="l00295"></a>00295 
<a name="l00296"></a><a class="code" href="classDatabaseConnection_ae5f21c56713948d849ff40bc97b53cd9.html#ae5f21c56713948d849ff40bc97b53cd9">00296</a>   <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_ae5f21c56713948d849ff40bc97b53cd9.html#ae5f21c56713948d849ff40bc97b53cd9">__construct</a>($dsn, $username, $password, $driver_options = array()) {
<a name="l00297"></a>00297     <span class="comment">// Initialize and prepare the connection prefix.</span>
<a name="l00298"></a>00298     $this-&gt;<a class="code" href="classDatabaseConnection_a8df68d814aa91a31f57990575d8349b6.html#a8df68d814aa91a31f57990575d8349b6" title="Set the list of prefixes used by this database connection.">setPrefix</a>(isset($this-&gt;connectionOptions[<span class="stringliteral">&#39;prefix&#39;</span>]) ? $this-&gt;connectionOptions[<span class="stringliteral">&#39;prefix&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="comment">// Because the other methods don&#39;t seem to work right.</span>
<a name="l00301"></a>00301     $driver_options[PDO::ATTR_ERRMODE] = PDO::ERRMODE_EXCEPTION;
<a name="l00302"></a>00302 
<a name="l00303"></a>00303     <span class="comment">// Call PDO::__construct and PDO::setAttribute.</span>
<a name="l00304"></a>00304     <a class="code" href="classDatabaseConnection_ae5f21c56713948d849ff40bc97b53cd9.html#ae5f21c56713948d849ff40bc97b53cd9">parent::__construct</a>($dsn, $username, $password, $driver_options);
<a name="l00305"></a>00305 
<a name="l00306"></a>00306     <span class="comment">// Set a specific PDOStatement class if the driver requires that.</span>
<a name="l00307"></a>00307     <span class="keywordflow">if</span> (!empty($this-&gt;statementClass)) {
<a name="l00308"></a>00308       $this-&gt;setAttribute(PDO::ATTR_STATEMENT_CLASS, array($this-&gt;statementClass, array($this)));
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310   }
<a name="l00311"></a>00311 
<a name="l00357"></a><a class="code" href="classDatabaseConnection_a190539d6c494ef2d7ac90d21226de5a5.html#a190539d6c494ef2d7ac90d21226de5a5">00357</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a190539d6c494ef2d7ac90d21226de5a5.html#a190539d6c494ef2d7ac90d21226de5a5" title="Returns the default query options for any given query.">defaultOptions</a>() {
<a name="l00358"></a>00358     <span class="keywordflow">return</span> array(
<a name="l00359"></a>00359       <span class="stringliteral">&#39;target&#39;</span> =&gt; <span class="stringliteral">&#39;default&#39;</span>,
<a name="l00360"></a>00360       <span class="stringliteral">&#39;fetch&#39;</span> =&gt; PDO::FETCH_OBJ,
<a name="l00361"></a>00361       <span class="stringliteral">&#39;return&#39;</span> =&gt; <a class="code" href="classDatabase_a7b7c6f8f81159b97752412e439d957dc.html#a7b7c6f8f81159b97752412e439d957dc" title="Flag to indicate a query call should return the prepared statement.">Database::RETURN_STATEMENT</a>,
<a name="l00362"></a>00362       <span class="stringliteral">&#39;throw_exception&#39;</span> =&gt; TRUE,
<a name="l00363"></a>00363     );
<a name="l00364"></a>00364   }
<a name="l00365"></a>00365 
<a name="l00378"></a><a class="code" href="classDatabaseConnection_afd8209665716f8866a799ddf2e985d1b.html#afd8209665716f8866a799ddf2e985d1b">00378</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_afd8209665716f8866a799ddf2e985d1b.html#afd8209665716f8866a799ddf2e985d1b" title="Returns the connection information for this connection object.">getConnectionOptions</a>() {
<a name="l00379"></a>00379     <span class="keywordflow">return</span> $this-&gt;connectionOptions;
<a name="l00380"></a>00380   }
<a name="l00381"></a>00381 
<a name="l00389"></a><a class="code" href="classDatabaseConnection_a8df68d814aa91a31f57990575d8349b6.html#a8df68d814aa91a31f57990575d8349b6">00389</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a8df68d814aa91a31f57990575d8349b6.html#a8df68d814aa91a31f57990575d8349b6" title="Set the list of prefixes used by this database connection.">setPrefix</a>($prefix) {
<a name="l00390"></a>00390     <span class="keywordflow">if</span> (is_array($prefix)) {
<a name="l00391"></a>00391       $this-&gt;prefixes = $prefix + array(<span class="stringliteral">&#39;default&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>);
<a name="l00392"></a>00392     }
<a name="l00393"></a>00393     <span class="keywordflow">else</span> {
<a name="l00394"></a>00394       $this-&gt;prefixes = array(<span class="stringliteral">&#39;default&#39;</span> =&gt; $prefix);
<a name="l00395"></a>00395     }
<a name="l00396"></a>00396 
<a name="l00397"></a>00397     <span class="comment">// Set up variables for use in prefixTables(). Replace table-specific</span>
<a name="l00398"></a>00398     <span class="comment">// prefixes first.</span>
<a name="l00399"></a>00399     $this-&gt;prefixSearch = array();
<a name="l00400"></a>00400     $this-&gt;prefixReplace = array();
<a name="l00401"></a>00401     <span class="keywordflow">foreach</span> ($this-&gt;prefixes as <a class="code" href="classDatabaseConnection_a8e817a1024b6ecf5800dd6ad8b50a66d.html#a8e817a1024b6ecf5800dd6ad8b50a66d">$key</a> =&gt; $val) {
<a name="l00402"></a>00402       <span class="keywordflow">if</span> (<a class="code" href="classDatabaseConnection_a8e817a1024b6ecf5800dd6ad8b50a66d.html#a8e817a1024b6ecf5800dd6ad8b50a66d">$key</a> != <span class="stringliteral">&#39;default&#39;</span>) {
<a name="l00403"></a>00403         $this-&gt;prefixSearch[] = <span class="charliteral">&#39;{&#39;</span> . <a class="code" href="classDatabaseConnection_a8e817a1024b6ecf5800dd6ad8b50a66d.html#a8e817a1024b6ecf5800dd6ad8b50a66d">$key</a> . <span class="charliteral">&#39;}&#39;</span>;
<a name="l00404"></a>00404         $this-&gt;prefixReplace[] = $val . <a class="code" href="classDatabaseConnection_a8e817a1024b6ecf5800dd6ad8b50a66d.html#a8e817a1024b6ecf5800dd6ad8b50a66d">$key</a>;
<a name="l00405"></a>00405       }
<a name="l00406"></a>00406     }
<a name="l00407"></a>00407     <span class="comment">// Then replace remaining tables with the default prefix.</span>
<a name="l00408"></a>00408     $this-&gt;prefixSearch[] = <span class="charliteral">&#39;{&#39;</span>;
<a name="l00409"></a>00409     $this-&gt;prefixReplace[] = $this-&gt;prefixes[<span class="stringliteral">&#39;default&#39;</span>];
<a name="l00410"></a>00410     $this-&gt;prefixSearch[] = <span class="charliteral">&#39;}&#39;</span>;
<a name="l00411"></a>00411     $this-&gt;prefixReplace[] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00412"></a>00412   }
<a name="l00413"></a>00413 
<a name="l00428"></a><a class="code" href="classDatabaseConnection_a10dfbe0177bc8c79a8589cc84afe24dd.html#a10dfbe0177bc8c79a8589cc84afe24dd">00428</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a10dfbe0177bc8c79a8589cc84afe24dd.html#a10dfbe0177bc8c79a8589cc84afe24dd" title="Appends a database prefix to all tables in a query.">prefixTables</a>($sql) {
<a name="l00429"></a>00429     <span class="keywordflow">return</span> str_replace($this-&gt;prefixSearch, $this-&gt;prefixReplace, $sql);
<a name="l00430"></a>00430   }
<a name="l00431"></a>00431 
<a name="l00438"></a><a class="code" href="classDatabaseConnection_af9ed26d47fbfce2a25c443c0e73295d7.html#af9ed26d47fbfce2a25c443c0e73295d7">00438</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_af9ed26d47fbfce2a25c443c0e73295d7.html#af9ed26d47fbfce2a25c443c0e73295d7" title="Find the prefix for a table.">tablePrefix</a>($table = <span class="stringliteral">&#39;default&#39;</span>) {
<a name="l00439"></a>00439     <span class="keywordflow">if</span> (isset($this-&gt;prefixes[$table])) {
<a name="l00440"></a>00440       <span class="keywordflow">return</span> $this-&gt;prefixes[$table];
<a name="l00441"></a>00441     }
<a name="l00442"></a>00442     <span class="keywordflow">else</span> {
<a name="l00443"></a>00443       <span class="keywordflow">return</span> $this-&gt;prefixes[<span class="stringliteral">&#39;default&#39;</span>];
<a name="l00444"></a>00444     }
<a name="l00445"></a>00445   }
<a name="l00446"></a>00446 
<a name="l00460"></a><a class="code" href="classDatabaseConnection_a3eb8c20adaffdd0f567bbe16d5226554.html#a3eb8c20adaffdd0f567bbe16d5226554">00460</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a3eb8c20adaffdd0f567bbe16d5226554.html#a3eb8c20adaffdd0f567bbe16d5226554" title="Prepares a query string and returns the prepared statement.">prepareQuery</a>($query) {
<a name="l00461"></a>00461     $query = $this-&gt;<a class="code" href="classDatabaseConnection_a10dfbe0177bc8c79a8589cc84afe24dd.html#a10dfbe0177bc8c79a8589cc84afe24dd" title="Appends a database prefix to all tables in a query.">prefixTables</a>($query);
<a name="l00462"></a>00462 
<a name="l00463"></a>00463     <span class="comment">// Call PDO::prepare.</span>
<a name="l00464"></a>00464     <span class="keywordflow">return</span> parent::prepare($query);
<a name="l00465"></a>00465   }
<a name="l00466"></a>00466 
<a name="l00479"></a><a class="code" href="classDatabaseConnection_ac4f67f4031517e8c1ee6acfa40427159.html#ac4f67f4031517e8c1ee6acfa40427159">00479</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_ac4f67f4031517e8c1ee6acfa40427159.html#ac4f67f4031517e8c1ee6acfa40427159" title="Tells this connection object what its target value is.">setTarget</a>(<a class="code" href="classDatabaseConnection_a9437bea57a47a6de0eef12b150fa253b.html#a9437bea57a47a6de0eef12b150fa253b">$target</a> = NULL) {
<a name="l00480"></a>00480     <span class="keywordflow">if</span> (!isset($this-&gt;target)) {
<a name="l00481"></a>00481       $this-&gt;target = <a class="code" href="classDatabaseConnection_a9437bea57a47a6de0eef12b150fa253b.html#a9437bea57a47a6de0eef12b150fa253b">$target</a>;
<a name="l00482"></a>00482     }
<a name="l00483"></a>00483   }
<a name="l00484"></a>00484 
<a name="l00491"></a><a class="code" href="classDatabaseConnection_a82dfe273b945f88d173100f0f760efd9.html#a82dfe273b945f88d173100f0f760efd9">00491</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a82dfe273b945f88d173100f0f760efd9.html#a82dfe273b945f88d173100f0f760efd9" title="Returns the target this connection is associated with.">getTarget</a>() {
<a name="l00492"></a>00492     <span class="keywordflow">return</span> $this-&gt;target;
<a name="l00493"></a>00493   }
<a name="l00494"></a>00494 
<a name="l00501"></a><a class="code" href="classDatabaseConnection_a057f1bce0514e0ce1a555bee7e61930b.html#a057f1bce0514e0ce1a555bee7e61930b">00501</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a057f1bce0514e0ce1a555bee7e61930b.html#a057f1bce0514e0ce1a555bee7e61930b" title="Tells this connection object what its key is.">setKey</a>(<a class="code" href="classDatabaseConnection_a8e817a1024b6ecf5800dd6ad8b50a66d.html#a8e817a1024b6ecf5800dd6ad8b50a66d">$key</a>) {
<a name="l00502"></a>00502     <span class="keywordflow">if</span> (!isset($this-&gt;key)) {
<a name="l00503"></a>00503       $this-&gt;key = <a class="code" href="classDatabaseConnection_a8e817a1024b6ecf5800dd6ad8b50a66d.html#a8e817a1024b6ecf5800dd6ad8b50a66d">$key</a>;
<a name="l00504"></a>00504     }
<a name="l00505"></a>00505   }
<a name="l00506"></a>00506 
<a name="l00513"></a><a class="code" href="classDatabaseConnection_ad7f059f5a02c65d2d805fe0991982e90.html#ad7f059f5a02c65d2d805fe0991982e90">00513</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_ad7f059f5a02c65d2d805fe0991982e90.html#ad7f059f5a02c65d2d805fe0991982e90" title="Returns the key this connection is associated with.">getKey</a>() {
<a name="l00514"></a>00514     <span class="keywordflow">return</span> $this-&gt;key;
<a name="l00515"></a>00515   }
<a name="l00516"></a>00516 
<a name="l00523"></a><a class="code" href="classDatabaseConnection_aaa0bb7258ae1b10cf8e762bd63c15ac2.html#aaa0bb7258ae1b10cf8e762bd63c15ac2">00523</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_aaa0bb7258ae1b10cf8e762bd63c15ac2.html#aaa0bb7258ae1b10cf8e762bd63c15ac2" title="Associates a logging object with this connection.">setLogger</a>(<a class="code" href="classDatabaseLog.html" title="Database query logger.">DatabaseLog</a> <a class="code" href="classDatabaseConnection_ad386591ee31049001e12539bca4e7fd8.html#ad386591ee31049001e12539bca4e7fd8">$logger</a>) {
<a name="l00524"></a>00524     $this-&gt;logger = <a class="code" href="classDatabaseConnection_ad386591ee31049001e12539bca4e7fd8.html#ad386591ee31049001e12539bca4e7fd8">$logger</a>;
<a name="l00525"></a>00525   }
<a name="l00526"></a>00526 
<a name="l00534"></a><a class="code" href="classDatabaseConnection_a9d07ce930cfc948c56fb165494c6b076.html#a9d07ce930cfc948c56fb165494c6b076">00534</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a9d07ce930cfc948c56fb165494c6b076.html#a9d07ce930cfc948c56fb165494c6b076" title="Gets the current logging object for this connection.">getLogger</a>() {
<a name="l00535"></a>00535     <span class="keywordflow">return</span> $this-&gt;logger;
<a name="l00536"></a>00536   }
<a name="l00537"></a>00537 
<a name="l00552"></a><a class="code" href="classDatabaseConnection_a5894f307c1cb799702449f30aa4a092b.html#a5894f307c1cb799702449f30aa4a092b">00552</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a5894f307c1cb799702449f30aa4a092b.html#a5894f307c1cb799702449f30aa4a092b" title="Creates the appropriate sequence name for a given table and serial field.">makeSequenceName</a>($table, $field) {
<a name="l00553"></a>00553     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDatabaseConnection_a10dfbe0177bc8c79a8589cc84afe24dd.html#a10dfbe0177bc8c79a8589cc84afe24dd" title="Appends a database prefix to all tables in a query.">prefixTables</a>(<span class="charliteral">&#39;{&#39;</span> . $table . <span class="stringliteral">&#39;}_&#39;</span> . $field . <span class="stringliteral">&#39;_seq&#39;</span>);
<a name="l00554"></a>00554   }
<a name="l00555"></a>00555 
<a name="l00567"></a><a class="code" href="classDatabaseConnection_a127563f6bb26ade0aa9480a117be0356.html#a127563f6bb26ade0aa9480a117be0356">00567</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a127563f6bb26ade0aa9480a117be0356.html#a127563f6bb26ade0aa9480a117be0356" title="Flatten an array of query comments into a single comment string.">makeComment</a>($comments) {
<a name="l00568"></a>00568     <span class="keywordflow">if</span> (empty($comments))
<a name="l00569"></a>00569       <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l00570"></a>00570 
<a name="l00571"></a>00571     <span class="comment">// Flatten the array of comments.</span>
<a name="l00572"></a>00572     $comment = implode(<span class="stringliteral">&#39;; &#39;</span>, $comments);
<a name="l00573"></a>00573 
<a name="l00574"></a>00574     <span class="comment">// Sanitize the comment string so as to avoid SQL injection attacks.</span>
<a name="l00575"></a>00575     <span class="keywordflow">return</span> <span class="stringliteral">&#39;/* &#39;</span> . $this-&gt;<a class="code" href="classDatabaseConnection_a68426a046aed8dcc9a70fcd5734f226c.html#a68426a046aed8dcc9a70fcd5734f226c" title="Sanitize a query comment string.">filterComment</a>($comment) . <span class="stringliteral">&#39; */ &#39;</span>;
<a name="l00576"></a>00576   }
<a name="l00577"></a>00577 
<a name="l00609"></a><a class="code" href="classDatabaseConnection_a68426a046aed8dcc9a70fcd5734f226c.html#a68426a046aed8dcc9a70fcd5734f226c">00609</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a68426a046aed8dcc9a70fcd5734f226c.html#a68426a046aed8dcc9a70fcd5734f226c" title="Sanitize a query comment string.">filterComment</a>($comment = <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00610"></a>00610     <span class="keywordflow">return</span> preg_replace(<span class="stringliteral">&#39;/(\/\*\s*)|(\s*\*\/)/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $comment);
<a name="l00611"></a>00611   }
<a name="l00612"></a>00612 
<a name="l00648"></a><a class="code" href="classDatabaseConnection_aff564097281c4496e9d10cb1bccbe98d.html#aff564097281c4496e9d10cb1bccbe98d">00648</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_aff564097281c4496e9d10cb1bccbe98d.html#aff564097281c4496e9d10cb1bccbe98d" title="Executes a query string against the database.">query</a>($query, array $args = array(), $options = array()) {
<a name="l00649"></a>00649 
<a name="l00650"></a>00650     <span class="comment">// Use default values if not already set.</span>
<a name="l00651"></a>00651     $options += $this-&gt;<a class="code" href="classDatabaseConnection_a190539d6c494ef2d7ac90d21226de5a5.html#a190539d6c494ef2d7ac90d21226de5a5" title="Returns the default query options for any given query.">defaultOptions</a>();
<a name="l00652"></a>00652 
<a name="l00653"></a>00653     <span class="keywordflow">try</span> {
<a name="l00654"></a>00654       <span class="comment">// We allow either a pre-bound statement object or a literal string.</span>
<a name="l00655"></a>00655       <span class="comment">// In either case, we want to end up with an executed statement object,</span>
<a name="l00656"></a>00656       <span class="comment">// which we pass to PDOStatement::execute.</span>
<a name="l00657"></a>00657       <span class="keywordflow">if</span> ($query instanceof <a class="code" href="interfaceDatabaseStatementInterface.html" title="Represents a prepared statement.">DatabaseStatementInterface</a>) {
<a name="l00658"></a>00658         $stmt = $query;
<a name="l00659"></a>00659         $stmt-&gt;execute(NULL, $options);
<a name="l00660"></a>00660       }
<a name="l00661"></a>00661       <span class="keywordflow">else</span> {
<a name="l00662"></a>00662         $this-&gt;<a class="code" href="classDatabaseConnection_a4ba47f85f7a45b83de78af6acb1c059a.html#a4ba47f85f7a45b83de78af6acb1c059a" title="Expands out shorthand placeholders.">expandArguments</a>($query, $args);
<a name="l00663"></a>00663         $stmt = $this-&gt;<a class="code" href="classDatabaseConnection_a3eb8c20adaffdd0f567bbe16d5226554.html#a3eb8c20adaffdd0f567bbe16d5226554" title="Prepares a query string and returns the prepared statement.">prepareQuery</a>($query);
<a name="l00664"></a>00664         $stmt-&gt;execute($args, $options);
<a name="l00665"></a>00665       }
<a name="l00666"></a>00666 
<a name="l00667"></a>00667       <span class="comment">// Depending on the type of query we may need to return a different value.</span>
<a name="l00668"></a>00668       <span class="comment">// See DatabaseConnection::defaultOptions() for a description of each</span>
<a name="l00669"></a>00669       <span class="comment">// value.</span>
<a name="l00670"></a>00670       <span class="keywordflow">switch</span> ($options[<span class="stringliteral">&#39;return&#39;</span>]) {
<a name="l00671"></a>00671         <span class="keywordflow">case</span> <a class="code" href="classDatabase_a7b7c6f8f81159b97752412e439d957dc.html#a7b7c6f8f81159b97752412e439d957dc" title="Flag to indicate a query call should return the prepared statement.">Database::RETURN_STATEMENT</a>:
<a name="l00672"></a>00672           <span class="keywordflow">return</span> $stmt;
<a name="l00673"></a>00673         <span class="keywordflow">case</span> <a class="code" href="classDatabase_a557879c7732a573ed395f9196afeb898.html#a557879c7732a573ed395f9196afeb898" title="Flag to indicate a query call should return the number of affected rows.">Database::RETURN_AFFECTED</a>:
<a name="l00674"></a>00674           <span class="keywordflow">return</span> $stmt-&gt;rowCount();
<a name="l00675"></a>00675         <span class="keywordflow">case</span> <a class="code" href="classDatabase_a56dab08fbf70f81aaf6f55a71922f4ef.html#a56dab08fbf70f81aaf6f55a71922f4ef" title="Flag to indicate a query call should return the &quot;last insert id&quot;.">Database::RETURN_INSERT_ID</a>:
<a name="l00676"></a>00676           <span class="keywordflow">return</span> $this-&gt;lastInsertId();
<a name="l00677"></a>00677         <span class="keywordflow">case</span> <a class="code" href="classDatabase_ae00484bf91c4447fc1b391408f7cfbd3.html#ae00484bf91c4447fc1b391408f7cfbd3" title="Flag to indicate a query call should simply return NULL.">Database::RETURN_NULL</a>:
<a name="l00678"></a>00678           <span class="keywordflow">return</span>;
<a name="l00679"></a>00679         <span class="keywordflow">default</span>:
<a name="l00680"></a>00680           <span class="keywordflow">throw</span> <span class="keyword">new</span> PDOException(<span class="stringliteral">&#39;Invalid return directive: &#39;</span> . $options[<span class="stringliteral">&#39;return&#39;</span>]);
<a name="l00681"></a>00681       }
<a name="l00682"></a>00682     }
<a name="l00683"></a>00683     <span class="keywordflow">catch</span> (PDOException $e) {
<a name="l00684"></a>00684       <span class="keywordflow">if</span> ($options[<span class="stringliteral">&#39;throw_exception&#39;</span>]) {
<a name="l00685"></a>00685         <span class="comment">// Add additional debug information.</span>
<a name="l00686"></a>00686         <span class="keywordflow">if</span> ($query instanceof <a class="code" href="interfaceDatabaseStatementInterface.html" title="Represents a prepared statement.">DatabaseStatementInterface</a>) {
<a name="l00687"></a>00687           $e-&gt;query_string = $stmt-&gt;getQueryString();
<a name="l00688"></a>00688         }
<a name="l00689"></a>00689         <span class="keywordflow">else</span> {
<a name="l00690"></a>00690           $e-&gt;query_string = $query;
<a name="l00691"></a>00691         }
<a name="l00692"></a>00692         $e-&gt;args = $args;
<a name="l00693"></a>00693         <span class="keywordflow">throw</span> $e;
<a name="l00694"></a>00694       }
<a name="l00695"></a>00695       <span class="keywordflow">return</span> NULL;
<a name="l00696"></a>00696     }
<a name="l00697"></a>00697   }
<a name="l00698"></a>00698 
<a name="l00713"></a><a class="code" href="classDatabaseConnection_a4ba47f85f7a45b83de78af6acb1c059a.html#a4ba47f85f7a45b83de78af6acb1c059a">00713</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a4ba47f85f7a45b83de78af6acb1c059a.html#a4ba47f85f7a45b83de78af6acb1c059a" title="Expands out shorthand placeholders.">expandArguments</a>(&amp;$query, &amp;$args) {
<a name="l00714"></a>00714     $modified = FALSE;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716     <span class="comment">// If the placeholder value to insert is an array, assume that we need</span>
<a name="l00717"></a>00717     <span class="comment">// to expand it out into a comma-delimited set of placeholders.</span>
<a name="l00718"></a>00718     <span class="keywordflow">foreach</span> (array_filter($args, <span class="stringliteral">&#39;is_array&#39;</span>) as <a class="code" href="classDatabaseConnection_a8e817a1024b6ecf5800dd6ad8b50a66d.html#a8e817a1024b6ecf5800dd6ad8b50a66d">$key</a> =&gt; $data) {
<a name="l00719"></a>00719       $new_keys = array();
<a name="l00720"></a>00720       <span class="keywordflow">foreach</span> ($data as $i =&gt; $value) {
<a name="l00721"></a>00721         <span class="comment">// This assumes that there are no other placeholders that use the same</span>
<a name="l00722"></a>00722         <span class="comment">// name.  For example, if the array placeholder is defined as :example</span>
<a name="l00723"></a>00723         <span class="comment">// and there is already an :example_2 placeholder, this will generate</span>
<a name="l00724"></a>00724         <span class="comment">// a duplicate key.  We do not account for that as the calling code</span>
<a name="l00725"></a>00725         <span class="comment">// is already broken if that happens.</span>
<a name="l00726"></a>00726         $new_keys[<a class="code" href="classDatabaseConnection_a8e817a1024b6ecf5800dd6ad8b50a66d.html#a8e817a1024b6ecf5800dd6ad8b50a66d">$key</a> . <span class="charliteral">&#39;_&#39;</span> . $i] = $value;
<a name="l00727"></a>00727       }
<a name="l00728"></a>00728 
<a name="l00729"></a>00729       <span class="comment">// Update the query with the new placeholders.</span>
<a name="l00730"></a>00730       <span class="comment">// preg_replace is necessary to ensure the replacement does not affect</span>
<a name="l00731"></a>00731       <span class="comment">// placeholders that start with the same exact text. For example, if the</span>
<a name="l00732"></a>00732       <span class="comment">// query contains the placeholders :foo and :foobar, and :foo has an</span>
<a name="l00733"></a>00733       <span class="comment">// array of values, using str_replace would affect both placeholders,</span>
<a name="l00734"></a>00734       <span class="comment">// but using the following preg_replace would only affect :foo because</span>
<a name="l00735"></a>00735       <span class="comment">// it is followed by a non-word character.</span>
<a name="l00736"></a>00736       $query = preg_replace(<span class="charliteral">&#39;#&#39;</span> . <a class="code" href="classDatabaseConnection_a8e817a1024b6ecf5800dd6ad8b50a66d.html#a8e817a1024b6ecf5800dd6ad8b50a66d">$key</a> . <span class="stringliteral">&#39;\b#&#39;</span>, implode(<span class="stringliteral">&#39;, &#39;</span>, array_keys($new_keys)), $query);
<a name="l00737"></a>00737 
<a name="l00738"></a>00738       <span class="comment">// Update the args array with the new placeholders.</span>
<a name="l00739"></a>00739       unset($args[<a class="code" href="classDatabaseConnection_a8e817a1024b6ecf5800dd6ad8b50a66d.html#a8e817a1024b6ecf5800dd6ad8b50a66d">$key</a>]);
<a name="l00740"></a>00740       $args += $new_keys;
<a name="l00741"></a>00741 
<a name="l00742"></a>00742       $modified = TRUE;
<a name="l00743"></a>00743     }
<a name="l00744"></a>00744 
<a name="l00745"></a>00745     <span class="keywordflow">return</span> $modified;
<a name="l00746"></a>00746   }
<a name="l00747"></a>00747 
<a name="l00761"></a><a class="code" href="classDatabaseConnection_a13497769ca9329dc4a62ad51b66566d4.html#a13497769ca9329dc4a62ad51b66566d4">00761</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a13497769ca9329dc4a62ad51b66566d4.html#a13497769ca9329dc4a62ad51b66566d4" title="Gets the driver-specific override class if any for the specified class.">getDriverClass</a>($class, array $files = array(), $use_autoload = FALSE) {
<a name="l00762"></a>00762     <span class="keywordflow">if</span> (empty($this-&gt;driverClasses[$class])) {
<a name="l00763"></a>00763       $driver = $this-&gt;<a class="code" href="classDatabaseConnection_a4a36a8d7352108c837c51a7172f966c3.html#a4a36a8d7352108c837c51a7172f966c3" title="Returns the type of database driver.">driver</a>();
<a name="l00764"></a>00764       $this-&gt;driverClasses[$class] = $class . <span class="charliteral">&#39;_&#39;</span> . $driver;
<a name="l00765"></a>00765       <a class="code" href="classDatabase_a25fe33ffa87aaf80ff680e356230d9e2.html#a25fe33ffa87aaf80ff680e356230d9e2" title="Load a file for the database that might hold a class.">Database::loadDriverFile</a>($driver, $files);
<a name="l00766"></a>00766       <span class="keywordflow">if</span> (!class_exists($this-&gt;driverClasses[$class], $use_autoload)) {
<a name="l00767"></a>00767         $this-&gt;driverClasses[$class] = $class;
<a name="l00768"></a>00768       }
<a name="l00769"></a>00769     }
<a name="l00770"></a>00770     <span class="keywordflow">return</span> $this-&gt;driverClasses[$class];
<a name="l00771"></a>00771   }
<a name="l00772"></a>00772 
<a name="l00792"></a><a class="code" href="classDatabaseConnection_a31f271cf685087c1a45a0cf74bb2b73e.html#a31f271cf685087c1a45a0cf74bb2b73e">00792</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a31f271cf685087c1a45a0cf74bb2b73e.html#a31f271cf685087c1a45a0cf74bb2b73e" title="Prepares and returns a SELECT query object.">select</a>($table, $alias = NULL, array $options = array()) {
<a name="l00793"></a>00793     $class = $this-&gt;<a class="code" href="classDatabaseConnection_a13497769ca9329dc4a62ad51b66566d4.html#a13497769ca9329dc4a62ad51b66566d4" title="Gets the driver-specific override class if any for the specified class.">getDriverClass</a>(<span class="stringliteral">&#39;SelectQuery&#39;</span>, array(<span class="stringliteral">&#39;query.inc&#39;</span>, <span class="stringliteral">&#39;select.inc&#39;</span>));
<a name="l00794"></a>00794     <span class="keywordflow">return</span> <span class="keyword">new</span> $class($table, $alias, $this, $options);
<a name="l00795"></a>00795   }
<a name="l00796"></a>00796 
<a name="l00808"></a><a class="code" href="classDatabaseConnection_aa979bc386e0457a0cb989d762da5afde.html#aa979bc386e0457a0cb989d762da5afde">00808</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_aa979bc386e0457a0cb989d762da5afde.html#aa979bc386e0457a0cb989d762da5afde" title="Prepares and returns an INSERT query object.">insert</a>($table, array $options = array()) {
<a name="l00809"></a>00809     $class = $this-&gt;<a class="code" href="classDatabaseConnection_a13497769ca9329dc4a62ad51b66566d4.html#a13497769ca9329dc4a62ad51b66566d4" title="Gets the driver-specific override class if any for the specified class.">getDriverClass</a>(<span class="stringliteral">&#39;InsertQuery&#39;</span>, array(<span class="stringliteral">&#39;query.inc&#39;</span>));
<a name="l00810"></a>00810     <span class="keywordflow">return</span> <span class="keyword">new</span> $class($this, $table, $options);
<a name="l00811"></a>00811   }
<a name="l00812"></a>00812 
<a name="l00824"></a><a class="code" href="classDatabaseConnection_ada81b5e7e2aa5f9741dc88474a917cff.html#ada81b5e7e2aa5f9741dc88474a917cff">00824</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_ada81b5e7e2aa5f9741dc88474a917cff.html#ada81b5e7e2aa5f9741dc88474a917cff" title="Prepares and returns a MERGE query object.">merge</a>($table, array $options = array()) {
<a name="l00825"></a>00825     $class = $this-&gt;<a class="code" href="classDatabaseConnection_a13497769ca9329dc4a62ad51b66566d4.html#a13497769ca9329dc4a62ad51b66566d4" title="Gets the driver-specific override class if any for the specified class.">getDriverClass</a>(<span class="stringliteral">&#39;MergeQuery&#39;</span>, array(<span class="stringliteral">&#39;query.inc&#39;</span>));
<a name="l00826"></a>00826     <span class="keywordflow">return</span> <span class="keyword">new</span> $class($this, $table, $options);
<a name="l00827"></a>00827   }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829 
<a name="l00841"></a><a class="code" href="classDatabaseConnection_a4c2fb58226e7045cc9f8a6b2edac630e.html#a4c2fb58226e7045cc9f8a6b2edac630e">00841</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a4c2fb58226e7045cc9f8a6b2edac630e.html#a4c2fb58226e7045cc9f8a6b2edac630e" title="Prepares and returns an UPDATE query object.">update</a>($table, array $options = array()) {
<a name="l00842"></a>00842     $class = $this-&gt;<a class="code" href="classDatabaseConnection_a13497769ca9329dc4a62ad51b66566d4.html#a13497769ca9329dc4a62ad51b66566d4" title="Gets the driver-specific override class if any for the specified class.">getDriverClass</a>(<span class="stringliteral">&#39;UpdateQuery&#39;</span>, array(<span class="stringliteral">&#39;query.inc&#39;</span>));
<a name="l00843"></a>00843     <span class="keywordflow">return</span> <span class="keyword">new</span> $class($this, $table, $options);
<a name="l00844"></a>00844   }
<a name="l00845"></a>00845 
<a name="l00857"></a><a class="code" href="classDatabaseConnection_af8bf777ee824d3c2c5a3e18e5941ece4.html#af8bf777ee824d3c2c5a3e18e5941ece4">00857</a>   <span class="keyword">public</span> <span class="keyword">function</span> <span class="keyword">delete</span>($table, array $options = array()) {
<a name="l00858"></a>00858     $class = $this-&gt;<a class="code" href="classDatabaseConnection_a13497769ca9329dc4a62ad51b66566d4.html#a13497769ca9329dc4a62ad51b66566d4" title="Gets the driver-specific override class if any for the specified class.">getDriverClass</a>(<span class="stringliteral">&#39;DeleteQuery&#39;</span>, array(<span class="stringliteral">&#39;query.inc&#39;</span>));
<a name="l00859"></a>00859     <span class="keywordflow">return</span> <span class="keyword">new</span> $class($this, $table, $options);
<a name="l00860"></a>00860   }
<a name="l00861"></a>00861 
<a name="l00873"></a><a class="code" href="classDatabaseConnection_a24e86882227b5b337daedcf20458e371.html#a24e86882227b5b337daedcf20458e371">00873</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a24e86882227b5b337daedcf20458e371.html#a24e86882227b5b337daedcf20458e371" title="Prepares and returns a TRUNCATE query object.">truncate</a>($table, array $options = array()) {
<a name="l00874"></a>00874     $class = $this-&gt;<a class="code" href="classDatabaseConnection_a13497769ca9329dc4a62ad51b66566d4.html#a13497769ca9329dc4a62ad51b66566d4" title="Gets the driver-specific override class if any for the specified class.">getDriverClass</a>(<span class="stringliteral">&#39;TruncateQuery&#39;</span>, array(<span class="stringliteral">&#39;query.inc&#39;</span>));
<a name="l00875"></a>00875     <span class="keywordflow">return</span> <span class="keyword">new</span> $class($this, $table, $options);
<a name="l00876"></a>00876   }
<a name="l00877"></a>00877 
<a name="l00886"></a><a class="code" href="classDatabaseConnection_a809aee6bbab9d383927be8f307b7ef7b.html#a809aee6bbab9d383927be8f307b7ef7b">00886</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a809aee6bbab9d383927be8f307b7ef7b.html#a809aee6bbab9d383927be8f307b7ef7b" title="Returns a DatabaseSchema object for manipulating the schema.">schema</a>() {
<a name="l00887"></a>00887     <span class="keywordflow">if</span> (empty($this-&gt;<a class="code" href="classDatabaseConnection_a809aee6bbab9d383927be8f307b7ef7b.html#a809aee6bbab9d383927be8f307b7ef7b" title="Returns a DatabaseSchema object for manipulating the schema.">schema</a>)) {
<a name="l00888"></a>00888       $class = $this-&gt;<a class="code" href="classDatabaseConnection_a13497769ca9329dc4a62ad51b66566d4.html#a13497769ca9329dc4a62ad51b66566d4" title="Gets the driver-specific override class if any for the specified class.">getDriverClass</a>(<span class="stringliteral">&#39;DatabaseSchema&#39;</span>, array(<span class="stringliteral">&#39;schema.inc&#39;</span>));
<a name="l00889"></a>00889       <span class="keywordflow">if</span> (class_exists($class)) {
<a name="l00890"></a>00890         $this-&gt;<a class="code" href="classDatabaseConnection_a809aee6bbab9d383927be8f307b7ef7b.html#a809aee6bbab9d383927be8f307b7ef7b" title="Returns a DatabaseSchema object for manipulating the schema.">schema</a> = <span class="keyword">new</span> $class($this);
<a name="l00891"></a>00891       }
<a name="l00892"></a>00892     }
<a name="l00893"></a>00893     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDatabaseConnection_a809aee6bbab9d383927be8f307b7ef7b.html#a809aee6bbab9d383927be8f307b7ef7b" title="Returns a DatabaseSchema object for manipulating the schema.">schema</a>;
<a name="l00894"></a>00894   }
<a name="l00895"></a>00895 
<a name="l00906"></a><a class="code" href="classDatabaseConnection_a4ea565fbd6c6d1f258594b23a2e10e20.html#a4ea565fbd6c6d1f258594b23a2e10e20">00906</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a4ea565fbd6c6d1f258594b23a2e10e20.html#a4ea565fbd6c6d1f258594b23a2e10e20" title="Escapes a table name string.">escapeTable</a>($table) {
<a name="l00907"></a>00907     <span class="keywordflow">return</span> preg_replace(<span class="stringliteral">&#39;/[^A-Za-z0-9_.]+/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $table);
<a name="l00908"></a>00908   }
<a name="l00909"></a>00909 
<a name="l00920"></a><a class="code" href="classDatabaseConnection_aae6a7cba6988731b2b84d645ea4de11c.html#aae6a7cba6988731b2b84d645ea4de11c">00920</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_aae6a7cba6988731b2b84d645ea4de11c.html#aae6a7cba6988731b2b84d645ea4de11c" title="Escapes a field name string.">escapeField</a>($field) {
<a name="l00921"></a>00921     <span class="keywordflow">return</span> preg_replace(<span class="stringliteral">&#39;/[^A-Za-z0-9_.]+/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $field);
<a name="l00922"></a>00922   }
<a name="l00923"></a>00923 
<a name="l00935"></a><a class="code" href="classDatabaseConnection_a400fea30d60f9477eb176d9fee36cfe2.html#a400fea30d60f9477eb176d9fee36cfe2">00935</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a400fea30d60f9477eb176d9fee36cfe2.html#a400fea30d60f9477eb176d9fee36cfe2" title="Escapes an alias name string.">escapeAlias</a>($field) {
<a name="l00936"></a>00936     <span class="keywordflow">return</span> preg_replace(<span class="stringliteral">&#39;/[^A-Za-z0-9_]+/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $field);
<a name="l00937"></a>00937   }
<a name="l00938"></a>00938 
<a name="l00964"></a><a class="code" href="classDatabaseConnection_a048eda663834d6303ce3e3d0fabc7e75.html#a048eda663834d6303ce3e3d0fabc7e75">00964</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a048eda663834d6303ce3e3d0fabc7e75.html#a048eda663834d6303ce3e3d0fabc7e75" title="Escapes characters that work as wildcard characters in a LIKE pattern.">escapeLike</a>($string) {
<a name="l00965"></a>00965     <span class="keywordflow">return</span> addcslashes($string, <span class="stringliteral">&#39;\%_&#39;</span>);
<a name="l00966"></a>00966   }
<a name="l00967"></a>00967 
<a name="l00974"></a><a class="code" href="classDatabaseConnection_ac1ff742bc653f3d67d633c3d1b256229.html#ac1ff742bc653f3d67d633c3d1b256229">00974</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_ac1ff742bc653f3d67d633c3d1b256229.html#ac1ff742bc653f3d67d633c3d1b256229" title="Determines if there is an active transaction open.">inTransaction</a>() {
<a name="l00975"></a>00975     <span class="keywordflow">return</span> ($this-&gt;<a class="code" href="classDatabaseConnection_a6b2631c56f4951032f30a7c519a4837e.html#a6b2631c56f4951032f30a7c519a4837e" title="Determines current transaction depth.">transactionDepth</a>() &gt; 0);
<a name="l00976"></a>00976   }
<a name="l00977"></a>00977 
<a name="l00981"></a><a class="code" href="classDatabaseConnection_a6b2631c56f4951032f30a7c519a4837e.html#a6b2631c56f4951032f30a7c519a4837e">00981</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a6b2631c56f4951032f30a7c519a4837e.html#a6b2631c56f4951032f30a7c519a4837e" title="Determines current transaction depth.">transactionDepth</a>() {
<a name="l00982"></a>00982     <span class="keywordflow">return</span> count($this-&gt;transactionLayers);
<a name="l00983"></a>00983   }
<a name="l00984"></a>00984 
<a name="l00996"></a><a class="code" href="classDatabaseConnection_a210f69060d31ab1559a8b2231e83a318.html#a210f69060d31ab1559a8b2231e83a318">00996</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a210f69060d31ab1559a8b2231e83a318.html#a210f69060d31ab1559a8b2231e83a318" title="Returns a new DatabaseTransaction object on this connection.">startTransaction</a>($name = <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00997"></a>00997     $class = $this-&gt;<a class="code" href="classDatabaseConnection_a13497769ca9329dc4a62ad51b66566d4.html#a13497769ca9329dc4a62ad51b66566d4" title="Gets the driver-specific override class if any for the specified class.">getDriverClass</a>(<span class="stringliteral">&#39;DatabaseTransaction&#39;</span>);
<a name="l00998"></a>00998     <span class="keywordflow">return</span> <span class="keyword">new</span> $class($this, $name);
<a name="l00999"></a>00999   }
<a name="l01000"></a>01000 
<a name="l01014"></a><a class="code" href="classDatabaseConnection_aef0f8cd6cbfbc304e721baaa14be14cf.html#aef0f8cd6cbfbc304e721baaa14be14cf">01014</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_aef0f8cd6cbfbc304e721baaa14be14cf.html#aef0f8cd6cbfbc304e721baaa14be14cf" title="Rolls back the transaction entirely or to a named savepoint.">rollback</a>($savepoint_name = <span class="stringliteral">&#39;drupal_transaction&#39;</span>) {
<a name="l01015"></a>01015     <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="classDatabaseConnection_a6f5f74fd00cad354a98cea3ddef509a9.html#a6f5f74fd00cad354a98cea3ddef509a9" title="Determines if this driver supports transactions.">supportsTransactions</a>()) {
<a name="l01016"></a>01016       <span class="keywordflow">return</span>;
<a name="l01017"></a>01017     }
<a name="l01018"></a>01018     <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="classDatabaseConnection_ac1ff742bc653f3d67d633c3d1b256229.html#ac1ff742bc653f3d67d633c3d1b256229" title="Determines if there is an active transaction open.">inTransaction</a>()) {
<a name="l01019"></a>01019       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDatabaseTransactionNoActiveException.html" title="Exception for when popTransaction() is called with no active transaction.">DatabaseTransactionNoActiveException</a>();
<a name="l01020"></a>01020     }
<a name="l01021"></a>01021     <span class="comment">// A previous rollback to an earlier savepoint may mean that the savepoint</span>
<a name="l01022"></a>01022     <span class="comment">// in question has already been accidentally committed.</span>
<a name="l01023"></a>01023     <span class="keywordflow">if</span> (!isset($this-&gt;transactionLayers[$savepoint_name])) {
<a name="l01024"></a>01024       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDatabaseTransactionNoActiveException.html" title="Exception for when popTransaction() is called with no active transaction.">DatabaseTransactionNoActiveException</a>();
<a name="l01025"></a>01025     }
<a name="l01026"></a>01026 
<a name="l01027"></a>01027     <span class="comment">// We need to find the point we&#39;re rolling back to, all other savepoints</span>
<a name="l01028"></a>01028     <span class="comment">// before are no longer needed. If we rolled back other active savepoints,</span>
<a name="l01029"></a>01029     <span class="comment">// we need to throw an exception.</span>
<a name="l01030"></a>01030     $rolled_back_other_active_savepoints = FALSE;
<a name="l01031"></a>01031     <span class="keywordflow">while</span> ($savepoint = array_pop($this-&gt;transactionLayers)) {
<a name="l01032"></a>01032       <span class="keywordflow">if</span> ($savepoint == $savepoint_name) {
<a name="l01033"></a>01033         <span class="comment">// If it is the last the transaction in the stack, then it is not a</span>
<a name="l01034"></a>01034         <span class="comment">// savepoint, it is the transaction itself so we will need to roll back</span>
<a name="l01035"></a>01035         <span class="comment">// the transaction rather than a savepoint.</span>
<a name="l01036"></a>01036         <span class="keywordflow">if</span> (empty($this-&gt;transactionLayers)) {
<a name="l01037"></a>01037           <span class="keywordflow">break</span>;
<a name="l01038"></a>01038         }
<a name="l01039"></a>01039         $this-&gt;<a class="code" href="classDatabaseConnection_aff564097281c4496e9d10cb1bccbe98d.html#aff564097281c4496e9d10cb1bccbe98d" title="Executes a query string against the database.">query</a>(<span class="stringliteral">&#39;ROLLBACK TO SAVEPOINT &#39;</span> . $savepoint);
<a name="l01040"></a>01040         $this-&gt;<a class="code" href="classDatabaseConnection_ade8d68cea197dc7703042ab505ed940d.html#ade8d68cea197dc7703042ab505ed940d" title="Internal function: commit all the transaction layers that can commit.">popCommittableTransactions</a>();
<a name="l01041"></a>01041         <span class="keywordflow">if</span> ($rolled_back_other_active_savepoints) {
<a name="l01042"></a>01042           <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDatabaseTransactionOutOfOrderException.html" title="Exception thrown when a rollback() resulted in other active transactions being rolled-back.">DatabaseTransactionOutOfOrderException</a>();
<a name="l01043"></a>01043         }
<a name="l01044"></a>01044         <span class="keywordflow">return</span>;
<a name="l01045"></a>01045       }
<a name="l01046"></a>01046       <span class="keywordflow">else</span> {
<a name="l01047"></a>01047         $rolled_back_other_active_savepoints = TRUE;
<a name="l01048"></a>01048       }
<a name="l01049"></a>01049     }
<a name="l01050"></a>01050     parent::rollBack();
<a name="l01051"></a>01051     <span class="keywordflow">if</span> ($rolled_back_other_active_savepoints) {
<a name="l01052"></a>01052       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDatabaseTransactionOutOfOrderException.html" title="Exception thrown when a rollback() resulted in other active transactions being rolled-back.">DatabaseTransactionOutOfOrderException</a>();
<a name="l01053"></a>01053     }
<a name="l01054"></a>01054   }
<a name="l01055"></a>01055 
<a name="l01065"></a><a class="code" href="classDatabaseConnection_a3aa9a595dd90a2b64d6b6c187f25828a.html#a3aa9a595dd90a2b64d6b6c187f25828a">01065</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a3aa9a595dd90a2b64d6b6c187f25828a.html#a3aa9a595dd90a2b64d6b6c187f25828a" title="Increases the depth of transaction nesting.">pushTransaction</a>($name) {
<a name="l01066"></a>01066     <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="classDatabaseConnection_a6f5f74fd00cad354a98cea3ddef509a9.html#a6f5f74fd00cad354a98cea3ddef509a9" title="Determines if this driver supports transactions.">supportsTransactions</a>()) {
<a name="l01067"></a>01067       <span class="keywordflow">return</span>;
<a name="l01068"></a>01068     }
<a name="l01069"></a>01069     <span class="keywordflow">if</span> (isset($this-&gt;transactionLayers[$name])) {
<a name="l01070"></a>01070       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDatabaseTransactionNameNonUniqueException.html" title="Exception thrown when a savepoint or transaction name occurs twice.">DatabaseTransactionNameNonUniqueException</a>($name . <span class="stringliteral">&quot; is already in use.&quot;</span>);
<a name="l01071"></a>01071     }
<a name="l01072"></a>01072     <span class="comment">// If we&#39;re already in a transaction then we want to create a savepoint</span>
<a name="l01073"></a>01073     <span class="comment">// rather than try to create another transaction.</span>
<a name="l01074"></a>01074     <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classDatabaseConnection_ac1ff742bc653f3d67d633c3d1b256229.html#ac1ff742bc653f3d67d633c3d1b256229" title="Determines if there is an active transaction open.">inTransaction</a>()) {
<a name="l01075"></a>01075       $this-&gt;<a class="code" href="classDatabaseConnection_aff564097281c4496e9d10cb1bccbe98d.html#aff564097281c4496e9d10cb1bccbe98d" title="Executes a query string against the database.">query</a>(<span class="stringliteral">&#39;SAVEPOINT &#39;</span> . $name);
<a name="l01076"></a>01076     }
<a name="l01077"></a>01077     <span class="keywordflow">else</span> {
<a name="l01078"></a>01078       parent::beginTransaction();
<a name="l01079"></a>01079     }
<a name="l01080"></a>01080     $this-&gt;transactionLayers[$name] = $name;
<a name="l01081"></a>01081   }
<a name="l01082"></a>01082 
<a name="l01098"></a><a class="code" href="classDatabaseConnection_a0bca5087efb85e6480b953cc76ccfcb1.html#a0bca5087efb85e6480b953cc76ccfcb1">01098</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a0bca5087efb85e6480b953cc76ccfcb1.html#a0bca5087efb85e6480b953cc76ccfcb1" title="Decreases the depth of transaction nesting.">popTransaction</a>($name) {
<a name="l01099"></a>01099     <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="classDatabaseConnection_a6f5f74fd00cad354a98cea3ddef509a9.html#a6f5f74fd00cad354a98cea3ddef509a9" title="Determines if this driver supports transactions.">supportsTransactions</a>()) {
<a name="l01100"></a>01100       <span class="keywordflow">return</span>;
<a name="l01101"></a>01101     }
<a name="l01102"></a>01102     <span class="comment">// The transaction has already been committed earlier. There is nothing we</span>
<a name="l01103"></a>01103     <span class="comment">// need to do. If this transaction was part of an earlier out-of-order</span>
<a name="l01104"></a>01104     <span class="comment">// rollback, an exception would already have been thrown by</span>
<a name="l01105"></a>01105     <span class="comment">// Database::rollback().</span>
<a name="l01106"></a>01106     <span class="keywordflow">if</span> (!isset($this-&gt;transactionLayers[$name])) {
<a name="l01107"></a>01107       <span class="keywordflow">return</span>;
<a name="l01108"></a>01108     }
<a name="l01109"></a>01109 
<a name="l01110"></a>01110     <span class="comment">// Mark this layer as committable.</span>
<a name="l01111"></a>01111     $this-&gt;transactionLayers[$name] = FALSE;
<a name="l01112"></a>01112     $this-&gt;<a class="code" href="classDatabaseConnection_ade8d68cea197dc7703042ab505ed940d.html#ade8d68cea197dc7703042ab505ed940d" title="Internal function: commit all the transaction layers that can commit.">popCommittableTransactions</a>();
<a name="l01113"></a>01113   }
<a name="l01114"></a>01114 
<a name="l01118"></a><a class="code" href="classDatabaseConnection_ade8d68cea197dc7703042ab505ed940d.html#ade8d68cea197dc7703042ab505ed940d">01118</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_ade8d68cea197dc7703042ab505ed940d.html#ade8d68cea197dc7703042ab505ed940d" title="Internal function: commit all the transaction layers that can commit.">popCommittableTransactions</a>() {
<a name="l01119"></a>01119     <span class="comment">// Commit all the committable layers.</span>
<a name="l01120"></a>01120     <span class="keywordflow">foreach</span> (array_reverse($this-&gt;transactionLayers) as $name =&gt; $active) {
<a name="l01121"></a>01121       <span class="comment">// Stop once we found an active transaction.</span>
<a name="l01122"></a>01122       <span class="keywordflow">if</span> ($active) {
<a name="l01123"></a>01123         <span class="keywordflow">break</span>;
<a name="l01124"></a>01124       }
<a name="l01125"></a>01125 
<a name="l01126"></a>01126       <span class="comment">// If there are no more layers left then we should commit.</span>
<a name="l01127"></a>01127       unset($this-&gt;transactionLayers[$name]);
<a name="l01128"></a>01128       <span class="keywordflow">if</span> (empty($this-&gt;transactionLayers)) {
<a name="l01129"></a>01129         <span class="keywordflow">if</span> (!parent::commit()) {
<a name="l01130"></a>01130           <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDatabaseTransactionCommitFailedException.html" title="Exception thrown when a commit() function fails.">DatabaseTransactionCommitFailedException</a>();
<a name="l01131"></a>01131         }
<a name="l01132"></a>01132       }
<a name="l01133"></a>01133       <span class="keywordflow">else</span> {
<a name="l01134"></a>01134         $this-&gt;<a class="code" href="classDatabaseConnection_aff564097281c4496e9d10cb1bccbe98d.html#aff564097281c4496e9d10cb1bccbe98d" title="Executes a query string against the database.">query</a>(<span class="stringliteral">&#39;RELEASE SAVEPOINT &#39;</span> . $name);
<a name="l01135"></a>01135       }
<a name="l01136"></a>01136     }
<a name="l01137"></a>01137   }
<a name="l01138"></a>01138 
<a name="l01162"></a>01162   <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a1c97c77517b969270bb92c5c7e022a5d.html#a1c97c77517b969270bb92c5c7e022a5d" title="Runs a limited-range query on this database object.">queryRange</a>($query, $from, $count, array $args = array(), array $options = array());
<a name="l01163"></a>01163 
<a name="l01170"></a><a class="code" href="classDatabaseConnection_a8726459b0a9478a9a80d36237fa3ba30.html#a8726459b0a9478a9a80d36237fa3ba30">01170</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a8726459b0a9478a9a80d36237fa3ba30.html#a8726459b0a9478a9a80d36237fa3ba30" title="Generates a temporary table name.">generateTemporaryTableName</a>() {
<a name="l01171"></a>01171     <span class="keywordflow">return</span> <span class="stringliteral">&quot;db_temporary_&quot;</span> . $this-&gt;temporaryNameIndex++;
<a name="l01172"></a>01172   }
<a name="l01173"></a>01173 
<a name="l01197"></a>01197   <span class="keyword">abstract</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_ae4d9ad286187f493172da04fca77ca8f.html#ae4d9ad286187f493172da04fca77ca8f" title="Runs a SELECT query and stores its results in a temporary table.">queryTemporary</a>($query, array $args = array(), array $options = array());
<a name="l01198"></a>01198 
<a name="l01207"></a>01207   <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a4a36a8d7352108c837c51a7172f966c3.html#a4a36a8d7352108c837c51a7172f966c3" title="Returns the type of database driver.">driver</a>();
<a name="l01208"></a>01208 
<a name="l01212"></a><a class="code" href="classDatabaseConnection_a0c3c9a1fa27838cd1ce5d9cc8d8e6a29.html#a0c3c9a1fa27838cd1ce5d9cc8d8e6a29">01212</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a0c3c9a1fa27838cd1ce5d9cc8d8e6a29.html#a0c3c9a1fa27838cd1ce5d9cc8d8e6a29" title="Returns the version of the database server.">version</a>() {
<a name="l01213"></a>01213     <span class="keywordflow">return</span> $this-&gt;getAttribute(PDO::ATTR_SERVER_VERSION);
<a name="l01214"></a>01214   }
<a name="l01215"></a>01215 
<a name="l01222"></a><a class="code" href="classDatabaseConnection_a6f5f74fd00cad354a98cea3ddef509a9.html#a6f5f74fd00cad354a98cea3ddef509a9">01222</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a6f5f74fd00cad354a98cea3ddef509a9.html#a6f5f74fd00cad354a98cea3ddef509a9" title="Determines if this driver supports transactions.">supportsTransactions</a>() {
<a name="l01223"></a>01223     <span class="keywordflow">return</span> $this-&gt;transactionSupport;
<a name="l01224"></a>01224   }
<a name="l01225"></a>01225 
<a name="l01235"></a><a class="code" href="classDatabaseConnection_a9ae6d1315a680a7250444d2aa9a3d30b.html#a9ae6d1315a680a7250444d2aa9a3d30b">01235</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a9ae6d1315a680a7250444d2aa9a3d30b.html#a9ae6d1315a680a7250444d2aa9a3d30b" title="Determines if this driver supports transactional DDL.">supportsTransactionalDDL</a>() {
<a name="l01236"></a>01236     <span class="keywordflow">return</span> $this-&gt;transactionalDDLSupport;
<a name="l01237"></a>01237   }
<a name="l01238"></a>01238 
<a name="l01242"></a>01242   <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a7dd7e76bc813c6a90a6d26a5529d67b0.html#a7dd7e76bc813c6a90a6d26a5529d67b0" title="Returns the name of the PDO driver for this connection.">databaseType</a>();
<a name="l01243"></a>01243 
<a name="l01244"></a>01244 
<a name="l01261"></a>01261   <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_aef82436b30fa08a6c81c34e11f3b1717.html#aef82436b30fa08a6c81c34e11f3b1717" title="Gets any special processing requirements for the condition operator.">mapConditionOperator</a>($operator);
<a name="l01262"></a>01262 
<a name="l01275"></a><a class="code" href="classDatabaseConnection_a7e938dd2dbf5bbef8e2eb06bda3eeb2f.html#a7e938dd2dbf5bbef8e2eb06bda3eeb2f">01275</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a7e938dd2dbf5bbef8e2eb06bda3eeb2f.html#a7e938dd2dbf5bbef8e2eb06bda3eeb2f" title="Throws an exception to deny direct access to transaction commits.">commit</a>() {
<a name="l01276"></a>01276     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDatabaseTransactionExplicitCommitNotAllowedException.html" title="Exception to deny attempts to explicitly manage transactions.">DatabaseTransactionExplicitCommitNotAllowedException</a>();
<a name="l01277"></a>01277   }
<a name="l01278"></a>01278 
<a name="l01296"></a>01296   <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseConnection_a173e333ef1b61541cf37125468a37231.html#a173e333ef1b61541cf37125468a37231" title="Retrieves an unique id from a given sequence.">nextId</a>($existing_id = 0);
<a name="l01297"></a>01297 }
<a name="l01298"></a>01298 
<a name="l01306"></a><a class="code" href="classDatabase.html">01306</a> <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="classDatabase.html" title="Primary front-controller for the database system.">Database</a> {
<a name="l01307"></a>01307 
<a name="l01314"></a><a class="code" href="classDatabase_ae00484bf91c4447fc1b391408f7cfbd3.html#ae00484bf91c4447fc1b391408f7cfbd3">01314</a>   <span class="keyword">const</span> <a class="code" href="classDatabase_ae00484bf91c4447fc1b391408f7cfbd3.html#ae00484bf91c4447fc1b391408f7cfbd3" title="Flag to indicate a query call should simply return NULL.">RETURN_NULL</a> = 0;
<a name="l01315"></a>01315 
<a name="l01319"></a><a class="code" href="classDatabase_a7b7c6f8f81159b97752412e439d957dc.html#a7b7c6f8f81159b97752412e439d957dc">01319</a>   <span class="keyword">const</span> <a class="code" href="classDatabase_a7b7c6f8f81159b97752412e439d957dc.html#a7b7c6f8f81159b97752412e439d957dc" title="Flag to indicate a query call should return the prepared statement.">RETURN_STATEMENT</a> = 1;
<a name="l01320"></a>01320 
<a name="l01324"></a><a class="code" href="classDatabase_a557879c7732a573ed395f9196afeb898.html#a557879c7732a573ed395f9196afeb898">01324</a>   <span class="keyword">const</span> <a class="code" href="classDatabase_a557879c7732a573ed395f9196afeb898.html#a557879c7732a573ed395f9196afeb898" title="Flag to indicate a query call should return the number of affected rows.">RETURN_AFFECTED</a> = 2;
<a name="l01325"></a>01325 
<a name="l01329"></a><a class="code" href="classDatabase_a56dab08fbf70f81aaf6f55a71922f4ef.html#a56dab08fbf70f81aaf6f55a71922f4ef">01329</a>   <span class="keyword">const</span> <a class="code" href="classDatabase_a56dab08fbf70f81aaf6f55a71922f4ef.html#a56dab08fbf70f81aaf6f55a71922f4ef" title="Flag to indicate a query call should return the &quot;last insert id&quot;.">RETURN_INSERT_ID</a> = 3;
<a name="l01330"></a>01330 
<a name="l01337"></a><a class="code" href="classDatabase_a5b3475f4078edb1c0629ddcc00901ec7.html#a5b3475f4078edb1c0629ddcc00901ec7">01337</a>   <span class="keyword">static</span> <span class="keyword">protected</span> <a class="code" href="classDatabase_a5b3475f4078edb1c0629ddcc00901ec7.html#a5b3475f4078edb1c0629ddcc00901ec7">$connections</a> = array();
<a name="l01338"></a>01338 
<a name="l01344"></a><a class="code" href="classDatabase_a0c015937446b53480050a687608fc09b.html#a0c015937446b53480050a687608fc09b">01344</a>   <span class="keyword">static</span> <span class="keyword">protected</span> <a class="code" href="classDatabase_a0c015937446b53480050a687608fc09b.html#a0c015937446b53480050a687608fc09b">$databaseInfo</a> = NULL;
<a name="l01345"></a>01345 
<a name="l01351"></a><a class="code" href="classDatabase_a835e96936183cb872b1dce649e11ba41.html#a835e96936183cb872b1dce649e11ba41">01351</a>   <span class="keyword">static</span> <span class="keyword">protected</span> <a class="code" href="classDatabase_a835e96936183cb872b1dce649e11ba41.html#a835e96936183cb872b1dce649e11ba41">$ignoreTargets</a> = array();
<a name="l01352"></a>01352 
<a name="l01358"></a><a class="code" href="classDatabase_a96a67e90069e624c96c59e6c7f7a95d7.html#a96a67e90069e624c96c59e6c7f7a95d7">01358</a>   <span class="keyword">static</span> <span class="keyword">protected</span> <a class="code" href="classDatabase_a96a67e90069e624c96c59e6c7f7a95d7.html#a96a67e90069e624c96c59e6c7f7a95d7">$activeKey</a> = <span class="stringliteral">&#39;default&#39;</span>;
<a name="l01359"></a>01359 
<a name="l01372"></a><a class="code" href="classDatabase_aad829292749f9df6fa49b9dbe38882e3.html#aad829292749f9df6fa49b9dbe38882e3">01372</a>   <span class="keyword">static</span> <span class="keyword">protected</span> <a class="code" href="classDatabase_aad829292749f9df6fa49b9dbe38882e3.html#aad829292749f9df6fa49b9dbe38882e3">$logs</a> = array();
<a name="l01373"></a>01373 
<a name="l01389"></a><a class="code" href="classDatabase_a4785b9bc2918dacdcc861b261513715d.html#a4785b9bc2918dacdcc861b261513715d">01389</a>   <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classDatabase_a4785b9bc2918dacdcc861b261513715d.html#a4785b9bc2918dacdcc861b261513715d" title="Starts logging a given logging key on the specified connection.">startLog</a>($logging_key, $key = <span class="stringliteral">&#39;default&#39;</span>) {
<a name="l01390"></a>01390     <span class="keywordflow">if</span> (empty(self::$logs[$key])) {
<a name="l01391"></a>01391       self::$logs[$key] = <span class="keyword">new</span> <a class="code" href="classDatabaseLog.html" title="Database query logger.">DatabaseLog</a>($key);
<a name="l01392"></a>01392 
<a name="l01393"></a>01393       <span class="comment">// Every target already active for this connection key needs to have the</span>
<a name="l01394"></a>01394       <span class="comment">// logging object associated with it.</span>
<a name="l01395"></a>01395       <span class="keywordflow">if</span> (!empty(self::$connections[$key])) {
<a name="l01396"></a>01396         <span class="keywordflow">foreach</span> (self::$connections[$key] as $connection) {
<a name="l01397"></a>01397           $connection-&gt;setLogger(self::$logs[$key]);
<a name="l01398"></a>01398         }
<a name="l01399"></a>01399       }
<a name="l01400"></a>01400     }
<a name="l01401"></a>01401 
<a name="l01402"></a>01402     self::$logs[$key]-&gt;start($logging_key);
<a name="l01403"></a>01403     <span class="keywordflow">return</span> self::$logs[$key];
<a name="l01404"></a>01404   }
<a name="l01405"></a>01405 
<a name="l01424"></a><a class="code" href="classDatabase_a0a11c88ba9539bff6131c8fae25e504d.html#a0a11c88ba9539bff6131c8fae25e504d">01424</a>   <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classDatabase_a0a11c88ba9539bff6131c8fae25e504d.html#a0a11c88ba9539bff6131c8fae25e504d" title="Retrieves the queries logged on for given logging key.">getLog</a>($logging_key, $key = <span class="stringliteral">&#39;default&#39;</span>) {
<a name="l01425"></a>01425     <span class="keywordflow">if</span> (empty(self::$logs[$key])) {
<a name="l01426"></a>01426       <span class="keywordflow">return</span> NULL;
<a name="l01427"></a>01427     }
<a name="l01428"></a>01428     $queries = self::$logs[$key]-&gt;get($logging_key);
<a name="l01429"></a>01429     self::$logs[$key]-&gt;end($logging_key);
<a name="l01430"></a>01430     <span class="keywordflow">return</span> $queries;
<a name="l01431"></a>01431   }
<a name="l01432"></a>01432 
<a name="l01444"></a><a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf">01444</a>   <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">getConnection</a>($target = <span class="stringliteral">&#39;default&#39;</span>, $key = NULL) {
<a name="l01445"></a>01445     <span class="keywordflow">if</span> (!isset($key)) {
<a name="l01446"></a>01446       <span class="comment">// By default, we want the active connection, set in setActiveConnection.</span>
<a name="l01447"></a>01447       $key = <a class="code" href="classDatabase_a96a67e90069e624c96c59e6c7f7a95d7.html#a96a67e90069e624c96c59e6c7f7a95d7">self::$activeKey</a>;
<a name="l01448"></a>01448     }
<a name="l01449"></a>01449     <span class="comment">// If the requested target does not exist, or if it is ignored, we fall back</span>
<a name="l01450"></a>01450     <span class="comment">// to the default target. The target is typically either &quot;default&quot; or</span>
<a name="l01451"></a>01451     <span class="comment">// &quot;slave&quot;, indicating to use a slave SQL server if one is available. If</span>
<a name="l01452"></a>01452     <span class="comment">// it&#39;s not available, then the default/master server is the correct server</span>
<a name="l01453"></a>01453     <span class="comment">// to use.</span>
<a name="l01454"></a>01454     <span class="keywordflow">if</span> (!empty(self::$ignoreTargets[$key][$target]) || !isset(self::$databaseInfo[$key][$target])) {
<a name="l01455"></a>01455       $target = <span class="stringliteral">&#39;default&#39;</span>;
<a name="l01456"></a>01456     }
<a name="l01457"></a>01457 
<a name="l01458"></a>01458     <span class="keywordflow">if</span> (!isset(self::$connections[$key][$target])) {
<a name="l01459"></a>01459       <span class="comment">// If necessary, a new connection is opened.</span>
<a name="l01460"></a>01460       self::$connections[$key][$target] = <a class="code" href="classDatabase_a40724407e492d149e9b45e7d5e90ec37.html#a40724407e492d149e9b45e7d5e90ec37" title="Opens a connection to the server specified by the given key and target.">self::openConnection</a>($key, $target);
<a name="l01461"></a>01461     }
<a name="l01462"></a>01462     <span class="keywordflow">return</span> self::$connections[$key][$target];
<a name="l01463"></a>01463   }
<a name="l01464"></a>01464 
<a name="l01475"></a><a class="code" href="classDatabase_ac67e96fee55a1ec6820a6678428d7b91.html#ac67e96fee55a1ec6820a6678428d7b91">01475</a>   <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classDatabase_ac67e96fee55a1ec6820a6678428d7b91.html#ac67e96fee55a1ec6820a6678428d7b91" title="Determines if there is an active connection.">isActiveConnection</a>() {
<a name="l01476"></a>01476     <span class="keywordflow">return</span> !empty(self::$activeKey) &amp;&amp; !empty(self::$connections) &amp;&amp; !empty(self::$connections[self::$activeKey]);
<a name="l01477"></a>01477   }
<a name="l01478"></a>01478 
<a name="l01485"></a><a class="code" href="classDatabase_afee50f4c59d97ccdcc6c4088adf7bc4e.html#afee50f4c59d97ccdcc6c4088adf7bc4e">01485</a>   <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classDatabase_afee50f4c59d97ccdcc6c4088adf7bc4e.html#afee50f4c59d97ccdcc6c4088adf7bc4e" title="Sets the active connection to the specified key.">setActiveConnection</a>($key = <span class="stringliteral">&#39;default&#39;</span>) {
<a name="l01486"></a>01486     <span class="keywordflow">if</span> (empty(self::$databaseInfo)) {
<a name="l01487"></a>01487       <a class="code" href="classDatabase_a65d7ffd8cc0b81ead0e2a6ca0836343c.html#a65d7ffd8cc0b81ead0e2a6ca0836343c" title="Process the configuration file for database information.">self::parseConnectionInfo</a>();
<a name="l01488"></a>01488     }
<a name="l01489"></a>01489 
<a name="l01490"></a>01490     <span class="keywordflow">if</span> (!empty(self::$databaseInfo[$key])) {
<a name="l01491"></a>01491       $old_key = <a class="code" href="classDatabase_a96a67e90069e624c96c59e6c7f7a95d7.html#a96a67e90069e624c96c59e6c7f7a95d7">self::$activeKey</a>;
<a name="l01492"></a>01492       self::$activeKey = $key;
<a name="l01493"></a>01493       <span class="keywordflow">return</span> $old_key;
<a name="l01494"></a>01494     }
<a name="l01495"></a>01495   }
<a name="l01496"></a>01496 
<a name="l01500"></a><a class="code" href="classDatabase_a65d7ffd8cc0b81ead0e2a6ca0836343c.html#a65d7ffd8cc0b81ead0e2a6ca0836343c">01500</a>   <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classDatabase_a65d7ffd8cc0b81ead0e2a6ca0836343c.html#a65d7ffd8cc0b81ead0e2a6ca0836343c" title="Process the configuration file for database information.">parseConnectionInfo</a>() {
<a name="l01501"></a>01501     global <a class="code" href="default_8settings_8php_a97cde67402a68697692531e8b067f86f.html#a97cde67402a68697692531e8b067f86f" title="Database settings:">$databases</a>;
<a name="l01502"></a>01502 
<a name="l01503"></a>01503     $database_info = is_array($databases) ? $databases : array();
<a name="l01504"></a>01504     <span class="keywordflow">foreach</span> ($database_info as $index =&gt; $info) {
<a name="l01505"></a>01505       <span class="keywordflow">foreach</span> ($database_info[$index] as $target =&gt; $value) {
<a name="l01506"></a>01506         <span class="comment">// If there is no &quot;driver&quot; property, then we assume it&#39;s an array of</span>
<a name="l01507"></a>01507         <span class="comment">// possible connections for this target. Pick one at random. That allows</span>
<a name="l01508"></a>01508         <span class="comment">//  us to have, for example, multiple slave servers.</span>
<a name="l01509"></a>01509         <span class="keywordflow">if</span> (empty($value[<span class="stringliteral">&#39;driver&#39;</span>])) {
<a name="l01510"></a>01510           $database_info[$index][$target] = $database_info[$index][$target][mt_rand(0, count($database_info[$index][$target]) - 1)];
<a name="l01511"></a>01511         }
<a name="l01512"></a>01512 
<a name="l01513"></a>01513         <span class="comment">// Parse the prefix information.</span>
<a name="l01514"></a>01514         <span class="keywordflow">if</span> (!isset($database_info[$index][$target][<span class="stringliteral">&#39;prefix&#39;</span>])) {
<a name="l01515"></a>01515           <span class="comment">// Default to an empty prefix.</span>
<a name="l01516"></a>01516           $database_info[$index][$target][<span class="stringliteral">&#39;prefix&#39;</span>] = array(
<a name="l01517"></a>01517             <span class="stringliteral">&#39;default&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l01518"></a>01518           );
<a name="l01519"></a>01519         }
<a name="l01520"></a>01520         elseif (!is_array($database_info[$index][$target][<span class="stringliteral">&#39;prefix&#39;</span>])) {
<a name="l01521"></a>01521           <span class="comment">// Transform the flat form into an array form.</span>
<a name="l01522"></a>01522           $database_info[$index][$target][<span class="stringliteral">&#39;prefix&#39;</span>] = array(
<a name="l01523"></a>01523             <span class="stringliteral">&#39;default&#39;</span> =&gt; $database_info[$index][$target][<span class="stringliteral">&#39;prefix&#39;</span>],
<a name="l01524"></a>01524           );
<a name="l01525"></a>01525         }
<a name="l01526"></a>01526       }
<a name="l01527"></a>01527     }
<a name="l01528"></a>01528 
<a name="l01529"></a>01529     <span class="keywordflow">if</span> (!is_array(self::$databaseInfo)) {
<a name="l01530"></a>01530       self::$databaseInfo = $database_info;
<a name="l01531"></a>01531     }
<a name="l01532"></a>01532 
<a name="l01533"></a>01533     <span class="comment">// Merge the new $database_info into the existing.</span>
<a name="l01534"></a>01534     <span class="comment">// array_merge_recursive() cannot be used, as it would make multiple</span>
<a name="l01535"></a>01535     <span class="comment">// database, user, and password keys in the same database array.</span>
<a name="l01536"></a>01536     <span class="keywordflow">else</span> {
<a name="l01537"></a>01537       <span class="keywordflow">foreach</span> ($database_info as $database_key =&gt; $database_values) {
<a name="l01538"></a>01538         <span class="keywordflow">foreach</span> ($database_values as $target =&gt; $target_values) {
<a name="l01539"></a>01539           self::$databaseInfo[$database_key][$target] = $target_values;
<a name="l01540"></a>01540         }
<a name="l01541"></a>01541       }
<a name="l01542"></a>01542     }
<a name="l01543"></a>01543   }
<a name="l01544"></a>01544 
<a name="l01565"></a><a class="code" href="classDatabase_a8b2462c18a8a4fea7c350e1123d3c6e7.html#a8b2462c18a8a4fea7c350e1123d3c6e7">01565</a>   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classDatabase_a8b2462c18a8a4fea7c350e1123d3c6e7.html#a8b2462c18a8a4fea7c350e1123d3c6e7" title="Adds database connection information for a given key/target.">addConnectionInfo</a>($key, $target, $info) {
<a name="l01566"></a>01566     <span class="keywordflow">if</span> (empty(self::$databaseInfo[$key][$target])) {
<a name="l01567"></a>01567       self::$databaseInfo[$key][$target] = $info;
<a name="l01568"></a>01568     }
<a name="l01569"></a>01569   }
<a name="l01570"></a>01570 
<a name="l01577"></a><a class="code" href="classDatabase_a4ddbb695ae89b6180e0390c231b70ea5.html#a4ddbb695ae89b6180e0390c231b70ea5">01577</a>   <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classDatabase_a4ddbb695ae89b6180e0390c231b70ea5.html#a4ddbb695ae89b6180e0390c231b70ea5" title="Gets information on the specified database connection.">getConnectionInfo</a>($key = <span class="stringliteral">&#39;default&#39;</span>) {
<a name="l01578"></a>01578     <span class="keywordflow">if</span> (empty(self::$databaseInfo)) {
<a name="l01579"></a>01579       <a class="code" href="classDatabase_a65d7ffd8cc0b81ead0e2a6ca0836343c.html#a65d7ffd8cc0b81ead0e2a6ca0836343c" title="Process the configuration file for database information.">self::parseConnectionInfo</a>();
<a name="l01580"></a>01580     }
<a name="l01581"></a>01581 
<a name="l01582"></a>01582     <span class="keywordflow">if</span> (!empty(self::$databaseInfo[$key])) {
<a name="l01583"></a>01583       <span class="keywordflow">return</span> self::$databaseInfo[$key];
<a name="l01584"></a>01584     }
<a name="l01585"></a>01585   }
<a name="l01586"></a>01586 
<a name="l01597"></a><a class="code" href="classDatabase_aa0401fcf5edecc7f81cf32251aeee593.html#aa0401fcf5edecc7f81cf32251aeee593">01597</a>   <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classDatabase_aa0401fcf5edecc7f81cf32251aeee593.html#aa0401fcf5edecc7f81cf32251aeee593" title="Rename a connection and its corresponding connection information.">renameConnection</a>($old_key, $new_key) {
<a name="l01598"></a>01598     <span class="keywordflow">if</span> (empty(self::$databaseInfo)) {
<a name="l01599"></a>01599       <a class="code" href="classDatabase_a65d7ffd8cc0b81ead0e2a6ca0836343c.html#a65d7ffd8cc0b81ead0e2a6ca0836343c" title="Process the configuration file for database information.">self::parseConnectionInfo</a>();
<a name="l01600"></a>01600     }
<a name="l01601"></a>01601 
<a name="l01602"></a>01602     <span class="keywordflow">if</span> (!empty(self::$databaseInfo[$old_key]) &amp;&amp; empty(self::$databaseInfo[$new_key])) {
<a name="l01603"></a>01603       <span class="comment">// Migrate the database connection information.</span>
<a name="l01604"></a>01604       self::$databaseInfo[$new_key] = self::$databaseInfo[$old_key];
<a name="l01605"></a>01605       unset(self::$databaseInfo[$old_key]);
<a name="l01606"></a>01606 
<a name="l01607"></a>01607       <span class="comment">// Migrate over the DatabaseConnection object if it exists.</span>
<a name="l01608"></a>01608       <span class="keywordflow">if</span> (isset(self::$connections[$old_key])) {
<a name="l01609"></a>01609         self::$connections[$new_key] = self::$connections[$old_key];
<a name="l01610"></a>01610         unset(self::$connections[$old_key]);
<a name="l01611"></a>01611       }
<a name="l01612"></a>01612 
<a name="l01613"></a>01613       <span class="keywordflow">return</span> TRUE;
<a name="l01614"></a>01614     }
<a name="l01615"></a>01615     <span class="keywordflow">else</span> {
<a name="l01616"></a>01616       <span class="keywordflow">return</span> FALSE;
<a name="l01617"></a>01617     }
<a name="l01618"></a>01618   }
<a name="l01619"></a>01619 
<a name="l01628"></a><a class="code" href="classDatabase_a5c2f9463e38304080a2d555a588010ef.html#a5c2f9463e38304080a2d555a588010ef">01628</a>   <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classDatabase_a5c2f9463e38304080a2d555a588010ef.html#a5c2f9463e38304080a2d555a588010ef" title="Remove a connection and its corresponding connection information.">removeConnection</a>($key) {
<a name="l01629"></a>01629     <span class="keywordflow">if</span> (isset(self::$databaseInfo[$key])) {
<a name="l01630"></a>01630       unset(self::$databaseInfo[$key]);
<a name="l01631"></a>01631       unset(self::$connections[$key]);
<a name="l01632"></a>01632       <span class="keywordflow">return</span> TRUE;
<a name="l01633"></a>01633     }
<a name="l01634"></a>01634     <span class="keywordflow">else</span> {
<a name="l01635"></a>01635       <span class="keywordflow">return</span> FALSE;
<a name="l01636"></a>01636     }
<a name="l01637"></a>01637   }
<a name="l01638"></a>01638 
<a name="l01651"></a><a class="code" href="classDatabase_a40724407e492d149e9b45e7d5e90ec37.html#a40724407e492d149e9b45e7d5e90ec37">01651</a>   <span class="keyword">final</span> <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classDatabase_a40724407e492d149e9b45e7d5e90ec37.html#a40724407e492d149e9b45e7d5e90ec37" title="Opens a connection to the server specified by the given key and target.">openConnection</a>($key, $target) {
<a name="l01652"></a>01652     <span class="keywordflow">if</span> (empty(self::$databaseInfo)) {
<a name="l01653"></a>01653       <a class="code" href="classDatabase_a65d7ffd8cc0b81ead0e2a6ca0836343c.html#a65d7ffd8cc0b81ead0e2a6ca0836343c" title="Process the configuration file for database information.">self::parseConnectionInfo</a>();
<a name="l01654"></a>01654     }
<a name="l01655"></a>01655 
<a name="l01656"></a>01656     <span class="comment">// If the requested database does not exist then it is an unrecoverable</span>
<a name="l01657"></a>01657     <span class="comment">// error.</span>
<a name="l01658"></a>01658     <span class="keywordflow">if</span> (!isset(self::$databaseInfo[$key])) {
<a name="l01659"></a>01659       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDatabaseConnectionNotDefinedException.html" title="Exception thrown if an undefined database connection is requested.">DatabaseConnectionNotDefinedException</a>(<span class="stringliteral">&#39;The specified database connection is not defined: &#39;</span> . $key);
<a name="l01660"></a>01660     }
<a name="l01661"></a>01661 
<a name="l01662"></a>01662     <span class="keywordflow">if</span> (!$driver = self::$databaseInfo[$key][$target][<span class="stringliteral">&#39;driver&#39;</span>]) {
<a name="l01663"></a>01663       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDatabaseDriverNotSpecifiedException.html" title="Exception thrown if no driver is specified for a database connection.">DatabaseDriverNotSpecifiedException</a>(<span class="stringliteral">&#39;Driver not specified for this database connection: &#39;</span> . $key);
<a name="l01664"></a>01664     }
<a name="l01665"></a>01665 
<a name="l01666"></a>01666     <span class="comment">// We cannot rely on the registry yet, because the registry requires an</span>
<a name="l01667"></a>01667     <span class="comment">// open database connection.</span>
<a name="l01668"></a>01668     $driver_class = <span class="stringliteral">&#39;DatabaseConnection_&#39;</span> . $driver;
<a name="l01669"></a>01669     require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/database/&#39;</span> . $driver . <span class="stringliteral">&#39;/database.inc&#39;</span>;
<a name="l01670"></a>01670     $new_connection = <span class="keyword">new</span> $driver_class(self::$databaseInfo[$key][$target]);
<a name="l01671"></a>01671     $new_connection-&gt;setTarget($target);
<a name="l01672"></a>01672     $new_connection-&gt;setKey($key);
<a name="l01673"></a>01673 
<a name="l01674"></a>01674     <span class="comment">// If we have any active logging objects for this connection key, we need</span>
<a name="l01675"></a>01675     <span class="comment">// to associate them with the connection we just opened.</span>
<a name="l01676"></a>01676     <span class="keywordflow">if</span> (!empty(self::$logs[$key])) {
<a name="l01677"></a>01677       $new_connection-&gt;setLogger(self::$logs[$key]);
<a name="l01678"></a>01678     }
<a name="l01679"></a>01679 
<a name="l01680"></a>01680     <span class="keywordflow">return</span> $new_connection;
<a name="l01681"></a>01681   }
<a name="l01682"></a>01682 
<a name="l01692"></a><a class="code" href="classDatabase_a1e6a2484bc6ea4ac8ce820dd12baaa5b.html#a1e6a2484bc6ea4ac8ce820dd12baaa5b">01692</a>   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classDatabase_a1e6a2484bc6ea4ac8ce820dd12baaa5b.html#a1e6a2484bc6ea4ac8ce820dd12baaa5b" title="Closes a connection to the server specified by the given key and target.">closeConnection</a>($target = NULL, $key = NULL) {
<a name="l01693"></a>01693     <span class="comment">// Gets the active connection by default.</span>
<a name="l01694"></a>01694     <span class="keywordflow">if</span> (!isset($key)) {
<a name="l01695"></a>01695       $key = <a class="code" href="classDatabase_a96a67e90069e624c96c59e6c7f7a95d7.html#a96a67e90069e624c96c59e6c7f7a95d7">self::$activeKey</a>;
<a name="l01696"></a>01696     }
<a name="l01697"></a>01697     <span class="comment">// To close the connection, we need to unset the static variable.</span>
<a name="l01698"></a>01698     <span class="keywordflow">if</span> (isset($target)) {
<a name="l01699"></a>01699       unset(self::$connections[$key][$target]);
<a name="l01700"></a>01700     }
<a name="l01701"></a>01701     <span class="keywordflow">else</span> {
<a name="l01702"></a>01702       unset(self::$connections[$key]);
<a name="l01703"></a>01703     }
<a name="l01704"></a>01704   }
<a name="l01705"></a>01705 
<a name="l01718"></a><a class="code" href="classDatabase_a574ba08b096e4051b221166fc0bc4d21.html#a574ba08b096e4051b221166fc0bc4d21">01718</a>   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classDatabase_a574ba08b096e4051b221166fc0bc4d21.html#a574ba08b096e4051b221166fc0bc4d21" title="Instructs the system to temporarily ignore a given key/target.">ignoreTarget</a>($key, $target) {
<a name="l01719"></a>01719     self::$ignoreTargets[$key][$target] = TRUE;
<a name="l01720"></a>01720   }
<a name="l01721"></a>01721 
<a name="l01730"></a><a class="code" href="classDatabase_a25fe33ffa87aaf80ff680e356230d9e2.html#a25fe33ffa87aaf80ff680e356230d9e2">01730</a>   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classDatabase_a25fe33ffa87aaf80ff680e356230d9e2.html#a25fe33ffa87aaf80ff680e356230d9e2" title="Load a file for the database that might hold a class.">loadDriverFile</a>($driver, array $files = array()) {
<a name="l01731"></a>01731     <span class="keyword">static</span> $base_path;
<a name="l01732"></a>01732 
<a name="l01733"></a>01733     <span class="keywordflow">if</span> (empty($base_path)) {
<a name="l01734"></a>01734       $base_path = dirname(realpath(__FILE__));
<a name="l01735"></a>01735     }
<a name="l01736"></a>01736 
<a name="l01737"></a>01737     $driver_base_path = <span class="stringliteral">&quot;$base_path/$driver&quot;</span>;
<a name="l01738"></a>01738     <span class="keywordflow">foreach</span> ($files as $file) {
<a name="l01739"></a>01739       <span class="comment">// Load the base file first so that classes extending base classes will</span>
<a name="l01740"></a>01740       <span class="comment">// have the base class loaded.</span>
<a name="l01741"></a>01741       <span class="keywordflow">foreach</span> (array(<span class="stringliteral">&quot;$base_path/$file&quot;</span>, <span class="stringliteral">&quot;$driver_base_path/$file&quot;</span>) as $filename) {
<a name="l01742"></a>01742         <span class="comment">// The OS caches file_exists() and PHP caches require_once(), so</span>
<a name="l01743"></a>01743         <span class="comment">// we&#39;ll let both of those take care of performance here.</span>
<a name="l01744"></a>01744         <span class="keywordflow">if</span> (file_exists($filename)) {
<a name="l01745"></a>01745           require_once $filename;
<a name="l01746"></a>01746         }
<a name="l01747"></a>01747       }
<a name="l01748"></a>01748     }
<a name="l01749"></a>01749   }
<a name="l01750"></a>01750 }
<a name="l01751"></a>01751 
<a name="l01755"></a><a class="code" href="classDatabaseTransactionNoActiveException.html">01755</a> <span class="keyword">class </span><a class="code" href="classDatabaseTransactionNoActiveException.html" title="Exception for when popTransaction() is called with no active transaction.">DatabaseTransactionNoActiveException</a> <span class="keyword">extends</span> <a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> { }
<a name="l01756"></a>01756 
<a name="l01760"></a><a class="code" href="classDatabaseTransactionNameNonUniqueException.html">01760</a> <span class="keyword">class </span><a class="code" href="classDatabaseTransactionNameNonUniqueException.html" title="Exception thrown when a savepoint or transaction name occurs twice.">DatabaseTransactionNameNonUniqueException</a> <span class="keyword">extends</span> <a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> { }
<a name="l01761"></a>01761 
<a name="l01765"></a><a class="code" href="classDatabaseTransactionCommitFailedException.html">01765</a> <span class="keyword">class </span><a class="code" href="classDatabaseTransactionCommitFailedException.html" title="Exception thrown when a commit() function fails.">DatabaseTransactionCommitFailedException</a> <span class="keyword">extends</span> <a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> { }
<a name="l01766"></a>01766 
<a name="l01773"></a><a class="code" href="classDatabaseTransactionExplicitCommitNotAllowedException.html">01773</a> <span class="keyword">class </span><a class="code" href="classDatabaseTransactionExplicitCommitNotAllowedException.html" title="Exception to deny attempts to explicitly manage transactions.">DatabaseTransactionExplicitCommitNotAllowedException</a> <span class="keyword">extends</span> <a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> { }
<a name="l01774"></a>01774 
<a name="l01778"></a><a class="code" href="classDatabaseTransactionOutOfOrderException.html">01778</a> <span class="keyword">class </span><a class="code" href="classDatabaseTransactionOutOfOrderException.html" title="Exception thrown when a rollback() resulted in other active transactions being rolled-back.">DatabaseTransactionOutOfOrderException</a> <span class="keyword">extends</span> <a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> { }
<a name="l01779"></a>01779 
<a name="l01786"></a><a class="code" href="classInvalidMergeQueryException.html">01786</a> <span class="keyword">class </span><a class="code" href="classInvalidMergeQueryException.html" title="Exception thrown for merge queries that do not make semantic sense.">InvalidMergeQueryException</a> <span class="keyword">extends</span> <a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> {}
<a name="l01787"></a>01787 
<a name="l01794"></a><a class="code" href="classFieldsOverlapException.html">01794</a> <span class="keyword">class </span><a class="code" href="classFieldsOverlapException.html" title="Exception thrown if an insert query specifies a field twice.">FieldsOverlapException</a> <span class="keyword">extends</span> <a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> {}
<a name="l01795"></a>01795 
<a name="l01799"></a><a class="code" href="classNoFieldsException.html">01799</a> <span class="keyword">class </span><a class="code" href="classNoFieldsException.html" title="Exception thrown if an insert query doesn&#39;t specify insert or default fields.">NoFieldsException</a> <span class="keyword">extends</span> <a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> {}
<a name="l01800"></a>01800 
<a name="l01804"></a><a class="code" href="classDatabaseConnectionNotDefinedException.html">01804</a> <span class="keyword">class </span><a class="code" href="classDatabaseConnectionNotDefinedException.html" title="Exception thrown if an undefined database connection is requested.">DatabaseConnectionNotDefinedException</a> <span class="keyword">extends</span> <a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> {}
<a name="l01805"></a>01805 
<a name="l01809"></a><a class="code" href="classDatabaseDriverNotSpecifiedException.html">01809</a> <span class="keyword">class </span><a class="code" href="classDatabaseDriverNotSpecifiedException.html" title="Exception thrown if no driver is specified for a database connection.">DatabaseDriverNotSpecifiedException</a> <span class="keyword">extends</span> <a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> {}
<a name="l01810"></a>01810 
<a name="l01811"></a>01811 
<a name="l01831"></a><a class="code" href="classDatabaseTransaction.html">01831</a> <span class="keyword">class </span><a class="code" href="classDatabaseTransaction.html" title="A wrapper class for creating and managing database transactions.">DatabaseTransaction</a> {
<a name="l01832"></a>01832 
<a name="l01838"></a><a class="code" href="classDatabaseTransaction_a2dd9c7fc6e8a3cc51ee3b224327d26db.html#a2dd9c7fc6e8a3cc51ee3b224327d26db">01838</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseTransaction_a2dd9c7fc6e8a3cc51ee3b224327d26db.html#a2dd9c7fc6e8a3cc51ee3b224327d26db">$connection</a>;
<a name="l01839"></a>01839 
<a name="l01845"></a><a class="code" href="classDatabaseTransaction_ab01b1e7c761fae2fbf64a29c5d7ec411.html#ab01b1e7c761fae2fbf64a29c5d7ec411">01845</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseTransaction_ab01b1e7c761fae2fbf64a29c5d7ec411.html#ab01b1e7c761fae2fbf64a29c5d7ec411">$rolledBack</a> = FALSE;
<a name="l01846"></a>01846 
<a name="l01853"></a><a class="code" href="classDatabaseTransaction_a70011229968a0f37f3a2be5ab72d03f6.html#a70011229968a0f37f3a2be5ab72d03f6">01853</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseTransaction_a70011229968a0f37f3a2be5ab72d03f6.html#a70011229968a0f37f3a2be5ab72d03f6" title="The name of the transaction.">$name</a>;
<a name="l01854"></a>01854 
<a name="l01855"></a><a class="code" href="classDatabaseTransaction_a4e3dbaab5d54ff0e9e87ebb297acb23c.html#a4e3dbaab5d54ff0e9e87ebb297acb23c">01855</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseTransaction_a4e3dbaab5d54ff0e9e87ebb297acb23c.html#a4e3dbaab5d54ff0e9e87ebb297acb23c">__construct</a>(<a class="code" href="classDatabaseConnection.html" title="Base Database API class.">DatabaseConnection</a> &amp;<a class="code" href="classDatabaseTransaction_a2dd9c7fc6e8a3cc51ee3b224327d26db.html#a2dd9c7fc6e8a3cc51ee3b224327d26db">$connection</a>, <a class="code" href="classDatabaseTransaction_a70011229968a0f37f3a2be5ab72d03f6.html#a70011229968a0f37f3a2be5ab72d03f6" title="The name of the transaction.">$name</a> = NULL) {
<a name="l01856"></a>01856     $this-&gt;connection = &amp;<a class="code" href="classDatabaseTransaction_a2dd9c7fc6e8a3cc51ee3b224327d26db.html#a2dd9c7fc6e8a3cc51ee3b224327d26db">$connection</a>;
<a name="l01857"></a>01857     <span class="comment">// If there is no transaction depth, then no transaction has started. Name</span>
<a name="l01858"></a>01858     <span class="comment">// the transaction &#39;drupal_transaction&#39;.</span>
<a name="l01859"></a>01859     <span class="keywordflow">if</span> (!$depth = $connection-&gt;<a class="code" href="classDatabaseConnection_a6b2631c56f4951032f30a7c519a4837e.html#a6b2631c56f4951032f30a7c519a4837e" title="Determines current transaction depth.">transactionDepth</a>()) {
<a name="l01860"></a>01860       $this-&gt;<a class="code" href="classDatabaseTransaction_ae1a70609e1ea2bb1e3d7e58f7e19e0ed.html#ae1a70609e1ea2bb1e3d7e58f7e19e0ed" title="Retrieves the name of the transaction or savepoint.">name</a> = <span class="stringliteral">&#39;drupal_transaction&#39;</span>;
<a name="l01861"></a>01861     }
<a name="l01862"></a>01862     <span class="comment">// Within transactions, savepoints are used. Each savepoint requires a</span>
<a name="l01863"></a>01863     <span class="comment">// name. So if no name is present we need to create one.</span>
<a name="l01864"></a>01864     elseif (!<a class="code" href="classDatabaseTransaction_a70011229968a0f37f3a2be5ab72d03f6.html#a70011229968a0f37f3a2be5ab72d03f6" title="The name of the transaction.">$name</a>) {
<a name="l01865"></a>01865       $this-&gt;<a class="code" href="classDatabaseTransaction_ae1a70609e1ea2bb1e3d7e58f7e19e0ed.html#ae1a70609e1ea2bb1e3d7e58f7e19e0ed" title="Retrieves the name of the transaction or savepoint.">name</a> = <span class="stringliteral">&#39;savepoint_&#39;</span> . $depth;
<a name="l01866"></a>01866     }
<a name="l01867"></a>01867     <span class="keywordflow">else</span> {
<a name="l01868"></a>01868       $this-&gt;<a class="code" href="classDatabaseTransaction_ae1a70609e1ea2bb1e3d7e58f7e19e0ed.html#ae1a70609e1ea2bb1e3d7e58f7e19e0ed" title="Retrieves the name of the transaction or savepoint.">name</a> = <a class="code" href="classDatabaseTransaction_a70011229968a0f37f3a2be5ab72d03f6.html#a70011229968a0f37f3a2be5ab72d03f6" title="The name of the transaction.">$name</a>;
<a name="l01869"></a>01869     }
<a name="l01870"></a>01870     $this-&gt;connection-&gt;pushTransaction($this-&gt;<a class="code" href="classDatabaseTransaction_ae1a70609e1ea2bb1e3d7e58f7e19e0ed.html#ae1a70609e1ea2bb1e3d7e58f7e19e0ed" title="Retrieves the name of the transaction or savepoint.">name</a>);
<a name="l01871"></a>01871   }
<a name="l01872"></a>01872 
<a name="l01873"></a><a class="code" href="classDatabaseTransaction_a53bbbd4998387991cf17d5f5168c410f.html#a53bbbd4998387991cf17d5f5168c410f">01873</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseTransaction_a53bbbd4998387991cf17d5f5168c410f.html#a53bbbd4998387991cf17d5f5168c410f">__destruct</a>() {
<a name="l01874"></a>01874     <span class="comment">// If we rolled back then the transaction would have already been popped.</span>
<a name="l01875"></a>01875     <span class="keywordflow">if</span> (!$this-&gt;rolledBack) {
<a name="l01876"></a>01876       $this-&gt;connection-&gt;popTransaction($this-&gt;<a class="code" href="classDatabaseTransaction_ae1a70609e1ea2bb1e3d7e58f7e19e0ed.html#ae1a70609e1ea2bb1e3d7e58f7e19e0ed" title="Retrieves the name of the transaction or savepoint.">name</a>);
<a name="l01877"></a>01877     }
<a name="l01878"></a>01878   }
<a name="l01879"></a>01879 
<a name="l01883"></a><a class="code" href="classDatabaseTransaction_ae1a70609e1ea2bb1e3d7e58f7e19e0ed.html#ae1a70609e1ea2bb1e3d7e58f7e19e0ed">01883</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseTransaction_ae1a70609e1ea2bb1e3d7e58f7e19e0ed.html#ae1a70609e1ea2bb1e3d7e58f7e19e0ed" title="Retrieves the name of the transaction or savepoint.">name</a>() {
<a name="l01884"></a>01884     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDatabaseTransaction_ae1a70609e1ea2bb1e3d7e58f7e19e0ed.html#ae1a70609e1ea2bb1e3d7e58f7e19e0ed" title="Retrieves the name of the transaction or savepoint.">name</a>;
<a name="l01885"></a>01885   }
<a name="l01886"></a>01886 
<a name="l01899"></a><a class="code" href="classDatabaseTransaction_a51bdf8ca9423cc331e877dbf43cd6981.html#a51bdf8ca9423cc331e877dbf43cd6981">01899</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseTransaction_a51bdf8ca9423cc331e877dbf43cd6981.html#a51bdf8ca9423cc331e877dbf43cd6981" title="Rolls back the current transaction.">rollback</a>() {
<a name="l01900"></a>01900     $this-&gt;rolledBack = TRUE;
<a name="l01901"></a>01901     $this-&gt;connection-&gt;rollback($this-&gt;<a class="code" href="classDatabaseTransaction_ae1a70609e1ea2bb1e3d7e58f7e19e0ed.html#ae1a70609e1ea2bb1e3d7e58f7e19e0ed" title="Retrieves the name of the transaction or savepoint.">name</a>);
<a name="l01902"></a>01902   }
<a name="l01903"></a>01903 }
<a name="l01904"></a>01904 
<a name="l01924"></a><a class="code" href="interfaceDatabaseStatementInterface.html">01924</a> <span class="keyword">interface </span><a class="code" href="interfaceDatabaseStatementInterface.html" title="Represents a prepared statement.">DatabaseStatementInterface</a> <span class="keyword">extends</span> Traversable {
<a name="l01925"></a>01925 
<a name="l01938"></a>01938   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceDatabaseStatementInterface_a716e454a44a7667f7a90b90c1a6fe3eb.html#a716e454a44a7667f7a90b90c1a6fe3eb" title="Executes a prepared statement.">execute</a>($args = array(), $options = array());
<a name="l01939"></a>01939 
<a name="l01946"></a>01946   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceDatabaseStatementInterface_a2c248a565c623713d8e5ddf0ba83880d.html#a2c248a565c623713d8e5ddf0ba83880d" title="Gets the query string of this statement.">getQueryString</a>();
<a name="l01947"></a>01947 
<a name="l01955"></a>01955   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceDatabaseStatementInterface_a97657e1cf89c6e1700f7bfa0e90deaf5.html#a97657e1cf89c6e1700f7bfa0e90deaf5" title="Returns the number of rows affected by the last SQL statement.">rowCount</a>();
<a name="l01956"></a>01956 
<a name="l01974"></a>01974   <span class="comment">// public function setFetchMode($mode, $a1 = NULL, $a2 = array());</span>
<a name="l01975"></a>01975 
<a name="l01993"></a>01993   <span class="comment">// public function fetch($mode = NULL, $cursor_orientation = NULL, $cursor_offset = NULL);</span>
<a name="l01994"></a>01994 
<a name="l02004"></a>02004   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceDatabaseStatementInterface_a66325e9222c90de0fc87c201652be9e4.html#a66325e9222c90de0fc87c201652be9e4" title="Sets the default fetch mode for this statement.">fetchField</a>($index = 0);
<a name="l02005"></a>02005 
<a name="l02012"></a>02012   <span class="comment">// public function fetchObject();</span>
<a name="l02013"></a>02013 
<a name="l02024"></a>02024   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceDatabaseStatementInterface_a754f04359c97c0866f5d80e785a24299.html#a754f04359c97c0866f5d80e785a24299" title="Fetches the next row and returns it as an object.">fetchAssoc</a>();
<a name="l02025"></a>02025 
<a name="l02039"></a>02039   <span class="comment">// function fetchAll($mode = NULL, $column_index = NULL, array $constructor_arguments);</span>
<a name="l02040"></a>02040 
<a name="l02052"></a>02052   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceDatabaseStatementInterface_a1c66bf4ef84ffd4710fa6545974cdf23.html#a1c66bf4ef84ffd4710fa6545974cdf23" title="Returns an array containing all of the result set rows.">fetchCol</a>($index = 0);
<a name="l02053"></a>02053 
<a name="l02072"></a>02072   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceDatabaseStatementInterface_a9ffce739d0b144c36fc60b0a7e8a9824.html#a9ffce739d0b144c36fc60b0a7e8a9824" title="Returns the entire result set as a single associative array.">fetchAllKeyed</a>($key_index = 0, $value_index = 1);
<a name="l02073"></a>02073 
<a name="l02091"></a>02091   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceDatabaseStatementInterface_a8be68ba0a27dc2f5358c5bcf3243108b.html#a8be68ba0a27dc2f5358c5bcf3243108b" title="Returns the result set as an associative array keyed by the given field.">fetchAllAssoc</a>($key, $fetch = NULL);
<a name="l02092"></a>02092 }
<a name="l02093"></a>02093 
<a name="l02105"></a><a class="code" href="classDatabaseStatementBase.html">02105</a> <span class="keyword">class </span><a class="code" href="classDatabaseStatementBase.html" title="Default implementation of DatabaseStatementInterface.">DatabaseStatementBase</a> <span class="keyword">extends</span> PDOStatement implements <a class="code" href="interfaceDatabaseStatementInterface.html" title="Represents a prepared statement.">DatabaseStatementInterface</a> {
<a name="l02106"></a>02106 
<a name="l02114"></a><a class="code" href="classDatabaseStatementBase_a27936318a48921d4cb271803ea786880.html#a27936318a48921d4cb271803ea786880">02114</a>   <span class="keyword">public</span> <a class="code" href="classDatabaseStatementBase_a27936318a48921d4cb271803ea786880.html#a27936318a48921d4cb271803ea786880">$dbh</a>;
<a name="l02115"></a>02115 
<a name="l02116"></a><a class="code" href="classDatabaseStatementBase_afffe31535cb72edb8fb427054e97bd36.html#afffe31535cb72edb8fb427054e97bd36">02116</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementBase_afffe31535cb72edb8fb427054e97bd36.html#afffe31535cb72edb8fb427054e97bd36">__construct</a>(<a class="code" href="classDatabaseStatementBase_a27936318a48921d4cb271803ea786880.html#a27936318a48921d4cb271803ea786880">$dbh</a>) {
<a name="l02117"></a>02117     $this-&gt;dbh = <a class="code" href="classDatabaseStatementBase_a27936318a48921d4cb271803ea786880.html#a27936318a48921d4cb271803ea786880">$dbh</a>;
<a name="l02118"></a>02118     $this-&gt;setFetchMode(PDO::FETCH_OBJ);
<a name="l02119"></a>02119   }
<a name="l02120"></a>02120 
<a name="l02121"></a><a class="code" href="classDatabaseStatementBase_a21521f5da2bf06d851bfb782c0d21b52.html#a21521f5da2bf06d851bfb782c0d21b52">02121</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementBase_a21521f5da2bf06d851bfb782c0d21b52.html#a21521f5da2bf06d851bfb782c0d21b52" title="Executes a prepared statement.">execute</a>($args = array(), $options = array()) {
<a name="l02122"></a>02122     <span class="keywordflow">if</span> (isset($options[<span class="stringliteral">&#39;fetch&#39;</span>])) {
<a name="l02123"></a>02123       <span class="keywordflow">if</span> (is_string($options[<span class="stringliteral">&#39;fetch&#39;</span>])) {
<a name="l02124"></a>02124         <span class="comment">// Default to an object. Note: db fields will be added to the object</span>
<a name="l02125"></a>02125         <span class="comment">// before the constructor is run. If you need to assign fields after</span>
<a name="l02126"></a>02126         <span class="comment">// the constructor is run, see http://drupal.org/node/315092.</span>
<a name="l02127"></a>02127         $this-&gt;setFetchMode(PDO::FETCH_CLASS, $options[<span class="stringliteral">&#39;fetch&#39;</span>]);
<a name="l02128"></a>02128       }
<a name="l02129"></a>02129       <span class="keywordflow">else</span> {
<a name="l02130"></a>02130         $this-&gt;setFetchMode($options[<span class="stringliteral">&#39;fetch&#39;</span>]);
<a name="l02131"></a>02131       }
<a name="l02132"></a>02132     }
<a name="l02133"></a>02133 
<a name="l02134"></a>02134     $logger = $this-&gt;dbh-&gt;getLogger();
<a name="l02135"></a>02135     <span class="keywordflow">if</span> (!empty($logger)) {
<a name="l02136"></a>02136       $query_start = microtime(TRUE);
<a name="l02137"></a>02137     }
<a name="l02138"></a>02138 
<a name="l02139"></a>02139     $return = <a class="code" href="classDatabaseStatementBase_a21521f5da2bf06d851bfb782c0d21b52.html#a21521f5da2bf06d851bfb782c0d21b52" title="Executes a prepared statement.">parent::execute</a>($args);
<a name="l02140"></a>02140 
<a name="l02141"></a>02141     <span class="keywordflow">if</span> (!empty($logger)) {
<a name="l02142"></a>02142       $query_end = microtime(TRUE);
<a name="l02143"></a>02143       $logger-&gt;log($this, $args, $query_end - $query_start);
<a name="l02144"></a>02144     }
<a name="l02145"></a>02145 
<a name="l02146"></a>02146     <span class="keywordflow">return</span> $return;
<a name="l02147"></a>02147   }
<a name="l02148"></a>02148 
<a name="l02149"></a><a class="code" href="classDatabaseStatementBase_afc56564e99ad8fe9c8c2549f77c37b3c.html#afc56564e99ad8fe9c8c2549f77c37b3c">02149</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementBase_afc56564e99ad8fe9c8c2549f77c37b3c.html#afc56564e99ad8fe9c8c2549f77c37b3c" title="Gets the query string of this statement.">getQueryString</a>() {
<a name="l02150"></a>02150     <span class="keywordflow">return</span> $this-&gt;queryString;
<a name="l02151"></a>02151   }
<a name="l02152"></a>02152 
<a name="l02153"></a><a class="code" href="classDatabaseStatementBase_a0f1eb97063c61c3c0dc98b946595bc5b.html#a0f1eb97063c61c3c0dc98b946595bc5b">02153</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementBase_a0f1eb97063c61c3c0dc98b946595bc5b.html#a0f1eb97063c61c3c0dc98b946595bc5b" title="Returns an array containing all of the result set rows.">fetchCol</a>($index = 0) {
<a name="l02154"></a>02154     <span class="keywordflow">return</span> $this-&gt;fetchAll(PDO::FETCH_COLUMN, $index);
<a name="l02155"></a>02155   }
<a name="l02156"></a>02156 
<a name="l02157"></a><a class="code" href="classDatabaseStatementBase_a7ed7713a07605775cf41019d52b65f35.html#a7ed7713a07605775cf41019d52b65f35">02157</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementBase_a7ed7713a07605775cf41019d52b65f35.html#a7ed7713a07605775cf41019d52b65f35" title="Returns the result set as an associative array keyed by the given field.">fetchAllAssoc</a>($key, $fetch = NULL) {
<a name="l02158"></a>02158     $return = array();
<a name="l02159"></a>02159     <span class="keywordflow">if</span> (isset($fetch)) {
<a name="l02160"></a>02160       <span class="keywordflow">if</span> (is_string($fetch)) {
<a name="l02161"></a>02161         $this-&gt;setFetchMode(PDO::FETCH_CLASS, $fetch);
<a name="l02162"></a>02162       }
<a name="l02163"></a>02163       <span class="keywordflow">else</span> {
<a name="l02164"></a>02164         $this-&gt;setFetchMode($fetch);
<a name="l02165"></a>02165       }
<a name="l02166"></a>02166     }
<a name="l02167"></a>02167 
<a name="l02168"></a>02168     <span class="keywordflow">foreach</span> ($this as $record) {
<a name="l02169"></a>02169       $record_key = is_object($record) ? $record-&gt;$key : $record[$key];
<a name="l02170"></a>02170       $return[$record_key] = $record;
<a name="l02171"></a>02171     }
<a name="l02172"></a>02172 
<a name="l02173"></a>02173     <span class="keywordflow">return</span> $return;
<a name="l02174"></a>02174   }
<a name="l02175"></a>02175 
<a name="l02176"></a><a class="code" href="classDatabaseStatementBase_a1083f1060fd59bec06a7ae14dbc0b307.html#a1083f1060fd59bec06a7ae14dbc0b307">02176</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementBase_a1083f1060fd59bec06a7ae14dbc0b307.html#a1083f1060fd59bec06a7ae14dbc0b307" title="Returns the entire result set as a single associative array.">fetchAllKeyed</a>($key_index = 0, $value_index = 1) {
<a name="l02177"></a>02177     $return = array();
<a name="l02178"></a>02178     $this-&gt;setFetchMode(PDO::FETCH_NUM);
<a name="l02179"></a>02179     <span class="keywordflow">foreach</span> ($this as $record) {
<a name="l02180"></a>02180       $return[$record[$key_index]] = $record[$value_index];
<a name="l02181"></a>02181     }
<a name="l02182"></a>02182     <span class="keywordflow">return</span> $return;
<a name="l02183"></a>02183   }
<a name="l02184"></a>02184 
<a name="l02185"></a><a class="code" href="classDatabaseStatementBase_ad80ef261e8934f5c69422f7530aa4cdc.html#ad80ef261e8934f5c69422f7530aa4cdc">02185</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementBase_ad80ef261e8934f5c69422f7530aa4cdc.html#ad80ef261e8934f5c69422f7530aa4cdc" title="Sets the default fetch mode for this statement.">fetchField</a>($index = 0) {
<a name="l02186"></a>02186     <span class="comment">// Call PDOStatement::fetchColumn to fetch the field.</span>
<a name="l02187"></a>02187     <span class="keywordflow">return</span> $this-&gt;fetchColumn($index);
<a name="l02188"></a>02188   }
<a name="l02189"></a>02189 
<a name="l02190"></a><a class="code" href="classDatabaseStatementBase_af1eb19aab88b13d6045bd6cce1b3c573.html#af1eb19aab88b13d6045bd6cce1b3c573">02190</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementBase_af1eb19aab88b13d6045bd6cce1b3c573.html#af1eb19aab88b13d6045bd6cce1b3c573" title="Fetches the next row and returns it as an object.">fetchAssoc</a>() {
<a name="l02191"></a>02191     <span class="comment">// Call PDOStatement::fetch to fetch the row.</span>
<a name="l02192"></a>02192     <span class="keywordflow">return</span> $this-&gt;fetch(PDO::FETCH_ASSOC);
<a name="l02193"></a>02193   }
<a name="l02194"></a>02194 }
<a name="l02195"></a>02195 
<a name="l02207"></a><a class="code" href="classDatabaseStatementEmpty.html">02207</a> <span class="keyword">class </span><a class="code" href="classDatabaseStatementEmpty.html" title="Empty implementation of a database statement.">DatabaseStatementEmpty</a> <span class="keyword">implements</span> Iterator, <a class="code" href="interfaceDatabaseStatementInterface.html" title="Represents a prepared statement.">DatabaseStatementInterface</a> {
<a name="l02208"></a>02208 
<a name="l02209"></a><a class="code" href="classDatabaseStatementEmpty_a01d549f8173db0919ba199cb4e8d92a9.html#a01d549f8173db0919ba199cb4e8d92a9">02209</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementEmpty_a01d549f8173db0919ba199cb4e8d92a9.html#a01d549f8173db0919ba199cb4e8d92a9" title="Executes a prepared statement.">execute</a>($args = array(), $options = array()) {
<a name="l02210"></a>02210     <span class="keywordflow">return</span> FALSE;
<a name="l02211"></a>02211   }
<a name="l02212"></a>02212 
<a name="l02213"></a><a class="code" href="classDatabaseStatementEmpty_a14114ed9aed78af3b2ff03eb40840e7d.html#a14114ed9aed78af3b2ff03eb40840e7d">02213</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementEmpty_a14114ed9aed78af3b2ff03eb40840e7d.html#a14114ed9aed78af3b2ff03eb40840e7d" title="Gets the query string of this statement.">getQueryString</a>() {
<a name="l02214"></a>02214     <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l02215"></a>02215   }
<a name="l02216"></a>02216 
<a name="l02217"></a><a class="code" href="classDatabaseStatementEmpty_aba97790d259fd594defbd52ff9f1037d.html#aba97790d259fd594defbd52ff9f1037d">02217</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementEmpty_aba97790d259fd594defbd52ff9f1037d.html#aba97790d259fd594defbd52ff9f1037d" title="Returns the number of rows affected by the last SQL statement.">rowCount</a>() {
<a name="l02218"></a>02218     <span class="keywordflow">return</span> 0;
<a name="l02219"></a>02219   }
<a name="l02220"></a>02220 
<a name="l02221"></a><a class="code" href="classDatabaseStatementEmpty_a4deaaf27d70cd50ce96e2ad85b5641bc.html#a4deaaf27d70cd50ce96e2ad85b5641bc">02221</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementEmpty_a4deaaf27d70cd50ce96e2ad85b5641bc.html#a4deaaf27d70cd50ce96e2ad85b5641bc">setFetchMode</a>($mode, $a1 = NULL, $a2 = array()) {
<a name="l02222"></a>02222     <span class="keywordflow">return</span>;
<a name="l02223"></a>02223   }
<a name="l02224"></a>02224 
<a name="l02225"></a><a class="code" href="classDatabaseStatementEmpty_ac692f1b4621399596a0ce3bb4e2e17fb.html#ac692f1b4621399596a0ce3bb4e2e17fb">02225</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementEmpty_ac692f1b4621399596a0ce3bb4e2e17fb.html#ac692f1b4621399596a0ce3bb4e2e17fb">fetch</a>($mode = NULL, $cursor_orientation = NULL, $cursor_offset = NULL) {
<a name="l02226"></a>02226     <span class="keywordflow">return</span> NULL;
<a name="l02227"></a>02227   }
<a name="l02228"></a>02228 
<a name="l02229"></a><a class="code" href="classDatabaseStatementEmpty_a0cadfb54ef7906aaaf57d7278ab6bb27.html#a0cadfb54ef7906aaaf57d7278ab6bb27">02229</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementEmpty_a0cadfb54ef7906aaaf57d7278ab6bb27.html#a0cadfb54ef7906aaaf57d7278ab6bb27" title="Sets the default fetch mode for this statement.">fetchField</a>($index = 0) {
<a name="l02230"></a>02230     <span class="keywordflow">return</span> NULL;
<a name="l02231"></a>02231   }
<a name="l02232"></a>02232 
<a name="l02233"></a><a class="code" href="classDatabaseStatementEmpty_a2250d20e4854cc2343d3ca4f79e218b7.html#a2250d20e4854cc2343d3ca4f79e218b7">02233</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementEmpty_a2250d20e4854cc2343d3ca4f79e218b7.html#a2250d20e4854cc2343d3ca4f79e218b7">fetchObject</a>() {
<a name="l02234"></a>02234     <span class="keywordflow">return</span> NULL;
<a name="l02235"></a>02235   }
<a name="l02236"></a>02236 
<a name="l02237"></a><a class="code" href="classDatabaseStatementEmpty_a4e3f452f86f9be6c96db961d0e734a37.html#a4e3f452f86f9be6c96db961d0e734a37">02237</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementEmpty_a4e3f452f86f9be6c96db961d0e734a37.html#a4e3f452f86f9be6c96db961d0e734a37" title="Fetches the next row and returns it as an object.">fetchAssoc</a>() {
<a name="l02238"></a>02238     <span class="keywordflow">return</span> NULL;
<a name="l02239"></a>02239   }
<a name="l02240"></a>02240 
<a name="l02241"></a><a class="code" href="classDatabaseStatementEmpty_a08b5526a29f47725bc3f900c8bb9523e.html#a08b5526a29f47725bc3f900c8bb9523e">02241</a>   <span class="keyword">function</span> <a class="code" href="classDatabaseStatementEmpty_a08b5526a29f47725bc3f900c8bb9523e.html#a08b5526a29f47725bc3f900c8bb9523e">fetchAll</a>($mode = NULL, $column_index = NULL, array $constructor_arguments = array()) {
<a name="l02242"></a>02242     <span class="keywordflow">return</span> array();
<a name="l02243"></a>02243   }
<a name="l02244"></a>02244 
<a name="l02245"></a><a class="code" href="classDatabaseStatementEmpty_a51d1a6428d3357315eab407864c08826.html#a51d1a6428d3357315eab407864c08826">02245</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementEmpty_a51d1a6428d3357315eab407864c08826.html#a51d1a6428d3357315eab407864c08826" title="Returns an array containing all of the result set rows.">fetchCol</a>($index = 0) {
<a name="l02246"></a>02246     <span class="keywordflow">return</span> array();
<a name="l02247"></a>02247   }
<a name="l02248"></a>02248 
<a name="l02249"></a><a class="code" href="classDatabaseStatementEmpty_ab0bfa3541bdfb1f7003f15363911c99f.html#ab0bfa3541bdfb1f7003f15363911c99f">02249</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementEmpty_ab0bfa3541bdfb1f7003f15363911c99f.html#ab0bfa3541bdfb1f7003f15363911c99f" title="Returns the entire result set as a single associative array.">fetchAllKeyed</a>($key_index = 0, $value_index = 1) {
<a name="l02250"></a>02250     <span class="keywordflow">return</span> array();
<a name="l02251"></a>02251   }
<a name="l02252"></a>02252 
<a name="l02253"></a><a class="code" href="classDatabaseStatementEmpty_a7715d753726ebd0b6c292faabfc4ed90.html#a7715d753726ebd0b6c292faabfc4ed90">02253</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementEmpty_a7715d753726ebd0b6c292faabfc4ed90.html#a7715d753726ebd0b6c292faabfc4ed90" title="Returns the result set as an associative array keyed by the given field.">fetchAllAssoc</a>($key, $fetch = NULL) {
<a name="l02254"></a>02254     <span class="keywordflow">return</span> array();
<a name="l02255"></a>02255   }
<a name="l02256"></a>02256 
<a name="l02257"></a>02257   <span class="comment">/* Implementations of Iterator. */</span>
<a name="l02258"></a>02258 
<a name="l02259"></a><a class="code" href="classDatabaseStatementEmpty_ad758070598b28d6f302c0557f4e85d40.html#ad758070598b28d6f302c0557f4e85d40">02259</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementEmpty_ad758070598b28d6f302c0557f4e85d40.html#ad758070598b28d6f302c0557f4e85d40">current</a>() {
<a name="l02260"></a>02260     <span class="keywordflow">return</span> NULL;
<a name="l02261"></a>02261   }
<a name="l02262"></a>02262 
<a name="l02263"></a><a class="code" href="classDatabaseStatementEmpty_abc0587456f84f4e8d3d60a38c64d5080.html#abc0587456f84f4e8d3d60a38c64d5080">02263</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementEmpty_abc0587456f84f4e8d3d60a38c64d5080.html#abc0587456f84f4e8d3d60a38c64d5080">key</a>() {
<a name="l02264"></a>02264     <span class="keywordflow">return</span> NULL;
<a name="l02265"></a>02265   }
<a name="l02266"></a>02266 
<a name="l02267"></a><a class="code" href="classDatabaseStatementEmpty_af828c2432be191122fb55939a7f2c184.html#af828c2432be191122fb55939a7f2c184">02267</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementEmpty_af828c2432be191122fb55939a7f2c184.html#af828c2432be191122fb55939a7f2c184">rewind</a>() {
<a name="l02268"></a>02268     <span class="comment">// Nothing to do: our DatabaseStatement can&#39;t be rewound.</span>
<a name="l02269"></a>02269   }
<a name="l02270"></a>02270 
<a name="l02271"></a><a class="code" href="classDatabaseStatementEmpty_ad3dddbe954de423fb8c6edf74d3d018d.html#ad3dddbe954de423fb8c6edf74d3d018d">02271</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementEmpty_ad3dddbe954de423fb8c6edf74d3d018d.html#ad3dddbe954de423fb8c6edf74d3d018d">next</a>() {
<a name="l02272"></a>02272     <span class="comment">// Do nothing, since this is an always-empty implementation.</span>
<a name="l02273"></a>02273   }
<a name="l02274"></a>02274 
<a name="l02275"></a><a class="code" href="classDatabaseStatementEmpty_a20e35d5049a44dbef376c40d9116630c.html#a20e35d5049a44dbef376c40d9116630c">02275</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseStatementEmpty_a20e35d5049a44dbef376c40d9116630c.html#a20e35d5049a44dbef376c40d9116630c">valid</a>() {
<a name="l02276"></a>02276     <span class="keywordflow">return</span> FALSE;
<a name="l02277"></a>02277   }
<a name="l02278"></a>02278 }
<a name="l02279"></a>02279 
<a name="l02313"></a><a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b">02313</a> <span class="keyword">function</span> <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>($query, array $args = array(), array $options = array()) {
<a name="l02314"></a>02314   <span class="keywordflow">if</span> (empty($options[<span class="stringliteral">&#39;target&#39;</span>])) {
<a name="l02315"></a>02315     $options[<span class="stringliteral">&#39;target&#39;</span>] = <span class="stringliteral">&#39;default&#39;</span>;
<a name="l02316"></a>02316   }
<a name="l02317"></a>02317 
<a name="l02318"></a>02318   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>($options[<span class="stringliteral">&#39;target&#39;</span>])-&gt;query($query, $args, $options);
<a name="l02319"></a>02319 }
<a name="l02320"></a>02320 
<a name="l02345"></a><a class="code" href="group__database_gadd8bfb4984a4c69ac741b2bb20d6b9bf.html#gadd8bfb4984a4c69ac741b2bb20d6b9bf">02345</a> <span class="keyword">function</span> <a class="code" href="group__database_gadd8bfb4984a4c69ac741b2bb20d6b9bf.html#gadd8bfb4984a4c69ac741b2bb20d6b9bf" title="Executes a query against the active database, restricted to a range.">db_query_range</a>($query, $from, $count, array $args = array(), array $options = array()) {
<a name="l02346"></a>02346   <span class="keywordflow">if</span> (empty($options[<span class="stringliteral">&#39;target&#39;</span>])) {
<a name="l02347"></a>02347     $options[<span class="stringliteral">&#39;target&#39;</span>] = <span class="stringliteral">&#39;default&#39;</span>;
<a name="l02348"></a>02348   }
<a name="l02349"></a>02349 
<a name="l02350"></a>02350   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>($options[<span class="stringliteral">&#39;target&#39;</span>])-&gt;queryRange($query, $from, $count, $args, $options);
<a name="l02351"></a>02351 }
<a name="l02352"></a>02352 
<a name="l02375"></a><a class="code" href="group__database_gaac717e09516a8acb0ff82b3a990c13a6.html#gaac717e09516a8acb0ff82b3a990c13a6">02375</a> <span class="keyword">function</span> <a class="code" href="group__database_gaac717e09516a8acb0ff82b3a990c13a6.html#gaac717e09516a8acb0ff82b3a990c13a6" title="Executes a query string and saves the result set to a temporary table.">db_query_temporary</a>($query, array $args = array(), array $options = array()) {
<a name="l02376"></a>02376   <span class="keywordflow">if</span> (empty($options[<span class="stringliteral">&#39;target&#39;</span>])) {
<a name="l02377"></a>02377     $options[<span class="stringliteral">&#39;target&#39;</span>] = <span class="stringliteral">&#39;default&#39;</span>;
<a name="l02378"></a>02378   }
<a name="l02379"></a>02379 
<a name="l02380"></a>02380   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>($options[<span class="stringliteral">&#39;target&#39;</span>])-&gt;queryTemporary($query, $args, $options);
<a name="l02381"></a>02381 }
<a name="l02382"></a>02382 
<a name="l02394"></a><a class="code" href="group__database_gaadfbffaf30ff5eb14f1bd88619351345.html#gaadfbffaf30ff5eb14f1bd88619351345">02394</a> <span class="keyword">function</span> <a class="code" href="group__database_gaadfbffaf30ff5eb14f1bd88619351345.html#gaadfbffaf30ff5eb14f1bd88619351345" title="Returns a new InsertQuery object for the active database.">db_insert</a>($table, array $options = array()) {
<a name="l02395"></a>02395   <span class="keywordflow">if</span> (empty($options[<span class="stringliteral">&#39;target&#39;</span>]) || $options[<span class="stringliteral">&#39;target&#39;</span>] == <span class="stringliteral">&#39;slave&#39;</span>) {
<a name="l02396"></a>02396     $options[<span class="stringliteral">&#39;target&#39;</span>] = <span class="stringliteral">&#39;default&#39;</span>;
<a name="l02397"></a>02397   }
<a name="l02398"></a>02398   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>($options[<span class="stringliteral">&#39;target&#39;</span>])-&gt;insert($table, $options);
<a name="l02399"></a>02399 }
<a name="l02400"></a>02400 
<a name="l02412"></a><a class="code" href="group__database_ga429c73a1bdc6dbb18c4a4a8a2235beaf.html#ga429c73a1bdc6dbb18c4a4a8a2235beaf">02412</a> <span class="keyword">function</span> <a class="code" href="group__database_ga429c73a1bdc6dbb18c4a4a8a2235beaf.html#ga429c73a1bdc6dbb18c4a4a8a2235beaf" title="Returns a new MergeQuery object for the active database.">db_merge</a>($table, array $options = array()) {
<a name="l02413"></a>02413   <span class="keywordflow">if</span> (empty($options[<span class="stringliteral">&#39;target&#39;</span>]) || $options[<span class="stringliteral">&#39;target&#39;</span>] == <span class="stringliteral">&#39;slave&#39;</span>) {
<a name="l02414"></a>02414     $options[<span class="stringliteral">&#39;target&#39;</span>] = <span class="stringliteral">&#39;default&#39;</span>;
<a name="l02415"></a>02415   }
<a name="l02416"></a>02416   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>($options[<span class="stringliteral">&#39;target&#39;</span>])-&gt;merge($table, $options);
<a name="l02417"></a>02417 }
<a name="l02418"></a>02418 
<a name="l02430"></a><a class="code" href="group__database_ga40967197ee5d6a23a5c5a77e627067fe.html#ga40967197ee5d6a23a5c5a77e627067fe">02430</a> <span class="keyword">function</span> <a class="code" href="group__database_ga40967197ee5d6a23a5c5a77e627067fe.html#ga40967197ee5d6a23a5c5a77e627067fe" title="Returns a new UpdateQuery object for the active database.">db_update</a>($table, array $options = array()) {
<a name="l02431"></a>02431   <span class="keywordflow">if</span> (empty($options[<span class="stringliteral">&#39;target&#39;</span>]) || $options[<span class="stringliteral">&#39;target&#39;</span>] == <span class="stringliteral">&#39;slave&#39;</span>) {
<a name="l02432"></a>02432     $options[<span class="stringliteral">&#39;target&#39;</span>] = <span class="stringliteral">&#39;default&#39;</span>;
<a name="l02433"></a>02433   }
<a name="l02434"></a>02434   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>($options[<span class="stringliteral">&#39;target&#39;</span>])-&gt;update($table, $options);
<a name="l02435"></a>02435 }
<a name="l02436"></a>02436 
<a name="l02448"></a><a class="code" href="group__database_ga72f0ccecc0ba181de16c6e3451150f2c.html#ga72f0ccecc0ba181de16c6e3451150f2c">02448</a> <span class="keyword">function</span> <a class="code" href="group__database_ga72f0ccecc0ba181de16c6e3451150f2c.html#ga72f0ccecc0ba181de16c6e3451150f2c" title="Returns a new DeleteQuery object for the active database.">db_delete</a>($table, array $options = array()) {
<a name="l02449"></a>02449   <span class="keywordflow">if</span> (empty($options[<span class="stringliteral">&#39;target&#39;</span>]) || $options[<span class="stringliteral">&#39;target&#39;</span>] == <span class="stringliteral">&#39;slave&#39;</span>) {
<a name="l02450"></a>02450     $options[<span class="stringliteral">&#39;target&#39;</span>] = <span class="stringliteral">&#39;default&#39;</span>;
<a name="l02451"></a>02451   }
<a name="l02452"></a>02452   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>($options[<span class="stringliteral">&#39;target&#39;</span>])-&gt;delete($table, $options);
<a name="l02453"></a>02453 }
<a name="l02454"></a>02454 
<a name="l02466"></a><a class="code" href="group__database_gaf6b4b59f572821cfd043317b81eeb71e.html#gaf6b4b59f572821cfd043317b81eeb71e">02466</a> <span class="keyword">function</span> <a class="code" href="group__database_gaf6b4b59f572821cfd043317b81eeb71e.html#gaf6b4b59f572821cfd043317b81eeb71e" title="Returns a new TruncateQuery object for the active database.">db_truncate</a>($table, array $options = array()) {
<a name="l02467"></a>02467   <span class="keywordflow">if</span> (empty($options[<span class="stringliteral">&#39;target&#39;</span>]) || $options[<span class="stringliteral">&#39;target&#39;</span>] == <span class="stringliteral">&#39;slave&#39;</span>) {
<a name="l02468"></a>02468     $options[<span class="stringliteral">&#39;target&#39;</span>] = <span class="stringliteral">&#39;default&#39;</span>;
<a name="l02469"></a>02469   }
<a name="l02470"></a>02470   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>($options[<span class="stringliteral">&#39;target&#39;</span>])-&gt;truncate($table, $options);
<a name="l02471"></a>02471 }
<a name="l02472"></a>02472 
<a name="l02487"></a><a class="code" href="group__database_ga9e030cee657d64e3d8e524c65814cc9f.html#ga9e030cee657d64e3d8e524c65814cc9f">02487</a> <span class="keyword">function</span> <a class="code" href="group__database_ga9e030cee657d64e3d8e524c65814cc9f.html#ga9e030cee657d64e3d8e524c65814cc9f" title="Returns a new SelectQuery object for the active database.">db_select</a>($table, $alias = NULL, array $options = array()) {
<a name="l02488"></a>02488   <span class="keywordflow">if</span> (empty($options[<span class="stringliteral">&#39;target&#39;</span>])) {
<a name="l02489"></a>02489     $options[<span class="stringliteral">&#39;target&#39;</span>] = <span class="stringliteral">&#39;default&#39;</span>;
<a name="l02490"></a>02490   }
<a name="l02491"></a>02491   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>($options[<span class="stringliteral">&#39;target&#39;</span>])-&gt;select($table, $alias, $options);
<a name="l02492"></a>02492 }
<a name="l02493"></a>02493 
<a name="l02506"></a><a class="code" href="group__database_gabdd0e69f5b2c63f8ad9e76f0fdf552be.html#gabdd0e69f5b2c63f8ad9e76f0fdf552be">02506</a> <span class="keyword">function</span> <a class="code" href="group__database_gabdd0e69f5b2c63f8ad9e76f0fdf552be.html#gabdd0e69f5b2c63f8ad9e76f0fdf552be" title="Returns a new transaction object for the active database.">db_transaction</a>($name = NULL, array $options = array()) {
<a name="l02507"></a>02507   <span class="keywordflow">if</span> (empty($options[<span class="stringliteral">&#39;target&#39;</span>])) {
<a name="l02508"></a>02508     $options[<span class="stringliteral">&#39;target&#39;</span>] = <span class="stringliteral">&#39;default&#39;</span>;
<a name="l02509"></a>02509   }
<a name="l02510"></a>02510   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>($options[<span class="stringliteral">&#39;target&#39;</span>])-&gt;startTransaction($name);
<a name="l02511"></a>02511 }
<a name="l02512"></a>02512 
<a name="l02522"></a><a class="code" href="group__database_ga954d1bbb12742f285927e43f9489fdaf.html#ga954d1bbb12742f285927e43f9489fdaf">02522</a> <span class="keyword">function</span> <a class="code" href="group__database_ga954d1bbb12742f285927e43f9489fdaf.html#ga954d1bbb12742f285927e43f9489fdaf" title="Sets a new active database.">db_set_active</a>($key = <span class="stringliteral">&#39;default&#39;</span>) {
<a name="l02523"></a>02523   <span class="keywordflow">return</span> <a class="code" href="classDatabase_afee50f4c59d97ccdcc6c4088adf7bc4e.html#afee50f4c59d97ccdcc6c4088adf7bc4e" title="Sets the active connection to the specified key.">Database::setActiveConnection</a>($key);
<a name="l02524"></a>02524 }
<a name="l02525"></a>02525 
<a name="l02537"></a><a class="code" href="group__database_ga3bc27db8c5946da0cab63d9b6314d48d.html#ga3bc27db8c5946da0cab63d9b6314d48d">02537</a> <span class="keyword">function</span> <a class="code" href="group__database_ga3bc27db8c5946da0cab63d9b6314d48d.html#ga3bc27db8c5946da0cab63d9b6314d48d" title="Restricts a dynamic table name to safe characters.">db_escape_table</a>($table) {
<a name="l02538"></a>02538   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;escapeTable($table);
<a name="l02539"></a>02539 }
<a name="l02540"></a>02540 
<a name="l02552"></a><a class="code" href="group__database_ga7e3c82a45a3e894ce2b4a5a37fa69246.html#ga7e3c82a45a3e894ce2b4a5a37fa69246">02552</a> <span class="keyword">function</span> <a class="code" href="group__database_ga7e3c82a45a3e894ce2b4a5a37fa69246.html#ga7e3c82a45a3e894ce2b4a5a37fa69246" title="Restricts a dynamic column or constraint name to safe characters.">db_escape_field</a>($field) {
<a name="l02553"></a>02553   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;escapeField($field);
<a name="l02554"></a>02554 }
<a name="l02555"></a>02555 
<a name="l02581"></a><a class="code" href="group__database_ga4e86622a079f0992dbb987e66320be7a.html#ga4e86622a079f0992dbb987e66320be7a">02581</a> <span class="keyword">function</span> <a class="code" href="group__database_ga4e86622a079f0992dbb987e66320be7a.html#ga4e86622a079f0992dbb987e66320be7a" title="Escapes characters that work as wildcard characters in a LIKE pattern.">db_like</a>($string) {
<a name="l02582"></a>02582   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;escapeLike($string);
<a name="l02583"></a>02583 }
<a name="l02584"></a>02584 
<a name="l02591"></a><a class="code" href="group__database_gabf958ef859f66154f7fd705eda7a06af.html#gabf958ef859f66154f7fd705eda7a06af">02591</a> <span class="keyword">function</span> <a class="code" href="group__database_gabf958ef859f66154f7fd705eda7a06af.html#gabf958ef859f66154f7fd705eda7a06af" title="Retrieves the name of the currently active database driver.">db_driver</a>() {
<a name="l02592"></a>02592   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;driver();
<a name="l02593"></a>02593 }
<a name="l02594"></a>02594 
<a name="l02602"></a><a class="code" href="group__database_ga3ee89e12a6f70888bfe4ac30f89df442.html#ga3ee89e12a6f70888bfe4ac30f89df442">02602</a> <span class="keyword">function</span> <a class="code" href="group__database_ga3ee89e12a6f70888bfe4ac30f89df442.html#ga3ee89e12a6f70888bfe4ac30f89df442" title="Closes the active database connection.">db_close</a>(array $options = array()) {
<a name="l02603"></a>02603   <span class="keywordflow">if</span> (empty($options[<span class="stringliteral">&#39;target&#39;</span>])) {
<a name="l02604"></a>02604     $options[<span class="stringliteral">&#39;target&#39;</span>] = NULL;
<a name="l02605"></a>02605   }
<a name="l02606"></a>02606   <a class="code" href="classDatabase_a1e6a2484bc6ea4ac8ce820dd12baaa5b.html#a1e6a2484bc6ea4ac8ce820dd12baaa5b" title="Closes a connection to the server specified by the given key and target.">Database::closeConnection</a>($options[<span class="stringliteral">&#39;target&#39;</span>]);
<a name="l02607"></a>02607 }
<a name="l02608"></a>02608 
<a name="l02624"></a><a class="code" href="group__database_gab0a2cb3e94525a74407740043b821c5b.html#gab0a2cb3e94525a74407740043b821c5b">02624</a> <span class="keyword">function</span> <a class="code" href="group__database_gab0a2cb3e94525a74407740043b821c5b.html#gab0a2cb3e94525a74407740043b821c5b" title="Retrieves a unique id.">db_next_id</a>($existing_id = 0) {
<a name="l02625"></a>02625   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;nextId($existing_id);
<a name="l02626"></a>02626 }
<a name="l02627"></a>02627 
<a name="l02633"></a><a class="code" href="group__database_ga1a7695a360b8c2219fe1998dfc272080.html#ga1a7695a360b8c2219fe1998dfc272080">02633</a> <span class="keyword">function</span> <a class="code" href="group__database_ga1a7695a360b8c2219fe1998dfc272080.html#ga1a7695a360b8c2219fe1998dfc272080" title="Returns a new DatabaseCondition, set to &quot;OR&quot; all conditions together.">db_or</a>() {
<a name="l02634"></a>02634   <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classDatabaseCondition.html" title="Generic class for a series of conditions in a query.">DatabaseCondition</a>(<span class="stringliteral">&#39;OR&#39;</span>);
<a name="l02635"></a>02635 }
<a name="l02636"></a>02636 
<a name="l02642"></a><a class="code" href="group__database_ga39ab6e9c3b5316eb4d8fe8f52af91acc.html#ga39ab6e9c3b5316eb4d8fe8f52af91acc">02642</a> <span class="keyword">function</span> <a class="code" href="group__database_ga39ab6e9c3b5316eb4d8fe8f52af91acc.html#ga39ab6e9c3b5316eb4d8fe8f52af91acc" title="Returns a new DatabaseCondition, set to &quot;AND&quot; all conditions together.">db_and</a>() {
<a name="l02643"></a>02643   <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classDatabaseCondition.html" title="Generic class for a series of conditions in a query.">DatabaseCondition</a>(<span class="stringliteral">&#39;AND&#39;</span>);
<a name="l02644"></a>02644 }
<a name="l02645"></a>02645 
<a name="l02651"></a><a class="code" href="group__database_ga85bb17ee005f930dd2caa93f0752d0e8.html#ga85bb17ee005f930dd2caa93f0752d0e8">02651</a> <span class="keyword">function</span> <a class="code" href="group__database_ga85bb17ee005f930dd2caa93f0752d0e8.html#ga85bb17ee005f930dd2caa93f0752d0e8" title="Returns a new DatabaseCondition, set to &quot;XOR&quot; all conditions together.">db_xor</a>() {
<a name="l02652"></a>02652   <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classDatabaseCondition.html" title="Generic class for a series of conditions in a query.">DatabaseCondition</a>(<span class="stringliteral">&#39;XOR&#39;</span>);
<a name="l02653"></a>02653 }
<a name="l02654"></a>02654 
<a name="l02665"></a><a class="code" href="group__database_ga7e591c732d1eb7da6813ef79867a9859.html#ga7e591c732d1eb7da6813ef79867a9859">02665</a> <span class="keyword">function</span> <a class="code" href="group__database_ga7e591c732d1eb7da6813ef79867a9859.html#ga7e591c732d1eb7da6813ef79867a9859" title="Returns a new DatabaseCondition, set to the specified conjunction.">db_condition</a>($conjunction) {
<a name="l02666"></a>02666   <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classDatabaseCondition.html" title="Generic class for a series of conditions in a query.">DatabaseCondition</a>($conjunction);
<a name="l02667"></a>02667 }
<a name="l02668"></a>02668 
<a name="l02687"></a><a class="code" href="group__schemaapi_gaf3a8307693d6b28374665c72531b429f.html#gaf3a8307693d6b28374665c72531b429f">02687</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_gaf3a8307693d6b28374665c72531b429f.html#gaf3a8307693d6b28374665c72531b429f" title="Creates a new table from a Drupal table definition.">db_create_table</a>($name, $table) {
<a name="l02688"></a>02688   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;createTable($name, $table);
<a name="l02689"></a>02689 }
<a name="l02690"></a>02690 
<a name="l02703"></a><a class="code" href="group__schemaapi_gaeb423ba53e5133548abe3d999f86e787.html#gaeb423ba53e5133548abe3d999f86e787">02703</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_gaeb423ba53e5133548abe3d999f86e787.html#gaeb423ba53e5133548abe3d999f86e787" title="Returns an array of field names from an array of key/index column specifiers.">db_field_names</a>($fields) {
<a name="l02704"></a>02704   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;fieldNames($fields);
<a name="l02705"></a>02705 }
<a name="l02706"></a>02706 
<a name="l02718"></a><a class="code" href="group__schemaapi_ga0c10c365922d538e4d5d17fb314d4b79.html#ga0c10c365922d538e4d5d17fb314d4b79">02718</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga0c10c365922d538e4d5d17fb314d4b79.html#ga0c10c365922d538e4d5d17fb314d4b79" title="Checks if an index exists in the given table.">db_index_exists</a>($table, $name) {
<a name="l02719"></a>02719   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;indexExists($table, $name);
<a name="l02720"></a>02720 }
<a name="l02721"></a>02721 
<a name="l02731"></a><a class="code" href="group__schemaapi_ga78809300cee80db034832825aed55b70.html#ga78809300cee80db034832825aed55b70">02731</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga78809300cee80db034832825aed55b70.html#ga78809300cee80db034832825aed55b70" title="Checks if a table exists.">db_table_exists</a>($table) {
<a name="l02732"></a>02732   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;tableExists($table);
<a name="l02733"></a>02733 }
<a name="l02734"></a>02734 
<a name="l02746"></a><a class="code" href="group__schemaapi_ga6b39d7c0876ab53b1588ff9e40677c42.html#ga6b39d7c0876ab53b1588ff9e40677c42">02746</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga6b39d7c0876ab53b1588ff9e40677c42.html#ga6b39d7c0876ab53b1588ff9e40677c42" title="Checks if a column exists in the given table.">db_field_exists</a>($table, $field) {
<a name="l02747"></a>02747   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;fieldExists($table, $field);
<a name="l02748"></a>02748 }
<a name="l02749"></a>02749 
<a name="l02760"></a><a class="code" href="group__schemaapi_gac723bfddd5f133eb4d3dcec84c3c3f3c.html#gac723bfddd5f133eb4d3dcec84c3c3f3c">02760</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_gac723bfddd5f133eb4d3dcec84c3c3f3c.html#gac723bfddd5f133eb4d3dcec84c3c3f3c" title="Finds all tables that are like the specified base table name.">db_find_tables</a>($table_expression) {
<a name="l02761"></a>02761   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;findTables($table_expression);
<a name="l02762"></a>02762 }
<a name="l02763"></a>02763 
<a name="l02764"></a><a class="code" href="group__schemaapi_gaa4be538758cb8279d3aeed18e1b25c2d.html#gaa4be538758cb8279d3aeed18e1b25c2d">02764</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_gaa4be538758cb8279d3aeed18e1b25c2d.html#gaa4be538758cb8279d3aeed18e1b25c2d">_db_create_keys_sql</a>($spec) {
<a name="l02765"></a>02765   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;createKeysSql($spec);
<a name="l02766"></a>02766 }
<a name="l02767"></a>02767 
<a name="l02776"></a><a class="code" href="group__schemaapi_ga629fe4d738f4caeb9d8c8acc2cc4d05b.html#ga629fe4d738f4caeb9d8c8acc2cc4d05b">02776</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga629fe4d738f4caeb9d8c8acc2cc4d05b.html#ga629fe4d738f4caeb9d8c8acc2cc4d05b" title="Renames a table.">db_rename_table</a>($table, $new_name) {
<a name="l02777"></a>02777   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;renameTable($table, $new_name);
<a name="l02778"></a>02778 }
<a name="l02779"></a>02779 
<a name="l02786"></a><a class="code" href="group__schemaapi_ga5d744ae7a6fe2c9eaa1c7bd350a071d3.html#ga5d744ae7a6fe2c9eaa1c7bd350a071d3">02786</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga5d744ae7a6fe2c9eaa1c7bd350a071d3.html#ga5d744ae7a6fe2c9eaa1c7bd350a071d3" title="Drops a table.">db_drop_table</a>($table) {
<a name="l02787"></a>02787   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;dropTable($table);
<a name="l02788"></a>02788 }
<a name="l02789"></a>02789 
<a name="l02811"></a><a class="code" href="group__schemaapi_ga10bc9c435dd6d36c112d7ec179840cff.html#ga10bc9c435dd6d36c112d7ec179840cff">02811</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga10bc9c435dd6d36c112d7ec179840cff.html#ga10bc9c435dd6d36c112d7ec179840cff" title="Adds a new field to a table.">db_add_field</a>($table, $field, $spec, $keys_new = array()) {
<a name="l02812"></a>02812   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;addField($table, $field, $spec, $keys_new);
<a name="l02813"></a>02813 }
<a name="l02814"></a>02814 
<a name="l02823"></a><a class="code" href="group__schemaapi_ga0e404d9200bf56fbed738aa4f57b3ec4.html#ga0e404d9200bf56fbed738aa4f57b3ec4">02823</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga0e404d9200bf56fbed738aa4f57b3ec4.html#ga0e404d9200bf56fbed738aa4f57b3ec4" title="Drops a field.">db_drop_field</a>($table, $field) {
<a name="l02824"></a>02824   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;dropField($table, $field);
<a name="l02825"></a>02825 }
<a name="l02826"></a>02826 
<a name="l02837"></a><a class="code" href="group__schemaapi_ga63a499297d184dba68309dcd1b7e17d4.html#ga63a499297d184dba68309dcd1b7e17d4">02837</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga63a499297d184dba68309dcd1b7e17d4.html#ga63a499297d184dba68309dcd1b7e17d4" title="Sets the default value for a field.">db_field_set_default</a>($table, $field, $default) {
<a name="l02838"></a>02838   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;fieldSetDefault($table, $field, $default);
<a name="l02839"></a>02839 }
<a name="l02840"></a>02840 
<a name="l02849"></a><a class="code" href="group__schemaapi_gad1714b6920155f673f4291845fdb5f62.html#gad1714b6920155f673f4291845fdb5f62">02849</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_gad1714b6920155f673f4291845fdb5f62.html#gad1714b6920155f673f4291845fdb5f62" title="Sets a field to have no default value.">db_field_set_no_default</a>($table, $field) {
<a name="l02850"></a>02850   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;fieldSetNoDefault($table, $field);
<a name="l02851"></a>02851 }
<a name="l02852"></a>02852 
<a name="l02861"></a><a class="code" href="group__schemaapi_ga666b117ebedc9b50dacf193c6ba4dcf8.html#ga666b117ebedc9b50dacf193c6ba4dcf8">02861</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga666b117ebedc9b50dacf193c6ba4dcf8.html#ga666b117ebedc9b50dacf193c6ba4dcf8" title="Adds a primary key to a database table.">db_add_primary_key</a>($table, $fields) {
<a name="l02862"></a>02862   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;addPrimaryKey($table, $fields);
<a name="l02863"></a>02863 }
<a name="l02864"></a>02864 
<a name="l02871"></a><a class="code" href="group__schemaapi_ga733a41de3d8b74798a8cf3c87ae33715.html#ga733a41de3d8b74798a8cf3c87ae33715">02871</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga733a41de3d8b74798a8cf3c87ae33715.html#ga733a41de3d8b74798a8cf3c87ae33715" title="Drops the primary key of a database table.">db_drop_primary_key</a>($table) {
<a name="l02872"></a>02872   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;dropPrimaryKey($table);
<a name="l02873"></a>02873 }
<a name="l02874"></a>02874 
<a name="l02885"></a><a class="code" href="group__schemaapi_gad6dd1c6f39d180bc21853ac6118a8f40.html#gad6dd1c6f39d180bc21853ac6118a8f40">02885</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_gad6dd1c6f39d180bc21853ac6118a8f40.html#gad6dd1c6f39d180bc21853ac6118a8f40" title="Adds a unique key.">db_add_unique_key</a>($table, $name, $fields) {
<a name="l02886"></a>02886   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;addUniqueKey($table, $name, $fields);
<a name="l02887"></a>02887 }
<a name="l02888"></a>02888 
<a name="l02897"></a><a class="code" href="group__schemaapi_gab06ca0fe63625f37a649cf3432fd8ffe.html#gab06ca0fe63625f37a649cf3432fd8ffe">02897</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_gab06ca0fe63625f37a649cf3432fd8ffe.html#gab06ca0fe63625f37a649cf3432fd8ffe" title="Drops a unique key.">db_drop_unique_key</a>($table, $name) {
<a name="l02898"></a>02898   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;dropUniqueKey($table, $name);
<a name="l02899"></a>02899 }
<a name="l02900"></a>02900 
<a name="l02911"></a><a class="code" href="group__schemaapi_gafb7153a65df9b5a0877a602cde86a0cc.html#gafb7153a65df9b5a0877a602cde86a0cc">02911</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_gafb7153a65df9b5a0877a602cde86a0cc.html#gafb7153a65df9b5a0877a602cde86a0cc" title="Adds an index.">db_add_index</a>($table, $name, $fields) {
<a name="l02912"></a>02912   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;addIndex($table, $name, $fields);
<a name="l02913"></a>02913 }
<a name="l02914"></a>02914 
<a name="l02923"></a><a class="code" href="group__schemaapi_gaa59d447eb4a7b25350fb7404f9a70ec0.html#gaa59d447eb4a7b25350fb7404f9a70ec0">02923</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_gaa59d447eb4a7b25350fb7404f9a70ec0.html#gaa59d447eb4a7b25350fb7404f9a70ec0" title="Drops an index.">db_drop_index</a>($table, $name) {
<a name="l02924"></a>02924   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;dropIndex($table, $name);
<a name="l02925"></a>02925 }
<a name="l02926"></a>02926 
<a name="l02987"></a><a class="code" href="group__schemaapi_ga9e0a4211eb8137e187d5f3f4fa716cea.html#ga9e0a4211eb8137e187d5f3f4fa716cea">02987</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga9e0a4211eb8137e187d5f3f4fa716cea.html#ga9e0a4211eb8137e187d5f3f4fa716cea" title="Changes a field definition.">db_change_field</a>($table, $field, $field_new, $spec, $keys_new = array()) {
<a name="l02988"></a>02988   <span class="keywordflow">return</span> <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;schema()-&gt;changeField($table, $field, $field_new, $spec, $keys_new);
<a name="l02989"></a>02989 }
<a name="l02990"></a>02990 
<a name="l02998"></a><a class="code" href="database_8inc_a75131a7e4b6765eb3b31dcd82f064e9b.html#a75131a7e4b6765eb3b31dcd82f064e9b">02998</a> <span class="keyword">function</span> <a class="code" href="database_8inc_a75131a7e4b6765eb3b31dcd82f064e9b.html#a75131a7e4b6765eb3b31dcd82f064e9b" title="End of &quot;addtogroup schemaapi&quot;.">db_ignore_slave</a>() {
<a name="l02999"></a>02999   $connection_info = <a class="code" href="classDatabase_a4ddbb695ae89b6180e0390c231b70ea5.html#a4ddbb695ae89b6180e0390c231b70ea5" title="Gets information on the specified database connection.">Database::getConnectionInfo</a>();
<a name="l03000"></a>03000   <span class="comment">// Only set ignore_slave_server if there are slave servers being used, which</span>
<a name="l03001"></a>03001   <span class="comment">// is assumed if there are more than one.</span>
<a name="l03002"></a>03002   <span class="keywordflow">if</span> (count($connection_info) &gt; 1) {
<a name="l03003"></a>03003     <span class="comment">// Five minutes is long enough to allow the slave to break and resume</span>
<a name="l03004"></a>03004     <span class="comment">// interrupted replication without causing problems on the Drupal site from</span>
<a name="l03005"></a>03005     <span class="comment">// the old data.</span>
<a name="l03006"></a>03006     $duration = <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;maximum_replication_lag&#39;</span>, 300);
<a name="l03007"></a>03007     <span class="comment">// Set session variable with amount of time to delay before using slave.</span>
<a name="l03008"></a>03008     $_SESSION[<span class="stringliteral">&#39;ignore_slave_server&#39;</span>] = <a class="code" href="bootstrap_8inc_a08bcd0b03e31c17fb7d58786bef2b7f4.html#a08bcd0b03e31c17fb7d58786bef2b7f4" title="Time of the current request in seconds elapsed since the Unix Epoch.">REQUEST_TIME</a> + $duration;
<a name="l03009"></a>03009   }
<a name="l03010"></a>03010 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 22 2012 16:46:14 for Shopcart by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
