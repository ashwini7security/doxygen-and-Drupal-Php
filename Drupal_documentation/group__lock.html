<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Shopcart: Locking mechanisms</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Shopcart
   &#160;<span id="projectnumber">version2.0</span>
   </div>
   <div id="projectbrief">Shoppingcart</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Locking mechanisms</div>  </div>
</div><!--header-->
<div class="contents">

<p>Functions to coordinate long-running operations across requests.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lock_ga8e0cf09d86196c0a26b50df3567108a4.html#ga8e0cf09d86196c0a26b50df3567108a4">lock_initialize</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the locking system.  <a href="#ga8e0cf09d86196c0a26b50df3567108a4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lock_ga22f64c6b65bc54d5f8f981559b0cdf04.html#ga22f64c6b65bc54d5f8f981559b0cdf04">_lock_id</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function to get this request's unique id.  <a href="#ga22f64c6b65bc54d5f8f981559b0cdf04"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lock_gac67a4b1061491f7a869646f47b66e998.html#gac67a4b1061491f7a869646f47b66e998">lock_acquire</a> ($name, $timeout=30.0)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Acquire (or renew) a lock, but do not block if it fails.  <a href="#gac67a4b1061491f7a869646f47b66e998"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lock_ga095b65838e63b109f52ff6d8c00d8963.html#ga095b65838e63b109f52ff6d8c00d8963">lock_may_be_available</a> ($name)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if lock acquired by a different process may be available.  <a href="#ga095b65838e63b109f52ff6d8c00d8963"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lock_ga54c2ee771edac47614b8f12d949d3376.html#ga54c2ee771edac47614b8f12d949d3376">lock_wait</a> ($name, $delay=30)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for a lock to be available.  <a href="#ga54c2ee771edac47614b8f12d949d3376"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lock_ga73e1456861f9aff1a506a650f43aceb0.html#ga73e1456861f9aff1a506a650f43aceb0">lock_release</a> ($name)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Release a lock previously acquired by <a class="el" href="group__lock_gac67a4b1061491f7a869646f47b66e998.html#gac67a4b1061491f7a869646f47b66e998" title="Acquire (or renew) a lock, but do not block if it fails.">lock_acquire()</a>.  <a href="#ga73e1456861f9aff1a506a650f43aceb0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lock_ga290817e14e2a9ecc0bd34c6b7b0af031.html#ga290817e14e2a9ecc0bd34c6b7b0af031">lock_release_all</a> ($lock_id=NULL)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Release all previously acquired locks.  <a href="#ga290817e14e2a9ecc0bd34c6b7b0af031"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<p>Functions to coordinate long-running operations across requests. </p>
<p>In most environments, multiple Drupal page requests (a.k.a. threads or processes) will execute in parallel. This leads to potential conflicts or race conditions when two requests execute the same code at the same time. A common example of this is a rebuild like <a class="el" href="group__menu_gaf36dcb9d5491ef5e7d2cf22c1f5c69f4.html#gaf36dcb9d5491ef5e7d2cf22c1f5c69f4" title="(Re)populate the database tables used by various menu functions.">menu_rebuild()</a> where we invoke many hook implementations to get and process data from all active modules, and then delete the current data in the database to insert the new afterwards.</p>
<p>This is a cooperative, advisory lock system. Any long-running operation that could potentially be attempted in parallel by multiple requests should try to acquire a lock before proceeding. By obtaining a lock, one request notifies any other requests that a specific operation is in progress which must not be executed in parallel.</p>
<p>To use this API, pick a unique name for the lock. A sensible choice is the name of the function performing the operation. A very simple example use of this API: </p>
<div class="fragment"><pre class="fragment"> <span class="keyword">function</span> mymodule_long_operation() {
   <span class="keywordflow">if</span> (<a class="code" href="group__lock_gac67a4b1061491f7a869646f47b66e998.html#gac67a4b1061491f7a869646f47b66e998" title="Acquire (or renew) a lock, but do not block if it fails.">lock_acquire</a>(<span class="stringliteral">&#39;mymodule_long_operation&#39;</span>)) {
     <span class="comment">// Do the long operation here.</span>
     <span class="comment">// ...</span>
     <a class="code" href="group__lock_ga73e1456861f9aff1a506a650f43aceb0.html#ga73e1456861f9aff1a506a650f43aceb0" title="Release a lock previously acquired by lock_acquire().">lock_release</a>(<span class="stringliteral">&#39;mymodule_long_operation&#39;</span>);
   }
 }
</pre></div><p>If a function acquires a lock it should always release it when the operation is complete by calling <a class="el" href="group__lock_ga73e1456861f9aff1a506a650f43aceb0.html#ga73e1456861f9aff1a506a650f43aceb0" title="Release a lock previously acquired by lock_acquire().">lock_release()</a>, as in the example.</p>
<p>A function that has acquired a lock may attempt to renew a lock (extend the duration of the lock) by calling <a class="el" href="group__lock_gac67a4b1061491f7a869646f47b66e998.html#gac67a4b1061491f7a869646f47b66e998" title="Acquire (or renew) a lock, but do not block if it fails.">lock_acquire()</a> again during the operation. Failure to renew a lock is indicative that another request has acquired the lock, and that the current operation may need to be aborted.</p>
<p>If a function fails to acquire a lock it may either immediately return, or it may call <a class="el" href="group__lock_ga54c2ee771edac47614b8f12d949d3376.html#ga54c2ee771edac47614b8f12d949d3376" title="Wait for a lock to be available.">lock_wait()</a> if the rest of the current page request requires that the operation in question be complete. After <a class="el" href="group__lock_ga54c2ee771edac47614b8f12d949d3376.html#ga54c2ee771edac47614b8f12d949d3376" title="Wait for a lock to be available.">lock_wait()</a> returns, the function may again attempt to acquire the lock, or may simply allow the page request to proceed on the assumption that a parallel request completed the operation.</p>
<p><a class="el" href="group__lock_gac67a4b1061491f7a869646f47b66e998.html#gac67a4b1061491f7a869646f47b66e998" title="Acquire (or renew) a lock, but do not block if it fails.">lock_acquire()</a> and <a class="el" href="group__lock_ga54c2ee771edac47614b8f12d949d3376.html#ga54c2ee771edac47614b8f12d949d3376" title="Wait for a lock to be available.">lock_wait()</a> will automatically break (delete) a lock whose duration has exceeded the timeout specified when it was acquired.</p>
<p>Alternative implementations of this API (such as APC) may be substituted by setting the 'lock_inc' variable to an alternate include filepath. Since this is an API intended to support alternative implementations, code using this API should never rely upon specific implementation details (for example no code should look for or directly modify a lock in the {semaphore} table). </p>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 22 2012 16:46:17 for Shopcart by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
