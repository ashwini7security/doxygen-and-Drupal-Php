<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Shopcart: includes/bootstrap.inc Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Shopcart
   &#160;<span id="projectnumber">version2.0</span>
   </div>
   <div id="projectbrief">Shoppingcart</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_5b89693129504707d608c5412e7b88d4.html">includes</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">bootstrap.inc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="bootstrap_8inc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00011"></a><a class="code" href="bootstrap_8inc_ae48ea820d6b3acc7353b763034c772af.html#ae48ea820d6b3acc7353b763034c772af">00011</a> define(<span class="stringliteral">&#39;VERSION&#39;</span>, <span class="stringliteral">&#39;7.16&#39;</span>);
<a name="l00012"></a>00012 
<a name="l00016"></a><a class="code" href="bootstrap_8inc_a4f0dd177a6291b9d7fc1b5ae033b5eaf.html#a4f0dd177a6291b9d7fc1b5ae033b5eaf">00016</a> define(<span class="stringliteral">&#39;DRUPAL_CORE_COMPATIBILITY&#39;</span>, <span class="stringliteral">&#39;7.x&#39;</span>);
<a name="l00017"></a>00017 
<a name="l00021"></a><a class="code" href="bootstrap_8inc_a370c52d1679da96064df124c55f16ea8.html#a370c52d1679da96064df124c55f16ea8">00021</a> define(<span class="stringliteral">&#39;DRUPAL_MINIMUM_PHP&#39;</span>, <span class="stringliteral">&#39;5.2.4&#39;</span>);
<a name="l00022"></a>00022 
<a name="l00026"></a><a class="code" href="bootstrap_8inc_a996d6c835e5fee7728aed6a4dfc6a6aa.html#a996d6c835e5fee7728aed6a4dfc6a6aa">00026</a> define(<span class="stringliteral">&#39;DRUPAL_MINIMUM_PHP_MEMORY_LIMIT&#39;</span>, <span class="stringliteral">&#39;32M&#39;</span>);
<a name="l00027"></a>00027 
<a name="l00033"></a><a class="code" href="bootstrap_8inc_ad987330fff5fa7c75800762ddedf300c.html#ad987330fff5fa7c75800762ddedf300c">00033</a> define(<span class="stringliteral">&#39;CACHE_PERMANENT&#39;</span>, 0);
<a name="l00034"></a>00034 
<a name="l00038"></a><a class="code" href="bootstrap_8inc_a1f2558e91eb9f33d14168bb8dfd99690.html#a1f2558e91eb9f33d14168bb8dfd99690">00038</a> define(<span class="stringliteral">&#39;CACHE_TEMPORARY&#39;</span>, -1);
<a name="l00039"></a>00039 
<a name="l00063"></a><a class="code" href="group__logging__severity__levels_ga467e941228edf3b033b5ef460e1bfcf7.html#ga467e941228edf3b033b5ef460e1bfcf7">00063</a> define(<span class="stringliteral">&#39;WATCHDOG_EMERGENCY&#39;</span>, 0);
<a name="l00064"></a>00064 
<a name="l00068"></a><a class="code" href="group__logging__severity__levels_ga9fdd40d55b14109f09f091f401f237c0.html#ga9fdd40d55b14109f09f091f401f237c0">00068</a> define(<span class="stringliteral">&#39;WATCHDOG_ALERT&#39;</span>, 1);
<a name="l00069"></a>00069 
<a name="l00073"></a><a class="code" href="group__logging__severity__levels_gab4129b98c8480bea3cbcd62083ae81e3.html#gab4129b98c8480bea3cbcd62083ae81e3">00073</a> define(<span class="stringliteral">&#39;WATCHDOG_CRITICAL&#39;</span>, 2);
<a name="l00074"></a>00074 
<a name="l00078"></a><a class="code" href="group__logging__severity__levels_ga174c9df2936096e11986fcf184d48576.html#ga174c9df2936096e11986fcf184d48576">00078</a> define(<span class="stringliteral">&#39;WATCHDOG_ERROR&#39;</span>, 3);
<a name="l00079"></a>00079 
<a name="l00083"></a><a class="code" href="group__logging__severity__levels_ga5361f835e10b39b553ee73c1b9414bf1.html#ga5361f835e10b39b553ee73c1b9414bf1">00083</a> define(<span class="stringliteral">&#39;WATCHDOG_WARNING&#39;</span>, 4);
<a name="l00084"></a>00084 
<a name="l00088"></a><a class="code" href="group__logging__severity__levels_ga757a33416683e8c44636a8799f60b477.html#ga757a33416683e8c44636a8799f60b477">00088</a> define(<span class="stringliteral">&#39;WATCHDOG_NOTICE&#39;</span>, 5);
<a name="l00089"></a>00089 
<a name="l00093"></a><a class="code" href="group__logging__severity__levels_ga9629ff808fd20ce4abb297db5976af4d.html#ga9629ff808fd20ce4abb297db5976af4d">00093</a> define(<span class="stringliteral">&#39;WATCHDOG_INFO&#39;</span>, 6);
<a name="l00094"></a>00094 
<a name="l00098"></a><a class="code" href="group__logging__severity__levels_gaf672cd38d5654f8a4a12e32d9b9e749d.html#gaf672cd38d5654f8a4a12e32d9b9e749d">00098</a> define(<span class="stringliteral">&#39;WATCHDOG_DEBUG&#39;</span>, 7);
<a name="l00099"></a>00099 
<a name="l00107"></a><a class="code" href="bootstrap_8inc_ad71394314c3ad7cef54b5f566e3ec177.html#ad71394314c3ad7cef54b5f566e3ec177">00107</a> define(<span class="stringliteral">&#39;DRUPAL_BOOTSTRAP_CONFIGURATION&#39;</span>, 0);
<a name="l00108"></a>00108 
<a name="l00112"></a><a class="code" href="bootstrap_8inc_a72f3a79e7308050a8f4d074592314c0f.html#a72f3a79e7308050a8f4d074592314c0f">00112</a> define(<span class="stringliteral">&#39;DRUPAL_BOOTSTRAP_PAGE_CACHE&#39;</span>, 1);
<a name="l00113"></a>00113 
<a name="l00117"></a><a class="code" href="bootstrap_8inc_a693d842eaaf448b1e6c37cc4ef068e3a.html#a693d842eaaf448b1e6c37cc4ef068e3a">00117</a> define(<span class="stringliteral">&#39;DRUPAL_BOOTSTRAP_DATABASE&#39;</span>, 2);
<a name="l00118"></a>00118 
<a name="l00122"></a><a class="code" href="bootstrap_8inc_a83083de674fde28341c7b833b9397390.html#a83083de674fde28341c7b833b9397390">00122</a> define(<span class="stringliteral">&#39;DRUPAL_BOOTSTRAP_VARIABLES&#39;</span>, 3);
<a name="l00123"></a>00123 
<a name="l00127"></a><a class="code" href="bootstrap_8inc_aa6c510376f042cd2d05fc9bb458e7138.html#aa6c510376f042cd2d05fc9bb458e7138">00127</a> define(<span class="stringliteral">&#39;DRUPAL_BOOTSTRAP_SESSION&#39;</span>, 4);
<a name="l00128"></a>00128 
<a name="l00132"></a><a class="code" href="bootstrap_8inc_aa237aa5f95f8059a465efef6c72e49ce.html#aa237aa5f95f8059a465efef6c72e49ce">00132</a> define(<span class="stringliteral">&#39;DRUPAL_BOOTSTRAP_PAGE_HEADER&#39;</span>, 5);
<a name="l00133"></a>00133 
<a name="l00137"></a><a class="code" href="bootstrap_8inc_ae4a0a1bc1243082285abc3fc052e5d38.html#ae4a0a1bc1243082285abc3fc052e5d38">00137</a> define(<span class="stringliteral">&#39;DRUPAL_BOOTSTRAP_LANGUAGE&#39;</span>, 6);
<a name="l00138"></a>00138 
<a name="l00142"></a><a class="code" href="bootstrap_8inc_a2c8ac509af1924cf2fa7420a22e1b048.html#a2c8ac509af1924cf2fa7420a22e1b048">00142</a> define(<span class="stringliteral">&#39;DRUPAL_BOOTSTRAP_FULL&#39;</span>, 7);
<a name="l00143"></a>00143 
<a name="l00147"></a><a class="code" href="bootstrap_8inc_ac7816037c6b6b794a56dcce4dea70569.html#ac7816037c6b6b794a56dcce4dea70569">00147</a> define(<span class="stringliteral">&#39;DRUPAL_ANONYMOUS_RID&#39;</span>, 1);
<a name="l00148"></a>00148 
<a name="l00152"></a><a class="code" href="bootstrap_8inc_ac2d2d9cd4c8559510f9baa997525373e.html#ac2d2d9cd4c8559510f9baa997525373e">00152</a> define(<span class="stringliteral">&#39;DRUPAL_AUTHENTICATED_RID&#39;</span>, 2);
<a name="l00153"></a>00153 
<a name="l00159"></a><a class="code" href="bootstrap_8inc_ab6865363d0c783dee8dccbda9849de9f.html#ab6865363d0c783dee8dccbda9849de9f">00159</a> define(<span class="stringliteral">&#39;DRUPAL_KILOBYTE&#39;</span>, 1024);
<a name="l00160"></a>00160 
<a name="l00166"></a><a class="code" href="bootstrap_8inc_a9e91e2136aa0ce5c5e80f06aa3ad8266.html#a9e91e2136aa0ce5c5e80f06aa3ad8266">00166</a> define(<span class="stringliteral">&#39;LANGUAGE_NONE&#39;</span>, <span class="stringliteral">&#39;und&#39;</span>);
<a name="l00167"></a>00167 
<a name="l00171"></a><a class="code" href="bootstrap_8inc_a40466aefcfc6ea9766f1fedf53cb3a6d.html#a40466aefcfc6ea9766f1fedf53cb3a6d">00171</a> define(<span class="stringliteral">&#39;LANGUAGE_TYPE_CONTENT&#39;</span>, <span class="stringliteral">&#39;language_content&#39;</span>);
<a name="l00172"></a>00172 
<a name="l00176"></a><a class="code" href="bootstrap_8inc_adcc8b40b0d1ee5cd37f1c7314cc541dc.html#adcc8b40b0d1ee5cd37f1c7314cc541dc">00176</a> define(<span class="stringliteral">&#39;LANGUAGE_TYPE_INTERFACE&#39;</span>, <span class="stringliteral">&#39;language&#39;</span>);
<a name="l00177"></a>00177 
<a name="l00181"></a><a class="code" href="bootstrap_8inc_aa234a385123b721683deb3bcbf072635.html#aa234a385123b721683deb3bcbf072635">00181</a> define(<span class="stringliteral">&#39;LANGUAGE_TYPE_URL&#39;</span>, <span class="stringliteral">&#39;language_url&#39;</span>);
<a name="l00182"></a>00182 
<a name="l00186"></a><a class="code" href="bootstrap_8inc_a8790965df4de009fe8bdcf17f6a5c738.html#a8790965df4de009fe8bdcf17f6a5c738">00186</a> define(<span class="stringliteral">&#39;LANGUAGE_LTR&#39;</span>, 0);
<a name="l00187"></a>00187 
<a name="l00191"></a><a class="code" href="bootstrap_8inc_ac3c2ed4c787f238d2d39d644dbdcb6d4.html#ac3c2ed4c787f238d2d39d644dbdcb6d4">00191</a> define(<span class="stringliteral">&#39;LANGUAGE_RTL&#39;</span>, 1);
<a name="l00192"></a>00192 
<a name="l00203"></a><a class="code" href="bootstrap_8inc_a08bcd0b03e31c17fb7d58786bef2b7f4.html#a08bcd0b03e31c17fb7d58786bef2b7f4">00203</a> define(<span class="stringliteral">&#39;REQUEST_TIME&#39;</span>, (<span class="keywordtype">int</span>) $_SERVER[<span class="stringliteral">&#39;REQUEST_TIME&#39;</span>]);
<a name="l00204"></a>00204 
<a name="l00208"></a><a class="code" href="bootstrap_8inc_a7b115778ff532867b7af4c53d39a1de2.html#a7b115778ff532867b7af4c53d39a1de2">00208</a> define(<span class="stringliteral">&#39;CHECK_PLAIN&#39;</span>, 0);
<a name="l00209"></a>00209 
<a name="l00213"></a><a class="code" href="bootstrap_8inc_a90c8d2e0e3b0f4acce7e88c8c60ddbca.html#a90c8d2e0e3b0f4acce7e88c8c60ddbca">00213</a> define(<span class="stringliteral">&#39;PASS_THROUGH&#39;</span>, -1);
<a name="l00214"></a>00214 
<a name="l00218"></a><a class="code" href="bootstrap_8inc_a6045f5b23cf5e2c5e6ed8a2effaa7bfb.html#a6045f5b23cf5e2c5e6ed8a2effaa7bfb">00218</a> define(<span class="stringliteral">&#39;REGISTRY_RESET_LOOKUP_CACHE&#39;</span>, 1);
<a name="l00219"></a>00219 
<a name="l00223"></a><a class="code" href="bootstrap_8inc_ab6acafa683cd17da2d120b9faf3e04c2.html#ab6acafa683cd17da2d120b9faf3e04c2">00223</a> define(<span class="stringliteral">&#39;REGISTRY_WRITE_LOOKUP_CACHE&#39;</span>, 2);
<a name="l00224"></a>00224 
<a name="l00230"></a><a class="code" href="bootstrap_8inc_ac2b8a8a3549cb6839c538ebc812ecf8c.html#ac2b8a8a3549cb6839c538ebc812ecf8c">00230</a> define(<span class="stringliteral">&#39;DRUPAL_PHP_FUNCTION_PATTERN&#39;</span>, <span class="stringliteral">&#39;[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*&#39;</span>);
<a name="l00231"></a>00231 
<a name="l00287"></a><a class="code" href="classDrupalCacheArray.html">00287</a> <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="classDrupalCacheArray.html" title="Provides a caching wrapper to be used in place of large array structures.">DrupalCacheArray</a> <span class="keyword">implements</span> ArrayAccess {
<a name="l00288"></a>00288 
<a name="l00292"></a><a class="code" href="group__schemaapi_ga616fba4b18bafdf4cc6e34c4b5696d58.html#ga616fba4b18bafdf4cc6e34c4b5696d58">00292</a>   <span class="keyword">protected</span> <a class="code" href="group__schemaapi_ga616fba4b18bafdf4cc6e34c4b5696d58.html#ga616fba4b18bafdf4cc6e34c4b5696d58" title="A cid to pass to cache_set() and cache_get().">$cid</a>;
<a name="l00293"></a>00293 
<a name="l00297"></a><a class="code" href="group__schemaapi_ga29eeef3160c70f129c447e796e330cdb.html#ga29eeef3160c70f129c447e796e330cdb">00297</a>   <span class="keyword">protected</span> <a class="code" href="group__schemaapi_ga29eeef3160c70f129c447e796e330cdb.html#ga29eeef3160c70f129c447e796e330cdb" title="A bin to pass to cache_set() and cache_get().">$bin</a>;
<a name="l00298"></a>00298 
<a name="l00302"></a><a class="code" href="group__schemaapi_ga0ba2e712f18ec2c8ee8bf97d115c85d1.html#ga0ba2e712f18ec2c8ee8bf97d115c85d1">00302</a>   <span class="keyword">protected</span> <a class="code" href="group__schemaapi_ga0ba2e712f18ec2c8ee8bf97d115c85d1.html#ga0ba2e712f18ec2c8ee8bf97d115c85d1" title="An array of keys to add to the cache at the end of the request.">$keysToPersist</a> = array();
<a name="l00303"></a>00303 
<a name="l00307"></a><a class="code" href="group__schemaapi_ga696fd96aa3639a9d7d968961db9d5819.html#ga696fd96aa3639a9d7d968961db9d5819">00307</a>   <span class="keyword">protected</span> <a class="code" href="group__schemaapi_ga696fd96aa3639a9d7d968961db9d5819.html#ga696fd96aa3639a9d7d968961db9d5819" title="Storage for the data itself.">$storage</a> = array();
<a name="l00308"></a>00308 
<a name="l00317"></a><a class="code" href="group__schemaapi_gadbc374d9057276944d38062e769a1a99.html#gadbc374d9057276944d38062e769a1a99">00317</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="group__schemaapi_gadbc374d9057276944d38062e769a1a99.html#gadbc374d9057276944d38062e769a1a99" title="Constructs a DrupalCacheArray object.">__construct</a>(<a class="code" href="group__schemaapi_ga616fba4b18bafdf4cc6e34c4b5696d58.html#ga616fba4b18bafdf4cc6e34c4b5696d58" title="A cid to pass to cache_set() and cache_get().">$cid</a>, <a class="code" href="group__schemaapi_ga29eeef3160c70f129c447e796e330cdb.html#ga29eeef3160c70f129c447e796e330cdb" title="A bin to pass to cache_set() and cache_get().">$bin</a>) {
<a name="l00318"></a>00318     $this-&gt;cid = <a class="code" href="group__schemaapi_ga616fba4b18bafdf4cc6e34c4b5696d58.html#ga616fba4b18bafdf4cc6e34c4b5696d58" title="A cid to pass to cache_set() and cache_get().">$cid</a>;
<a name="l00319"></a>00319     $this-&gt;bin = <a class="code" href="group__schemaapi_ga29eeef3160c70f129c447e796e330cdb.html#ga29eeef3160c70f129c447e796e330cdb" title="A bin to pass to cache_set() and cache_get().">$bin</a>;
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     <span class="keywordflow">if</span> ($cached = <a class="code" href="cache_8inc_a9d873815c28909b61c3a6188b383f8a3.html#a9d873815c28909b61c3a6188b383f8a3" title="Returns data from the persistent cache.">cache_get</a>($this-&gt;cid, $this-&gt;bin)) {
<a name="l00322"></a>00322      $this-&gt;storage = $cached-&gt;data;
<a name="l00323"></a>00323     }
<a name="l00324"></a>00324   }
<a name="l00325"></a>00325 
<a name="l00329"></a><a class="code" href="group__schemaapi_gabec90ca8c02f7c14dfbf66fd9e6bb5dd.html#gabec90ca8c02f7c14dfbf66fd9e6bb5dd">00329</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="group__schemaapi_gabec90ca8c02f7c14dfbf66fd9e6bb5dd.html#gabec90ca8c02f7c14dfbf66fd9e6bb5dd" title="Implements ArrayAccess::offsetExists().">offsetExists</a>($offset) {
<a name="l00330"></a>00330     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="group__schemaapi_ga57be4d1b39bee68ee1c395c1cd9a2de5.html#ga57be4d1b39bee68ee1c395c1cd9a2de5" title="Implements ArrayAccess::offsetGet().">offsetGet</a>($offset) !== NULL;
<a name="l00331"></a>00331   }
<a name="l00332"></a>00332 
<a name="l00336"></a><a class="code" href="group__schemaapi_ga57be4d1b39bee68ee1c395c1cd9a2de5.html#ga57be4d1b39bee68ee1c395c1cd9a2de5">00336</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga57be4d1b39bee68ee1c395c1cd9a2de5.html#ga57be4d1b39bee68ee1c395c1cd9a2de5" title="Implements ArrayAccess::offsetGet().">offsetGet</a>($offset) {
<a name="l00337"></a>00337     <span class="keywordflow">if</span> (isset($this-&gt;storage[$offset]) || array_key_exists($offset, $this-&gt;storage)) {
<a name="l00338"></a>00338       <span class="keywordflow">return</span> $this-&gt;storage[$offset];
<a name="l00339"></a>00339     }
<a name="l00340"></a>00340     <span class="keywordflow">else</span> {
<a name="l00341"></a>00341       <span class="keywordflow">return</span> $this-&gt;<a class="code" href="group__schemaapi_ga33d892a839b353177e2483f6946178e9.html#ga33d892a839b353177e2483f6946178e9" title="Resolves a cache miss.">resolveCacheMiss</a>($offset);
<a name="l00342"></a>00342     }
<a name="l00343"></a>00343   }
<a name="l00344"></a>00344 
<a name="l00348"></a><a class="code" href="group__schemaapi_ga0d3377e6f4b8c592f006a75f8eadf21a.html#ga0d3377e6f4b8c592f006a75f8eadf21a">00348</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga0d3377e6f4b8c592f006a75f8eadf21a.html#ga0d3377e6f4b8c592f006a75f8eadf21a" title="Implements ArrayAccess::offsetSet().">offsetSet</a>($offset, $value) {
<a name="l00349"></a>00349     $this-&gt;storage[$offset] = $value;
<a name="l00350"></a>00350   }
<a name="l00351"></a>00351 
<a name="l00355"></a><a class="code" href="group__schemaapi_ga8bb43551e89c35590c56a49f8fb54e3f.html#ga8bb43551e89c35590c56a49f8fb54e3f">00355</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga8bb43551e89c35590c56a49f8fb54e3f.html#ga8bb43551e89c35590c56a49f8fb54e3f" title="Implements ArrayAccess::offsetUnset().">offsetUnset</a>($offset) {
<a name="l00356"></a>00356     unset($this-&gt;storage[$offset]);
<a name="l00357"></a>00357   }
<a name="l00358"></a>00358 
<a name="l00374"></a><a class="code" href="group__schemaapi_ga27687007f42979bdb8999683f3270c4a.html#ga27687007f42979bdb8999683f3270c4a">00374</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga27687007f42979bdb8999683f3270c4a.html#ga27687007f42979bdb8999683f3270c4a" title="Flags an offset value to be written to the persistent cache.">persist</a>($offset, $persist = TRUE) {
<a name="l00375"></a>00375     $this-&gt;keysToPersist[$offset] = $persist;
<a name="l00376"></a>00376   }
<a name="l00377"></a>00377 
<a name="l00391"></a>00391   <span class="keyword">abstract</span> <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga33d892a839b353177e2483f6946178e9.html#ga33d892a839b353177e2483f6946178e9" title="Resolves a cache miss.">resolveCacheMiss</a>($offset);
<a name="l00392"></a>00392 
<a name="l00401"></a><a class="code" href="group__schemaapi_ga9d99af903ba2660c09ca835e63c79118.html#ga9d99af903ba2660c09ca835e63c79118">00401</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <span class="keyword">set</span>($data, $lock = TRUE) {
<a name="l00402"></a>00402     <span class="comment">// Lock cache writes to help avoid stampedes.</span>
<a name="l00403"></a>00403     <span class="comment">// To implement locking for cache misses, override __construct().</span>
<a name="l00404"></a>00404     $lock_name = $this-&gt;cid . <span class="charliteral">&#39;:&#39;</span> . $this-&gt;bin;
<a name="l00405"></a>00405     <span class="keywordflow">if</span> (!$lock || <a class="code" href="group__lock_gac67a4b1061491f7a869646f47b66e998.html#gac67a4b1061491f7a869646f47b66e998" title="Acquire (or renew) a lock, but do not block if it fails.">lock_acquire</a>($lock_name)) {
<a name="l00406"></a>00406       <span class="keywordflow">if</span> ($cached = <a class="code" href="cache_8inc_a9d873815c28909b61c3a6188b383f8a3.html#a9d873815c28909b61c3a6188b383f8a3" title="Returns data from the persistent cache.">cache_get</a>($this-&gt;cid, $this-&gt;bin)) {
<a name="l00407"></a>00407         $data = $cached-&gt;data + $data;
<a name="l00408"></a>00408       }
<a name="l00409"></a>00409       <a class="code" href="cache_8inc_a48081f36334909f561ef4f538fa640d2.html#a48081f36334909f561ef4f538fa640d2" title="Stores data in the persistent cache.">cache_set</a>($this-&gt;cid, $data, $this-&gt;bin);
<a name="l00410"></a>00410       <span class="keywordflow">if</span> ($lock) {
<a name="l00411"></a>00411         <a class="code" href="group__lock_ga73e1456861f9aff1a506a650f43aceb0.html#ga73e1456861f9aff1a506a650f43aceb0" title="Release a lock previously acquired by lock_acquire().">lock_release</a>($lock_name);
<a name="l00412"></a>00412       }
<a name="l00413"></a>00413     }
<a name="l00414"></a>00414   }
<a name="l00415"></a>00415 
<a name="l00419"></a><a class="code" href="group__schemaapi_ga63c3aa47f3a451f0c5182800d29d5d9f.html#ga63c3aa47f3a451f0c5182800d29d5d9f">00419</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga63c3aa47f3a451f0c5182800d29d5d9f.html#ga63c3aa47f3a451f0c5182800d29d5d9f" title="Destructs the DrupalCacheArray object.">__destruct</a>() {
<a name="l00420"></a>00420     $data = array();
<a name="l00421"></a>00421     <span class="keywordflow">foreach</span> ($this-&gt;keysToPersist as $offset =&gt; $persist) {
<a name="l00422"></a>00422       <span class="keywordflow">if</span> ($persist) {
<a name="l00423"></a>00423         $data[$offset] = $this-&gt;storage[$offset];
<a name="l00424"></a>00424       }
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426     <span class="keywordflow">if</span> (!empty($data)) {
<a name="l00427"></a>00427       $this-&gt;<span class="keyword">set</span>($data);
<a name="l00428"></a>00428     }
<a name="l00429"></a>00429   }
<a name="l00430"></a>00430 }
<a name="l00431"></a>00431 
<a name="l00441"></a><a class="code" href="bootstrap_8inc_a0aaa023d3c72be50ab4ac3f7e1c989c0.html#a0aaa023d3c72be50ab4ac3f7e1c989c0">00441</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a0aaa023d3c72be50ab4ac3f7e1c989c0.html#a0aaa023d3c72be50ab4ac3f7e1c989c0" title="Starts the timer with the specified name.">timer_start</a>($name) {
<a name="l00442"></a>00442   global $timers;
<a name="l00443"></a>00443 
<a name="l00444"></a>00444   $timers[$name][<span class="stringliteral">&#39;start&#39;</span>] = microtime(TRUE);
<a name="l00445"></a>00445   $timers[$name][<span class="stringliteral">&#39;count&#39;</span>] = isset($timers[$name][<span class="stringliteral">&#39;count&#39;</span>]) ? ++$timers[$name][<span class="stringliteral">&#39;count&#39;</span>] : 1;
<a name="l00446"></a>00446 }
<a name="l00447"></a>00447 
<a name="l00457"></a><a class="code" href="bootstrap_8inc_ad093007ebd04feb2a1394ff5774eb6d4.html#ad093007ebd04feb2a1394ff5774eb6d4">00457</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_ad093007ebd04feb2a1394ff5774eb6d4.html#ad093007ebd04feb2a1394ff5774eb6d4" title="Reads the current timer value without stopping the timer.">timer_read</a>($name) {
<a name="l00458"></a>00458   global $timers;
<a name="l00459"></a>00459 
<a name="l00460"></a>00460   <span class="keywordflow">if</span> (isset($timers[$name][<span class="stringliteral">&#39;start&#39;</span>])) {
<a name="l00461"></a>00461     $stop = microtime(TRUE);
<a name="l00462"></a>00462     $diff = round(($stop - $timers[$name][<span class="stringliteral">&#39;start&#39;</span>]) * 1000, 2);
<a name="l00463"></a>00463 
<a name="l00464"></a>00464     <span class="keywordflow">if</span> (isset($timers[$name][<span class="stringliteral">&#39;time&#39;</span>])) {
<a name="l00465"></a>00465       $diff += $timers[$name][<span class="stringliteral">&#39;time&#39;</span>];
<a name="l00466"></a>00466     }
<a name="l00467"></a>00467     <span class="keywordflow">return</span> $diff;
<a name="l00468"></a>00468   }
<a name="l00469"></a>00469   <span class="keywordflow">return</span> $timers[$name][<span class="stringliteral">&#39;time&#39;</span>];
<a name="l00470"></a>00470 }
<a name="l00471"></a>00471 
<a name="l00482"></a><a class="code" href="bootstrap_8inc_a8cb56b8962398895710c35a3584a7d11.html#a8cb56b8962398895710c35a3584a7d11">00482</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a8cb56b8962398895710c35a3584a7d11.html#a8cb56b8962398895710c35a3584a7d11" title="Stops the timer with the specified name.">timer_stop</a>($name) {
<a name="l00483"></a>00483   global $timers;
<a name="l00484"></a>00484 
<a name="l00485"></a>00485   <span class="keywordflow">if</span> (isset($timers[$name][<span class="stringliteral">&#39;start&#39;</span>])) {
<a name="l00486"></a>00486     $stop = microtime(TRUE);
<a name="l00487"></a>00487     $diff = round(($stop - $timers[$name][<span class="stringliteral">&#39;start&#39;</span>]) * 1000, 2);
<a name="l00488"></a>00488     <span class="keywordflow">if</span> (isset($timers[$name][<span class="stringliteral">&#39;time&#39;</span>])) {
<a name="l00489"></a>00489       $timers[$name][<span class="stringliteral">&#39;time&#39;</span>] += $diff;
<a name="l00490"></a>00490     }
<a name="l00491"></a>00491     <span class="keywordflow">else</span> {
<a name="l00492"></a>00492       $timers[$name][<span class="stringliteral">&#39;time&#39;</span>] = $diff;
<a name="l00493"></a>00493     }
<a name="l00494"></a>00494     unset($timers[$name][<span class="stringliteral">&#39;start&#39;</span>]);
<a name="l00495"></a>00495   }
<a name="l00496"></a>00496 
<a name="l00497"></a>00497   <span class="keywordflow">return</span> $timers[$name];
<a name="l00498"></a>00498 }
<a name="l00499"></a>00499 
<a name="l00564"></a><a class="code" href="bootstrap_8inc_acef612ef19c49f6259531f0bee5c26cc.html#acef612ef19c49f6259531f0bee5c26cc">00564</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_acef612ef19c49f6259531f0bee5c26cc.html#acef612ef19c49f6259531f0bee5c26cc" title="Finds the appropriate configuration directory.">conf_path</a>($require_settings = TRUE, $reset = FALSE) {
<a name="l00565"></a>00565   <a class="code" href="authorize_8php_a10064a52f624358ea93475105245c4ac.html#a10064a52f624358ea93475105245c4ac">$conf</a> = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__, <span class="stringliteral">&#39;&#39;</span>);
<a name="l00566"></a>00566 
<a name="l00567"></a>00567   <span class="keywordflow">if</span> (<a class="code" href="authorize_8php_a10064a52f624358ea93475105245c4ac.html#a10064a52f624358ea93475105245c4ac">$conf</a> &amp;&amp; !$reset) {
<a name="l00568"></a>00568     <span class="keywordflow">return</span> <a class="code" href="authorize_8php_a10064a52f624358ea93475105245c4ac.html#a10064a52f624358ea93475105245c4ac">$conf</a>;
<a name="l00569"></a>00569   }
<a name="l00570"></a>00570 
<a name="l00571"></a>00571   $confdir = <span class="stringliteral">&#39;sites&#39;</span>;
<a name="l00572"></a>00572 
<a name="l00573"></a>00573   $sites = array();
<a name="l00574"></a>00574   <span class="keywordflow">if</span> (file_exists(<a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $confdir . <span class="stringliteral">&#39;/sites.php&#39;</span>)) {
<a name="l00575"></a>00575     <span class="comment">// This will overwrite $sites with the desired mappings.</span>
<a name="l00576"></a>00576     include(<a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $confdir . <span class="stringliteral">&#39;/sites.php&#39;</span>);
<a name="l00577"></a>00577   }
<a name="l00578"></a>00578 
<a name="l00579"></a>00579   $uri = explode(<span class="charliteral">&#39;/&#39;</span>, $_SERVER[<span class="stringliteral">&#39;SCRIPT_NAME&#39;</span>] ? $_SERVER[<span class="stringliteral">&#39;SCRIPT_NAME&#39;</span>] : $_SERVER[<span class="stringliteral">&#39;SCRIPT_FILENAME&#39;</span>]);
<a name="l00580"></a>00580   $server = explode(<span class="charliteral">&#39;.&#39;</span>, implode(<span class="charliteral">&#39;.&#39;</span>, array_reverse(explode(<span class="charliteral">&#39;:&#39;</span>, rtrim($_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>], <span class="charliteral">&#39;.&#39;</span>)))));
<a name="l00581"></a>00581   <span class="keywordflow">for</span> ($i = count($uri) - 1; $i &gt; 0; $i--) {
<a name="l00582"></a>00582     <span class="keywordflow">for</span> ($j = count($server); $j &gt; 0; $j--) {
<a name="l00583"></a>00583       $dir = implode(<span class="charliteral">&#39;.&#39;</span>, array_slice($server, -$j)) . implode(<span class="charliteral">&#39;.&#39;</span>, array_slice($uri, 0, $i));
<a name="l00584"></a>00584       <span class="keywordflow">if</span> (isset($sites[$dir]) &amp;&amp; file_exists(<a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $confdir . <span class="charliteral">&#39;/&#39;</span> . $sites[$dir])) {
<a name="l00585"></a>00585         $dir = $sites[$dir];
<a name="l00586"></a>00586       }
<a name="l00587"></a>00587       <span class="keywordflow">if</span> (file_exists(<a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $confdir . <span class="charliteral">&#39;/&#39;</span> . $dir . <span class="stringliteral">&#39;/settings.php&#39;</span>) || (!$require_settings &amp;&amp; file_exists(<a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $confdir . <span class="charliteral">&#39;/&#39;</span> . $dir))) {
<a name="l00588"></a>00588         <a class="code" href="authorize_8php_a10064a52f624358ea93475105245c4ac.html#a10064a52f624358ea93475105245c4ac">$conf</a> = <span class="stringliteral">&quot;$confdir/$dir&quot;</span>;
<a name="l00589"></a>00589         <span class="keywordflow">return</span> <a class="code" href="authorize_8php_a10064a52f624358ea93475105245c4ac.html#a10064a52f624358ea93475105245c4ac">$conf</a>;
<a name="l00590"></a>00590       }
<a name="l00591"></a>00591     }
<a name="l00592"></a>00592   }
<a name="l00593"></a>00593   <a class="code" href="authorize_8php_a10064a52f624358ea93475105245c4ac.html#a10064a52f624358ea93475105245c4ac">$conf</a> = <span class="stringliteral">&quot;$confdir/default&quot;</span>;
<a name="l00594"></a>00594   <span class="keywordflow">return</span> <a class="code" href="authorize_8php_a10064a52f624358ea93475105245c4ac.html#a10064a52f624358ea93475105245c4ac">$conf</a>;
<a name="l00595"></a>00595 }
<a name="l00596"></a>00596 
<a name="l00631"></a><a class="code" href="bootstrap_8inc_ae40262dd353ec3d0fada2e2d2d44a8ef.html#ae40262dd353ec3d0fada2e2d2d44a8ef">00631</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_ae40262dd353ec3d0fada2e2d2d44a8ef.html#ae40262dd353ec3d0fada2e2d2d44a8ef" title="Sets appropriate server variables needed for command line scripts to work.">drupal_override_server_variables</a>($variables = array()) {
<a name="l00632"></a>00632   <span class="comment">// Allow the provided URL to override any existing values in $_SERVER.</span>
<a name="l00633"></a>00633   <span class="keywordflow">if</span> (isset($variables[<span class="stringliteral">&#39;url&#39;</span>])) {
<a name="l00634"></a>00634     $url = parse_url($variables[<span class="stringliteral">&#39;url&#39;</span>]);
<a name="l00635"></a>00635     <span class="keywordflow">if</span> (isset($url[<span class="stringliteral">&#39;host&#39;</span>])) {
<a name="l00636"></a>00636       $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = $url[<span class="stringliteral">&#39;host&#39;</span>];
<a name="l00637"></a>00637     }
<a name="l00638"></a>00638     <span class="keywordflow">if</span> (isset($url[<span class="stringliteral">&#39;path&#39;</span>])) {
<a name="l00639"></a>00639       $_SERVER[<span class="stringliteral">&#39;SCRIPT_NAME&#39;</span>] = $url[<span class="stringliteral">&#39;path&#39;</span>];
<a name="l00640"></a>00640     }
<a name="l00641"></a>00641     unset($variables[<span class="stringliteral">&#39;url&#39;</span>]);
<a name="l00642"></a>00642   }
<a name="l00643"></a>00643   <span class="comment">// Define default values for $_SERVER keys. These will be used if $_SERVER</span>
<a name="l00644"></a>00644   <span class="comment">// does not already define them and no other values are passed in to this</span>
<a name="l00645"></a>00645   <span class="comment">// function.</span>
<a name="l00646"></a>00646   $defaults = array(
<a name="l00647"></a>00647     <span class="stringliteral">&#39;HTTP_HOST&#39;</span> =&gt; <span class="stringliteral">&#39;localhost&#39;</span>,
<a name="l00648"></a>00648     <span class="stringliteral">&#39;SCRIPT_NAME&#39;</span> =&gt; NULL,
<a name="l00649"></a>00649     <span class="stringliteral">&#39;REMOTE_ADDR&#39;</span> =&gt; <span class="stringliteral">&#39;127.0.0.1&#39;</span>,
<a name="l00650"></a>00650     <span class="stringliteral">&#39;REQUEST_METHOD&#39;</span> =&gt; <span class="stringliteral">&#39;GET&#39;</span>,
<a name="l00651"></a>00651     <span class="stringliteral">&#39;SERVER_NAME&#39;</span> =&gt; NULL,
<a name="l00652"></a>00652     <span class="stringliteral">&#39;SERVER_SOFTWARE&#39;</span> =&gt; NULL,
<a name="l00653"></a>00653     <span class="stringliteral">&#39;HTTP_USER_AGENT&#39;</span> =&gt; NULL,
<a name="l00654"></a>00654   );
<a name="l00655"></a>00655   <span class="comment">// Replace elements of the $_SERVER array, as appropriate.</span>
<a name="l00656"></a>00656   $_SERVER = $variables + $_SERVER + $defaults;
<a name="l00657"></a>00657 }
<a name="l00658"></a>00658 
<a name="l00662"></a><a class="code" href="bootstrap_8inc_a14319f2e33c7996576b203ed2bae9b62.html#a14319f2e33c7996576b203ed2bae9b62">00662</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a14319f2e33c7996576b203ed2bae9b62.html#a14319f2e33c7996576b203ed2bae9b62" title="Initializes the PHP environment.">drupal_environment_initialize</a>() {
<a name="l00663"></a>00663   <span class="keywordflow">if</span> (!isset($_SERVER[<span class="stringliteral">&#39;HTTP_REFERER&#39;</span>])) {
<a name="l00664"></a>00664     $_SERVER[<span class="stringliteral">&#39;HTTP_REFERER&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00665"></a>00665   }
<a name="l00666"></a>00666   <span class="keywordflow">if</span> (!isset($_SERVER[<span class="stringliteral">&#39;SERVER_PROTOCOL&#39;</span>]) || ($_SERVER[<span class="stringliteral">&#39;SERVER_PROTOCOL&#39;</span>] != <span class="stringliteral">&#39;HTTP/1.0&#39;</span> &amp;&amp; $_SERVER[<span class="stringliteral">&#39;SERVER_PROTOCOL&#39;</span>] != <span class="stringliteral">&#39;HTTP/1.1&#39;</span>)) {
<a name="l00667"></a>00667     $_SERVER[<span class="stringliteral">&#39;SERVER_PROTOCOL&#39;</span>] = <span class="stringliteral">&#39;HTTP/1.0&#39;</span>;
<a name="l00668"></a>00668   }
<a name="l00669"></a>00669 
<a name="l00670"></a>00670   <span class="keywordflow">if</span> (isset($_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>])) {
<a name="l00671"></a>00671     <span class="comment">// As HTTP_HOST is user input, ensure it only contains characters allowed</span>
<a name="l00672"></a>00672     <span class="comment">// in hostnames. See RFC 952 (and RFC 2181).</span>
<a name="l00673"></a>00673     <span class="comment">// $_SERVER[&#39;HTTP_HOST&#39;] is lowercased here per specifications.</span>
<a name="l00674"></a>00674     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = strtolower($_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>]);
<a name="l00675"></a>00675     <span class="keywordflow">if</span> (!<a class="code" href="bootstrap_8inc_ae65d9d5f6c34309eb884e51fd39ffb6d.html#ae65d9d5f6c34309eb884e51fd39ffb6d" title="Validates that a hostname (for example $_SERVER[&#39;HTTP_HOST&#39;]) is safe.">drupal_valid_http_host</a>($_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>])) {
<a name="l00676"></a>00676       <span class="comment">// HTTP_HOST is invalid, e.g. if containing slashes it may be an attack.</span>
<a name="l00677"></a>00677       header($_SERVER[<span class="stringliteral">&#39;SERVER_PROTOCOL&#39;</span>] . <span class="stringliteral">&#39; 400 Bad Request&#39;</span>);
<a name="l00678"></a>00678       exit;
<a name="l00679"></a>00679     }
<a name="l00680"></a>00680   }
<a name="l00681"></a>00681   <span class="keywordflow">else</span> {
<a name="l00682"></a>00682     <span class="comment">// Some pre-HTTP/1.1 clients will not send a Host header. Ensure the key is</span>
<a name="l00683"></a>00683     <span class="comment">// defined for E_ALL compliance.</span>
<a name="l00684"></a>00684     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00685"></a>00685   }
<a name="l00686"></a>00686 
<a name="l00687"></a>00687   <span class="comment">// When clean URLs are enabled, emulate ?q=foo/bar using REQUEST_URI. It is</span>
<a name="l00688"></a>00688   <span class="comment">// not possible to append the query string using mod_rewrite without the B</span>
<a name="l00689"></a>00689   <span class="comment">// flag (this was added in Apache 2.2.8), because mod_rewrite unescapes the</span>
<a name="l00690"></a>00690   <span class="comment">// path before passing it on to PHP. This is a problem when the path contains</span>
<a name="l00691"></a>00691   <span class="comment">// e.g. &quot;&amp;&quot; or &quot;%&quot; that have special meanings in URLs and must be encoded.</span>
<a name="l00692"></a>00692   $_GET[<span class="charliteral">&#39;q&#39;</span>] = <a class="code" href="bootstrap_8inc_a58aae06c8c4282de3a6e292353bac1c0.html#a58aae06c8c4282de3a6e292353bac1c0" title="Returns the requested URL path of the page being viewed.">request_path</a>();
<a name="l00693"></a>00693 
<a name="l00694"></a>00694   <span class="comment">// Enforce E_ALL, but allow users to set levels not part of E_ALL.</span>
<a name="l00695"></a>00695   error_reporting(E_ALL | error_reporting());
<a name="l00696"></a>00696 
<a name="l00697"></a>00697   <span class="comment">// Override PHP settings required for Drupal to work properly.</span>
<a name="l00698"></a>00698   <span class="comment">// sites/default/default.settings.php contains more runtime settings.</span>
<a name="l00699"></a>00699   <span class="comment">// The .htaccess file contains settings that cannot be changed at runtime.</span>
<a name="l00700"></a>00700 
<a name="l00701"></a>00701   <span class="comment">// Don&#39;t escape quotes when reading files from the database, disk, etc.</span>
<a name="l00702"></a>00702   ini_set(<span class="stringliteral">&#39;magic_quotes_runtime&#39;</span>, <span class="charliteral">&#39;0&#39;</span>);
<a name="l00703"></a>00703   <span class="comment">// Use session cookies, not transparent sessions that puts the session id in</span>
<a name="l00704"></a>00704   <span class="comment">// the query string.</span>
<a name="l00705"></a>00705   ini_set(<span class="stringliteral">&#39;session.use_cookies&#39;</span>, <span class="charliteral">&#39;1&#39;</span>);
<a name="l00706"></a>00706   ini_set(<span class="stringliteral">&#39;session.use_only_cookies&#39;</span>, <span class="charliteral">&#39;1&#39;</span>);
<a name="l00707"></a>00707   ini_set(<span class="stringliteral">&#39;session.use_trans_sid&#39;</span>, <span class="charliteral">&#39;0&#39;</span>);
<a name="l00708"></a>00708   <span class="comment">// Don&#39;t send HTTP headers using PHP&#39;s session handler.</span>
<a name="l00709"></a>00709   ini_set(<span class="stringliteral">&#39;session.cache_limiter&#39;</span>, <span class="stringliteral">&#39;none&#39;</span>);
<a name="l00710"></a>00710   <span class="comment">// Use httponly session cookies.</span>
<a name="l00711"></a>00711   ini_set(<span class="stringliteral">&#39;session.cookie_httponly&#39;</span>, <span class="charliteral">&#39;1&#39;</span>);
<a name="l00712"></a>00712 
<a name="l00713"></a>00713   <span class="comment">// Set sane locale settings, to ensure consistent string, dates, times and</span>
<a name="l00714"></a>00714   <span class="comment">// numbers handling.</span>
<a name="l00715"></a>00715   setlocale(LC_ALL, <span class="charliteral">&#39;C&#39;</span>);
<a name="l00716"></a>00716 }
<a name="l00717"></a>00717 
<a name="l00724"></a><a class="code" href="bootstrap_8inc_ae65d9d5f6c34309eb884e51fd39ffb6d.html#ae65d9d5f6c34309eb884e51fd39ffb6d">00724</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_ae65d9d5f6c34309eb884e51fd39ffb6d.html#ae65d9d5f6c34309eb884e51fd39ffb6d" title="Validates that a hostname (for example $_SERVER[&#39;HTTP_HOST&#39;]) is safe.">drupal_valid_http_host</a>($host) {
<a name="l00725"></a>00725   <span class="keywordflow">return</span> preg_match(<span class="stringliteral">&#39;/^\[?(?:[a-zA-Z0-9-:\]_]+\.?)+$/&#39;</span>, $host);
<a name="l00726"></a>00726 }
<a name="l00727"></a>00727 
<a name="l00731"></a><a class="code" href="bootstrap_8inc_acae9a8501a2571219d7517f50cc6afec.html#acae9a8501a2571219d7517f50cc6afec">00731</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_acae9a8501a2571219d7517f50cc6afec.html#acae9a8501a2571219d7517f50cc6afec" title="Sets the base URL, cookie domain, and session name from configuration.">drupal_settings_initialize</a>() {
<a name="l00732"></a>00732   global $base_url, $base_path, $base_root;
<a name="l00733"></a>00733 
<a name="l00734"></a>00734   <span class="comment">// Export the following settings.php variables to the global namespace</span>
<a name="l00735"></a>00735   global <a class="code" href="default_8settings_8php_a97cde67402a68697692531e8b067f86f.html#a97cde67402a68697692531e8b067f86f" title="Database settings:">$databases</a>, $cookie_domain, <a class="code" href="authorize_8php_a10064a52f624358ea93475105245c4ac.html#a10064a52f624358ea93475105245c4ac">$conf</a>, $installed_profile, <a class="code" href="default_8settings_8php_afa06f20a6b90dec9a2573e779cd10b44.html#afa06f20a6b90dec9a2573e779cd10b44" title="Access control for update.php script.">$update_free_access</a>, $db_url, $db_prefix, <a class="code" href="default_8settings_8php_a75c981b07486dd3b07d5f122702dd87e.html#a75c981b07486dd3b07d5f122702dd87e" title="Salt for one-time login links and cancel links, form tokens, etc.">$drupal_hash_salt</a>, $is_https, $base_secure_url, $base_insecure_url;
<a name="l00736"></a>00736   $conf = array();
<a name="l00737"></a>00737 
<a name="l00738"></a>00738   <span class="keywordflow">if</span> (file_exists(<a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . <a class="code" href="bootstrap_8inc_acef612ef19c49f6259531f0bee5c26cc.html#acef612ef19c49f6259531f0bee5c26cc" title="Finds the appropriate configuration directory.">conf_path</a>() . <span class="stringliteral">&#39;/settings.php&#39;</span>)) {
<a name="l00739"></a>00739     include_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . <a class="code" href="bootstrap_8inc_acef612ef19c49f6259531f0bee5c26cc.html#acef612ef19c49f6259531f0bee5c26cc" title="Finds the appropriate configuration directory.">conf_path</a>() . <span class="stringliteral">&#39;/settings.php&#39;</span>;
<a name="l00740"></a>00740   }
<a name="l00741"></a>00741   $is_https = isset($_SERVER[<span class="stringliteral">&#39;HTTPS&#39;</span>]) &amp;&amp; strtolower($_SERVER[<span class="stringliteral">&#39;HTTPS&#39;</span>]) == <span class="stringliteral">&#39;on&#39;</span>;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743   <span class="keywordflow">if</span> (isset($base_url)) {
<a name="l00744"></a>00744     <span class="comment">// Parse fixed base URL from settings.php.</span>
<a name="l00745"></a>00745     $parts = parse_url($base_url);
<a name="l00746"></a>00746     $http_protocol = $parts[<span class="stringliteral">&#39;scheme&#39;</span>];
<a name="l00747"></a>00747     <span class="keywordflow">if</span> (!isset($parts[<span class="stringliteral">&#39;path&#39;</span>])) {
<a name="l00748"></a>00748       $parts[<span class="stringliteral">&#39;path&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00749"></a>00749     }
<a name="l00750"></a>00750     $base_path = $parts[<span class="stringliteral">&#39;path&#39;</span>] . <span class="charliteral">&#39;/&#39;</span>;
<a name="l00751"></a>00751     <span class="comment">// Build $base_root (everything until first slash after &quot;scheme://&quot;).</span>
<a name="l00752"></a>00752     $base_root = substr($base_url, 0, strlen($base_url) - strlen($parts[<span class="stringliteral">&#39;path&#39;</span>]));
<a name="l00753"></a>00753   }
<a name="l00754"></a>00754   <span class="keywordflow">else</span> {
<a name="l00755"></a>00755     <span class="comment">// Create base URL</span>
<a name="l00756"></a>00756     $http_protocol = $is_https ? <span class="stringliteral">&#39;https&#39;</span> : <span class="stringliteral">&#39;http&#39;</span>;
<a name="l00757"></a>00757     $base_root = $http_protocol . <span class="stringliteral">&#39;://&#39;</span> . $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>];
<a name="l00758"></a>00758 
<a name="l00759"></a>00759     $base_url = $base_root;
<a name="l00760"></a>00760 
<a name="l00761"></a>00761     <span class="comment">// $_SERVER[&#39;SCRIPT_NAME&#39;] can, in contrast to $_SERVER[&#39;PHP_SELF&#39;], not</span>
<a name="l00762"></a>00762     <span class="comment">// be modified by a visitor.</span>
<a name="l00763"></a>00763     <span class="keywordflow">if</span> ($dir = rtrim(dirname($_SERVER[<span class="stringliteral">&#39;SCRIPT_NAME&#39;</span>]), <span class="charliteral">&#39;\/&#39;</span>)) {
<a name="l00764"></a>00764       $base_path = $dir;
<a name="l00765"></a>00765       $base_url .= $base_path;
<a name="l00766"></a>00766       $base_path .= <span class="charliteral">&#39;/&#39;</span>;
<a name="l00767"></a>00767     }
<a name="l00768"></a>00768     <span class="keywordflow">else</span> {
<a name="l00769"></a>00769       $base_path = <span class="charliteral">&#39;/&#39;</span>;
<a name="l00770"></a>00770     }
<a name="l00771"></a>00771   }
<a name="l00772"></a>00772   $base_secure_url = str_replace(<span class="stringliteral">&#39;http://&#39;</span>, <span class="stringliteral">&#39;https://&#39;</span>, $base_url);
<a name="l00773"></a>00773   $base_insecure_url = str_replace(<span class="stringliteral">&#39;https://&#39;</span>, <span class="stringliteral">&#39;http://&#39;</span>, $base_url);
<a name="l00774"></a>00774 
<a name="l00775"></a>00775   <span class="keywordflow">if</span> ($cookie_domain) {
<a name="l00776"></a>00776     <span class="comment">// If the user specifies the cookie domain, also use it for session name.</span>
<a name="l00777"></a>00777     $session_name = $cookie_domain;
<a name="l00778"></a>00778   }
<a name="l00779"></a>00779   <span class="keywordflow">else</span> {
<a name="l00780"></a>00780     <span class="comment">// Otherwise use $base_url as session name, without the protocol</span>
<a name="l00781"></a>00781     <span class="comment">// to use the same session identifiers across http and https.</span>
<a name="l00782"></a>00782     list( , $session_name) = explode(<span class="stringliteral">&#39;://&#39;</span>, $base_url, 2);
<a name="l00783"></a>00783     <span class="comment">// HTTP_HOST can be modified by a visitor, but we already sanitized it</span>
<a name="l00784"></a>00784     <span class="comment">// in drupal_settings_initialize().</span>
<a name="l00785"></a>00785     <span class="keywordflow">if</span> (!empty($_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>])) {
<a name="l00786"></a>00786       $cookie_domain = $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>];
<a name="l00787"></a>00787       <span class="comment">// Strip leading periods, www., and port numbers from cookie domain.</span>
<a name="l00788"></a>00788       $cookie_domain = ltrim($cookie_domain, <span class="charliteral">&#39;.&#39;</span>);
<a name="l00789"></a>00789       <span class="keywordflow">if</span> (strpos($cookie_domain, <span class="stringliteral">&#39;www.&#39;</span>) === 0) {
<a name="l00790"></a>00790         $cookie_domain = substr($cookie_domain, 4);
<a name="l00791"></a>00791       }
<a name="l00792"></a>00792       $cookie_domain = explode(<span class="charliteral">&#39;:&#39;</span>, $cookie_domain);
<a name="l00793"></a>00793       $cookie_domain = <span class="charliteral">&#39;.&#39;</span> . $cookie_domain[0];
<a name="l00794"></a>00794     }
<a name="l00795"></a>00795   }
<a name="l00796"></a>00796   <span class="comment">// Per RFC 2109, cookie domains must contain at least one dot other than the</span>
<a name="l00797"></a>00797   <span class="comment">// first. For hosts such as &#39;localhost&#39; or IP Addresses we don&#39;t set a cookie domain.</span>
<a name="l00798"></a>00798   <span class="keywordflow">if</span> (count(explode(<span class="charliteral">&#39;.&#39;</span>, $cookie_domain)) &gt; 2 &amp;&amp; !is_numeric(str_replace(<span class="charliteral">&#39;.&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $cookie_domain))) {
<a name="l00799"></a>00799     ini_set(<span class="stringliteral">&#39;session.cookie_domain&#39;</span>, $cookie_domain);
<a name="l00800"></a>00800   }
<a name="l00801"></a>00801   <span class="comment">// To prevent session cookies from being hijacked, a user can configure the</span>
<a name="l00802"></a>00802   <span class="comment">// SSL version of their website to only transfer session cookies via SSL by</span>
<a name="l00803"></a>00803   <span class="comment">// using PHP&#39;s session.cookie_secure setting. The browser will then use two</span>
<a name="l00804"></a>00804   <span class="comment">// separate session cookies for the HTTPS and HTTP versions of the site. So we</span>
<a name="l00805"></a>00805   <span class="comment">// must use different session identifiers for HTTPS and HTTP to prevent a</span>
<a name="l00806"></a>00806   <span class="comment">// cookie collision.</span>
<a name="l00807"></a>00807   <span class="keywordflow">if</span> ($is_https) {
<a name="l00808"></a>00808     ini_set(<span class="stringliteral">&#39;session.cookie_secure&#39;</span>, TRUE);
<a name="l00809"></a>00809   }
<a name="l00810"></a>00810   $prefix = ini_get(<span class="stringliteral">&#39;session.cookie_secure&#39;</span>) ? <span class="stringliteral">&#39;SSESS&#39;</span> : <span class="stringliteral">&#39;SESS&#39;</span>;
<a name="l00811"></a>00811   session_name($prefix . substr(hash(<span class="stringliteral">&#39;sha256&#39;</span>, $session_name), 0, 32));
<a name="l00812"></a>00812 }
<a name="l00813"></a>00813 
<a name="l00843"></a><a class="code" href="bootstrap_8inc_ae2af73b6b16cc9d723e931748aa6c853.html#ae2af73b6b16cc9d723e931748aa6c853">00843</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_ae2af73b6b16cc9d723e931748aa6c853.html#ae2af73b6b16cc9d723e931748aa6c853" title="Returns and optionally sets the filename for a system resource.">drupal_get_filename</a>($type, $name, $filename = NULL) {
<a name="l00844"></a>00844   <span class="comment">// The location of files will not change during the request, so do not use</span>
<a name="l00845"></a>00845   <span class="comment">// drupal_static().</span>
<a name="l00846"></a>00846   <span class="keyword">static</span> $files = array(), $dirs = array();
<a name="l00847"></a>00847 
<a name="l00848"></a>00848   <span class="comment">// Profiles are a special case: they have a fixed location and naming.</span>
<a name="l00849"></a>00849   <span class="keywordflow">if</span> ($type == <span class="stringliteral">&#39;profile&#39;</span>) {
<a name="l00850"></a>00850     $profile_filename = <span class="stringliteral">&quot;profiles/$name/$name.profile&quot;</span>;
<a name="l00851"></a>00851     $files[$type][$name] = file_exists($profile_filename) ? $profile_filename : FALSE;
<a name="l00852"></a>00852   }
<a name="l00853"></a>00853   <span class="keywordflow">if</span> (!isset($files[$type])) {
<a name="l00854"></a>00854     $files[$type] = array();
<a name="l00855"></a>00855   }
<a name="l00856"></a>00856 
<a name="l00857"></a>00857   <span class="keywordflow">if</span> (!empty($filename) &amp;&amp; file_exists($filename)) {
<a name="l00858"></a>00858     $files[$type][$name] = $filename;
<a name="l00859"></a>00859   }
<a name="l00860"></a>00860   elseif (isset($files[$type][$name])) {
<a name="l00861"></a>00861     <span class="comment">// nothing</span>
<a name="l00862"></a>00862   }
<a name="l00863"></a>00863   <span class="comment">// Verify that we have an active database connection, before querying</span>
<a name="l00864"></a>00864   <span class="comment">// the database. This is required because this function is called both</span>
<a name="l00865"></a>00865   <span class="comment">// before we have a database connection (i.e. during installation) and</span>
<a name="l00866"></a>00866   <span class="comment">// when a database connection fails.</span>
<a name="l00867"></a>00867   <span class="keywordflow">else</span> {
<a name="l00868"></a>00868     <span class="keywordflow">try</span> {
<a name="l00869"></a>00869       <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;db_query&#39;</span>)) {
<a name="l00870"></a>00870         $file = <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&quot;SELECT filename FROM {system} WHERE name = :name AND type = :type&quot;</span>, array(<span class="stringliteral">&#39;:name&#39;</span> =&gt; $name, <span class="stringliteral">&#39;:type&#39;</span> =&gt; $type))-&gt;fetchField();
<a name="l00871"></a>00871         <span class="keywordflow">if</span> (file_exists(<a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $file)) {
<a name="l00872"></a>00872           $files[$type][$name] = $file;
<a name="l00873"></a>00873         }
<a name="l00874"></a>00874       }
<a name="l00875"></a>00875     }
<a name="l00876"></a>00876     <span class="keywordflow">catch</span> (<a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> $e) {
<a name="l00877"></a>00877       <span class="comment">// The database table may not exist because Drupal is not yet installed,</span>
<a name="l00878"></a>00878       <span class="comment">// or the database might be down. We have a fallback for this case so we</span>
<a name="l00879"></a>00879       <span class="comment">// hide the error completely.</span>
<a name="l00880"></a>00880     }
<a name="l00881"></a>00881     <span class="comment">// Fallback to searching the filesystem if the database could not find the</span>
<a name="l00882"></a>00882     <span class="comment">// file or the file returned by the database is not found.</span>
<a name="l00883"></a>00883     <span class="keywordflow">if</span> (!isset($files[$type][$name])) {
<a name="l00884"></a>00884       <span class="comment">// We have a consistent directory naming: modules, themes...</span>
<a name="l00885"></a>00885       $dir = $type . <span class="charliteral">&#39;s&#39;</span>;
<a name="l00886"></a>00886       <span class="keywordflow">if</span> ($type == <span class="stringliteral">&#39;theme_engine&#39;</span>) {
<a name="l00887"></a>00887         $dir = <span class="stringliteral">&#39;themes/engines&#39;</span>;
<a name="l00888"></a>00888         $extension = <span class="stringliteral">&#39;engine&#39;</span>;
<a name="l00889"></a>00889       }
<a name="l00890"></a>00890       elseif ($type == <span class="stringliteral">&#39;theme&#39;</span>) {
<a name="l00891"></a>00891         $extension = <span class="stringliteral">&#39;info&#39;</span>;
<a name="l00892"></a>00892       }
<a name="l00893"></a>00893       <span class="keywordflow">else</span> {
<a name="l00894"></a>00894         $extension = $type;
<a name="l00895"></a>00895       }
<a name="l00896"></a>00896 
<a name="l00897"></a>00897       <span class="keywordflow">if</span> (!isset($dirs[$dir][$extension])) {
<a name="l00898"></a>00898         $dirs[$dir][$extension] = TRUE;
<a name="l00899"></a>00899         <span class="keywordflow">if</span> (!function_exists(<span class="stringliteral">&#39;drupal_system_listing&#39;</span>)) {
<a name="l00900"></a>00900           require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/common.inc&#39;</span>;
<a name="l00901"></a>00901         }
<a name="l00902"></a>00902         <span class="comment">// Scan the appropriate directories for all files with the requested</span>
<a name="l00903"></a>00903         <span class="comment">// extension, not just the file we are currently looking for. This</span>
<a name="l00904"></a>00904         <span class="comment">// prevents unnecessary scans from being repeated when this function is</span>
<a name="l00905"></a>00905         <span class="comment">// called more than once in the same page request.</span>
<a name="l00906"></a>00906         $matches = <a class="code" href="common_8inc_a60d1237b23d4e84a59656003596add4b.html#a60d1237b23d4e84a59656003596add4b" title="Returns information about system object files (modules, themes, etc.).">drupal_system_listing</a>(<span class="stringliteral">&quot;/^&quot;</span> . <a class="code" href="bootstrap_8inc_ac2b8a8a3549cb6839c538ebc812ecf8c.html#ac2b8a8a3549cb6839c538ebc812ecf8c" title="Regular expression to match PHP function names.">DRUPAL_PHP_FUNCTION_PATTERN</a> . <span class="stringliteral">&quot;\.$extension$/&quot;</span>, $dir, <span class="stringliteral">&#39;name&#39;</span>, 0);
<a name="l00907"></a>00907         <span class="keywordflow">foreach</span> ($matches as $matched_name =&gt; $file) {
<a name="l00908"></a>00908           $files[$type][$matched_name] = $file-&gt;uri;
<a name="l00909"></a>00909         }
<a name="l00910"></a>00910       }
<a name="l00911"></a>00911     }
<a name="l00912"></a>00912   }
<a name="l00913"></a>00913 
<a name="l00914"></a>00914   <span class="keywordflow">if</span> (isset($files[$type][$name])) {
<a name="l00915"></a>00915     <span class="keywordflow">return</span> $files[$type][$name];
<a name="l00916"></a>00916   }
<a name="l00917"></a>00917 }
<a name="l00918"></a>00918 
<a name="l00926"></a><a class="code" href="bootstrap_8inc_a7cb710899d7238be1cad274e278cd87f.html#a7cb710899d7238be1cad274e278cd87f">00926</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a7cb710899d7238be1cad274e278cd87f.html#a7cb710899d7238be1cad274e278cd87f" title="Loads the persistent variable table.">variable_initialize</a>(<a class="code" href="authorize_8php_a10064a52f624358ea93475105245c4ac.html#a10064a52f624358ea93475105245c4ac">$conf</a> = array()) {
<a name="l00927"></a>00927   <span class="comment">// NOTE: caching the variables improves performance by 20% when serving</span>
<a name="l00928"></a>00928   <span class="comment">// cached pages.</span>
<a name="l00929"></a>00929   <span class="keywordflow">if</span> ($cached = <a class="code" href="cache_8inc_a9d873815c28909b61c3a6188b383f8a3.html#a9d873815c28909b61c3a6188b383f8a3" title="Returns data from the persistent cache.">cache_get</a>(<span class="stringliteral">&#39;variables&#39;</span>, <span class="stringliteral">&#39;cache_bootstrap&#39;</span>)) {
<a name="l00930"></a>00930     $variables = $cached-&gt;data;
<a name="l00931"></a>00931   }
<a name="l00932"></a>00932   <span class="keywordflow">else</span> {
<a name="l00933"></a>00933     <span class="comment">// Cache miss. Avoid a stampede.</span>
<a name="l00934"></a>00934     $name = <span class="stringliteral">&#39;variable_init&#39;</span>;
<a name="l00935"></a>00935     <span class="keywordflow">if</span> (!<a class="code" href="group__lock_gac67a4b1061491f7a869646f47b66e998.html#gac67a4b1061491f7a869646f47b66e998" title="Acquire (or renew) a lock, but do not block if it fails.">lock_acquire</a>($name, 1)) {
<a name="l00936"></a>00936       <span class="comment">// Another request is building the variable cache.</span>
<a name="l00937"></a>00937       <span class="comment">// Wait, then re-run this function.</span>
<a name="l00938"></a>00938       <a class="code" href="group__lock_ga54c2ee771edac47614b8f12d949d3376.html#ga54c2ee771edac47614b8f12d949d3376" title="Wait for a lock to be available.">lock_wait</a>($name);
<a name="l00939"></a>00939       <span class="keywordflow">return</span> <a class="code" href="bootstrap_8inc_a7cb710899d7238be1cad274e278cd87f.html#a7cb710899d7238be1cad274e278cd87f" title="Loads the persistent variable table.">variable_initialize</a>(<a class="code" href="authorize_8php_a10064a52f624358ea93475105245c4ac.html#a10064a52f624358ea93475105245c4ac">$conf</a>);
<a name="l00940"></a>00940     }
<a name="l00941"></a>00941     <span class="keywordflow">else</span> {
<a name="l00942"></a>00942       <span class="comment">// Proceed with variable rebuild.</span>
<a name="l00943"></a>00943       $variables = array_map(<span class="stringliteral">&#39;unserialize&#39;</span>, <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&#39;SELECT name, value FROM {variable}&#39;</span>)-&gt;fetchAllKeyed());
<a name="l00944"></a>00944       <a class="code" href="cache_8inc_a48081f36334909f561ef4f538fa640d2.html#a48081f36334909f561ef4f538fa640d2" title="Stores data in the persistent cache.">cache_set</a>(<span class="stringliteral">&#39;variables&#39;</span>, $variables, <span class="stringliteral">&#39;cache_bootstrap&#39;</span>);
<a name="l00945"></a>00945       <a class="code" href="group__lock_ga73e1456861f9aff1a506a650f43aceb0.html#ga73e1456861f9aff1a506a650f43aceb0" title="Release a lock previously acquired by lock_acquire().">lock_release</a>($name);
<a name="l00946"></a>00946     }
<a name="l00947"></a>00947   }
<a name="l00948"></a>00948 
<a name="l00949"></a>00949   <span class="keywordflow">foreach</span> (<a class="code" href="authorize_8php_a10064a52f624358ea93475105245c4ac.html#a10064a52f624358ea93475105245c4ac">$conf</a> as $name =&gt; $value) {
<a name="l00950"></a>00950     $variables[$name] = $value;
<a name="l00951"></a>00951   }
<a name="l00952"></a>00952 
<a name="l00953"></a>00953   <span class="keywordflow">return</span> $variables;
<a name="l00954"></a>00954 }
<a name="l00955"></a>00955 
<a name="l00974"></a><a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252">00974</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>($name, $default = NULL) {
<a name="l00975"></a>00975   global <a class="code" href="authorize_8php_a10064a52f624358ea93475105245c4ac.html#a10064a52f624358ea93475105245c4ac">$conf</a>;
<a name="l00976"></a>00976 
<a name="l00977"></a>00977   <span class="keywordflow">return</span> isset($conf[$name]) ? $conf[$name] : $default;
<a name="l00978"></a>00978 }
<a name="l00979"></a>00979 
<a name="l00996"></a><a class="code" href="bootstrap_8inc_a9859faa6fcd56ca6048be93dace95999.html#a9859faa6fcd56ca6048be93dace95999">00996</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a9859faa6fcd56ca6048be93dace95999.html#a9859faa6fcd56ca6048be93dace95999" title="Sets a persistent variable.">variable_set</a>($name, $value) {
<a name="l00997"></a>00997   global <a class="code" href="authorize_8php_a10064a52f624358ea93475105245c4ac.html#a10064a52f624358ea93475105245c4ac">$conf</a>;
<a name="l00998"></a>00998 
<a name="l00999"></a>00999   <a class="code" href="group__database_ga429c73a1bdc6dbb18c4a4a8a2235beaf.html#ga429c73a1bdc6dbb18c4a4a8a2235beaf" title="Returns a new MergeQuery object for the active database.">db_merge</a>(<span class="stringliteral">&#39;variable&#39;</span>)-&gt;key(array(<span class="stringliteral">&#39;name&#39;</span> =&gt; $name))-&gt;fields(array(<span class="stringliteral">&#39;value&#39;</span> =&gt; serialize($value)))-&gt;execute();
<a name="l01000"></a>01000 
<a name="l01001"></a>01001   <a class="code" href="cache_8inc_a409b34dd629640d791a11736a9de8125.html#a409b34dd629640d791a11736a9de8125" title="Expires data from the cache.">cache_clear_all</a>(<span class="stringliteral">&#39;variables&#39;</span>, <span class="stringliteral">&#39;cache_bootstrap&#39;</span>);
<a name="l01002"></a>01002 
<a name="l01003"></a>01003   $conf[$name] = $value;
<a name="l01004"></a>01004 }
<a name="l01005"></a>01005 
<a name="l01019"></a><a class="code" href="bootstrap_8inc_a7850bff5f313f85335f418e6d87606b1.html#a7850bff5f313f85335f418e6d87606b1">01019</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a7850bff5f313f85335f418e6d87606b1.html#a7850bff5f313f85335f418e6d87606b1" title="Unsets a persistent variable.">variable_del</a>($name) {
<a name="l01020"></a>01020   global <a class="code" href="authorize_8php_a10064a52f624358ea93475105245c4ac.html#a10064a52f624358ea93475105245c4ac">$conf</a>;
<a name="l01021"></a>01021 
<a name="l01022"></a>01022   <a class="code" href="group__database_ga72f0ccecc0ba181de16c6e3451150f2c.html#ga72f0ccecc0ba181de16c6e3451150f2c" title="Returns a new DeleteQuery object for the active database.">db_delete</a>(<span class="stringliteral">&#39;variable&#39;</span>)
<a name="l01023"></a>01023     -&gt;condition(<span class="stringliteral">&#39;name&#39;</span>, $name)
<a name="l01024"></a>01024     -&gt;execute();
<a name="l01025"></a>01025   <a class="code" href="cache_8inc_a409b34dd629640d791a11736a9de8125.html#a409b34dd629640d791a11736a9de8125" title="Expires data from the cache.">cache_clear_all</a>(<span class="stringliteral">&#39;variables&#39;</span>, <span class="stringliteral">&#39;cache_bootstrap&#39;</span>);
<a name="l01026"></a>01026 
<a name="l01027"></a>01027   unset($conf[$name]);
<a name="l01028"></a>01028 }
<a name="l01029"></a>01029 
<a name="l01045"></a><a class="code" href="bootstrap_8inc_ae0a2f358a39764e08d16be76415b367f.html#ae0a2f358a39764e08d16be76415b367f">01045</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_ae0a2f358a39764e08d16be76415b367f.html#ae0a2f358a39764e08d16be76415b367f" title="Retrieves the current page from the cache.">drupal_page_get_cache</a>($check_only = FALSE) {
<a name="l01046"></a>01046   global $base_root;
<a name="l01047"></a>01047   <span class="keyword">static</span> $cache_hit = FALSE;
<a name="l01048"></a>01048 
<a name="l01049"></a>01049   <span class="keywordflow">if</span> ($check_only) {
<a name="l01050"></a>01050     <span class="keywordflow">return</span> $cache_hit;
<a name="l01051"></a>01051   }
<a name="l01052"></a>01052 
<a name="l01053"></a>01053   <span class="keywordflow">if</span> (<a class="code" href="bootstrap_8inc_a7972b6ea362a180e975d1d531a18996a.html#a7972b6ea362a180e975d1d531a18996a" title="Determines the cacheability of the current page.">drupal_page_is_cacheable</a>()) {
<a name="l01054"></a>01054     $cache = <a class="code" href="cache_8inc_a9d873815c28909b61c3a6188b383f8a3.html#a9d873815c28909b61c3a6188b383f8a3" title="Returns data from the persistent cache.">cache_get</a>($base_root . <a class="code" href="bootstrap_8inc_a80b52d5331d840440b5e3dfe82dd7ea2.html#a80b52d5331d840440b5e3dfe82dd7ea2" title="Returns the equivalent of Apache&#39;s $_SERVER[&#39;REQUEST_URI&#39;] variable.">request_uri</a>(), <span class="stringliteral">&#39;cache_page&#39;</span>);
<a name="l01055"></a>01055     <span class="keywordflow">if</span> ($cache !== FALSE) {
<a name="l01056"></a>01056       $cache_hit = TRUE;
<a name="l01057"></a>01057     }
<a name="l01058"></a>01058     <span class="keywordflow">return</span> $cache;
<a name="l01059"></a>01059   }
<a name="l01060"></a>01060 }
<a name="l01061"></a>01061 
<a name="l01071"></a><a class="code" href="bootstrap_8inc_a7972b6ea362a180e975d1d531a18996a.html#a7972b6ea362a180e975d1d531a18996a">01071</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a7972b6ea362a180e975d1d531a18996a.html#a7972b6ea362a180e975d1d531a18996a" title="Determines the cacheability of the current page.">drupal_page_is_cacheable</a>($allow_caching = NULL) {
<a name="l01072"></a>01072   $allow_caching_static = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__, TRUE);
<a name="l01073"></a>01073   <span class="keywordflow">if</span> (isset($allow_caching)) {
<a name="l01074"></a>01074     $allow_caching_static = $allow_caching;
<a name="l01075"></a>01075   }
<a name="l01076"></a>01076 
<a name="l01077"></a>01077   <span class="keywordflow">return</span> $allow_caching_static &amp;&amp; ($_SERVER[<span class="stringliteral">&#39;REQUEST_METHOD&#39;</span>] == <span class="stringliteral">&#39;GET&#39;</span> || $_SERVER[<span class="stringliteral">&#39;REQUEST_METHOD&#39;</span>] == <span class="stringliteral">&#39;HEAD&#39;</span>)
<a name="l01078"></a>01078     &amp;&amp; !<a class="code" href="group__schemaapi_gac880b82ae302f9d15c64d264a269d1f4.html#gac880b82ae302f9d15c64d264a269d1f4" title="Detects whether the current script is running in a command-line environment.">drupal_is_cli</a>();
<a name="l01079"></a>01079 }
<a name="l01080"></a>01080 
<a name="l01089"></a><a class="code" href="bootstrap_8inc_a3f13159d2e93ecfd09823d8dca30f5d9.html#a3f13159d2e93ecfd09823d8dca30f5d9">01089</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a3f13159d2e93ecfd09823d8dca30f5d9.html#a3f13159d2e93ecfd09823d8dca30f5d9" title="Invokes a bootstrap hook in all bootstrap modules that implement it.">bootstrap_invoke_all</a>($hook) {
<a name="l01090"></a>01090   <span class="comment">// Bootstrap modules should have been loaded when this function is called, so</span>
<a name="l01091"></a>01091   <span class="comment">// we don&#39;t need to tell module_list() to reset its internal list (and we</span>
<a name="l01092"></a>01092   <span class="comment">// therefore leave the first parameter at its default value of FALSE). We</span>
<a name="l01093"></a>01093   <span class="comment">// still pass in TRUE for the second parameter, though; in case this is the</span>
<a name="l01094"></a>01094   <span class="comment">// first time during the bootstrap that module_list() is called, we want to</span>
<a name="l01095"></a>01095   <span class="comment">// make sure that its internal cache is primed with the bootstrap modules</span>
<a name="l01096"></a>01096   <span class="comment">// only.</span>
<a name="l01097"></a>01097   <span class="keywordflow">foreach</span> (<a class="code" href="module_8inc_ad4ef444bbb8e56724e12908cf9b6e1aa.html#ad4ef444bbb8e56724e12908cf9b6e1aa" title="Returns a list of currently active modules.">module_list</a>(FALSE, TRUE) as $module) {
<a name="l01098"></a>01098     <a class="code" href="bootstrap_8inc_a13a2254228f213a980dc1f09886b8802.html#a13a2254228f213a980dc1f09886b8802" title="Includes a file with the provided type and name.">drupal_load</a>(<span class="stringliteral">&#39;module&#39;</span>, $module);
<a name="l01099"></a>01099     <a class="code" href="group__hooks_ga7547905cff161d057f9e71088ec67f05.html#ga7547905cff161d057f9e71088ec67f05" title="Invoke a hook in a particular module.">module_invoke</a>($module, $hook);
<a name="l01100"></a>01100   }
<a name="l01101"></a>01101 }
<a name="l01102"></a>01102 
<a name="l01116"></a><a class="code" href="bootstrap_8inc_a13a2254228f213a980dc1f09886b8802.html#a13a2254228f213a980dc1f09886b8802">01116</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a13a2254228f213a980dc1f09886b8802.html#a13a2254228f213a980dc1f09886b8802" title="Includes a file with the provided type and name.">drupal_load</a>($type, $name) {
<a name="l01117"></a>01117   <span class="comment">// Once a file is included this can&#39;t be reversed during a request so do not</span>
<a name="l01118"></a>01118   <span class="comment">// use drupal_static() here.</span>
<a name="l01119"></a>01119   <span class="keyword">static</span> $files = array();
<a name="l01120"></a>01120 
<a name="l01121"></a>01121   <span class="keywordflow">if</span> (isset($files[$type][$name])) {
<a name="l01122"></a>01122     <span class="keywordflow">return</span> TRUE;
<a name="l01123"></a>01123   }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125   $filename = <a class="code" href="bootstrap_8inc_ae2af73b6b16cc9d723e931748aa6c853.html#ae2af73b6b16cc9d723e931748aa6c853" title="Returns and optionally sets the filename for a system resource.">drupal_get_filename</a>($type, $name);
<a name="l01126"></a>01126 
<a name="l01127"></a>01127   <span class="keywordflow">if</span> ($filename) {
<a name="l01128"></a>01128     include_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $filename;
<a name="l01129"></a>01129     $files[$type][$name] = TRUE;
<a name="l01130"></a>01130 
<a name="l01131"></a>01131     <span class="keywordflow">return</span> TRUE;
<a name="l01132"></a>01132   }
<a name="l01133"></a>01133 
<a name="l01134"></a>01134   <span class="keywordflow">return</span> FALSE;
<a name="l01135"></a>01135 }
<a name="l01136"></a>01136 
<a name="l01152"></a><a class="code" href="bootstrap_8inc_ad4ff2b2cf5a2fb632c2c869bc1a5a70f.html#ad4ff2b2cf5a2fb632c2c869bc1a5a70f">01152</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_ad4ff2b2cf5a2fb632c2c869bc1a5a70f.html#ad4ff2b2cf5a2fb632c2c869bc1a5a70f" title="Sets an HTTP response header for the current page.">drupal_add_http_header</a>($name, $value, $append = FALSE) {
<a name="l01153"></a>01153   <span class="comment">// The headers as name/value pairs.</span>
<a name="l01154"></a>01154   $headers = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(<span class="stringliteral">&#39;drupal_http_headers&#39;</span>, array());
<a name="l01155"></a>01155 
<a name="l01156"></a>01156   $name_lower = strtolower($name);
<a name="l01157"></a>01157   <a class="code" href="bootstrap_8inc_a5a8f423c6c77a609be5dc291e52470fb.html#a5a8f423c6c77a609be5dc291e52470fb" title="Sets the preferred name for the HTTP header.">_drupal_set_preferred_header_name</a>($name);
<a name="l01158"></a>01158 
<a name="l01159"></a>01159   <span class="keywordflow">if</span> ($value === FALSE) {
<a name="l01160"></a>01160     $headers[$name_lower] = FALSE;
<a name="l01161"></a>01161   }
<a name="l01162"></a>01162   elseif (isset($headers[$name_lower]) &amp;&amp; $append) {
<a name="l01163"></a>01163     <span class="comment">// Multiple headers with identical names may be combined using comma (RFC</span>
<a name="l01164"></a>01164     <span class="comment">// 2616, section 4.2).</span>
<a name="l01165"></a>01165     $headers[$name_lower] .= <span class="charliteral">&#39;,&#39;</span> . $value;
<a name="l01166"></a>01166   }
<a name="l01167"></a>01167   <span class="keywordflow">else</span> {
<a name="l01168"></a>01168     $headers[$name_lower] = $value;
<a name="l01169"></a>01169   }
<a name="l01170"></a>01170   <a class="code" href="bootstrap_8inc_a903274a2d3421ae33eaa053b36ac9855.html#a903274a2d3421ae33eaa053b36ac9855" title="Sends the HTTP response headers that were previously set, adding defaults.">drupal_send_headers</a>(array($name =&gt; $headers[$name_lower]), TRUE);
<a name="l01171"></a>01171 }
<a name="l01172"></a>01172 
<a name="l01184"></a><a class="code" href="bootstrap_8inc_a159cce492ef9bed6e8a1dd33227fd11e.html#a159cce492ef9bed6e8a1dd33227fd11e">01184</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a159cce492ef9bed6e8a1dd33227fd11e.html#a159cce492ef9bed6e8a1dd33227fd11e" title="Gets the HTTP response headers for the current page.">drupal_get_http_header</a>($name = NULL) {
<a name="l01185"></a>01185   $headers = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(<span class="stringliteral">&#39;drupal_http_headers&#39;</span>, array());
<a name="l01186"></a>01186   <span class="keywordflow">if</span> (isset($name)) {
<a name="l01187"></a>01187     $name = strtolower($name);
<a name="l01188"></a>01188     <span class="keywordflow">return</span> isset($headers[$name]) ? $headers[$name] : NULL;
<a name="l01189"></a>01189   }
<a name="l01190"></a>01190   <span class="keywordflow">else</span> {
<a name="l01191"></a>01191     <span class="keywordflow">return</span> $headers;
<a name="l01192"></a>01192   }
<a name="l01193"></a>01193 }
<a name="l01194"></a>01194 
<a name="l01201"></a><a class="code" href="bootstrap_8inc_a5a8f423c6c77a609be5dc291e52470fb.html#a5a8f423c6c77a609be5dc291e52470fb">01201</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a5a8f423c6c77a609be5dc291e52470fb.html#a5a8f423c6c77a609be5dc291e52470fb" title="Sets the preferred name for the HTTP header.">_drupal_set_preferred_header_name</a>($name = NULL) {
<a name="l01202"></a>01202   <span class="keyword">static</span> $header_names = array();
<a name="l01203"></a>01203 
<a name="l01204"></a>01204   <span class="keywordflow">if</span> (!isset($name)) {
<a name="l01205"></a>01205     <span class="keywordflow">return</span> $header_names;
<a name="l01206"></a>01206   }
<a name="l01207"></a>01207   $header_names[strtolower($name)] = $name;
<a name="l01208"></a>01208 }
<a name="l01209"></a>01209 
<a name="l01221"></a><a class="code" href="bootstrap_8inc_a903274a2d3421ae33eaa053b36ac9855.html#a903274a2d3421ae33eaa053b36ac9855">01221</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a903274a2d3421ae33eaa053b36ac9855.html#a903274a2d3421ae33eaa053b36ac9855" title="Sends the HTTP response headers that were previously set, adding defaults.">drupal_send_headers</a>($default_headers = array(), $only_default = FALSE) {
<a name="l01222"></a>01222   $headers_sent = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__, FALSE);
<a name="l01223"></a>01223   $headers = <a class="code" href="bootstrap_8inc_a159cce492ef9bed6e8a1dd33227fd11e.html#a159cce492ef9bed6e8a1dd33227fd11e" title="Gets the HTTP response headers for the current page.">drupal_get_http_header</a>();
<a name="l01224"></a>01224   <span class="keywordflow">if</span> ($only_default &amp;&amp; $headers_sent) {
<a name="l01225"></a>01225     $headers = array();
<a name="l01226"></a>01226   }
<a name="l01227"></a>01227   $headers_sent = TRUE;
<a name="l01228"></a>01228 
<a name="l01229"></a>01229   $header_names = <a class="code" href="bootstrap_8inc_a5a8f423c6c77a609be5dc291e52470fb.html#a5a8f423c6c77a609be5dc291e52470fb" title="Sets the preferred name for the HTTP header.">_drupal_set_preferred_header_name</a>();
<a name="l01230"></a>01230   <span class="keywordflow">foreach</span> ($default_headers as $name =&gt; $value) {
<a name="l01231"></a>01231     $name_lower = strtolower($name);
<a name="l01232"></a>01232     <span class="keywordflow">if</span> (!isset($headers[$name_lower])) {
<a name="l01233"></a>01233       $headers[$name_lower] = $value;
<a name="l01234"></a>01234       $header_names[$name_lower] = $name;
<a name="l01235"></a>01235     }
<a name="l01236"></a>01236   }
<a name="l01237"></a>01237   <span class="keywordflow">foreach</span> ($headers as $name_lower =&gt; $value) {
<a name="l01238"></a>01238     <span class="keywordflow">if</span> ($name_lower == <span class="stringliteral">&#39;status&#39;</span>) {
<a name="l01239"></a>01239       header($_SERVER[<span class="stringliteral">&#39;SERVER_PROTOCOL&#39;</span>] . <span class="charliteral">&#39; &#39;</span> . $value);
<a name="l01240"></a>01240     }
<a name="l01241"></a>01241     <span class="comment">// Skip headers that have been unset.</span>
<a name="l01242"></a>01242     elseif ($value) {
<a name="l01243"></a>01243       header($header_names[$name_lower] . <span class="stringliteral">&#39;: &#39;</span> . $value);
<a name="l01244"></a>01244     }
<a name="l01245"></a>01245   }
<a name="l01246"></a>01246 }
<a name="l01247"></a>01247 
<a name="l01275"></a><a class="code" href="bootstrap_8inc_a05f3dc0377da7898b9cb53977c30cca6.html#a05f3dc0377da7898b9cb53977c30cca6">01275</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a05f3dc0377da7898b9cb53977c30cca6.html#a05f3dc0377da7898b9cb53977c30cca6" title="Sets HTTP headers in preparation for a page response.">drupal_page_header</a>() {
<a name="l01276"></a>01276   $headers_sent = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__, FALSE);
<a name="l01277"></a>01277   <span class="keywordflow">if</span> ($headers_sent) {
<a name="l01278"></a>01278     <span class="keywordflow">return</span> TRUE;
<a name="l01279"></a>01279   }
<a name="l01280"></a>01280   $headers_sent = TRUE;
<a name="l01281"></a>01281 
<a name="l01282"></a>01282   $default_headers = array(
<a name="l01283"></a>01283     <span class="stringliteral">&#39;Expires&#39;</span> =&gt; <span class="stringliteral">&#39;Sun, 19 Nov 1978 05:00:00 GMT&#39;</span>,
<a name="l01284"></a>01284     <span class="stringliteral">&#39;Last-Modified&#39;</span> =&gt; gmdate(DATE_RFC1123, <a class="code" href="bootstrap_8inc_a08bcd0b03e31c17fb7d58786bef2b7f4.html#a08bcd0b03e31c17fb7d58786bef2b7f4" title="Time of the current request in seconds elapsed since the Unix Epoch.">REQUEST_TIME</a>),
<a name="l01285"></a>01285     <span class="stringliteral">&#39;Cache-Control&#39;</span> =&gt; <span class="stringliteral">&#39;no-cache, must-revalidate, post-check=0, pre-check=0&#39;</span>,
<a name="l01286"></a>01286     <span class="stringliteral">&#39;ETag&#39;</span> =&gt; <span class="charliteral">&#39;&quot;&#39;</span> . <a class="code" href="bootstrap_8inc_a08bcd0b03e31c17fb7d58786bef2b7f4.html#a08bcd0b03e31c17fb7d58786bef2b7f4" title="Time of the current request in seconds elapsed since the Unix Epoch.">REQUEST_TIME</a> . <span class="charliteral">&#39;&quot;&#39;</span>,
<a name="l01287"></a>01287   );
<a name="l01288"></a>01288   <a class="code" href="bootstrap_8inc_a903274a2d3421ae33eaa053b36ac9855.html#a903274a2d3421ae33eaa053b36ac9855" title="Sends the HTTP response headers that were previously set, adding defaults.">drupal_send_headers</a>($default_headers);
<a name="l01289"></a>01289 }
<a name="l01290"></a>01290 
<a name="l01302"></a><a class="code" href="bootstrap_8inc_ae09cf8051ec110fd6ce67f4a3b77a3fb.html#ae09cf8051ec110fd6ce67f4a3b77a3fb">01302</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_ae09cf8051ec110fd6ce67f4a3b77a3fb.html#ae09cf8051ec110fd6ce67f4a3b77a3fb" title="Sets HTTP headers in preparation for a cached page response.">drupal_serve_page_from_cache</a>(stdClass $cache) {
<a name="l01303"></a>01303   <span class="comment">// Negotiate whether to use compression.</span>
<a name="l01304"></a>01304   $page_compression = <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;page_compression&#39;</span>, TRUE) &amp;&amp; extension_loaded(<span class="stringliteral">&#39;zlib&#39;</span>);
<a name="l01305"></a>01305   $return_compressed = $page_compression &amp;&amp; isset($_SERVER[<span class="stringliteral">&#39;HTTP_ACCEPT_ENCODING&#39;</span>]) &amp;&amp; strpos($_SERVER[<span class="stringliteral">&#39;HTTP_ACCEPT_ENCODING&#39;</span>], <span class="stringliteral">&#39;gzip&#39;</span>) !== FALSE;
<a name="l01306"></a>01306 
<a name="l01307"></a>01307   <span class="comment">// Get headers set in hook_boot(). Keys are lower-case.</span>
<a name="l01308"></a>01308   $hook_boot_headers = <a class="code" href="bootstrap_8inc_a159cce492ef9bed6e8a1dd33227fd11e.html#a159cce492ef9bed6e8a1dd33227fd11e" title="Gets the HTTP response headers for the current page.">drupal_get_http_header</a>();
<a name="l01309"></a>01309 
<a name="l01310"></a>01310   <span class="comment">// Headers generated in this function, that may be replaced or unset using</span>
<a name="l01311"></a>01311   <span class="comment">// drupal_add_http_headers(). Keys are mixed-case.</span>
<a name="l01312"></a>01312   $default_headers = array();
<a name="l01313"></a>01313 
<a name="l01314"></a>01314   <span class="keywordflow">foreach</span> ($cache-&gt;data[<span class="stringliteral">&#39;headers&#39;</span>] as $name =&gt; $value) {
<a name="l01315"></a>01315     <span class="comment">// In the case of a 304 response, certain headers must be sent, and the</span>
<a name="l01316"></a>01316     <span class="comment">// remaining may not (see RFC 2616, section 10.3.5). Do not override</span>
<a name="l01317"></a>01317     <span class="comment">// headers set in hook_boot().</span>
<a name="l01318"></a>01318     $name_lower = strtolower($name);
<a name="l01319"></a>01319     <span class="keywordflow">if</span> (in_array($name_lower, array(<span class="stringliteral">&#39;content-location&#39;</span>, <span class="stringliteral">&#39;expires&#39;</span>, <span class="stringliteral">&#39;cache-control&#39;</span>, <span class="stringliteral">&#39;vary&#39;</span>)) &amp;&amp; !isset($hook_boot_headers[$name_lower])) {
<a name="l01320"></a>01320       <a class="code" href="bootstrap_8inc_ad4ff2b2cf5a2fb632c2c869bc1a5a70f.html#ad4ff2b2cf5a2fb632c2c869bc1a5a70f" title="Sets an HTTP response header for the current page.">drupal_add_http_header</a>($name, $value);
<a name="l01321"></a>01321       unset($cache-&gt;data[<span class="stringliteral">&#39;headers&#39;</span>][$name]);
<a name="l01322"></a>01322     }
<a name="l01323"></a>01323   }
<a name="l01324"></a>01324 
<a name="l01325"></a>01325   <span class="comment">// If the client sent a session cookie, a cached copy will only be served</span>
<a name="l01326"></a>01326   <span class="comment">// to that one particular client due to Vary: Cookie. Thus, do not set</span>
<a name="l01327"></a>01327   <span class="comment">// max-age &gt; 0, allowing the page to be cached by external proxies, when a</span>
<a name="l01328"></a>01328   <span class="comment">// session cookie is present unless the Vary header has been replaced or</span>
<a name="l01329"></a>01329   <span class="comment">// unset in hook_boot().</span>
<a name="l01330"></a>01330   $max_age = !isset($_COOKIE[session_name()]) || isset($hook_boot_headers[<span class="stringliteral">&#39;vary&#39;</span>]) ? <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;page_cache_maximum_age&#39;</span>, 0) : 0;
<a name="l01331"></a>01331   $default_headers[<span class="stringliteral">&#39;Cache-Control&#39;</span>] = <span class="stringliteral">&#39;public, max-age=&#39;</span> . $max_age;
<a name="l01332"></a>01332 
<a name="l01333"></a>01333   <span class="comment">// Entity tag should change if the output changes.</span>
<a name="l01334"></a>01334   $etag = <span class="charliteral">&#39;&quot;&#39;</span> . $cache-&gt;created . <span class="charliteral">&#39;-&#39;</span> . intval($return_compressed) . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l01335"></a>01335   header(<span class="stringliteral">&#39;Etag: &#39;</span> . $etag);
<a name="l01336"></a>01336 
<a name="l01337"></a>01337   <span class="comment">// See if the client has provided the required HTTP headers.</span>
<a name="l01338"></a>01338   $if_modified_since = isset($_SERVER[<span class="stringliteral">&#39;HTTP_IF_MODIFIED_SINCE&#39;</span>]) ? strtotime($_SERVER[<span class="stringliteral">&#39;HTTP_IF_MODIFIED_SINCE&#39;</span>]) : FALSE;
<a name="l01339"></a>01339   $if_none_match = isset($_SERVER[<span class="stringliteral">&#39;HTTP_IF_NONE_MATCH&#39;</span>]) ? stripslashes($_SERVER[<span class="stringliteral">&#39;HTTP_IF_NONE_MATCH&#39;</span>]) : FALSE;
<a name="l01340"></a>01340 
<a name="l01341"></a>01341   <span class="keywordflow">if</span> ($if_modified_since &amp;&amp; $if_none_match
<a name="l01342"></a>01342       &amp;&amp; $if_none_match == $etag <span class="comment">// etag must match</span>
<a name="l01343"></a>01343       &amp;&amp; $if_modified_since == $cache-&gt;created) {  <span class="comment">// if-modified-since must match</span>
<a name="l01344"></a>01344     header($_SERVER[<span class="stringliteral">&#39;SERVER_PROTOCOL&#39;</span>] . <span class="stringliteral">&#39; 304 Not Modified&#39;</span>);
<a name="l01345"></a>01345     <a class="code" href="bootstrap_8inc_a903274a2d3421ae33eaa053b36ac9855.html#a903274a2d3421ae33eaa053b36ac9855" title="Sends the HTTP response headers that were previously set, adding defaults.">drupal_send_headers</a>($default_headers);
<a name="l01346"></a>01346     <span class="keywordflow">return</span>;
<a name="l01347"></a>01347   }
<a name="l01348"></a>01348 
<a name="l01349"></a>01349   <span class="comment">// Send the remaining headers.</span>
<a name="l01350"></a>01350   <span class="keywordflow">foreach</span> ($cache-&gt;data[<span class="stringliteral">&#39;headers&#39;</span>] as $name =&gt; $value) {
<a name="l01351"></a>01351     <a class="code" href="bootstrap_8inc_ad4ff2b2cf5a2fb632c2c869bc1a5a70f.html#ad4ff2b2cf5a2fb632c2c869bc1a5a70f" title="Sets an HTTP response header for the current page.">drupal_add_http_header</a>($name, $value);
<a name="l01352"></a>01352   }
<a name="l01353"></a>01353 
<a name="l01354"></a>01354   $default_headers[<span class="stringliteral">&#39;Last-Modified&#39;</span>] = gmdate(DATE_RFC1123, $cache-&gt;created);
<a name="l01355"></a>01355 
<a name="l01356"></a>01356   <span class="comment">// HTTP/1.0 proxies does not support the Vary header, so prevent any caching</span>
<a name="l01357"></a>01357   <span class="comment">// by sending an Expires date in the past. HTTP/1.1 clients ignores the</span>
<a name="l01358"></a>01358   <span class="comment">// Expires header if a Cache-Control: max-age= directive is specified (see RFC</span>
<a name="l01359"></a>01359   <span class="comment">// 2616, section 14.9.3).</span>
<a name="l01360"></a>01360   $default_headers[<span class="stringliteral">&#39;Expires&#39;</span>] = <span class="stringliteral">&#39;Sun, 19 Nov 1978 05:00:00 GMT&#39;</span>;
<a name="l01361"></a>01361 
<a name="l01362"></a>01362   <a class="code" href="bootstrap_8inc_a903274a2d3421ae33eaa053b36ac9855.html#a903274a2d3421ae33eaa053b36ac9855" title="Sends the HTTP response headers that were previously set, adding defaults.">drupal_send_headers</a>($default_headers);
<a name="l01363"></a>01363 
<a name="l01364"></a>01364   <span class="comment">// Allow HTTP proxies to cache pages for anonymous users without a session</span>
<a name="l01365"></a>01365   <span class="comment">// cookie. The Vary header is used to indicates the set of request-header</span>
<a name="l01366"></a>01366   <span class="comment">// fields that fully determines whether a cache is permitted to use the</span>
<a name="l01367"></a>01367   <span class="comment">// response to reply to a subsequent request for a given URL without</span>
<a name="l01368"></a>01368   <span class="comment">// revalidation. If a Vary header has been set in hook_boot(), it is assumed</span>
<a name="l01369"></a>01369   <span class="comment">// that the module knows how to cache the page.</span>
<a name="l01370"></a>01370   <span class="keywordflow">if</span> (!isset($hook_boot_headers[<span class="stringliteral">&#39;vary&#39;</span>]) &amp;&amp; !<a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;omit_vary_cookie&#39;</span>)) {
<a name="l01371"></a>01371     header(<span class="stringliteral">&#39;Vary: Cookie&#39;</span>);
<a name="l01372"></a>01372   }
<a name="l01373"></a>01373 
<a name="l01374"></a>01374   <span class="keywordflow">if</span> ($page_compression) {
<a name="l01375"></a>01375     header(<span class="stringliteral">&#39;Vary: Accept-Encoding&#39;</span>, FALSE);
<a name="l01376"></a>01376     <span class="comment">// If page_compression is enabled, the cache contains gzipped data.</span>
<a name="l01377"></a>01377     <span class="keywordflow">if</span> ($return_compressed) {
<a name="l01378"></a>01378       <span class="comment">// $cache-&gt;data[&#39;body&#39;] is already gzip&#39;ed, so make sure</span>
<a name="l01379"></a>01379       <span class="comment">// zlib.output_compression does not compress it once more.</span>
<a name="l01380"></a>01380       ini_set(<span class="stringliteral">&#39;zlib.output_compression&#39;</span>, <span class="charliteral">&#39;0&#39;</span>);
<a name="l01381"></a>01381       header(<span class="stringliteral">&#39;Content-Encoding: gzip&#39;</span>);
<a name="l01382"></a>01382     }
<a name="l01383"></a>01383     <span class="keywordflow">else</span> {
<a name="l01384"></a>01384       <span class="comment">// The client does not support compression, so unzip the data in the</span>
<a name="l01385"></a>01385       <span class="comment">// cache. Strip the gzip header and run uncompress.</span>
<a name="l01386"></a>01386       $cache-&gt;data[<span class="stringliteral">&#39;body&#39;</span>] = gzinflate(substr(substr($cache-&gt;data[<span class="stringliteral">&#39;body&#39;</span>], 10), 0, -8));
<a name="l01387"></a>01387     }
<a name="l01388"></a>01388   }
<a name="l01389"></a>01389 
<a name="l01390"></a>01390   <span class="comment">// Print the page.</span>
<a name="l01391"></a>01391   print $cache-&gt;data[<span class="stringliteral">&#39;body&#39;</span>];
<a name="l01392"></a>01392 }
<a name="l01393"></a>01393 
<a name="l01397"></a><a class="code" href="bootstrap_8inc_a7a24c0b200b76c22c63b99e935e1bd5a.html#a7a24c0b200b76c22c63b99e935e1bd5a">01397</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a7a24c0b200b76c22c63b99e935e1bd5a.html#a7a24c0b200b76c22c63b99e935e1bd5a" title="Defines the critical hooks that force modules to always be loaded.">bootstrap_hooks</a>() {
<a name="l01398"></a>01398   <span class="keywordflow">return</span> array(<span class="stringliteral">&#39;boot&#39;</span>, <span class="stringliteral">&#39;exit&#39;</span>, <span class="stringliteral">&#39;watchdog&#39;</span>, <span class="stringliteral">&#39;language_init&#39;</span>);
<a name="l01399"></a>01399 }
<a name="l01400"></a>01400 
<a name="l01409"></a><a class="code" href="bootstrap_8inc_a4ca39fd7bed1a45e340f86bc2d59224d.html#a4ca39fd7bed1a45e340f86bc2d59224d">01409</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a4ca39fd7bed1a45e340f86bc2d59224d.html#a4ca39fd7bed1a45e340f86bc2d59224d" title="Unserializes and appends elements from a serialized string.">drupal_unpack</a>($obj, $field = <span class="stringliteral">&#39;data&#39;</span>) {
<a name="l01410"></a>01410   <span class="keywordflow">if</span> ($obj-&gt;$field &amp;&amp; $data = unserialize($obj-&gt;$field)) {
<a name="l01411"></a>01411     <span class="keywordflow">foreach</span> ($data as $key =&gt; $value) {
<a name="l01412"></a>01412       <span class="keywordflow">if</span> (!empty($key) &amp;&amp; !isset($obj-&gt;$key)) {
<a name="l01413"></a>01413         $obj-&gt;$key = $value;
<a name="l01414"></a>01414       }
<a name="l01415"></a>01415     }
<a name="l01416"></a>01416   }
<a name="l01417"></a>01417   <span class="keywordflow">return</span> $obj;
<a name="l01418"></a>01418 }
<a name="l01419"></a>01419 
<a name="l01478"></a><a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a">01478</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>($string, array $args = array(), array $options = array()) {
<a name="l01479"></a>01479   global $language;
<a name="l01480"></a>01480   <span class="keyword">static</span> $custom_strings;
<a name="l01481"></a>01481 
<a name="l01482"></a>01482   <span class="comment">// Merge in default.</span>
<a name="l01483"></a>01483   <span class="keywordflow">if</span> (empty($options[<span class="stringliteral">&#39;langcode&#39;</span>])) {
<a name="l01484"></a>01484     $options[<span class="stringliteral">&#39;langcode&#39;</span>] = isset($language-&gt;language) ? $language-&gt;language : <span class="stringliteral">&#39;en&#39;</span>;
<a name="l01485"></a>01485   }
<a name="l01486"></a>01486   <span class="keywordflow">if</span> (empty($options[<span class="stringliteral">&#39;context&#39;</span>])) {
<a name="l01487"></a>01487     $options[<span class="stringliteral">&#39;context&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01488"></a>01488   }
<a name="l01489"></a>01489 
<a name="l01490"></a>01490   <span class="comment">// First, check for an array of customized strings. If present, use the array</span>
<a name="l01491"></a>01491   <span class="comment">// *instead of* database lookups. This is a high performance way to provide a</span>
<a name="l01492"></a>01492   <span class="comment">// handful of string replacements. See settings.php for examples.</span>
<a name="l01493"></a>01493   <span class="comment">// Cache the $custom_strings variable to improve performance.</span>
<a name="l01494"></a>01494   <span class="keywordflow">if</span> (!isset($custom_strings[$options[<span class="stringliteral">&#39;langcode&#39;</span>]])) {
<a name="l01495"></a>01495     $custom_strings[$options[<span class="stringliteral">&#39;langcode&#39;</span>]] = <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;locale_custom_strings_&#39;</span> . $options[<span class="stringliteral">&#39;langcode&#39;</span>], array());
<a name="l01496"></a>01496   }
<a name="l01497"></a>01497   <span class="comment">// Custom strings work for English too, even if locale module is disabled.</span>
<a name="l01498"></a>01498   <span class="keywordflow">if</span> (isset($custom_strings[$options[<span class="stringliteral">&#39;langcode&#39;</span>]][$options[<span class="stringliteral">&#39;context&#39;</span>]][$string])) {
<a name="l01499"></a>01499     $string = $custom_strings[$options[<span class="stringliteral">&#39;langcode&#39;</span>]][$options[<span class="stringliteral">&#39;context&#39;</span>]][$string];
<a name="l01500"></a>01500   }
<a name="l01501"></a>01501   <span class="comment">// Translate with locale module if enabled.</span>
<a name="l01502"></a>01502   elseif ($options[<span class="stringliteral">&#39;langcode&#39;</span>] != <span class="stringliteral">&#39;en&#39;</span> &amp;&amp; function_exists(<span class="stringliteral">&#39;locale&#39;</span>)) {
<a name="l01503"></a>01503     $string = locale($string, $options[<span class="stringliteral">&#39;context&#39;</span>], $options[<span class="stringliteral">&#39;langcode&#39;</span>]);
<a name="l01504"></a>01504   }
<a name="l01505"></a>01505   <span class="keywordflow">if</span> (empty($args)) {
<a name="l01506"></a>01506     <span class="keywordflow">return</span> $string;
<a name="l01507"></a>01507   }
<a name="l01508"></a>01508   <span class="keywordflow">else</span> {
<a name="l01509"></a>01509     <span class="keywordflow">return</span> <a class="code" href="group__sanitization_ga8da272cf93fb6ba229eca7c0b06ea4d2.html#ga8da272cf93fb6ba229eca7c0b06ea4d2" title="Replaces placeholders with sanitized values in a string.">format_string</a>($string, $args);
<a name="l01510"></a>01510   }
<a name="l01511"></a>01511 }
<a name="l01512"></a>01512 
<a name="l01533"></a><a class="code" href="group__sanitization_ga8da272cf93fb6ba229eca7c0b06ea4d2.html#ga8da272cf93fb6ba229eca7c0b06ea4d2">01533</a> <span class="keyword">function</span> <a class="code" href="group__sanitization_ga8da272cf93fb6ba229eca7c0b06ea4d2.html#ga8da272cf93fb6ba229eca7c0b06ea4d2" title="Replaces placeholders with sanitized values in a string.">format_string</a>($string, array $args = array()) {
<a name="l01534"></a>01534   <span class="comment">// Transform arguments before inserting them.</span>
<a name="l01535"></a>01535   <span class="keywordflow">foreach</span> ($args as $key =&gt; $value) {
<a name="l01536"></a>01536     <span class="keywordflow">switch</span> ($key[0]) {
<a name="l01537"></a>01537       <span class="keywordflow">case</span> <span class="charliteral">&#39;@&#39;</span>:
<a name="l01538"></a>01538         <span class="comment">// Escaped only.</span>
<a name="l01539"></a>01539         $args[$key] = <a class="code" href="group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d.html#ga76fc67a30fd8d75ddd80565e6e65a13d" title="Encodes special characters in a plain-text string for display as HTML.">check_plain</a>($value);
<a name="l01540"></a>01540         <span class="keywordflow">break</span>;
<a name="l01541"></a>01541 
<a name="l01542"></a>01542       <span class="keywordflow">case</span> <span class="charliteral">&#39;%&#39;</span>:
<a name="l01543"></a>01543       <span class="keywordflow">default</span>:
<a name="l01544"></a>01544         <span class="comment">// Escaped and placeholder.</span>
<a name="l01545"></a>01545         $args[$key] = <a class="code" href="group__schemaapi_ga4ab49ad51d8b93bb296a8492296d655b.html#ga4ab49ad51d8b93bb296a8492296d655b" title="Formats text for emphasized display in a placeholder inside a sentence.">drupal_placeholder</a>($value);
<a name="l01546"></a>01546         <span class="keywordflow">break</span>;
<a name="l01547"></a>01547 
<a name="l01548"></a>01548       <span class="keywordflow">case</span> <span class="charliteral">&#39;!&#39;</span>:
<a name="l01549"></a>01549         <span class="comment">// Pass-through.</span>
<a name="l01550"></a>01550     }
<a name="l01551"></a>01551   }
<a name="l01552"></a>01552   <span class="keywordflow">return</span> strtr($string, $args);
<a name="l01553"></a>01553 }
<a name="l01554"></a>01554 
<a name="l01571"></a><a class="code" href="group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d.html#ga76fc67a30fd8d75ddd80565e6e65a13d">01571</a> <span class="keyword">function</span> <a class="code" href="group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d.html#ga76fc67a30fd8d75ddd80565e6e65a13d" title="Encodes special characters in a plain-text string for display as HTML.">check_plain</a>($text) {
<a name="l01572"></a>01572   <span class="keywordflow">return</span> htmlspecialchars($text, ENT_QUOTES, <span class="stringliteral">&#39;UTF-8&#39;</span>);
<a name="l01573"></a>01573 }
<a name="l01574"></a>01574 
<a name="l01599"></a><a class="code" href="bootstrap_8inc_abf62947a33393477301b0070b1ff0c7a.html#abf62947a33393477301b0070b1ff0c7a">01599</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_abf62947a33393477301b0070b1ff0c7a.html#abf62947a33393477301b0070b1ff0c7a" title="Checks whether a string is valid UTF-8.">drupal_validate_utf8</a>($text) {
<a name="l01600"></a>01600   <span class="keywordflow">if</span> (strlen($text) == 0) {
<a name="l01601"></a>01601     <span class="keywordflow">return</span> TRUE;
<a name="l01602"></a>01602   }
<a name="l01603"></a>01603   <span class="comment">// With the PCRE_UTF8 modifier &#39;u&#39;, preg_match() fails silently on strings</span>
<a name="l01604"></a>01604   <span class="comment">// containing invalid UTF-8 byte sequences. It does not reject character</span>
<a name="l01605"></a>01605   <span class="comment">// codes above U+10FFFF (represented by 4 or more octets), though.</span>
<a name="l01606"></a>01606   <span class="keywordflow">return</span> (preg_match(<span class="stringliteral">&#39;/^./us&#39;</span>, $text) == 1);
<a name="l01607"></a>01607 }
<a name="l01608"></a>01608 
<a name="l01615"></a><a class="code" href="bootstrap_8inc_a80b52d5331d840440b5e3dfe82dd7ea2.html#a80b52d5331d840440b5e3dfe82dd7ea2">01615</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a80b52d5331d840440b5e3dfe82dd7ea2.html#a80b52d5331d840440b5e3dfe82dd7ea2" title="Returns the equivalent of Apache&#39;s $_SERVER[&#39;REQUEST_URI&#39;] variable.">request_uri</a>() {
<a name="l01616"></a>01616   <span class="keywordflow">if</span> (isset($_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>])) {
<a name="l01617"></a>01617     $uri = $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>];
<a name="l01618"></a>01618   }
<a name="l01619"></a>01619   <span class="keywordflow">else</span> {
<a name="l01620"></a>01620     <span class="keywordflow">if</span> (isset($_SERVER[<span class="stringliteral">&#39;argv&#39;</span>])) {
<a name="l01621"></a>01621       $uri = $_SERVER[<span class="stringliteral">&#39;SCRIPT_NAME&#39;</span>] . <span class="charliteral">&#39;?&#39;</span> . $_SERVER[<span class="stringliteral">&#39;argv&#39;</span>][0];
<a name="l01622"></a>01622     }
<a name="l01623"></a>01623     elseif (isset($_SERVER[<span class="stringliteral">&#39;QUERY_STRING&#39;</span>])) {
<a name="l01624"></a>01624       $uri = $_SERVER[<span class="stringliteral">&#39;SCRIPT_NAME&#39;</span>] . <span class="charliteral">&#39;?&#39;</span> . $_SERVER[<span class="stringliteral">&#39;QUERY_STRING&#39;</span>];
<a name="l01625"></a>01625     }
<a name="l01626"></a>01626     <span class="keywordflow">else</span> {
<a name="l01627"></a>01627       $uri = $_SERVER[<span class="stringliteral">&#39;SCRIPT_NAME&#39;</span>];
<a name="l01628"></a>01628     }
<a name="l01629"></a>01629   }
<a name="l01630"></a>01630   <span class="comment">// Prevent multiple slashes to avoid cross site requests via the Form API.</span>
<a name="l01631"></a>01631   $uri = <span class="charliteral">&#39;/&#39;</span> . ltrim($uri, <span class="charliteral">&#39;/&#39;</span>);
<a name="l01632"></a>01632 
<a name="l01633"></a>01633   <span class="keywordflow">return</span> $uri;
<a name="l01634"></a>01634 }
<a name="l01635"></a>01635 
<a name="l01660"></a><a class="code" href="bootstrap_8inc_aba38f35647efce6b4099dc59131e216b.html#aba38f35647efce6b4099dc59131e216b">01660</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_aba38f35647efce6b4099dc59131e216b.html#aba38f35647efce6b4099dc59131e216b" title="Logs an exception.">watchdog_exception</a>($type, <a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> $exception, $message = NULL, $variables = array(), $severity = <a class="code" href="group__logging__severity__levels_ga174c9df2936096e11986fcf184d48576.html#ga174c9df2936096e11986fcf184d48576" title="Log message severity -- Error conditions.">WATCHDOG_ERROR</a>, $link = NULL) {
<a name="l01661"></a>01661 
<a name="l01662"></a>01662    <span class="comment">// Use a default value if $message is not set.</span>
<a name="l01663"></a>01663    <span class="keywordflow">if</span> (empty($message)) {
<a name="l01664"></a>01664      <span class="comment">// The exception message is run through check_plain() by _drupal_decode_exception().</span>
<a name="l01665"></a>01665      $message = <span class="stringliteral">&#39;%type: !message in %function (line %line of %file).&#39;</span>;
<a name="l01666"></a>01666    }
<a name="l01667"></a>01667    <span class="comment">// $variables must be an array so that we can add the exception information.</span>
<a name="l01668"></a>01668    <span class="keywordflow">if</span> (!is_array($variables)) {
<a name="l01669"></a>01669      $variables = array();
<a name="l01670"></a>01670    }
<a name="l01671"></a>01671 
<a name="l01672"></a>01672    require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/errors.inc&#39;</span>;
<a name="l01673"></a>01673    $variables += <a class="code" href="errors_8inc_ace892832385b7832c106f55f8896060d.html#ace892832385b7832c106f55f8896060d" title="Decodes an exception and retrieves the correct caller.">_drupal_decode_exception</a>($exception);
<a name="l01674"></a>01674    <a class="code" href="bootstrap_8inc_acb7338e6740302727043d64e3ae1257b.html#acb7338e6740302727043d64e3ae1257b" title="Logs a system message.">watchdog</a>($type, $message, $variables, $severity, $link);
<a name="l01675"></a>01675 }
<a name="l01676"></a>01676 
<a name="l01710"></a><a class="code" href="bootstrap_8inc_acb7338e6740302727043d64e3ae1257b.html#acb7338e6740302727043d64e3ae1257b">01710</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_acb7338e6740302727043d64e3ae1257b.html#acb7338e6740302727043d64e3ae1257b" title="Logs a system message.">watchdog</a>($type, $message, $variables = array(), $severity = <a class="code" href="group__logging__severity__levels_ga757a33416683e8c44636a8799f60b477.html#ga757a33416683e8c44636a8799f60b477" title="Log message severity -- Normal but significant conditions.">WATCHDOG_NOTICE</a>, $link = NULL) {
<a name="l01711"></a>01711   global $user, $base_root;
<a name="l01712"></a>01712 
<a name="l01713"></a>01713   <span class="keyword">static</span> $in_error_state = FALSE;
<a name="l01714"></a>01714 
<a name="l01715"></a>01715   <span class="comment">// It is possible that the error handling will itself trigger an error. In that case, we could</span>
<a name="l01716"></a>01716   <span class="comment">// end up in an infinite loop. To avoid that, we implement a simple static semaphore.</span>
<a name="l01717"></a>01717   <span class="keywordflow">if</span> (!$in_error_state &amp;&amp; function_exists(<span class="stringliteral">&#39;module_implements&#39;</span>)) {
<a name="l01718"></a>01718     $in_error_state = TRUE;
<a name="l01719"></a>01719 
<a name="l01720"></a>01720     <span class="comment">// The user object may not exist in all conditions, so 0 is substituted if needed.</span>
<a name="l01721"></a>01721     $user_uid = isset($user-&gt;uid) ? $user-&gt;uid : 0;
<a name="l01722"></a>01722 
<a name="l01723"></a>01723     <span class="comment">// Prepare the fields to be logged</span>
<a name="l01724"></a>01724     $log_entry = array(
<a name="l01725"></a>01725       <span class="stringliteral">&#39;type&#39;</span>        =&gt; $type,
<a name="l01726"></a>01726       <span class="stringliteral">&#39;message&#39;</span>     =&gt; $message,
<a name="l01727"></a>01727       <span class="stringliteral">&#39;variables&#39;</span>   =&gt; $variables,
<a name="l01728"></a>01728       <span class="stringliteral">&#39;severity&#39;</span>    =&gt; $severity,
<a name="l01729"></a>01729       <span class="stringliteral">&#39;link&#39;</span>        =&gt; $link,
<a name="l01730"></a>01730       <span class="stringliteral">&#39;user&#39;</span>        =&gt; $user,
<a name="l01731"></a>01731       <span class="stringliteral">&#39;uid&#39;</span>         =&gt; $user_uid,
<a name="l01732"></a>01732       <span class="stringliteral">&#39;request_uri&#39;</span> =&gt; $base_root . <a class="code" href="bootstrap_8inc_a80b52d5331d840440b5e3dfe82dd7ea2.html#a80b52d5331d840440b5e3dfe82dd7ea2" title="Returns the equivalent of Apache&#39;s $_SERVER[&#39;REQUEST_URI&#39;] variable.">request_uri</a>(),
<a name="l01733"></a>01733       <span class="stringliteral">&#39;referer&#39;</span>     =&gt; isset($_SERVER[<span class="stringliteral">&#39;HTTP_REFERER&#39;</span>]) ? $_SERVER[<span class="stringliteral">&#39;HTTP_REFERER&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>,
<a name="l01734"></a>01734       <span class="stringliteral">&#39;ip&#39;</span>          =&gt; <a class="code" href="bootstrap_8inc_aec2f772317b4fb79cc696412c2e455c3.html#aec2f772317b4fb79cc696412c2e455c3" title="Returns the IP address of the client machine.">ip_address</a>(),
<a name="l01735"></a>01735       <span class="stringliteral">&#39;timestamp&#39;</span>   =&gt; <a class="code" href="bootstrap_8inc_a08bcd0b03e31c17fb7d58786bef2b7f4.html#a08bcd0b03e31c17fb7d58786bef2b7f4" title="Time of the current request in seconds elapsed since the Unix Epoch.">REQUEST_TIME</a>,
<a name="l01736"></a>01736     );
<a name="l01737"></a>01737 
<a name="l01738"></a>01738     <span class="comment">// Call the logging hooks to log/process the message</span>
<a name="l01739"></a>01739     <span class="keywordflow">foreach</span> (<a class="code" href="group__hooks_ga9191200072f2a641829e9d3c2759561f.html#ga9191200072f2a641829e9d3c2759561f" title="Determine which modules are implementing a hook.">module_implements</a>(<span class="stringliteral">&#39;watchdog&#39;</span>) as $module) {
<a name="l01740"></a>01740       <a class="code" href="group__hooks_ga7547905cff161d057f9e71088ec67f05.html#ga7547905cff161d057f9e71088ec67f05" title="Invoke a hook in a particular module.">module_invoke</a>($module, <span class="stringliteral">&#39;watchdog&#39;</span>, $log_entry);
<a name="l01741"></a>01741     }
<a name="l01742"></a>01742 
<a name="l01743"></a>01743     <span class="comment">// It is critical that the semaphore is only cleared here, in the parent</span>
<a name="l01744"></a>01744     <span class="comment">// watchdog() call (not outside the loop), to prevent recursive execution.</span>
<a name="l01745"></a>01745     $in_error_state = FALSE;
<a name="l01746"></a>01746   }
<a name="l01747"></a>01747 }
<a name="l01748"></a>01748 
<a name="l01782"></a><a class="code" href="bootstrap_8inc_ad9223d86c7b08b1288274ce211d9bfa6.html#ad9223d86c7b08b1288274ce211d9bfa6">01782</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_ad9223d86c7b08b1288274ce211d9bfa6.html#ad9223d86c7b08b1288274ce211d9bfa6" title="Sets a message to display to the user.">drupal_set_message</a>($message = NULL, $type = <span class="stringliteral">&#39;status&#39;</span>, $repeat = TRUE) {
<a name="l01783"></a>01783   <span class="keywordflow">if</span> ($message) {
<a name="l01784"></a>01784     <span class="keywordflow">if</span> (!isset($_SESSION[<span class="stringliteral">&#39;messages&#39;</span>][$type])) {
<a name="l01785"></a>01785       $_SESSION[<span class="stringliteral">&#39;messages&#39;</span>][$type] = array();
<a name="l01786"></a>01786     }
<a name="l01787"></a>01787 
<a name="l01788"></a>01788     <span class="keywordflow">if</span> ($repeat || !in_array($message, $_SESSION[<span class="stringliteral">&#39;messages&#39;</span>][$type])) {
<a name="l01789"></a>01789       $_SESSION[<span class="stringliteral">&#39;messages&#39;</span>][$type][] = $message;
<a name="l01790"></a>01790     }
<a name="l01791"></a>01791 
<a name="l01792"></a>01792     <span class="comment">// Mark this page as being uncacheable.</span>
<a name="l01793"></a>01793     <a class="code" href="bootstrap_8inc_a7972b6ea362a180e975d1d531a18996a.html#a7972b6ea362a180e975d1d531a18996a" title="Determines the cacheability of the current page.">drupal_page_is_cacheable</a>(FALSE);
<a name="l01794"></a>01794   }
<a name="l01795"></a>01795 
<a name="l01796"></a>01796   <span class="comment">// Messages not set when DB connection fails.</span>
<a name="l01797"></a>01797   <span class="keywordflow">return</span> isset($_SESSION[<span class="stringliteral">&#39;messages&#39;</span>]) ? $_SESSION[<span class="stringliteral">&#39;messages&#39;</span>] : NULL;
<a name="l01798"></a>01798 }
<a name="l01799"></a>01799 
<a name="l01814"></a><a class="code" href="bootstrap_8inc_a2c9915d030bad8c5bacf6de25e6fd14c.html#a2c9915d030bad8c5bacf6de25e6fd14c">01814</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a2c9915d030bad8c5bacf6de25e6fd14c.html#a2c9915d030bad8c5bacf6de25e6fd14c" title="Returns all messages that have been set.">drupal_get_messages</a>($type = NULL, $clear_queue = TRUE) {
<a name="l01815"></a>01815   <span class="keywordflow">if</span> ($messages = <a class="code" href="bootstrap_8inc_ad9223d86c7b08b1288274ce211d9bfa6.html#ad9223d86c7b08b1288274ce211d9bfa6" title="Sets a message to display to the user.">drupal_set_message</a>()) {
<a name="l01816"></a>01816     <span class="keywordflow">if</span> ($type) {
<a name="l01817"></a>01817       <span class="keywordflow">if</span> ($clear_queue) {
<a name="l01818"></a>01818         unset($_SESSION[<span class="stringliteral">&#39;messages&#39;</span>][$type]);
<a name="l01819"></a>01819       }
<a name="l01820"></a>01820       <span class="keywordflow">if</span> (isset($messages[$type])) {
<a name="l01821"></a>01821         <span class="keywordflow">return</span> array($type =&gt; $messages[$type]);
<a name="l01822"></a>01822       }
<a name="l01823"></a>01823     }
<a name="l01824"></a>01824     <span class="keywordflow">else</span> {
<a name="l01825"></a>01825       <span class="keywordflow">if</span> ($clear_queue) {
<a name="l01826"></a>01826         unset($_SESSION[<span class="stringliteral">&#39;messages&#39;</span>]);
<a name="l01827"></a>01827       }
<a name="l01828"></a>01828       <span class="keywordflow">return</span> $messages;
<a name="l01829"></a>01829     }
<a name="l01830"></a>01830   }
<a name="l01831"></a>01831   <span class="keywordflow">return</span> array();
<a name="l01832"></a>01832 }
<a name="l01833"></a>01833 
<a name="l01842"></a><a class="code" href="bootstrap_8inc_a88f660bf675e572de22a8469841bbd08.html#a88f660bf675e572de22a8469841bbd08">01842</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a88f660bf675e572de22a8469841bbd08.html#a88f660bf675e572de22a8469841bbd08" title="Gets the title of the current page.">drupal_get_title</a>() {
<a name="l01843"></a>01843   $title = <a class="code" href="bootstrap_8inc_a1994d49eb621df71fe1306e13b7e4910.html#a1994d49eb621df71fe1306e13b7e4910" title="Sets the title of the current page.">drupal_set_title</a>();
<a name="l01844"></a>01844 
<a name="l01845"></a>01845   <span class="comment">// During a bootstrap, menu.inc is not included and thus we cannot provide a title.</span>
<a name="l01846"></a>01846   <span class="keywordflow">if</span> (!isset($title) &amp;&amp; function_exists(<span class="stringliteral">&#39;menu_get_active_title&#39;</span>)) {
<a name="l01847"></a>01847     $title = <a class="code" href="group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d.html#ga76fc67a30fd8d75ddd80565e6e65a13d" title="Encodes special characters in a plain-text string for display as HTML.">check_plain</a>(<a class="code" href="group__menu_gaf0a358447097959e53ad1a20b8d811ed.html#gaf0a358447097959e53ad1a20b8d811ed" title="Get the title of the current page, as determined by the active trail.">menu_get_active_title</a>());
<a name="l01848"></a>01848   }
<a name="l01849"></a>01849 
<a name="l01850"></a>01850   <span class="keywordflow">return</span> $title;
<a name="l01851"></a>01851 }
<a name="l01852"></a>01852 
<a name="l01870"></a><a class="code" href="bootstrap_8inc_a1994d49eb621df71fe1306e13b7e4910.html#a1994d49eb621df71fe1306e13b7e4910">01870</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a1994d49eb621df71fe1306e13b7e4910.html#a1994d49eb621df71fe1306e13b7e4910" title="Sets the title of the current page.">drupal_set_title</a>($title = NULL, <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = <a class="code" href="bootstrap_8inc_a7b115778ff532867b7af4c53d39a1de2.html#a7b115778ff532867b7af4c53d39a1de2" title="Flag for drupal_set_title(); text is not sanitized, so run check_plain().">CHECK_PLAIN</a>) {
<a name="l01871"></a>01871   $stored_title = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__);
<a name="l01872"></a>01872 
<a name="l01873"></a>01873   <span class="keywordflow">if</span> (isset($title)) {
<a name="l01874"></a>01874     $stored_title = (<a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> == <a class="code" href="bootstrap_8inc_a90c8d2e0e3b0f4acce7e88c8c60ddbca.html#a90c8d2e0e3b0f4acce7e88c8c60ddbca" title="Flag for drupal_set_title(); text has already been sanitized.">PASS_THROUGH</a>) ? $title : <a class="code" href="group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d.html#ga76fc67a30fd8d75ddd80565e6e65a13d" title="Encodes special characters in a plain-text string for display as HTML.">check_plain</a>($title);
<a name="l01875"></a>01875   }
<a name="l01876"></a>01876 
<a name="l01877"></a>01877   <span class="keywordflow">return</span> $stored_title;
<a name="l01878"></a>01878 }
<a name="l01879"></a>01879 
<a name="l01894"></a><a class="code" href="bootstrap_8inc_ad5f73157a9aa67bd49759636f00fee8a.html#ad5f73157a9aa67bd49759636f00fee8a">01894</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_ad5f73157a9aa67bd49759636f00fee8a.html#ad5f73157a9aa67bd49759636f00fee8a" title="Checks to see if an IP address has been blocked.">drupal_is_denied</a>($ip) {
<a name="l01895"></a>01895   <span class="comment">// Because this function is called on every page request, we first check</span>
<a name="l01896"></a>01896   <span class="comment">// for an array of IP addresses in settings.php before querying the</span>
<a name="l01897"></a>01897   <span class="comment">// database.</span>
<a name="l01898"></a>01898   $blocked_ips = <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;blocked_ips&#39;</span>);
<a name="l01899"></a>01899   $denied = FALSE;
<a name="l01900"></a>01900   <span class="keywordflow">if</span> (isset($blocked_ips) &amp;&amp; is_array($blocked_ips)) {
<a name="l01901"></a>01901     $denied = in_array($ip, $blocked_ips);
<a name="l01902"></a>01902   }
<a name="l01903"></a>01903   <span class="comment">// Only check if database.inc is loaded already. If</span>
<a name="l01904"></a>01904   <span class="comment">// $conf[&#39;page_cache_without_database&#39;] = TRUE; is set in settings.php,</span>
<a name="l01905"></a>01905   <span class="comment">// then the database won&#39;t be loaded here so the IPs in the database</span>
<a name="l01906"></a>01906   <span class="comment">// won&#39;t be denied. However the user asked explicitly not to use the</span>
<a name="l01907"></a>01907   <span class="comment">// database and also in this case it&#39;s quite likely that the user relies</span>
<a name="l01908"></a>01908   <span class="comment">// on higher performance solutions like a firewall.</span>
<a name="l01909"></a>01909   elseif (class_exists(<span class="stringliteral">&#39;Database&#39;</span>, FALSE)) {
<a name="l01910"></a>01910     $denied = (bool)<a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&quot;SELECT 1 FROM {blocked_ips} WHERE ip = :ip&quot;</span>, array(<span class="stringliteral">&#39;:ip&#39;</span> =&gt; $ip))-&gt;fetchField();
<a name="l01911"></a>01911   }
<a name="l01912"></a>01912   <span class="keywordflow">return</span> $denied;
<a name="l01913"></a>01913 }
<a name="l01914"></a>01914 
<a name="l01921"></a><a class="code" href="bootstrap_8inc_a82de27d521020862a868f567d6bd7dea.html#a82de27d521020862a868f567d6bd7dea">01921</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a82de27d521020862a868f567d6bd7dea.html#a82de27d521020862a868f567d6bd7dea" title="Handles denied users.">drupal_block_denied</a>($ip) {
<a name="l01922"></a>01922   <span class="comment">// Deny access to blocked IP addresses - t() is not yet available.</span>
<a name="l01923"></a>01923   <span class="keywordflow">if</span> (<a class="code" href="bootstrap_8inc_ad5f73157a9aa67bd49759636f00fee8a.html#ad5f73157a9aa67bd49759636f00fee8a" title="Checks to see if an IP address has been blocked.">drupal_is_denied</a>($ip)) {
<a name="l01924"></a>01924     header($_SERVER[<span class="stringliteral">&#39;SERVER_PROTOCOL&#39;</span>] . <span class="stringliteral">&#39; 403 Forbidden&#39;</span>);
<a name="l01925"></a>01925     print <span class="stringliteral">&#39;Sorry, &#39;</span> . <a class="code" href="group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d.html#ga76fc67a30fd8d75ddd80565e6e65a13d" title="Encodes special characters in a plain-text string for display as HTML.">check_plain</a>(<a class="code" href="bootstrap_8inc_aec2f772317b4fb79cc696412c2e455c3.html#aec2f772317b4fb79cc696412c2e455c3" title="Returns the IP address of the client machine.">ip_address</a>()) . <span class="stringliteral">&#39; has been banned.&#39;</span>;
<a name="l01926"></a>01926     exit();
<a name="l01927"></a>01927   }
<a name="l01928"></a>01928 }
<a name="l01929"></a>01929 
<a name="l01941"></a><a class="code" href="bootstrap_8inc_a6eb7796c83ea744f818faa2a02f19953.html#a6eb7796c83ea744f818faa2a02f19953">01941</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a6eb7796c83ea744f818faa2a02f19953.html#a6eb7796c83ea744f818faa2a02f19953" title="Returns a string of highly randomized bytes (over the full 8-bit range).">drupal_random_bytes</a>($count)  {
<a name="l01942"></a>01942   <span class="comment">// $random_state does not use drupal_static as it stores random bytes.</span>
<a name="l01943"></a>01943   <span class="keyword">static</span> $random_state, $bytes, $php_compatible;
<a name="l01944"></a>01944   <span class="comment">// Initialize on the first call. The contents of $_SERVER includes a mix of</span>
<a name="l01945"></a>01945   <span class="comment">// user-specific and system information that varies a little with each page.</span>
<a name="l01946"></a>01946   <span class="keywordflow">if</span> (!isset($random_state)) {
<a name="l01947"></a>01947     $random_state = print_r($_SERVER, TRUE);
<a name="l01948"></a>01948     <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;getmypid&#39;</span>)) {
<a name="l01949"></a>01949       <span class="comment">// Further initialize with the somewhat random PHP process ID.</span>
<a name="l01950"></a>01950       $random_state .= getmypid();
<a name="l01951"></a>01951     }
<a name="l01952"></a>01952     $bytes = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01953"></a>01953   }
<a name="l01954"></a>01954   <span class="keywordflow">if</span> (strlen($bytes) &lt; $count) {
<a name="l01955"></a>01955     <span class="comment">// PHP versions prior 5.3.4 experienced openssl_random_pseudo_bytes()</span>
<a name="l01956"></a>01956     <span class="comment">// locking on Windows and rendered it unusable.</span>
<a name="l01957"></a>01957     <span class="keywordflow">if</span> (!isset($php_compatible)) {
<a name="l01958"></a>01958       $php_compatible = version_compare(PHP_VERSION, <span class="stringliteral">&#39;5.3.4&#39;</span>, <span class="stringliteral">&#39;&gt;=&#39;</span>);
<a name="l01959"></a>01959     }
<a name="l01960"></a>01960     <span class="comment">// /dev/urandom is available on many *nix systems and is considered the</span>
<a name="l01961"></a>01961     <span class="comment">// best commonly available pseudo-random source.</span>
<a name="l01962"></a>01962     <span class="keywordflow">if</span> ($fh = @fopen(<span class="stringliteral">&#39;/dev/urandom&#39;</span>, <span class="stringliteral">&#39;rb&#39;</span>)) {
<a name="l01963"></a>01963       <span class="comment">// PHP only performs buffered reads, so in reality it will always read</span>
<a name="l01964"></a>01964       <span class="comment">// at least 4096 bytes. Thus, it costs nothing extra to read and store</span>
<a name="l01965"></a>01965       <span class="comment">// that much so as to speed any additional invocations.</span>
<a name="l01966"></a>01966       $bytes .= fread($fh, max(4096, $count));
<a name="l01967"></a>01967       fclose($fh);
<a name="l01968"></a>01968     }
<a name="l01969"></a>01969     <span class="comment">// openssl_random_pseudo_bytes() will find entropy in a system-dependent</span>
<a name="l01970"></a>01970     <span class="comment">// way.</span>
<a name="l01971"></a>01971     elseif ($php_compatible &amp;&amp; function_exists(<span class="stringliteral">&#39;openssl_random_pseudo_bytes&#39;</span>)) {
<a name="l01972"></a>01972       $bytes .= openssl_random_pseudo_bytes($count - strlen($bytes));
<a name="l01973"></a>01973     }
<a name="l01974"></a>01974     <span class="comment">// If /dev/urandom is not available or returns no bytes, this loop will</span>
<a name="l01975"></a>01975     <span class="comment">// generate a good set of pseudo-random bytes on any system.</span>
<a name="l01976"></a>01976     <span class="comment">// Note that it may be important that our $random_state is passed</span>
<a name="l01977"></a>01977     <span class="comment">// through hash() prior to being rolled into $output, that the two hash()</span>
<a name="l01978"></a>01978     <span class="comment">// invocations are different, and that the extra input into the first one -</span>
<a name="l01979"></a>01979     <span class="comment">// the microtime() - is prepended rather than appended. This is to avoid</span>
<a name="l01980"></a>01980     <span class="comment">// directly leaking $random_state via the $output stream, which could</span>
<a name="l01981"></a>01981     <span class="comment">// allow for trivial prediction of further &quot;random&quot; numbers.</span>
<a name="l01982"></a>01982     <span class="keywordflow">while</span> (strlen($bytes) &lt; $count) {
<a name="l01983"></a>01983       $random_state = hash(<span class="stringliteral">&#39;sha256&#39;</span>, microtime() . mt_rand() . $random_state);
<a name="l01984"></a>01984       $bytes .= hash(<span class="stringliteral">&#39;sha256&#39;</span>, mt_rand() . $random_state, TRUE);
<a name="l01985"></a>01985     }
<a name="l01986"></a>01986   }
<a name="l01987"></a>01987   <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = substr($bytes, 0, $count);
<a name="l01988"></a>01988   $bytes = substr($bytes, $count);
<a name="l01989"></a>01989   <span class="keywordflow">return</span> <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a>;
<a name="l01990"></a>01990 }
<a name="l01991"></a>01991 
<a name="l02004"></a><a class="code" href="bootstrap_8inc_a677ac93b9fcba24a3ffeb02e08ca8e9a.html#a677ac93b9fcba24a3ffeb02e08ca8e9a">02004</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a677ac93b9fcba24a3ffeb02e08ca8e9a.html#a677ac93b9fcba24a3ffeb02e08ca8e9a" title="Calculates a base-64 encoded, URL-safe sha-256 hmac.">drupal_hmac_base64</a>($data, $key) {
<a name="l02005"></a>02005   $hmac = base64_encode(hash_hmac(<span class="stringliteral">&#39;sha256&#39;</span>, $data, $key, TRUE));
<a name="l02006"></a>02006   <span class="comment">// Modify the hmac so it&#39;s safe to use in URLs.</span>
<a name="l02007"></a>02007   <span class="keywordflow">return</span> strtr($hmac, array(<span class="charliteral">&#39;+&#39;</span> =&gt; <span class="charliteral">&#39;-&#39;</span>, <span class="charliteral">&#39;/&#39;</span> =&gt; <span class="charliteral">&#39;_&#39;</span>, <span class="charliteral">&#39;=&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>));
<a name="l02008"></a>02008 }
<a name="l02009"></a>02009 
<a name="l02020"></a><a class="code" href="bootstrap_8inc_afaa1b21aee7b2e06ee3f868065fdbcc1.html#afaa1b21aee7b2e06ee3f868065fdbcc1">02020</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_afaa1b21aee7b2e06ee3f868065fdbcc1.html#afaa1b21aee7b2e06ee3f868065fdbcc1" title="Calculates a base-64 encoded, URL-safe sha-256 hash.">drupal_hash_base64</a>($data) {
<a name="l02021"></a>02021   $hash = base64_encode(hash(<span class="stringliteral">&#39;sha256&#39;</span>, $data, TRUE));
<a name="l02022"></a>02022   <span class="comment">// Modify the hash so it&#39;s safe to use in URLs.</span>
<a name="l02023"></a>02023   <span class="keywordflow">return</span> strtr($hash, array(<span class="charliteral">&#39;+&#39;</span> =&gt; <span class="charliteral">&#39;-&#39;</span>, <span class="charliteral">&#39;/&#39;</span> =&gt; <span class="charliteral">&#39;_&#39;</span>, <span class="charliteral">&#39;=&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>));
<a name="l02024"></a>02024 }
<a name="l02025"></a>02025 
<a name="l02053"></a><a class="code" href="bootstrap_8inc_a4e822805ef55b0a271ab181c9620837a.html#a4e822805ef55b0a271ab181c9620837a">02053</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a4e822805ef55b0a271ab181c9620837a.html#a4e822805ef55b0a271ab181c9620837a" title="Merges multiple arrays, recursively, and returns the merged array.">drupal_array_merge_deep</a>() {
<a name="l02054"></a>02054   $args = func_get_args();
<a name="l02055"></a>02055   <span class="keywordflow">return</span> <a class="code" href="bootstrap_8inc_a1167ab45bbb945a5e6fd806b536eef70.html#a1167ab45bbb945a5e6fd806b536eef70" title="Merges multiple arrays, recursively, and returns the merged array.">drupal_array_merge_deep_array</a>($args);
<a name="l02056"></a>02056 }
<a name="l02057"></a>02057 
<a name="l02075"></a><a class="code" href="bootstrap_8inc_a1167ab45bbb945a5e6fd806b536eef70.html#a1167ab45bbb945a5e6fd806b536eef70">02075</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a1167ab45bbb945a5e6fd806b536eef70.html#a1167ab45bbb945a5e6fd806b536eef70" title="Merges multiple arrays, recursively, and returns the merged array.">drupal_array_merge_deep_array</a>($arrays) {
<a name="l02076"></a>02076   $result = array();
<a name="l02077"></a>02077 
<a name="l02078"></a>02078   <span class="keywordflow">foreach</span> ($arrays as $array) {
<a name="l02079"></a>02079     <span class="keywordflow">foreach</span> ($array as $key =&gt; $value) {
<a name="l02080"></a>02080       <span class="comment">// Renumber integer keys as array_merge_recursive() does. Note that PHP</span>
<a name="l02081"></a>02081       <span class="comment">// automatically converts array keys that are integer strings (e.g., &#39;1&#39;)</span>
<a name="l02082"></a>02082       <span class="comment">// to integers.</span>
<a name="l02083"></a>02083       <span class="keywordflow">if</span> (is_integer($key)) {
<a name="l02084"></a>02084         $result[] = $value;
<a name="l02085"></a>02085       }
<a name="l02086"></a>02086       <span class="comment">// Recurse when both values are arrays.</span>
<a name="l02087"></a>02087       elseif (isset($result[$key]) &amp;&amp; is_array($result[$key]) &amp;&amp; is_array($value)) {
<a name="l02088"></a>02088         $result[$key] = <a class="code" href="bootstrap_8inc_a1167ab45bbb945a5e6fd806b536eef70.html#a1167ab45bbb945a5e6fd806b536eef70" title="Merges multiple arrays, recursively, and returns the merged array.">drupal_array_merge_deep_array</a>(array($result[$key], $value));
<a name="l02089"></a>02089       }
<a name="l02090"></a>02090       <span class="comment">// Otherwise, use the latter value, overriding any previous value.</span>
<a name="l02091"></a>02091       <span class="keywordflow">else</span> {
<a name="l02092"></a>02092         $result[$key] = $value;
<a name="l02093"></a>02093       }
<a name="l02094"></a>02094     }
<a name="l02095"></a>02095   }
<a name="l02096"></a>02096 
<a name="l02097"></a>02097   <span class="keywordflow">return</span> $result;
<a name="l02098"></a>02098 }
<a name="l02099"></a>02099 
<a name="l02105"></a><a class="code" href="bootstrap_8inc_a9ad783f833f89bccb8ca03e960e3d33d.html#a9ad783f833f89bccb8ca03e960e3d33d">02105</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a9ad783f833f89bccb8ca03e960e3d33d.html#a9ad783f833f89bccb8ca03e960e3d33d" title="Generates a default anonymous $user object.">drupal_anonymous_user</a>() {
<a name="l02106"></a>02106   $user = <span class="keyword">new</span> stdClass();
<a name="l02107"></a>02107   $user-&gt;uid = 0;
<a name="l02108"></a>02108   $user-&gt;hostname = <a class="code" href="bootstrap_8inc_aec2f772317b4fb79cc696412c2e455c3.html#aec2f772317b4fb79cc696412c2e455c3" title="Returns the IP address of the client machine.">ip_address</a>();
<a name="l02109"></a>02109   $user-&gt;roles = array();
<a name="l02110"></a>02110   $user-&gt;roles[<a class="code" href="bootstrap_8inc_ac7816037c6b6b794a56dcce4dea70569.html#ac7816037c6b6b794a56dcce4dea70569" title="Role ID for anonymous users; should match what&#39;s in the &quot;role&quot; table.">DRUPAL_ANONYMOUS_RID</a>] = <span class="stringliteral">&#39;anonymous user&#39;</span>;
<a name="l02111"></a>02111   $user-&gt;cache = 0;
<a name="l02112"></a>02112   <span class="keywordflow">return</span> $user;
<a name="l02113"></a>02113 }
<a name="l02114"></a>02114 
<a name="l02133"></a><a class="code" href="bootstrap_8inc_a8dcad7737ed560086bcdd9998a020a93.html#a8dcad7737ed560086bcdd9998a020a93">02133</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a8dcad7737ed560086bcdd9998a020a93.html#a8dcad7737ed560086bcdd9998a020a93" title="Ensures Drupal is bootstrapped to the specified phase.">drupal_bootstrap</a>($phase = NULL, $new_phase = TRUE) {
<a name="l02134"></a>02134   <span class="comment">// Not drupal_static(), because does not depend on any run-time information.</span>
<a name="l02135"></a>02135   <span class="keyword">static</span> $phases = array(
<a name="l02136"></a>02136     <a class="code" href="bootstrap_8inc_ad71394314c3ad7cef54b5f566e3ec177.html#ad71394314c3ad7cef54b5f566e3ec177" title="End of &quot;defgroup logging_severity_levels&quot;.">DRUPAL_BOOTSTRAP_CONFIGURATION</a>,
<a name="l02137"></a>02137     <a class="code" href="bootstrap_8inc_a72f3a79e7308050a8f4d074592314c0f.html#a72f3a79e7308050a8f4d074592314c0f" title="Second bootstrap phase: try to serve a cached page.">DRUPAL_BOOTSTRAP_PAGE_CACHE</a>,
<a name="l02138"></a>02138     <a class="code" href="bootstrap_8inc_a693d842eaaf448b1e6c37cc4ef068e3a.html#a693d842eaaf448b1e6c37cc4ef068e3a" title="Third bootstrap phase: initialize database layer.">DRUPAL_BOOTSTRAP_DATABASE</a>,
<a name="l02139"></a>02139     <a class="code" href="bootstrap_8inc_a83083de674fde28341c7b833b9397390.html#a83083de674fde28341c7b833b9397390" title="Fourth bootstrap phase: initialize the variable system.">DRUPAL_BOOTSTRAP_VARIABLES</a>,
<a name="l02140"></a>02140     <a class="code" href="bootstrap_8inc_aa6c510376f042cd2d05fc9bb458e7138.html#aa6c510376f042cd2d05fc9bb458e7138" title="Fifth bootstrap phase: initialize session handling.">DRUPAL_BOOTSTRAP_SESSION</a>,
<a name="l02141"></a>02141     <a class="code" href="bootstrap_8inc_aa237aa5f95f8059a465efef6c72e49ce.html#aa237aa5f95f8059a465efef6c72e49ce" title="Sixth bootstrap phase: set up the page header.">DRUPAL_BOOTSTRAP_PAGE_HEADER</a>,
<a name="l02142"></a>02142     <a class="code" href="bootstrap_8inc_ae4a0a1bc1243082285abc3fc052e5d38.html#ae4a0a1bc1243082285abc3fc052e5d38" title="Seventh bootstrap phase: find out language of the page.">DRUPAL_BOOTSTRAP_LANGUAGE</a>,
<a name="l02143"></a>02143     <a class="code" href="bootstrap_8inc_a2c8ac509af1924cf2fa7420a22e1b048.html#a2c8ac509af1924cf2fa7420a22e1b048" title="Final bootstrap phase: Drupal is fully loaded; validate and fix input data.">DRUPAL_BOOTSTRAP_FULL</a>,
<a name="l02144"></a>02144   );
<a name="l02145"></a>02145   <span class="comment">// Not drupal_static(), because the only legitimate API to control this is to</span>
<a name="l02146"></a>02146   <span class="comment">// call drupal_bootstrap() with a new phase parameter.</span>
<a name="l02147"></a>02147   <span class="keyword">static</span> $final_phase;
<a name="l02148"></a>02148   <span class="comment">// Not drupal_static(), because it&#39;s impossible to roll back to an earlier</span>
<a name="l02149"></a>02149   <span class="comment">// bootstrap state.</span>
<a name="l02150"></a>02150   <span class="keyword">static</span> $stored_phase = -1;
<a name="l02151"></a>02151 
<a name="l02152"></a>02152   <span class="comment">// When not recursing, store the phase name so it&#39;s not forgotten while</span>
<a name="l02153"></a>02153   <span class="comment">// recursing.</span>
<a name="l02154"></a>02154   <span class="keywordflow">if</span> ($new_phase) {
<a name="l02155"></a>02155     $final_phase = $phase;
<a name="l02156"></a>02156   }
<a name="l02157"></a>02157   <span class="keywordflow">if</span> (isset($phase)) {
<a name="l02158"></a>02158     <span class="comment">// Call a phase if it has not been called before and is below the requested</span>
<a name="l02159"></a>02159     <span class="comment">// phase.</span>
<a name="l02160"></a>02160     <span class="keywordflow">while</span> ($phases &amp;&amp; $phase &gt; $stored_phase &amp;&amp; $final_phase &gt; $stored_phase) {
<a name="l02161"></a>02161       $current_phase = array_shift($phases);
<a name="l02162"></a>02162 
<a name="l02163"></a>02163       <span class="comment">// This function is re-entrant. Only update the completed phase when the</span>
<a name="l02164"></a>02164       <span class="comment">// current call actually resulted in a progress in the bootstrap process.</span>
<a name="l02165"></a>02165       <span class="keywordflow">if</span> ($current_phase &gt; $stored_phase) {
<a name="l02166"></a>02166         $stored_phase = $current_phase;
<a name="l02167"></a>02167       }
<a name="l02168"></a>02168 
<a name="l02169"></a>02169       <span class="keywordflow">switch</span> ($current_phase) {
<a name="l02170"></a>02170         <span class="keywordflow">case</span> <a class="code" href="bootstrap_8inc_ad71394314c3ad7cef54b5f566e3ec177.html#ad71394314c3ad7cef54b5f566e3ec177" title="End of &quot;defgroup logging_severity_levels&quot;.">DRUPAL_BOOTSTRAP_CONFIGURATION</a>:
<a name="l02171"></a>02171           <a class="code" href="bootstrap_8inc_ad6a32cc1a865d168128b5a16ce8630d9.html#ad6a32cc1a865d168128b5a16ce8630d9" title="Sets up the script environment and loads settings.php.">_drupal_bootstrap_configuration</a>();
<a name="l02172"></a>02172           <span class="keywordflow">break</span>;
<a name="l02173"></a>02173 
<a name="l02174"></a>02174         <span class="keywordflow">case</span> <a class="code" href="bootstrap_8inc_a72f3a79e7308050a8f4d074592314c0f.html#a72f3a79e7308050a8f4d074592314c0f" title="Second bootstrap phase: try to serve a cached page.">DRUPAL_BOOTSTRAP_PAGE_CACHE</a>:
<a name="l02175"></a>02175           <a class="code" href="bootstrap_8inc_a18e86c70c220ef294a9aaa5bdc756bce.html#a18e86c70c220ef294a9aaa5bdc756bce" title="Attempts to serve a page from the cache.">_drupal_bootstrap_page_cache</a>();
<a name="l02176"></a>02176           <span class="keywordflow">break</span>;
<a name="l02177"></a>02177 
<a name="l02178"></a>02178         <span class="keywordflow">case</span> <a class="code" href="bootstrap_8inc_a693d842eaaf448b1e6c37cc4ef068e3a.html#a693d842eaaf448b1e6c37cc4ef068e3a" title="Third bootstrap phase: initialize database layer.">DRUPAL_BOOTSTRAP_DATABASE</a>:
<a name="l02179"></a>02179           <a class="code" href="bootstrap_8inc_accb161e8cea2fd1fdfece6d6f087e195.html#accb161e8cea2fd1fdfece6d6f087e195" title="Initializes the database system and registers autoload functions.">_drupal_bootstrap_database</a>();
<a name="l02180"></a>02180           <span class="keywordflow">break</span>;
<a name="l02181"></a>02181 
<a name="l02182"></a>02182         <span class="keywordflow">case</span> <a class="code" href="bootstrap_8inc_a83083de674fde28341c7b833b9397390.html#a83083de674fde28341c7b833b9397390" title="Fourth bootstrap phase: initialize the variable system.">DRUPAL_BOOTSTRAP_VARIABLES</a>:
<a name="l02183"></a>02183           <a class="code" href="bootstrap_8inc_a2ea55f223f5f1c6ddcfcdfe4a11782db.html#a2ea55f223f5f1c6ddcfcdfe4a11782db" title="Loads system variables and all enabled bootstrap modules.">_drupal_bootstrap_variables</a>();
<a name="l02184"></a>02184           <span class="keywordflow">break</span>;
<a name="l02185"></a>02185 
<a name="l02186"></a>02186         <span class="keywordflow">case</span> <a class="code" href="bootstrap_8inc_aa6c510376f042cd2d05fc9bb458e7138.html#aa6c510376f042cd2d05fc9bb458e7138" title="Fifth bootstrap phase: initialize session handling.">DRUPAL_BOOTSTRAP_SESSION</a>:
<a name="l02187"></a>02187           require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;session_inc&#39;</span>, <span class="stringliteral">&#39;includes/session.inc&#39;</span>);
<a name="l02188"></a>02188           <a class="code" href="session_8inc_a1ddf625160ae9e448b25ea74f9fa58d0.html#a1ddf625160ae9e448b25ea74f9fa58d0" title="Initializes the session handler, starting a session if needed.">drupal_session_initialize</a>();
<a name="l02189"></a>02189           <span class="keywordflow">break</span>;
<a name="l02190"></a>02190 
<a name="l02191"></a>02191         <span class="keywordflow">case</span> <a class="code" href="bootstrap_8inc_aa237aa5f95f8059a465efef6c72e49ce.html#aa237aa5f95f8059a465efef6c72e49ce" title="Sixth bootstrap phase: set up the page header.">DRUPAL_BOOTSTRAP_PAGE_HEADER</a>:
<a name="l02192"></a>02192           <a class="code" href="bootstrap_8inc_aaec7ee804d0de51e5632a28a286578aa.html#aaec7ee804d0de51e5632a28a286578aa" title="Invokes hook_boot(), initializes locking system, and sends HTTP headers.">_drupal_bootstrap_page_header</a>();
<a name="l02193"></a>02193           <span class="keywordflow">break</span>;
<a name="l02194"></a>02194 
<a name="l02195"></a>02195         <span class="keywordflow">case</span> <a class="code" href="bootstrap_8inc_ae4a0a1bc1243082285abc3fc052e5d38.html#ae4a0a1bc1243082285abc3fc052e5d38" title="Seventh bootstrap phase: find out language of the page.">DRUPAL_BOOTSTRAP_LANGUAGE</a>:
<a name="l02196"></a>02196           <a class="code" href="bootstrap_8inc_a8abdce8019511ce4a74d3d9b48a93717.html#a8abdce8019511ce4a74d3d9b48a93717" title="Initializes all the defined language types.">drupal_language_initialize</a>();
<a name="l02197"></a>02197           <span class="keywordflow">break</span>;
<a name="l02198"></a>02198 
<a name="l02199"></a>02199         <span class="keywordflow">case</span> <a class="code" href="bootstrap_8inc_a2c8ac509af1924cf2fa7420a22e1b048.html#a2c8ac509af1924cf2fa7420a22e1b048" title="Final bootstrap phase: Drupal is fully loaded; validate and fix input data.">DRUPAL_BOOTSTRAP_FULL</a>:
<a name="l02200"></a>02200           require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/common.inc&#39;</span>;
<a name="l02201"></a>02201           <a class="code" href="common_8inc_ab7818b78cd7ba93b8b7522324bddb72d.html#ab7818b78cd7ba93b8b7522324bddb72d">_drupal_bootstrap_full</a>();
<a name="l02202"></a>02202           <span class="keywordflow">break</span>;
<a name="l02203"></a>02203       }
<a name="l02204"></a>02204     }
<a name="l02205"></a>02205   }
<a name="l02206"></a>02206   <span class="keywordflow">return</span> $stored_phase;
<a name="l02207"></a>02207 }
<a name="l02208"></a>02208 
<a name="l02212"></a><a class="code" href="bootstrap_8inc_aab3e512ebe00778d1f7fe97db22b4d9d.html#aab3e512ebe00778d1f7fe97db22b4d9d">02212</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_aab3e512ebe00778d1f7fe97db22b4d9d.html#aab3e512ebe00778d1f7fe97db22b4d9d" title="Returns the time zone of the current user.">drupal_get_user_timezone</a>() {
<a name="l02213"></a>02213   global $user;
<a name="l02214"></a>02214   <span class="keywordflow">if</span> (<a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;configurable_timezones&#39;</span>, 1) &amp;&amp; $user-&gt;uid &amp;&amp; $user-&gt;timezone) {
<a name="l02215"></a>02215     <span class="keywordflow">return</span> $user-&gt;timezone;
<a name="l02216"></a>02216   }
<a name="l02217"></a>02217   <span class="keywordflow">else</span> {
<a name="l02218"></a>02218     <span class="comment">// Ignore PHP strict notice if time zone has not yet been set in the php.ini</span>
<a name="l02219"></a>02219     <span class="comment">// configuration.</span>
<a name="l02220"></a>02220     <span class="keywordflow">return</span> <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;date_default_timezone&#39;</span>, @date_default_timezone_get());
<a name="l02221"></a>02221   }
<a name="l02222"></a>02222 }
<a name="l02223"></a>02223 
<a name="l02239"></a><a class="code" href="bootstrap_8inc_a81d5c3fc0ad3470c5071a001ba9b5a8b.html#a81d5c3fc0ad3470c5071a001ba9b5a8b">02239</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a81d5c3fc0ad3470c5071a001ba9b5a8b.html#a81d5c3fc0ad3470c5071a001ba9b5a8b" title="Provides custom PHP error handling.">_drupal_error_handler</a>($error_level, $message, $filename, $line, $context) {
<a name="l02240"></a>02240   require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/errors.inc&#39;</span>;
<a name="l02241"></a>02241   <a class="code" href="errors_8inc_a265af3be0f1c7ec1e99c0ed8bea5b0ad.html#a265af3be0f1c7ec1e99c0ed8bea5b0ad" title="Provides custom PHP error handling.">_drupal_error_handler_real</a>($error_level, $message, $filename, $line, $context);
<a name="l02242"></a>02242 }
<a name="l02243"></a>02243 
<a name="l02254"></a><a class="code" href="bootstrap_8inc_a42a79128a6db4edc9865224a2b90f8f5.html#a42a79128a6db4edc9865224a2b90f8f5">02254</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a42a79128a6db4edc9865224a2b90f8f5.html#a42a79128a6db4edc9865224a2b90f8f5" title="Provides custom PHP exception handling.">_drupal_exception_handler</a>($exception) {
<a name="l02255"></a>02255   require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/errors.inc&#39;</span>;
<a name="l02256"></a>02256 
<a name="l02257"></a>02257   <span class="keywordflow">try</span> {
<a name="l02258"></a>02258     <span class="comment">// Log the message to the watchdog and return an error page to the user.</span>
<a name="l02259"></a>02259     <a class="code" href="errors_8inc_adae530f2d49e1067ab4e9dd5753e387a.html#adae530f2d49e1067ab4e9dd5753e387a" title="Logs a PHP error or exception and displays an error page in fatal cases.">_drupal_log_error</a>(<a class="code" href="errors_8inc_ace892832385b7832c106f55f8896060d.html#ace892832385b7832c106f55f8896060d" title="Decodes an exception and retrieves the correct caller.">_drupal_decode_exception</a>($exception), TRUE);
<a name="l02260"></a>02260   }
<a name="l02261"></a>02261   <span class="keywordflow">catch</span> (<a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> $exception2) {
<a name="l02262"></a>02262     <span class="comment">// Another uncaught exception was thrown while handling the first one.</span>
<a name="l02263"></a>02263     <span class="comment">// If we are displaying errors, then do so with no possibility of a further uncaught exception being thrown.</span>
<a name="l02264"></a>02264     <span class="keywordflow">if</span> (<a class="code" href="errors_8inc_a84844a457938107e0ff1a1e5393feb8e.html#a84844a457938107e0ff1a1e5393feb8e" title="Determines whether an error should be displayed.">error_displayable</a>()) {
<a name="l02265"></a>02265       print <span class="stringliteral">&#39;&lt;h1&gt;Additional uncaught exception thrown while handling exception.&lt;/h1&gt;&#39;</span>;
<a name="l02266"></a>02266       print <span class="stringliteral">&#39;&lt;h2&gt;Original&lt;/h2&gt;&lt;p&gt;&#39;</span> . <a class="code" href="errors_8inc_a1f8bd68a322e820f9bed014cb6a9f1de.html#a1f8bd68a322e820f9bed014cb6a9f1de" title="Renders an exception error message without further exceptions.">_drupal_render_exception_safe</a>($exception) . <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;
<a name="l02267"></a>02267       print <span class="stringliteral">&#39;&lt;h2&gt;Additional&lt;/h2&gt;&lt;p&gt;&#39;</span> . <a class="code" href="errors_8inc_a1f8bd68a322e820f9bed014cb6a9f1de.html#a1f8bd68a322e820f9bed014cb6a9f1de" title="Renders an exception error message without further exceptions.">_drupal_render_exception_safe</a>($exception2) . <span class="stringliteral">&#39;&lt;/p&gt;&lt;hr /&gt;&#39;</span>;
<a name="l02268"></a>02268     }
<a name="l02269"></a>02269   }
<a name="l02270"></a>02270 }
<a name="l02271"></a>02271 
<a name="l02275"></a><a class="code" href="bootstrap_8inc_ad6a32cc1a865d168128b5a16ce8630d9.html#ad6a32cc1a865d168128b5a16ce8630d9">02275</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_ad6a32cc1a865d168128b5a16ce8630d9.html#ad6a32cc1a865d168128b5a16ce8630d9" title="Sets up the script environment and loads settings.php.">_drupal_bootstrap_configuration</a>() {
<a name="l02276"></a>02276   <span class="comment">// Set the Drupal custom error handler.</span>
<a name="l02277"></a>02277   set_error_handler(<span class="stringliteral">&#39;_drupal_error_handler&#39;</span>);
<a name="l02278"></a>02278   set_exception_handler(<span class="stringliteral">&#39;_drupal_exception_handler&#39;</span>);
<a name="l02279"></a>02279 
<a name="l02280"></a>02280   <a class="code" href="bootstrap_8inc_a14319f2e33c7996576b203ed2bae9b62.html#a14319f2e33c7996576b203ed2bae9b62" title="Initializes the PHP environment.">drupal_environment_initialize</a>();
<a name="l02281"></a>02281   <span class="comment">// Start a page timer:</span>
<a name="l02282"></a>02282   <a class="code" href="bootstrap_8inc_a0aaa023d3c72be50ab4ac3f7e1c989c0.html#a0aaa023d3c72be50ab4ac3f7e1c989c0" title="Starts the timer with the specified name.">timer_start</a>(<span class="stringliteral">&#39;page&#39;</span>);
<a name="l02283"></a>02283   <span class="comment">// Initialize the configuration, including variables from settings.php.</span>
<a name="l02284"></a>02284   <a class="code" href="bootstrap_8inc_acae9a8501a2571219d7517f50cc6afec.html#acae9a8501a2571219d7517f50cc6afec" title="Sets the base URL, cookie domain, and session name from configuration.">drupal_settings_initialize</a>();
<a name="l02285"></a>02285 }
<a name="l02286"></a>02286 
<a name="l02290"></a><a class="code" href="bootstrap_8inc_a18e86c70c220ef294a9aaa5bdc756bce.html#a18e86c70c220ef294a9aaa5bdc756bce">02290</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a18e86c70c220ef294a9aaa5bdc756bce.html#a18e86c70c220ef294a9aaa5bdc756bce" title="Attempts to serve a page from the cache.">_drupal_bootstrap_page_cache</a>() {
<a name="l02291"></a>02291   global $user;
<a name="l02292"></a>02292 
<a name="l02293"></a>02293   <span class="comment">// Allow specifying special cache handlers in settings.php, like</span>
<a name="l02294"></a>02294   <span class="comment">// using memcached or files for storing cache information.</span>
<a name="l02295"></a>02295   require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/cache.inc&#39;</span>;
<a name="l02296"></a>02296   <span class="keywordflow">foreach</span> (<a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;cache_backends&#39;</span>, array()) as $include) {
<a name="l02297"></a>02297     require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $include;
<a name="l02298"></a>02298   }
<a name="l02299"></a>02299   <span class="comment">// Check for a cache mode force from settings.php.</span>
<a name="l02300"></a>02300   <span class="keywordflow">if</span> (<a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;page_cache_without_database&#39;</span>)) {
<a name="l02301"></a>02301     $cache_enabled = TRUE;
<a name="l02302"></a>02302   }
<a name="l02303"></a>02303   <span class="keywordflow">else</span> {
<a name="l02304"></a>02304     <a class="code" href="bootstrap_8inc_a8dcad7737ed560086bcdd9998a020a93.html#a8dcad7737ed560086bcdd9998a020a93" title="Ensures Drupal is bootstrapped to the specified phase.">drupal_bootstrap</a>(<a class="code" href="bootstrap_8inc_a83083de674fde28341c7b833b9397390.html#a83083de674fde28341c7b833b9397390" title="Fourth bootstrap phase: initialize the variable system.">DRUPAL_BOOTSTRAP_VARIABLES</a>, FALSE);
<a name="l02305"></a>02305     $cache_enabled = <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;cache&#39;</span>);
<a name="l02306"></a>02306   }
<a name="l02307"></a>02307   <a class="code" href="bootstrap_8inc_a82de27d521020862a868f567d6bd7dea.html#a82de27d521020862a868f567d6bd7dea" title="Handles denied users.">drupal_block_denied</a>(<a class="code" href="bootstrap_8inc_aec2f772317b4fb79cc696412c2e455c3.html#aec2f772317b4fb79cc696412c2e455c3" title="Returns the IP address of the client machine.">ip_address</a>());
<a name="l02308"></a>02308   <span class="comment">// If there is no session cookie and cache is enabled (or forced), try</span>
<a name="l02309"></a>02309   <span class="comment">// to serve a cached page.</span>
<a name="l02310"></a>02310   <span class="keywordflow">if</span> (!isset($_COOKIE[session_name()]) &amp;&amp; $cache_enabled) {
<a name="l02311"></a>02311     <span class="comment">// Make sure there is a user object because its timestamp will be</span>
<a name="l02312"></a>02312     <span class="comment">// checked, hook_boot might check for anonymous user etc.</span>
<a name="l02313"></a>02313     $user = <a class="code" href="bootstrap_8inc_a9ad783f833f89bccb8ca03e960e3d33d.html#a9ad783f833f89bccb8ca03e960e3d33d" title="Generates a default anonymous $user object.">drupal_anonymous_user</a>();
<a name="l02314"></a>02314     <span class="comment">// Get the page from the cache.</span>
<a name="l02315"></a>02315     $cache = <a class="code" href="bootstrap_8inc_ae0a2f358a39764e08d16be76415b367f.html#ae0a2f358a39764e08d16be76415b367f" title="Retrieves the current page from the cache.">drupal_page_get_cache</a>();
<a name="l02316"></a>02316     <span class="comment">// If there is a cached page, display it.</span>
<a name="l02317"></a>02317     <span class="keywordflow">if</span> (is_object($cache)) {
<a name="l02318"></a>02318       header(<span class="stringliteral">&#39;X-Drupal-Cache: HIT&#39;</span>);
<a name="l02319"></a>02319       <span class="comment">// Restore the metadata cached with the page.</span>
<a name="l02320"></a>02320       $_GET[<span class="charliteral">&#39;q&#39;</span>] = $cache-&gt;data[<span class="stringliteral">&#39;path&#39;</span>];
<a name="l02321"></a>02321       <a class="code" href="bootstrap_8inc_a1994d49eb621df71fe1306e13b7e4910.html#a1994d49eb621df71fe1306e13b7e4910" title="Sets the title of the current page.">drupal_set_title</a>($cache-&gt;data[<span class="stringliteral">&#39;title&#39;</span>], <a class="code" href="bootstrap_8inc_a90c8d2e0e3b0f4acce7e88c8c60ddbca.html#a90c8d2e0e3b0f4acce7e88c8c60ddbca" title="Flag for drupal_set_title(); text has already been sanitized.">PASS_THROUGH</a>);
<a name="l02322"></a>02322       date_default_timezone_set(<a class="code" href="bootstrap_8inc_aab3e512ebe00778d1f7fe97db22b4d9d.html#aab3e512ebe00778d1f7fe97db22b4d9d" title="Returns the time zone of the current user.">drupal_get_user_timezone</a>());
<a name="l02323"></a>02323       <span class="comment">// If the skipping of the bootstrap hooks is not enforced, call</span>
<a name="l02324"></a>02324       <span class="comment">// hook_boot.</span>
<a name="l02325"></a>02325       <span class="keywordflow">if</span> (<a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;page_cache_invoke_hooks&#39;</span>, TRUE)) {
<a name="l02326"></a>02326         <a class="code" href="bootstrap_8inc_a3f13159d2e93ecfd09823d8dca30f5d9.html#a3f13159d2e93ecfd09823d8dca30f5d9" title="Invokes a bootstrap hook in all bootstrap modules that implement it.">bootstrap_invoke_all</a>(<span class="stringliteral">&#39;boot&#39;</span>);
<a name="l02327"></a>02327       }
<a name="l02328"></a>02328       <a class="code" href="bootstrap_8inc_ae09cf8051ec110fd6ce67f4a3b77a3fb.html#ae09cf8051ec110fd6ce67f4a3b77a3fb" title="Sets HTTP headers in preparation for a cached page response.">drupal_serve_page_from_cache</a>($cache);
<a name="l02329"></a>02329       <span class="comment">// If the skipping of the bootstrap hooks is not enforced, call</span>
<a name="l02330"></a>02330       <span class="comment">// hook_exit.</span>
<a name="l02331"></a>02331       <span class="keywordflow">if</span> (<a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;page_cache_invoke_hooks&#39;</span>, TRUE)) {
<a name="l02332"></a>02332         <a class="code" href="bootstrap_8inc_a3f13159d2e93ecfd09823d8dca30f5d9.html#a3f13159d2e93ecfd09823d8dca30f5d9" title="Invokes a bootstrap hook in all bootstrap modules that implement it.">bootstrap_invoke_all</a>(<span class="stringliteral">&#39;exit&#39;</span>);
<a name="l02333"></a>02333       }
<a name="l02334"></a>02334       <span class="comment">// We are done.</span>
<a name="l02335"></a>02335       exit;
<a name="l02336"></a>02336     }
<a name="l02337"></a>02337     <span class="keywordflow">else</span> {
<a name="l02338"></a>02338       header(<span class="stringliteral">&#39;X-Drupal-Cache: MISS&#39;</span>);
<a name="l02339"></a>02339     }
<a name="l02340"></a>02340   }
<a name="l02341"></a>02341 }
<a name="l02342"></a>02342 
<a name="l02346"></a><a class="code" href="bootstrap_8inc_accb161e8cea2fd1fdfece6d6f087e195.html#accb161e8cea2fd1fdfece6d6f087e195">02346</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_accb161e8cea2fd1fdfece6d6f087e195.html#accb161e8cea2fd1fdfece6d6f087e195" title="Initializes the database system and registers autoload functions.">_drupal_bootstrap_database</a>() {
<a name="l02347"></a>02347   <span class="comment">// Redirect the user to the installation script if Drupal has not been</span>
<a name="l02348"></a>02348   <span class="comment">// installed yet (i.e., if no $databases array has been defined in the</span>
<a name="l02349"></a>02349   <span class="comment">// settings.php file) and we are not already installing.</span>
<a name="l02350"></a>02350   <span class="keywordflow">if</span> (empty($GLOBALS[<span class="stringliteral">&#39;databases&#39;</span>]) &amp;&amp; !<a class="code" href="bootstrap_8inc_ac9902394c447118612c3a71191151f2c.html#ac9902394c447118612c3a71191151f2c" title="Returns TRUE if a Drupal installation is currently being attempted.">drupal_installation_attempted</a>()) {
<a name="l02351"></a>02351     include_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/install.inc&#39;</span>;
<a name="l02352"></a>02352     <a class="code" href="install_8inc_a8500b736c9651e3947265d35fc6ab920.html#a8500b736c9651e3947265d35fc6ab920" title="Send the user to a different installer page.">install_goto</a>(<span class="stringliteral">&#39;install.php&#39;</span>);
<a name="l02353"></a>02353   }
<a name="l02354"></a>02354 
<a name="l02355"></a>02355   <span class="comment">// The user agent header is used to pass a database prefix in the request when</span>
<a name="l02356"></a>02356   <span class="comment">// running tests. However, for security reasons, it is imperative that we</span>
<a name="l02357"></a>02357   <span class="comment">// validate we ourselves made the request.</span>
<a name="l02358"></a>02358   <span class="keywordflow">if</span> ($test_prefix = <a class="code" href="bootstrap_8inc_abdfb3ad2d4e0a21b9319296b2f4e25e2.html#abdfb3ad2d4e0a21b9319296b2f4e25e2" title="Returns the test prefix if this is an internal request from SimpleTest.">drupal_valid_test_ua</a>()) {
<a name="l02359"></a>02359     <span class="comment">// Set the test run id for use in other parts of Drupal.</span>
<a name="l02360"></a>02360     $test_info = &amp;$GLOBALS[<span class="stringliteral">&#39;drupal_test_info&#39;</span>];
<a name="l02361"></a>02361     $test_info[<span class="stringliteral">&#39;test_run_id&#39;</span>] = $test_prefix;
<a name="l02362"></a>02362     $test_info[<span class="stringliteral">&#39;in_child_site&#39;</span>] = TRUE;
<a name="l02363"></a>02363 
<a name="l02364"></a>02364     <span class="keywordflow">foreach</span> ($GLOBALS[<span class="stringliteral">&#39;databases&#39;</span>][<span class="stringliteral">&#39;default&#39;</span>] as &amp;$value) {
<a name="l02365"></a>02365       <span class="comment">// Extract the current default database prefix.</span>
<a name="l02366"></a>02366       <span class="keywordflow">if</span> (!isset($value[<span class="stringliteral">&#39;prefix&#39;</span>])) {
<a name="l02367"></a>02367         $current_prefix = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02368"></a>02368       }
<a name="l02369"></a>02369       elseif (is_array($value[<span class="stringliteral">&#39;prefix&#39;</span>])) {
<a name="l02370"></a>02370         $current_prefix = $value[<span class="stringliteral">&#39;prefix&#39;</span>][<span class="stringliteral">&#39;default&#39;</span>];
<a name="l02371"></a>02371       }
<a name="l02372"></a>02372       <span class="keywordflow">else</span> {
<a name="l02373"></a>02373         $current_prefix = $value[<span class="stringliteral">&#39;prefix&#39;</span>];
<a name="l02374"></a>02374       }
<a name="l02375"></a>02375 
<a name="l02376"></a>02376       <span class="comment">// Remove the current database prefix and replace it by our own.</span>
<a name="l02377"></a>02377       $value[<span class="stringliteral">&#39;prefix&#39;</span>] = array(
<a name="l02378"></a>02378         <span class="stringliteral">&#39;default&#39;</span> =&gt; $current_prefix . $test_prefix,
<a name="l02379"></a>02379       );
<a name="l02380"></a>02380     }
<a name="l02381"></a>02381   }
<a name="l02382"></a>02382 
<a name="l02383"></a>02383   <span class="comment">// Initialize the database system. Note that the connection</span>
<a name="l02384"></a>02384   <span class="comment">// won&#39;t be initialized until it is actually requested.</span>
<a name="l02385"></a>02385   require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/database/database.inc&#39;</span>;
<a name="l02386"></a>02386 
<a name="l02387"></a>02387   <span class="comment">// Register autoload functions so that we can access classes and interfaces.</span>
<a name="l02388"></a>02388   <span class="comment">// The database autoload routine comes first so that we can load the database</span>
<a name="l02389"></a>02389   <span class="comment">// system without hitting the database. That is especially important during</span>
<a name="l02390"></a>02390   <span class="comment">// the install or upgrade process.</span>
<a name="l02391"></a>02391   spl_autoload_register(<span class="stringliteral">&#39;drupal_autoload_class&#39;</span>);
<a name="l02392"></a>02392   spl_autoload_register(<span class="stringliteral">&#39;drupal_autoload_interface&#39;</span>);
<a name="l02393"></a>02393 }
<a name="l02394"></a>02394 
<a name="l02398"></a><a class="code" href="bootstrap_8inc_a2ea55f223f5f1c6ddcfcdfe4a11782db.html#a2ea55f223f5f1c6ddcfcdfe4a11782db">02398</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a2ea55f223f5f1c6ddcfcdfe4a11782db.html#a2ea55f223f5f1c6ddcfcdfe4a11782db" title="Loads system variables and all enabled bootstrap modules.">_drupal_bootstrap_variables</a>() {
<a name="l02399"></a>02399   global <a class="code" href="authorize_8php_a10064a52f624358ea93475105245c4ac.html#a10064a52f624358ea93475105245c4ac">$conf</a>;
<a name="l02400"></a>02400 
<a name="l02401"></a>02401   <span class="comment">// Initialize the lock system.</span>
<a name="l02402"></a>02402   require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;lock_inc&#39;</span>, <span class="stringliteral">&#39;includes/lock.inc&#39;</span>);
<a name="l02403"></a>02403   <a class="code" href="group__lock_ga8e0cf09d86196c0a26b50df3567108a4.html#ga8e0cf09d86196c0a26b50df3567108a4" title="Initialize the locking system.">lock_initialize</a>();
<a name="l02404"></a>02404 
<a name="l02405"></a>02405   <span class="comment">// Load variables from the database, but do not overwrite variables set in settings.php.</span>
<a name="l02406"></a>02406   $conf = <a class="code" href="bootstrap_8inc_a7cb710899d7238be1cad274e278cd87f.html#a7cb710899d7238be1cad274e278cd87f" title="Loads the persistent variable table.">variable_initialize</a>(isset($conf) ? $conf : array());
<a name="l02407"></a>02407   <span class="comment">// Load bootstrap modules.</span>
<a name="l02408"></a>02408   require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/module.inc&#39;</span>;
<a name="l02409"></a>02409   <a class="code" href="module_8inc_a76db4bd7c4962f254d6cc9bed5f0e1f6.html#a76db4bd7c4962f254d6cc9bed5f0e1f6" title="Load all the modules that have been enabled in the system table.">module_load_all</a>(TRUE);
<a name="l02410"></a>02410 }
<a name="l02411"></a>02411 
<a name="l02415"></a><a class="code" href="bootstrap_8inc_aaec7ee804d0de51e5632a28a286578aa.html#aaec7ee804d0de51e5632a28a286578aa">02415</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_aaec7ee804d0de51e5632a28a286578aa.html#aaec7ee804d0de51e5632a28a286578aa" title="Invokes hook_boot(), initializes locking system, and sends HTTP headers.">_drupal_bootstrap_page_header</a>() {
<a name="l02416"></a>02416   <a class="code" href="bootstrap_8inc_a3f13159d2e93ecfd09823d8dca30f5d9.html#a3f13159d2e93ecfd09823d8dca30f5d9" title="Invokes a bootstrap hook in all bootstrap modules that implement it.">bootstrap_invoke_all</a>(<span class="stringliteral">&#39;boot&#39;</span>);
<a name="l02417"></a>02417 
<a name="l02418"></a>02418   <span class="keywordflow">if</span> (!<a class="code" href="group__schemaapi_gac880b82ae302f9d15c64d264a269d1f4.html#gac880b82ae302f9d15c64d264a269d1f4" title="Detects whether the current script is running in a command-line environment.">drupal_is_cli</a>()) {
<a name="l02419"></a>02419     ob_start();
<a name="l02420"></a>02420     <a class="code" href="bootstrap_8inc_a05f3dc0377da7898b9cb53977c30cca6.html#a05f3dc0377da7898b9cb53977c30cca6" title="Sets HTTP headers in preparation for a page response.">drupal_page_header</a>();
<a name="l02421"></a>02421   }
<a name="l02422"></a>02422 }
<a name="l02423"></a>02423 
<a name="l02431"></a><a class="code" href="bootstrap_8inc_aef1090e39844ccfc688f9b93fd048d8d.html#aef1090e39844ccfc688f9b93fd048d8d">02431</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_aef1090e39844ccfc688f9b93fd048d8d.html#aef1090e39844ccfc688f9b93fd048d8d" title="Returns the current bootstrap phase for this Drupal process.">drupal_get_bootstrap_phase</a>() {
<a name="l02432"></a>02432   <span class="keywordflow">return</span> <a class="code" href="bootstrap_8inc_a8dcad7737ed560086bcdd9998a020a93.html#a8dcad7737ed560086bcdd9998a020a93" title="Ensures Drupal is bootstrapped to the specified phase.">drupal_bootstrap</a>();
<a name="l02433"></a>02433 }
<a name="l02434"></a>02434 
<a name="l02443"></a><a class="code" href="bootstrap_8inc_abdfb3ad2d4e0a21b9319296b2f4e25e2.html#abdfb3ad2d4e0a21b9319296b2f4e25e2">02443</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_abdfb3ad2d4e0a21b9319296b2f4e25e2.html#abdfb3ad2d4e0a21b9319296b2f4e25e2" title="Returns the test prefix if this is an internal request from SimpleTest.">drupal_valid_test_ua</a>() {
<a name="l02444"></a>02444   global <a class="code" href="default_8settings_8php_a75c981b07486dd3b07d5f122702dd87e.html#a75c981b07486dd3b07d5f122702dd87e" title="Salt for one-time login links and cancel links, form tokens, etc.">$drupal_hash_salt</a>;
<a name="l02445"></a>02445   <span class="comment">// No reason to reset this.</span>
<a name="l02446"></a>02446   <span class="keyword">static</span> $test_prefix;
<a name="l02447"></a>02447 
<a name="l02448"></a>02448   <span class="keywordflow">if</span> (isset($test_prefix)) {
<a name="l02449"></a>02449     <span class="keywordflow">return</span> $test_prefix;
<a name="l02450"></a>02450   }
<a name="l02451"></a>02451 
<a name="l02452"></a>02452   <span class="keywordflow">if</span> (isset($_SERVER[<span class="stringliteral">&#39;HTTP_USER_AGENT&#39;</span>]) &amp;&amp; preg_match(<span class="stringliteral">&quot;/^(simpletest\d+);(.+);(.+);(.+)$/&quot;</span>, $_SERVER[<span class="stringliteral">&#39;HTTP_USER_AGENT&#39;</span>], $matches)) {
<a name="l02453"></a>02453     list(, $prefix, $time, $salt, $hmac) = $matches;
<a name="l02454"></a>02454     $check_string =  $prefix . <span class="charliteral">&#39;;&#39;</span> . $time . <span class="charliteral">&#39;;&#39;</span> . $salt;
<a name="l02455"></a>02455     <span class="comment">// We use the salt from settings.php to make the HMAC key, since</span>
<a name="l02456"></a>02456     <span class="comment">// the database is not yet initialized and we can&#39;t access any Drupal variables.</span>
<a name="l02457"></a>02457     <span class="comment">// The file properties add more entropy not easily accessible to others.</span>
<a name="l02458"></a>02458     $key = $drupal_hash_salt . filectime(__FILE__) . fileinode(__FILE__);
<a name="l02459"></a>02459     $time_diff = <a class="code" href="bootstrap_8inc_a08bcd0b03e31c17fb7d58786bef2b7f4.html#a08bcd0b03e31c17fb7d58786bef2b7f4" title="Time of the current request in seconds elapsed since the Unix Epoch.">REQUEST_TIME</a> - $time;
<a name="l02460"></a>02460     <span class="comment">// Since we are making a local request a 5 second time window is allowed,</span>
<a name="l02461"></a>02461     <span class="comment">// and the HMAC must match.</span>
<a name="l02462"></a>02462     <span class="keywordflow">if</span> ($time_diff &gt;= 0 &amp;&amp; $time_diff &lt;= 5 &amp;&amp; $hmac == <a class="code" href="bootstrap_8inc_a677ac93b9fcba24a3ffeb02e08ca8e9a.html#a677ac93b9fcba24a3ffeb02e08ca8e9a" title="Calculates a base-64 encoded, URL-safe sha-256 hmac.">drupal_hmac_base64</a>($check_string, $key)) {
<a name="l02463"></a>02463       $test_prefix = $prefix;
<a name="l02464"></a>02464       <span class="keywordflow">return</span> $test_prefix;
<a name="l02465"></a>02465     }
<a name="l02466"></a>02466   }
<a name="l02467"></a>02467 
<a name="l02468"></a>02468   $test_prefix = FALSE;
<a name="l02469"></a>02469   <span class="keywordflow">return</span> $test_prefix;
<a name="l02470"></a>02470 }
<a name="l02471"></a>02471 
<a name="l02475"></a><a class="code" href="bootstrap_8inc_a58a494e2753af5f55a59dae53ceab3ac.html#a58a494e2753af5f55a59dae53ceab3ac">02475</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a58a494e2753af5f55a59dae53ceab3ac.html#a58a494e2753af5f55a59dae53ceab3ac" title="Generates a user agent string with a HMAC and timestamp for simpletest.">drupal_generate_test_ua</a>($prefix) {
<a name="l02476"></a>02476   global <a class="code" href="default_8settings_8php_a75c981b07486dd3b07d5f122702dd87e.html#a75c981b07486dd3b07d5f122702dd87e" title="Salt for one-time login links and cancel links, form tokens, etc.">$drupal_hash_salt</a>;
<a name="l02477"></a>02477   <span class="keyword">static</span> $key;
<a name="l02478"></a>02478 
<a name="l02479"></a>02479   <span class="keywordflow">if</span> (!isset($key)) {
<a name="l02480"></a>02480     <span class="comment">// We use the salt from settings.php to make the HMAC key, since</span>
<a name="l02481"></a>02481     <span class="comment">// the database is not yet initialized and we can&#39;t access any Drupal variables.</span>
<a name="l02482"></a>02482     <span class="comment">// The file properties add more entropy not easily accessible to others.</span>
<a name="l02483"></a>02483     $key = $drupal_hash_salt . filectime(__FILE__) . fileinode(__FILE__);
<a name="l02484"></a>02484   }
<a name="l02485"></a>02485   <span class="comment">// Generate a moderately secure HMAC based on the database credentials.</span>
<a name="l02486"></a>02486   $salt = uniqid(<span class="stringliteral">&#39;&#39;</span>, TRUE);
<a name="l02487"></a>02487   $check_string = $prefix . <span class="charliteral">&#39;;&#39;</span> . time() . <span class="charliteral">&#39;;&#39;</span> . $salt;
<a name="l02488"></a>02488   <span class="keywordflow">return</span> $check_string . <span class="charliteral">&#39;;&#39;</span> . <a class="code" href="bootstrap_8inc_a677ac93b9fcba24a3ffeb02e08ca8e9a.html#a677ac93b9fcba24a3ffeb02e08ca8e9a" title="Calculates a base-64 encoded, URL-safe sha-256 hmac.">drupal_hmac_base64</a>($check_string, $key);
<a name="l02489"></a>02489 }
<a name="l02490"></a>02490 
<a name="l02499"></a><a class="code" href="bootstrap_8inc_a861d3f7c553fe62829f6c0f2e4fe89e6.html#a861d3f7c553fe62829f6c0f2e4fe89e6">02499</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a861d3f7c553fe62829f6c0f2e4fe89e6.html#a861d3f7c553fe62829f6c0f2e4fe89e6" title="Enables use of the theme system without requiring database access.">drupal_maintenance_theme</a>() {
<a name="l02500"></a>02500   require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/theme.maintenance.inc&#39;</span>;
<a name="l02501"></a>02501   <a class="code" href="theme_8maintenance_8inc_a8f521a6aba04fc11935a874df3ad9f05.html#a8f521a6aba04fc11935a874df3ad9f05" title="Sets up the theming system for maintenance page.">_drupal_maintenance_theme</a>();
<a name="l02502"></a>02502 }
<a name="l02503"></a>02503 
<a name="l02518"></a><a class="code" href="bootstrap_8inc_a1b7e5fe865e978d10be87d3eb57e42f7.html#a1b7e5fe865e978d10be87d3eb57e42f7">02518</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a1b7e5fe865e978d10be87d3eb57e42f7.html#a1b7e5fe865e978d10be87d3eb57e42f7" title="Returns a simple 404 Not Found page.">drupal_fast_404</a>() {
<a name="l02519"></a>02519   $exclude_paths = <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;404_fast_paths_exclude&#39;</span>, FALSE);
<a name="l02520"></a>02520   <span class="keywordflow">if</span> ($exclude_paths &amp;&amp; !preg_match($exclude_paths, $_GET[<span class="charliteral">&#39;q&#39;</span>])) {
<a name="l02521"></a>02521     $fast_paths = <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;404_fast_paths&#39;</span>, FALSE);
<a name="l02522"></a>02522     <span class="keywordflow">if</span> ($fast_paths &amp;&amp; preg_match($fast_paths, $_GET[<span class="charliteral">&#39;q&#39;</span>])) {
<a name="l02523"></a>02523       <a class="code" href="bootstrap_8inc_ad4ff2b2cf5a2fb632c2c869bc1a5a70f.html#ad4ff2b2cf5a2fb632c2c869bc1a5a70f" title="Sets an HTTP response header for the current page.">drupal_add_http_header</a>(<span class="stringliteral">&#39;Status&#39;</span>, <span class="stringliteral">&#39;404 Not Found&#39;</span>);
<a name="l02524"></a>02524       $fast_404_html = <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;404_fast_html&#39;</span>, <span class="stringliteral">&#39;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Not Found&lt;/h1&gt;&lt;p&gt;The requested URL &quot;@path&quot; was not found on this server.&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span>);
<a name="l02525"></a>02525       <span class="comment">// Replace @path in the variable with the page path.</span>
<a name="l02526"></a>02526       print strtr($fast_404_html, array(<span class="stringliteral">&#39;@path&#39;</span> =&gt; <a class="code" href="group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d.html#ga76fc67a30fd8d75ddd80565e6e65a13d" title="Encodes special characters in a plain-text string for display as HTML.">check_plain</a>(<a class="code" href="bootstrap_8inc_a80b52d5331d840440b5e3dfe82dd7ea2.html#a80b52d5331d840440b5e3dfe82dd7ea2" title="Returns the equivalent of Apache&#39;s $_SERVER[&#39;REQUEST_URI&#39;] variable.">request_uri</a>())));
<a name="l02527"></a>02527       exit;
<a name="l02528"></a>02528     }
<a name="l02529"></a>02529   }
<a name="l02530"></a>02530 }
<a name="l02531"></a>02531 
<a name="l02535"></a><a class="code" href="bootstrap_8inc_ac9902394c447118612c3a71191151f2c.html#ac9902394c447118612c3a71191151f2c">02535</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_ac9902394c447118612c3a71191151f2c.html#ac9902394c447118612c3a71191151f2c" title="Returns TRUE if a Drupal installation is currently being attempted.">drupal_installation_attempted</a>() {
<a name="l02536"></a>02536   <span class="keywordflow">return</span> defined(<span class="stringliteral">&#39;MAINTENANCE_MODE&#39;</span>) &amp;&amp; <a class="code" href="authorize_8php_a5bf6dfe9ba7ee16c648e3932aa76535d.html#a5bf6dfe9ba7ee16c648e3932aa76535d" title="Global flag to identify update.php and authorize.php runs, and so avoid various unwanted operations...">MAINTENANCE_MODE</a> == <span class="stringliteral">&#39;install&#39;</span>;
<a name="l02537"></a>02537 }
<a name="l02538"></a>02538 
<a name="l02565"></a><a class="code" href="group__sanitization_gaa50232f577883a48731fc93530628a79.html#gaa50232f577883a48731fc93530628a79">02565</a> <span class="keyword">function</span> <a class="code" href="group__sanitization_gaa50232f577883a48731fc93530628a79.html#gaa50232f577883a48731fc93530628a79" title="Returns the name of the proper localization function.">get_t</a>() {
<a name="l02566"></a>02566   <span class="keyword">static</span> $t;
<a name="l02567"></a>02567   <span class="comment">// This is not converted to drupal_static because there is no point in</span>
<a name="l02568"></a>02568   <span class="comment">// resetting this as it can not change in the course of a request.</span>
<a name="l02569"></a>02569   <span class="keywordflow">if</span> (!isset($t)) {
<a name="l02570"></a>02570     $t = <a class="code" href="bootstrap_8inc_ac9902394c447118612c3a71191151f2c.html#ac9902394c447118612c3a71191151f2c" title="Returns TRUE if a Drupal installation is currently being attempted.">drupal_installation_attempted</a>() ? <span class="stringliteral">&#39;st&#39;</span> : <span class="charliteral">&#39;t&#39;</span>;
<a name="l02571"></a>02571   }
<a name="l02572"></a>02572   <span class="keywordflow">return</span> $t;
<a name="l02573"></a>02573 }
<a name="l02574"></a>02574 
<a name="l02578"></a><a class="code" href="bootstrap_8inc_a8abdce8019511ce4a74d3d9b48a93717.html#a8abdce8019511ce4a74d3d9b48a93717">02578</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a8abdce8019511ce4a74d3d9b48a93717.html#a8abdce8019511ce4a74d3d9b48a93717" title="Initializes all the defined language types.">drupal_language_initialize</a>() {
<a name="l02579"></a>02579   $types = <a class="code" href="bootstrap_8inc_ad541772a6e26f013b31257ee589979d5.html#ad541772a6e26f013b31257ee589979d5" title="Returns an array of the available language types.">language_types</a>();
<a name="l02580"></a>02580 
<a name="l02581"></a>02581   <span class="comment">// Ensure the language is correctly returned, even without multilanguage</span>
<a name="l02582"></a>02582   <span class="comment">// support. Also make sure we have a $language fallback, in case a language</span>
<a name="l02583"></a>02583   <span class="comment">// negotiation callback needs to do a full bootstrap.</span>
<a name="l02584"></a>02584   <span class="comment">// Useful for eg. XML/HTML &#39;lang&#39; attributes.</span>
<a name="l02585"></a>02585   $default = <a class="code" href="bootstrap_8inc_a336c0878074791056c62640cd95d8067.html#a336c0878074791056c62640cd95d8067" title="Returns the default language used on the site.">language_default</a>();
<a name="l02586"></a>02586   <span class="keywordflow">foreach</span> ($types as $type) {
<a name="l02587"></a>02587     $GLOBALS[$type] = $default;
<a name="l02588"></a>02588   }
<a name="l02589"></a>02589   <span class="keywordflow">if</span> (<a class="code" href="bootstrap_8inc_ae1a2f0f465079ac3f1767b8c14553582.html#ae1a2f0f465079ac3f1767b8c14553582" title="Returns TRUE if there is more than one language enabled.">drupal_multilingual</a>()) {
<a name="l02590"></a>02590     include_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/language.inc&#39;</span>;
<a name="l02591"></a>02591     <span class="keywordflow">foreach</span> ($types as $type) {
<a name="l02592"></a>02592       $GLOBALS[$type] = <a class="code" href="language_8inc_a483a318f6485628cbe7bdbf53bf80c5e.html#a483a318f6485628cbe7bdbf53bf80c5e" title="Choose a language for the given type based on language negotiation settings.">language_initialize</a>($type);
<a name="l02593"></a>02593     }
<a name="l02594"></a>02594     <span class="comment">// Allow modules to react on language system initialization in multilingual</span>
<a name="l02595"></a>02595     <span class="comment">// environments.</span>
<a name="l02596"></a>02596     <a class="code" href="bootstrap_8inc_a3f13159d2e93ecfd09823d8dca30f5d9.html#a3f13159d2e93ecfd09823d8dca30f5d9" title="Invokes a bootstrap hook in all bootstrap modules that implement it.">bootstrap_invoke_all</a>(<span class="stringliteral">&#39;language_init&#39;</span>);
<a name="l02597"></a>02597   }
<a name="l02598"></a>02598 }
<a name="l02599"></a>02599 
<a name="l02607"></a><a class="code" href="bootstrap_8inc_a663476297a1e5f0b01dd2e063757392a.html#a663476297a1e5f0b01dd2e063757392a">02607</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a663476297a1e5f0b01dd2e063757392a.html#a663476297a1e5f0b01dd2e063757392a" title="Returns a list of the built-in language types.">drupal_language_types</a>() {
<a name="l02608"></a>02608   <span class="keywordflow">return</span> array(
<a name="l02609"></a>02609     <a class="code" href="bootstrap_8inc_adcc8b40b0d1ee5cd37f1c7314cc541dc.html#adcc8b40b0d1ee5cd37f1c7314cc541dc" title="The type of language used to select the user interface.">LANGUAGE_TYPE_INTERFACE</a> =&gt; TRUE,
<a name="l02610"></a>02610     <a class="code" href="bootstrap_8inc_a40466aefcfc6ea9766f1fedf53cb3a6d.html#a40466aefcfc6ea9766f1fedf53cb3a6d" title="The type of language used to define the content language.">LANGUAGE_TYPE_CONTENT</a> =&gt; FALSE,
<a name="l02611"></a>02611     <a class="code" href="bootstrap_8inc_aa234a385123b721683deb3bcbf072635.html#aa234a385123b721683deb3bcbf072635" title="The type of language used for URLs.">LANGUAGE_TYPE_URL</a> =&gt; FALSE,
<a name="l02612"></a>02612   );
<a name="l02613"></a>02613 }
<a name="l02614"></a>02614 
<a name="l02618"></a><a class="code" href="bootstrap_8inc_ae1a2f0f465079ac3f1767b8c14553582.html#ae1a2f0f465079ac3f1767b8c14553582">02618</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_ae1a2f0f465079ac3f1767b8c14553582.html#ae1a2f0f465079ac3f1767b8c14553582" title="Returns TRUE if there is more than one language enabled.">drupal_multilingual</a>() {
<a name="l02619"></a>02619   <span class="comment">// The &quot;language_count&quot; variable stores the number of enabled languages to</span>
<a name="l02620"></a>02620   <span class="comment">// avoid unnecessarily querying the database when building the list of</span>
<a name="l02621"></a>02621   <span class="comment">// enabled languages on monolingual sites.</span>
<a name="l02622"></a>02622   <span class="keywordflow">return</span> <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;language_count&#39;</span>, 1) &gt; 1;
<a name="l02623"></a>02623 }
<a name="l02624"></a>02624 
<a name="l02628"></a><a class="code" href="bootstrap_8inc_ad541772a6e26f013b31257ee589979d5.html#ad541772a6e26f013b31257ee589979d5">02628</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_ad541772a6e26f013b31257ee589979d5.html#ad541772a6e26f013b31257ee589979d5" title="Returns an array of the available language types.">language_types</a>() {
<a name="l02629"></a>02629   <span class="keywordflow">return</span> array_keys(<a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;language_types&#39;</span>, <a class="code" href="bootstrap_8inc_a663476297a1e5f0b01dd2e063757392a.html#a663476297a1e5f0b01dd2e063757392a" title="Returns a list of the built-in language types.">drupal_language_types</a>()));
<a name="l02630"></a>02630 }
<a name="l02631"></a>02631 
<a name="l02646"></a><a class="code" href="bootstrap_8inc_aec69f67dd1921a3b55d7f9de9034ecb4.html#aec69f67dd1921a3b55d7f9de9034ecb4">02646</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_aec69f67dd1921a3b55d7f9de9034ecb4.html#aec69f67dd1921a3b55d7f9de9034ecb4" title="Returns a list of installed languages, indexed by the specified key.">language_list</a>($field = <span class="stringliteral">&#39;language&#39;</span>) {
<a name="l02647"></a>02647   $languages = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__);
<a name="l02648"></a>02648   <span class="comment">// Init language list</span>
<a name="l02649"></a>02649   <span class="keywordflow">if</span> (!isset($languages)) {
<a name="l02650"></a>02650     <span class="keywordflow">if</span> (<a class="code" href="bootstrap_8inc_ae1a2f0f465079ac3f1767b8c14553582.html#ae1a2f0f465079ac3f1767b8c14553582" title="Returns TRUE if there is more than one language enabled.">drupal_multilingual</a>() || <a class="code" href="module_8inc_a83bfe4eac372da50ff3eaf949b1b6ff8.html#a83bfe4eac372da50ff3eaf949b1b6ff8" title="Determine whether a given module exists.">module_exists</a>(<span class="stringliteral">&#39;locale&#39;</span>)) {
<a name="l02651"></a>02651       $languages[<span class="stringliteral">&#39;language&#39;</span>] = <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&#39;SELECT * FROM {languages} ORDER BY weight ASC, name ASC&#39;</span>)-&gt;fetchAllAssoc(<span class="stringliteral">&#39;language&#39;</span>);
<a name="l02652"></a>02652       <span class="comment">// Users cannot uninstall the native English language. However, we allow</span>
<a name="l02653"></a>02653       <span class="comment">// it to be hidden from the installed languages. Therefore, at least one</span>
<a name="l02654"></a>02654       <span class="comment">// other language must be enabled then.</span>
<a name="l02655"></a>02655       <span class="keywordflow">if</span> (!$languages[<span class="stringliteral">&#39;language&#39;</span>][<span class="stringliteral">&#39;en&#39;</span>]-&gt;enabled &amp;&amp; !<a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;language_native_enabled&#39;</span>, TRUE)) {
<a name="l02656"></a>02656         unset($languages[<span class="stringliteral">&#39;language&#39;</span>][<span class="stringliteral">&#39;en&#39;</span>]);
<a name="l02657"></a>02657       }
<a name="l02658"></a>02658     }
<a name="l02659"></a>02659     <span class="keywordflow">else</span> {
<a name="l02660"></a>02660       <span class="comment">// No locale module, so use the default language only.</span>
<a name="l02661"></a>02661       $default = <a class="code" href="bootstrap_8inc_a336c0878074791056c62640cd95d8067.html#a336c0878074791056c62640cd95d8067" title="Returns the default language used on the site.">language_default</a>();
<a name="l02662"></a>02662       $languages[<span class="stringliteral">&#39;language&#39;</span>][$default-&gt;language] = $default;
<a name="l02663"></a>02663     }
<a name="l02664"></a>02664   }
<a name="l02665"></a>02665 
<a name="l02666"></a>02666   <span class="comment">// Return the array indexed by the right field</span>
<a name="l02667"></a>02667   <span class="keywordflow">if</span> (!isset($languages[$field])) {
<a name="l02668"></a>02668     $languages[$field] = array();
<a name="l02669"></a>02669     <span class="keywordflow">foreach</span> ($languages[<span class="stringliteral">&#39;language&#39;</span>] as $lang) {
<a name="l02670"></a>02670       <span class="comment">// Some values should be collected into an array</span>
<a name="l02671"></a>02671       <span class="keywordflow">if</span> (in_array($field, array(<span class="stringliteral">&#39;enabled&#39;</span>, <span class="stringliteral">&#39;weight&#39;</span>))) {
<a name="l02672"></a>02672         $languages[$field][$lang-&gt;$field][$lang-&gt;language] = $lang;
<a name="l02673"></a>02673       }
<a name="l02674"></a>02674       <span class="keywordflow">else</span> {
<a name="l02675"></a>02675         $languages[$field][$lang-&gt;$field] = $lang;
<a name="l02676"></a>02676       }
<a name="l02677"></a>02677     }
<a name="l02678"></a>02678   }
<a name="l02679"></a>02679   <span class="keywordflow">return</span> $languages[$field];
<a name="l02680"></a>02680 }
<a name="l02681"></a>02681 
<a name="l02688"></a><a class="code" href="bootstrap_8inc_a336c0878074791056c62640cd95d8067.html#a336c0878074791056c62640cd95d8067">02688</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a336c0878074791056c62640cd95d8067.html#a336c0878074791056c62640cd95d8067" title="Returns the default language used on the site.">language_default</a>($property = NULL) {
<a name="l02689"></a>02689   $language = <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;language_default&#39;</span>, (<span class="keywordtype">object</span>) array(<span class="stringliteral">&#39;language&#39;</span> =&gt; <span class="stringliteral">&#39;en&#39;</span>, <span class="stringliteral">&#39;name&#39;</span> =&gt; <span class="stringliteral">&#39;English&#39;</span>, <span class="stringliteral">&#39;native&#39;</span> =&gt; <span class="stringliteral">&#39;English&#39;</span>, <span class="stringliteral">&#39;direction&#39;</span> =&gt; 0, <span class="stringliteral">&#39;enabled&#39;</span> =&gt; 1, <span class="stringliteral">&#39;plurals&#39;</span> =&gt; 0, <span class="stringliteral">&#39;formula&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;domain&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;prefix&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;weight&#39;</span> =&gt; 0, <span class="stringliteral">&#39;javascript&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>));
<a name="l02690"></a>02690   <span class="keywordflow">return</span> $property ? $language-&gt;$property : $language;
<a name="l02691"></a>02691 }
<a name="l02692"></a>02692 
<a name="l02710"></a><a class="code" href="bootstrap_8inc_a58aae06c8c4282de3a6e292353bac1c0.html#a58aae06c8c4282de3a6e292353bac1c0">02710</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_a58aae06c8c4282de3a6e292353bac1c0.html#a58aae06c8c4282de3a6e292353bac1c0" title="Returns the requested URL path of the page being viewed.">request_path</a>() {
<a name="l02711"></a>02711   <span class="keyword">static</span> $path;
<a name="l02712"></a>02712 
<a name="l02713"></a>02713   <span class="keywordflow">if</span> (isset($path)) {
<a name="l02714"></a>02714     <span class="keywordflow">return</span> $path;
<a name="l02715"></a>02715   }
<a name="l02716"></a>02716 
<a name="l02717"></a>02717   <span class="keywordflow">if</span> (isset($_GET[<span class="charliteral">&#39;q&#39;</span>]) &amp;&amp; is_string($_GET[<span class="charliteral">&#39;q&#39;</span>])) {
<a name="l02718"></a>02718     <span class="comment">// This is a request with a ?q=foo/bar query string. $_GET[&#39;q&#39;] is</span>
<a name="l02719"></a>02719     <span class="comment">// overwritten in drupal_path_initialize(), but request_path() is called</span>
<a name="l02720"></a>02720     <span class="comment">// very early in the bootstrap process, so the original value is saved in</span>
<a name="l02721"></a>02721     <span class="comment">// $path and returned in later calls.</span>
<a name="l02722"></a>02722     $path = $_GET[<span class="charliteral">&#39;q&#39;</span>];
<a name="l02723"></a>02723   }
<a name="l02724"></a>02724   elseif (isset($_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>])) {
<a name="l02725"></a>02725     <span class="comment">// This request is either a clean URL, or &#39;index.php&#39;, or nonsense.</span>
<a name="l02726"></a>02726     <span class="comment">// Extract the path from REQUEST_URI.</span>
<a name="l02727"></a>02727     $request_path = strtok($_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>], <span class="charliteral">&#39;?&#39;</span>);
<a name="l02728"></a>02728     $base_path_len = strlen(rtrim(dirname($_SERVER[<span class="stringliteral">&#39;SCRIPT_NAME&#39;</span>]), <span class="charliteral">&#39;\/&#39;</span>));
<a name="l02729"></a>02729     <span class="comment">// Unescape and strip $base_path prefix, leaving q without a leading slash.</span>
<a name="l02730"></a>02730     $path = substr(urldecode($request_path), $base_path_len + 1);
<a name="l02731"></a>02731     <span class="comment">// If the path equals the script filename, either because &#39;index.php&#39; was</span>
<a name="l02732"></a>02732     <span class="comment">// explicitly provided in the URL, or because the server added it to</span>
<a name="l02733"></a>02733     <span class="comment">// $_SERVER[&#39;REQUEST_URI&#39;] even when it wasn&#39;t provided in the URL (some</span>
<a name="l02734"></a>02734     <span class="comment">// versions of Microsoft IIS do this), the front page should be served.</span>
<a name="l02735"></a>02735     <span class="keywordflow">if</span> ($path == basename($_SERVER[<span class="stringliteral">&#39;PHP_SELF&#39;</span>])) {
<a name="l02736"></a>02736       $path = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02737"></a>02737     }
<a name="l02738"></a>02738   }
<a name="l02739"></a>02739   <span class="keywordflow">else</span> {
<a name="l02740"></a>02740     <span class="comment">// This is the front page.</span>
<a name="l02741"></a>02741     $path = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02742"></a>02742   }
<a name="l02743"></a>02743 
<a name="l02744"></a>02744   <span class="comment">// Under certain conditions Apache&#39;s RewriteRule directive prepends the value</span>
<a name="l02745"></a>02745   <span class="comment">// assigned to $_GET[&#39;q&#39;] with a slash. Moreover we can always have a trailing</span>
<a name="l02746"></a>02746   <span class="comment">// slash in place, hence we need to normalize $_GET[&#39;q&#39;].</span>
<a name="l02747"></a>02747   $path = trim($path, <span class="charliteral">&#39;/&#39;</span>);
<a name="l02748"></a>02748 
<a name="l02749"></a>02749   <span class="keywordflow">return</span> $path;
<a name="l02750"></a>02750 }
<a name="l02751"></a>02751 
<a name="l02775"></a><a class="code" href="bootstrap_8inc_afd40bf1dc5dc1f68fb326a8f6e0b88da.html#afd40bf1dc5dc1f68fb326a8f6e0b88da">02775</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_afd40bf1dc5dc1f68fb326a8f6e0b88da.html#afd40bf1dc5dc1f68fb326a8f6e0b88da" title="Returns a component of the current Drupal path.">arg</a>($index = NULL, $path = NULL) {
<a name="l02776"></a>02776   <span class="comment">// Even though $arguments doesn&#39;t need to be resettable for any functional</span>
<a name="l02777"></a>02777   <span class="comment">// reasons (the result of explode() does not depend on any run-time</span>
<a name="l02778"></a>02778   <span class="comment">// information), it should be resettable anyway in case a module needs to</span>
<a name="l02779"></a>02779   <span class="comment">// free up the memory used by it.</span>
<a name="l02780"></a>02780   <span class="comment">// Use the advanced drupal_static() pattern, since this is called very often.</span>
<a name="l02781"></a>02781   <span class="keyword">static</span> $drupal_static_fast;
<a name="l02782"></a>02782   <span class="keywordflow">if</span> (!isset($drupal_static_fast)) {
<a name="l02783"></a>02783     $drupal_static_fast[<span class="stringliteral">&#39;arguments&#39;</span>] = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__);
<a name="l02784"></a>02784   }
<a name="l02785"></a>02785   $arguments = &amp;$drupal_static_fast[<span class="stringliteral">&#39;arguments&#39;</span>];
<a name="l02786"></a>02786 
<a name="l02787"></a>02787   <span class="keywordflow">if</span> (!isset($path)) {
<a name="l02788"></a>02788     $path = $_GET[<span class="charliteral">&#39;q&#39;</span>];
<a name="l02789"></a>02789   }
<a name="l02790"></a>02790   <span class="keywordflow">if</span> (!isset($arguments[$path])) {
<a name="l02791"></a>02791     $arguments[$path] = explode(<span class="charliteral">&#39;/&#39;</span>, $path);
<a name="l02792"></a>02792   }
<a name="l02793"></a>02793   <span class="keywordflow">if</span> (!isset($index)) {
<a name="l02794"></a>02794     <span class="keywordflow">return</span> $arguments[$path];
<a name="l02795"></a>02795   }
<a name="l02796"></a>02796   <span class="keywordflow">if</span> (isset($arguments[$path][$index])) {
<a name="l02797"></a>02797     <span class="keywordflow">return</span> $arguments[$path][$index];
<a name="l02798"></a>02798   }
<a name="l02799"></a>02799 }
<a name="l02800"></a>02800 
<a name="l02813"></a><a class="code" href="bootstrap_8inc_aec2f772317b4fb79cc696412c2e455c3.html#aec2f772317b4fb79cc696412c2e455c3">02813</a> <span class="keyword">function</span> <a class="code" href="bootstrap_8inc_aec2f772317b4fb79cc696412c2e455c3.html#aec2f772317b4fb79cc696412c2e455c3" title="Returns the IP address of the client machine.">ip_address</a>() {
<a name="l02814"></a>02814   $ip_address = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__);
<a name="l02815"></a>02815 
<a name="l02816"></a>02816   <span class="keywordflow">if</span> (!isset($ip_address)) {
<a name="l02817"></a>02817     $ip_address = $_SERVER[<span class="stringliteral">&#39;REMOTE_ADDR&#39;</span>];
<a name="l02818"></a>02818 
<a name="l02819"></a>02819     <span class="keywordflow">if</span> (<a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;reverse_proxy&#39;</span>, 0)) {
<a name="l02820"></a>02820       $reverse_proxy_header = <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;reverse_proxy_header&#39;</span>, <span class="stringliteral">&#39;HTTP_X_FORWARDED_FOR&#39;</span>);
<a name="l02821"></a>02821       <span class="keywordflow">if</span> (!empty($_SERVER[$reverse_proxy_header])) {
<a name="l02822"></a>02822         <span class="comment">// If an array of known reverse proxy IPs is provided, then trust</span>
<a name="l02823"></a>02823         <span class="comment">// the XFF header if request really comes from one of them.</span>
<a name="l02824"></a>02824         $reverse_proxy_addresses = <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;reverse_proxy_addresses&#39;</span>, array());
<a name="l02825"></a>02825 
<a name="l02826"></a>02826         <span class="comment">// Turn XFF header into an array.</span>
<a name="l02827"></a>02827         $forwarded = explode(<span class="charliteral">&#39;,&#39;</span>, $_SERVER[$reverse_proxy_header]);
<a name="l02828"></a>02828 
<a name="l02829"></a>02829         <span class="comment">// Trim the forwarded IPs; they may have been delimited by commas and spaces.</span>
<a name="l02830"></a>02830         $forwarded = array_map(<span class="stringliteral">&#39;trim&#39;</span>, $forwarded);
<a name="l02831"></a>02831 
<a name="l02832"></a>02832         <span class="comment">// Tack direct client IP onto end of forwarded array.</span>
<a name="l02833"></a>02833         $forwarded[] = $ip_address;
<a name="l02834"></a>02834 
<a name="l02835"></a>02835         <span class="comment">// Eliminate all trusted IPs.</span>
<a name="l02836"></a>02836         $untrusted = array_diff($forwarded, $reverse_proxy_addresses);
<a name="l02837"></a>02837 
<a name="l02838"></a>02838         <span class="comment">// The right-most IP is the most specific we can trust.</span>
<a name="l02839"></a>02839         $ip_address = array_pop($untrusted);
<a name="l02840"></a>02840       }
<a name="l02841"></a>02841     }
<a name="l02842"></a>02842   }
<a name="l02843"></a>02843 
<a name="l02844"></a>02844   <span class="keywordflow">return</span> $ip_address;
<a name="l02845"></a>02845 }
<a name="l02846"></a>02846 
<a name="l02863"></a><a class="code" href="group__schemaapi_ga979670bd6bd2e34337ffc5f0810f2d71.html#ga979670bd6bd2e34337ffc5f0810f2d71">02863</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga979670bd6bd2e34337ffc5f0810f2d71.html#ga979670bd6bd2e34337ffc5f0810f2d71" title="Gets the schema definition of a table, or the whole database schema.">drupal_get_schema</a>($table = NULL, $rebuild = FALSE) {
<a name="l02864"></a>02864   <span class="keyword">static</span> $schema;
<a name="l02865"></a>02865 
<a name="l02866"></a>02866   <span class="keywordflow">if</span> ($rebuild || !isset($table)) {
<a name="l02867"></a>02867     $schema = <a class="code" href="group__schemaapi_ga31cee7d4c13fafc15c69304f16e34686.html#ga31cee7d4c13fafc15c69304f16e34686" title="Gets the whole database schema.">drupal_get_complete_schema</a>($rebuild);
<a name="l02868"></a>02868   }
<a name="l02869"></a>02869   elseif (!isset($schema)) {
<a name="l02870"></a>02870     $schema = <span class="keyword">new</span> <a class="code" href="classSchemaCache.html" title="Extends DrupalCacheArray to allow for dynamic building of the schema cache.">SchemaCache</a>();
<a name="l02871"></a>02871   }
<a name="l02872"></a>02872 
<a name="l02873"></a>02873   <span class="keywordflow">if</span> (!isset($table)) {
<a name="l02874"></a>02874     <span class="keywordflow">return</span> $schema;
<a name="l02875"></a>02875   }
<a name="l02876"></a>02876   <span class="keywordflow">if</span> (isset($schema[$table])) {
<a name="l02877"></a>02877     <span class="keywordflow">return</span> $schema[$table];
<a name="l02878"></a>02878   }
<a name="l02879"></a>02879   <span class="keywordflow">else</span> {
<a name="l02880"></a>02880     <span class="keywordflow">return</span> FALSE;
<a name="l02881"></a>02881   }
<a name="l02882"></a>02882 }
<a name="l02883"></a>02883 
<a name="l02887"></a><a class="code" href="classSchemaCache.html">02887</a> <span class="keyword">class </span><a class="code" href="classSchemaCache.html" title="Extends DrupalCacheArray to allow for dynamic building of the schema cache.">SchemaCache</a> <span class="keyword">extends</span> <a class="code" href="classDrupalCacheArray.html" title="Provides a caching wrapper to be used in place of large array structures.">DrupalCacheArray</a> {
<a name="l02888"></a>02888 
<a name="l02892"></a><a class="code" href="group__schemaapi_gada562761e010404178ae0e0b29caf163.html#gada562761e010404178ae0e0b29caf163">02892</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="group__schemaapi_gada562761e010404178ae0e0b29caf163.html#gada562761e010404178ae0e0b29caf163" title="Constructs a SchemaCache object.">__construct</a>() {
<a name="l02893"></a>02893     <span class="comment">// Cache by request method.</span>
<a name="l02894"></a>02894     <a class="code" href="group__schemaapi_gada562761e010404178ae0e0b29caf163.html#gada562761e010404178ae0e0b29caf163" title="Constructs a SchemaCache object.">parent::__construct</a>(<span class="stringliteral">&#39;schema:runtime:&#39;</span> . ($_SERVER[<span class="stringliteral">&#39;REQUEST_METHOD&#39;</span>] == <span class="stringliteral">&#39;GET&#39;</span>), <span class="stringliteral">&#39;cache&#39;</span>);
<a name="l02895"></a>02895   }
<a name="l02896"></a>02896 
<a name="l02900"></a><a class="code" href="group__schemaapi_gadb0a973c0269c37d3389946d5b57c01c.html#gadb0a973c0269c37d3389946d5b57c01c">02900</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="group__schemaapi_gadb0a973c0269c37d3389946d5b57c01c.html#gadb0a973c0269c37d3389946d5b57c01c" title="Overrides DrupalCacheArray::resolveCacheMiss().">resolveCacheMiss</a>($offset) {
<a name="l02901"></a>02901     $complete_schema = <a class="code" href="group__schemaapi_ga31cee7d4c13fafc15c69304f16e34686.html#ga31cee7d4c13fafc15c69304f16e34686" title="Gets the whole database schema.">drupal_get_complete_schema</a>();
<a name="l02902"></a>02902     $value = isset($complete_schema[$offset]) ? $complete_schema[$offset] :  NULL;
<a name="l02903"></a>02903     $this-&gt;storage[$offset] = $value;
<a name="l02904"></a>02904     $this-&gt;<a class="code" href="group__schemaapi_ga27687007f42979bdb8999683f3270c4a.html#ga27687007f42979bdb8999683f3270c4a" title="Flags an offset value to be written to the persistent cache.">persist</a>($offset);
<a name="l02905"></a>02905     <span class="keywordflow">return</span> $value;
<a name="l02906"></a>02906   }
<a name="l02907"></a>02907 }
<a name="l02908"></a>02908 
<a name="l02918"></a><a class="code" href="group__schemaapi_ga31cee7d4c13fafc15c69304f16e34686.html#ga31cee7d4c13fafc15c69304f16e34686">02918</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga31cee7d4c13fafc15c69304f16e34686.html#ga31cee7d4c13fafc15c69304f16e34686" title="Gets the whole database schema.">drupal_get_complete_schema</a>($rebuild = FALSE) {
<a name="l02919"></a>02919   <span class="keyword">static</span> $schema = array();
<a name="l02920"></a>02920 
<a name="l02921"></a>02921   <span class="keywordflow">if</span> (empty($schema) || $rebuild) {
<a name="l02922"></a>02922     <span class="comment">// Try to load the schema from cache.</span>
<a name="l02923"></a>02923     <span class="keywordflow">if</span> (!$rebuild &amp;&amp; $cached = <a class="code" href="cache_8inc_a9d873815c28909b61c3a6188b383f8a3.html#a9d873815c28909b61c3a6188b383f8a3" title="Returns data from the persistent cache.">cache_get</a>(<span class="stringliteral">&#39;schema&#39;</span>)) {
<a name="l02924"></a>02924       $schema = $cached-&gt;data;
<a name="l02925"></a>02925     }
<a name="l02926"></a>02926     <span class="comment">// Otherwise, rebuild the schema cache.</span>
<a name="l02927"></a>02927     <span class="keywordflow">else</span> {
<a name="l02928"></a>02928       $schema = array();
<a name="l02929"></a>02929       <span class="comment">// Load the .install files to get hook_schema.</span>
<a name="l02930"></a>02930       <span class="comment">// On some databases this function may be called before bootstrap has</span>
<a name="l02931"></a>02931       <span class="comment">// been completed, so we force the functions we need to load just in case.</span>
<a name="l02932"></a>02932       <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;module_load_all_includes&#39;</span>)) {
<a name="l02933"></a>02933         <span class="comment">// This function can be called very early in the bootstrap process, so</span>
<a name="l02934"></a>02934         <span class="comment">// we force the module_list() cache to be refreshed to ensure that it</span>
<a name="l02935"></a>02935         <span class="comment">// contains the complete list of modules before we go on to call</span>
<a name="l02936"></a>02936         <span class="comment">// module_load_all_includes().</span>
<a name="l02937"></a>02937         <a class="code" href="module_8inc_ad4ef444bbb8e56724e12908cf9b6e1aa.html#ad4ef444bbb8e56724e12908cf9b6e1aa" title="Returns a list of currently active modules.">module_list</a>(TRUE);
<a name="l02938"></a>02938         <a class="code" href="module_8inc_a4e2123e44529b4d307fc1ac78519e966.html#a4e2123e44529b4d307fc1ac78519e966" title="Load an include file for each of the modules that have been enabled in the system table...">module_load_all_includes</a>(<span class="stringliteral">&#39;install&#39;</span>);
<a name="l02939"></a>02939       }
<a name="l02940"></a>02940 
<a name="l02941"></a>02941       require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/common.inc&#39;</span>;
<a name="l02942"></a>02942       <span class="comment">// Invoke hook_schema for all modules.</span>
<a name="l02943"></a>02943       <span class="keywordflow">foreach</span> (<a class="code" href="group__hooks_ga9191200072f2a641829e9d3c2759561f.html#ga9191200072f2a641829e9d3c2759561f" title="Determine which modules are implementing a hook.">module_implements</a>(<span class="stringliteral">&#39;schema&#39;</span>) as $module) {
<a name="l02944"></a>02944         <span class="comment">// Cast the result of hook_schema() to an array, as a NULL return value</span>
<a name="l02945"></a>02945         <span class="comment">// would cause array_merge() to set the $schema variable to NULL as well.</span>
<a name="l02946"></a>02946         <span class="comment">// That would break modules which use $schema further down the line.</span>
<a name="l02947"></a>02947         $current = (array) <a class="code" href="group__hooks_ga7547905cff161d057f9e71088ec67f05.html#ga7547905cff161d057f9e71088ec67f05" title="Invoke a hook in a particular module.">module_invoke</a>($module, <span class="stringliteral">&#39;schema&#39;</span>);
<a name="l02948"></a>02948         <span class="comment">// Set &#39;module&#39; and &#39;name&#39; keys for each table, and remove descriptions,</span>
<a name="l02949"></a>02949         <span class="comment">// as they needlessly slow down cache_get() for every single request.</span>
<a name="l02950"></a>02950         <a class="code" href="group__schemaapi_gad4ce891e1e944b1d6eee7253448a0178.html#gad4ce891e1e944b1d6eee7253448a0178" title="Fills in required default values for table definitions from hook_schema().">_drupal_schema_initialize</a>($current, $module);
<a name="l02951"></a>02951         $schema = array_merge($schema, $current);
<a name="l02952"></a>02952       }
<a name="l02953"></a>02953 
<a name="l02954"></a>02954       <a class="code" href="module_8inc_a9badfa1d68b90764aa160aee0e58b4ef.html#a9badfa1d68b90764aa160aee0e58b4ef" title="Hands off alterable variables to type-specific *_alter implementations.">drupal_alter</a>(<span class="stringliteral">&#39;schema&#39;</span>, $schema);
<a name="l02955"></a>02955       <span class="comment">// If the schema is empty, avoid saving it: some database engines require</span>
<a name="l02956"></a>02956       <span class="comment">// the schema to perform queries, and this could lead to infinite loops.</span>
<a name="l02957"></a>02957       <span class="keywordflow">if</span> (!empty($schema) &amp;&amp; (<a class="code" href="bootstrap_8inc_aef1090e39844ccfc688f9b93fd048d8d.html#aef1090e39844ccfc688f9b93fd048d8d" title="Returns the current bootstrap phase for this Drupal process.">drupal_get_bootstrap_phase</a>() == <a class="code" href="bootstrap_8inc_a2c8ac509af1924cf2fa7420a22e1b048.html#a2c8ac509af1924cf2fa7420a22e1b048" title="Final bootstrap phase: Drupal is fully loaded; validate and fix input data.">DRUPAL_BOOTSTRAP_FULL</a>)) {
<a name="l02958"></a>02958         <a class="code" href="cache_8inc_a48081f36334909f561ef4f538fa640d2.html#a48081f36334909f561ef4f538fa640d2" title="Stores data in the persistent cache.">cache_set</a>(<span class="stringliteral">&#39;schema&#39;</span>, $schema);
<a name="l02959"></a>02959       }
<a name="l02960"></a>02960       <span class="keywordflow">if</span> ($rebuild) {
<a name="l02961"></a>02961         <a class="code" href="cache_8inc_a409b34dd629640d791a11736a9de8125.html#a409b34dd629640d791a11736a9de8125" title="Expires data from the cache.">cache_clear_all</a>(<span class="stringliteral">&#39;schema:&#39;</span>, <span class="stringliteral">&#39;cache&#39;</span>, TRUE);
<a name="l02962"></a>02962       }
<a name="l02963"></a>02963     }
<a name="l02964"></a>02964   }
<a name="l02965"></a>02965 
<a name="l02966"></a>02966   <span class="keywordflow">return</span> $schema;
<a name="l02967"></a>02967 }
<a name="l02968"></a>02968 
<a name="l02991"></a><a class="code" href="group__registry_gaf7822bbec92566b95a44dc1c224389e8.html#gaf7822bbec92566b95a44dc1c224389e8">02991</a> <span class="keyword">function</span> <a class="code" href="group__registry_gaf7822bbec92566b95a44dc1c224389e8.html#gaf7822bbec92566b95a44dc1c224389e8" title="Confirms that an interface is available.">drupal_autoload_interface</a>($interface) {
<a name="l02992"></a>02992   <span class="keywordflow">return</span> <a class="code" href="group__registry_gac399c501a8a90c383ea9a901a3a45ed6.html#gac399c501a8a90c383ea9a901a3a45ed6" title="Checks for a resource in the registry.">_registry_check_code</a>(<span class="stringliteral">&#39;interface&#39;</span>, $interface);
<a name="l02993"></a>02993 }
<a name="l02994"></a>02994 
<a name="l03007"></a><a class="code" href="group__registry_ga0fee2e4ebba5986067aa486c3436f51e.html#ga0fee2e4ebba5986067aa486c3436f51e">03007</a> <span class="keyword">function</span> <a class="code" href="group__registry_ga0fee2e4ebba5986067aa486c3436f51e.html#ga0fee2e4ebba5986067aa486c3436f51e" title="Confirms that a class is available.">drupal_autoload_class</a>($class) {
<a name="l03008"></a>03008   <span class="keywordflow">return</span> <a class="code" href="group__registry_gac399c501a8a90c383ea9a901a3a45ed6.html#gac399c501a8a90c383ea9a901a3a45ed6" title="Checks for a resource in the registry.">_registry_check_code</a>(<span class="stringliteral">&#39;class&#39;</span>, $class);
<a name="l03009"></a>03009 }
<a name="l03010"></a>03010 
<a name="l03026"></a><a class="code" href="group__registry_gac399c501a8a90c383ea9a901a3a45ed6.html#gac399c501a8a90c383ea9a901a3a45ed6">03026</a> <span class="keyword">function</span> <a class="code" href="group__registry_gac399c501a8a90c383ea9a901a3a45ed6.html#gac399c501a8a90c383ea9a901a3a45ed6" title="Checks for a resource in the registry.">_registry_check_code</a>($type, $name = NULL) {
<a name="l03027"></a>03027   <span class="keyword">static</span> $lookup_cache, $cache_update_needed;
<a name="l03028"></a>03028 
<a name="l03029"></a>03029   <span class="keywordflow">if</span> ($type == <span class="stringliteral">&#39;class&#39;</span> &amp;&amp; class_exists($name) || $type == <span class="stringliteral">&#39;interface&#39;</span> &amp;&amp; interface_exists($name)) {
<a name="l03030"></a>03030     <span class="keywordflow">return</span> TRUE;
<a name="l03031"></a>03031   }
<a name="l03032"></a>03032 
<a name="l03033"></a>03033   <span class="keywordflow">if</span> (!isset($lookup_cache)) {
<a name="l03034"></a>03034     $lookup_cache = array();
<a name="l03035"></a>03035     <span class="keywordflow">if</span> ($cache = <a class="code" href="cache_8inc_a9d873815c28909b61c3a6188b383f8a3.html#a9d873815c28909b61c3a6188b383f8a3" title="Returns data from the persistent cache.">cache_get</a>(<span class="stringliteral">&#39;lookup_cache&#39;</span>, <span class="stringliteral">&#39;cache_bootstrap&#39;</span>)) {
<a name="l03036"></a>03036       $lookup_cache = $cache-&gt;data;
<a name="l03037"></a>03037     }
<a name="l03038"></a>03038   }
<a name="l03039"></a>03039 
<a name="l03040"></a>03040   <span class="comment">// When we rebuild the registry, we need to reset this cache so</span>
<a name="l03041"></a>03041   <span class="comment">// we don&#39;t keep lookups for resources that changed during the rebuild.</span>
<a name="l03042"></a>03042   <span class="keywordflow">if</span> ($type == <a class="code" href="bootstrap_8inc_a6045f5b23cf5e2c5e6ed8a2effaa7bfb.html#a6045f5b23cf5e2c5e6ed8a2effaa7bfb" title="Signals that the registry lookup cache should be reset.">REGISTRY_RESET_LOOKUP_CACHE</a>) {
<a name="l03043"></a>03043     $cache_update_needed = TRUE;
<a name="l03044"></a>03044     $lookup_cache = NULL;
<a name="l03045"></a>03045     <span class="keywordflow">return</span>;
<a name="l03046"></a>03046   }
<a name="l03047"></a>03047 
<a name="l03048"></a>03048   <span class="comment">// Called from drupal_page_footer, we write to permanent storage if there</span>
<a name="l03049"></a>03049   <span class="comment">// changes to the lookup cache for this request.</span>
<a name="l03050"></a>03050   <span class="keywordflow">if</span> ($type == <a class="code" href="bootstrap_8inc_ab6acafa683cd17da2d120b9faf3e04c2.html#ab6acafa683cd17da2d120b9faf3e04c2" title="Signals that the registry lookup cache should be written to storage.">REGISTRY_WRITE_LOOKUP_CACHE</a>) {
<a name="l03051"></a>03051     <span class="keywordflow">if</span> ($cache_update_needed) {
<a name="l03052"></a>03052       <a class="code" href="cache_8inc_a48081f36334909f561ef4f538fa640d2.html#a48081f36334909f561ef4f538fa640d2" title="Stores data in the persistent cache.">cache_set</a>(<span class="stringliteral">&#39;lookup_cache&#39;</span>, $lookup_cache, <span class="stringliteral">&#39;cache_bootstrap&#39;</span>);
<a name="l03053"></a>03053     }
<a name="l03054"></a>03054     <span class="keywordflow">return</span>;
<a name="l03055"></a>03055   }
<a name="l03056"></a>03056 
<a name="l03057"></a>03057   <span class="comment">// $type is either &#39;interface&#39; or &#39;class&#39;, so we only need the first letter to</span>
<a name="l03058"></a>03058   <span class="comment">// keep the cache key unique.</span>
<a name="l03059"></a>03059   $cache_key = $type[0] . $name;
<a name="l03060"></a>03060   <span class="keywordflow">if</span> (isset($lookup_cache[$cache_key])) {
<a name="l03061"></a>03061     <span class="keywordflow">if</span> ($lookup_cache[$cache_key]) {
<a name="l03062"></a>03062       require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $lookup_cache[$cache_key];
<a name="l03063"></a>03063     }
<a name="l03064"></a>03064     <span class="keywordflow">return</span> (<span class="keywordtype">bool</span>) $lookup_cache[$cache_key];
<a name="l03065"></a>03065   }
<a name="l03066"></a>03066 
<a name="l03067"></a>03067   <span class="comment">// This function may get called when the default database is not active, but</span>
<a name="l03068"></a>03068   <span class="comment">// there is no reason we&#39;d ever want to not use the default database for</span>
<a name="l03069"></a>03069   <span class="comment">// this query.</span>
<a name="l03070"></a>03070   $file = <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>(<span class="stringliteral">&#39;default&#39;</span>, <span class="stringliteral">&#39;default&#39;</span>)-&gt;query(<span class="stringliteral">&quot;SELECT filename FROM {registry} WHERE name = :name AND type = :type&quot;</span>, array(
<a name="l03071"></a>03071       <span class="stringliteral">&#39;:name&#39;</span> =&gt; $name,
<a name="l03072"></a>03072       <span class="stringliteral">&#39;:type&#39;</span> =&gt; $type,
<a name="l03073"></a>03073     ))
<a name="l03074"></a>03074     -&gt;fetchField();
<a name="l03075"></a>03075 
<a name="l03076"></a>03076   <span class="comment">// Flag that we&#39;ve run a lookup query and need to update the cache.</span>
<a name="l03077"></a>03077   $cache_update_needed = TRUE;
<a name="l03078"></a>03078 
<a name="l03079"></a>03079   <span class="comment">// Misses are valuable information worth caching, so cache even if</span>
<a name="l03080"></a>03080   <span class="comment">// $file is FALSE.</span>
<a name="l03081"></a>03081   $lookup_cache[$cache_key] = $file;
<a name="l03082"></a>03082 
<a name="l03083"></a>03083   <span class="keywordflow">if</span> ($file) {
<a name="l03084"></a>03084     require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $file;
<a name="l03085"></a>03085     <span class="keywordflow">return</span> TRUE;
<a name="l03086"></a>03086   }
<a name="l03087"></a>03087   <span class="keywordflow">else</span> {
<a name="l03088"></a>03088     <span class="keywordflow">return</span> FALSE;
<a name="l03089"></a>03089   }
<a name="l03090"></a>03090 }
<a name="l03091"></a>03091 
<a name="l03098"></a><a class="code" href="group__registry_ga63939dbdcf7950c97292f7d341f6d339.html#ga63939dbdcf7950c97292f7d341f6d339">03098</a> <span class="keyword">function</span> <a class="code" href="group__registry_ga63939dbdcf7950c97292f7d341f6d339.html#ga63939dbdcf7950c97292f7d341f6d339" title="Rescans all enabled modules and rebuilds the registry.">registry_rebuild</a>() {
<a name="l03099"></a>03099   system_rebuild_module_data();
<a name="l03100"></a>03100   <a class="code" href="group__registry_gaab1bcea9fb061684c700676aa5ebe608.html#gaab1bcea9fb061684c700676aa5ebe608" title="Updates the registry based on the latest files listed in the database.">registry_update</a>();
<a name="l03101"></a>03101 }
<a name="l03102"></a>03102 
<a name="l03116"></a><a class="code" href="group__registry_gaab1bcea9fb061684c700676aa5ebe608.html#gaab1bcea9fb061684c700676aa5ebe608">03116</a> <span class="keyword">function</span> <a class="code" href="group__registry_gaab1bcea9fb061684c700676aa5ebe608.html#gaab1bcea9fb061684c700676aa5ebe608" title="Updates the registry based on the latest files listed in the database.">registry_update</a>() {
<a name="l03117"></a>03117   <span class="comment">// install_system_module() calls module_enable() which calls into this</span>
<a name="l03118"></a>03118   <span class="comment">// function during initial system installation, so the lock system is neither</span>
<a name="l03119"></a>03119   <span class="comment">// loaded nor does its storage exist yet.</span>
<a name="l03120"></a>03120   $in_installer = <a class="code" href="bootstrap_8inc_ac9902394c447118612c3a71191151f2c.html#ac9902394c447118612c3a71191151f2c" title="Returns TRUE if a Drupal installation is currently being attempted.">drupal_installation_attempted</a>();
<a name="l03121"></a>03121   <span class="keywordflow">if</span> (!$in_installer &amp;&amp; !<a class="code" href="group__lock_gac67a4b1061491f7a869646f47b66e998.html#gac67a4b1061491f7a869646f47b66e998" title="Acquire (or renew) a lock, but do not block if it fails.">lock_acquire</a>(__FUNCTION__)) {
<a name="l03122"></a>03122     <span class="comment">// Another request got the lock, wait for it to finish.</span>
<a name="l03123"></a>03123     <a class="code" href="group__lock_ga54c2ee771edac47614b8f12d949d3376.html#ga54c2ee771edac47614b8f12d949d3376" title="Wait for a lock to be available.">lock_wait</a>(__FUNCTION__);
<a name="l03124"></a>03124     <span class="keywordflow">return</span> FALSE;
<a name="l03125"></a>03125   }
<a name="l03126"></a>03126 
<a name="l03127"></a>03127   require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/registry.inc&#39;</span>;
<a name="l03128"></a>03128   <a class="code" href="group__registry_ga5008c77b133d55af7f1f4442d9e51167.html#ga5008c77b133d55af7f1f4442d9e51167" title="Does the work for registry_update().">_registry_update</a>();
<a name="l03129"></a>03129 
<a name="l03130"></a>03130   <span class="keywordflow">if</span> (!$in_installer) {
<a name="l03131"></a>03131     <a class="code" href="group__lock_ga73e1456861f9aff1a506a650f43aceb0.html#ga73e1456861f9aff1a506a650f43aceb0" title="Release a lock previously acquired by lock_acquire().">lock_release</a>(__FUNCTION__);
<a name="l03132"></a>03132   }
<a name="l03133"></a>03133   <span class="keywordflow">return</span> TRUE;
<a name="l03134"></a>03134 }
<a name="l03135"></a>03135 
<a name="l03258"></a><a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21">03258</a> <span class="keyword">function</span> &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>($name, $default_value = NULL, $reset = FALSE) {
<a name="l03259"></a>03259   <span class="keyword">static</span> $data = array(), $default = array();
<a name="l03260"></a>03260   <span class="comment">// First check if dealing with a previously defined static variable.</span>
<a name="l03261"></a>03261   <span class="keywordflow">if</span> (isset($data[$name]) || array_key_exists($name, $data)) {
<a name="l03262"></a>03262     <span class="comment">// Non-NULL $name and both $data[$name] and $default[$name] statics exist.</span>
<a name="l03263"></a>03263     <span class="keywordflow">if</span> ($reset) {
<a name="l03264"></a>03264       <span class="comment">// Reset pre-existing static variable to its default value.</span>
<a name="l03265"></a>03265       $data[$name] = $default[$name];
<a name="l03266"></a>03266     }
<a name="l03267"></a>03267     <span class="keywordflow">return</span> $data[$name];
<a name="l03268"></a>03268   }
<a name="l03269"></a>03269   <span class="comment">// Neither $data[$name] nor $default[$name] static variables exist.</span>
<a name="l03270"></a>03270   <span class="keywordflow">if</span> (isset($name)) {
<a name="l03271"></a>03271     <span class="keywordflow">if</span> ($reset) {
<a name="l03272"></a>03272       <span class="comment">// Reset was called before a default is set and yet a variable must be</span>
<a name="l03273"></a>03273       <span class="comment">// returned.</span>
<a name="l03274"></a>03274       <span class="keywordflow">return</span> $data;
<a name="l03275"></a>03275     }
<a name="l03276"></a>03276     <span class="comment">// First call with new non-NULL $name. Initialize a new static variable.</span>
<a name="l03277"></a>03277     $default[$name] = $data[$name] = $default_value;
<a name="l03278"></a>03278     <span class="keywordflow">return</span> $data[$name];
<a name="l03279"></a>03279   }
<a name="l03280"></a>03280   <span class="comment">// Reset all: ($name == NULL). This needs to be done one at a time so that</span>
<a name="l03281"></a>03281   <span class="comment">// references returned by earlier invocations of drupal_static() also get</span>
<a name="l03282"></a>03282   <span class="comment">// reset.</span>
<a name="l03283"></a>03283   <span class="keywordflow">foreach</span> ($default as $name =&gt; $value) {
<a name="l03284"></a>03284     $data[$name] = $value;
<a name="l03285"></a>03285   }
<a name="l03286"></a>03286   <span class="comment">// As the function returns a reference, the return should always be a</span>
<a name="l03287"></a>03287   <span class="comment">// variable.</span>
<a name="l03288"></a>03288   <span class="keywordflow">return</span> $data;
<a name="l03289"></a>03289 }
<a name="l03290"></a>03290 
<a name="l03297"></a><a class="code" href="group__schemaapi_ga714b5ed0b14c43b61eef0c895598c5c4.html#ga714b5ed0b14c43b61eef0c895598c5c4">03297</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga714b5ed0b14c43b61eef0c895598c5c4.html#ga714b5ed0b14c43b61eef0c895598c5c4" title="Resets one or all centrally stored static variable(s).">drupal_static_reset</a>($name = NULL) {
<a name="l03298"></a>03298   <a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>($name, NULL, TRUE);
<a name="l03299"></a>03299 }
<a name="l03300"></a>03300 
<a name="l03304"></a><a class="code" href="group__schemaapi_gac880b82ae302f9d15c64d264a269d1f4.html#gac880b82ae302f9d15c64d264a269d1f4">03304</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_gac880b82ae302f9d15c64d264a269d1f4.html#gac880b82ae302f9d15c64d264a269d1f4" title="Detects whether the current script is running in a command-line environment.">drupal_is_cli</a>() {
<a name="l03305"></a>03305   <span class="keywordflow">return</span> (!isset($_SERVER[<span class="stringliteral">&#39;SERVER_SOFTWARE&#39;</span>]) &amp;&amp; (php_sapi_name() == <span class="stringliteral">&#39;cli&#39;</span> || (is_numeric($_SERVER[<span class="stringliteral">&#39;argc&#39;</span>]) &amp;&amp; $_SERVER[<span class="stringliteral">&#39;argc&#39;</span>] &gt; 0)));
<a name="l03306"></a>03306 }
<a name="l03307"></a>03307 
<a name="l03319"></a><a class="code" href="group__schemaapi_ga4ab49ad51d8b93bb296a8492296d655b.html#ga4ab49ad51d8b93bb296a8492296d655b">03319</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga4ab49ad51d8b93bb296a8492296d655b.html#ga4ab49ad51d8b93bb296a8492296d655b" title="Formats text for emphasized display in a placeholder inside a sentence.">drupal_placeholder</a>($text) {
<a name="l03320"></a>03320   <span class="keywordflow">return</span> <span class="stringliteral">&#39;&lt;em class=&quot;placeholder&quot;&gt;&#39;</span> . <a class="code" href="group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d.html#ga76fc67a30fd8d75ddd80565e6e65a13d" title="Encodes special characters in a plain-text string for display as HTML.">check_plain</a>($text) . <span class="stringliteral">&#39;&lt;/em&gt;&#39;</span>;
<a name="l03321"></a>03321 }
<a name="l03322"></a>03322 
<a name="l03340"></a><a class="code" href="group__php__wrappers_gac7eaf11b49995f7f539f5c830a65b34f.html#gac7eaf11b49995f7f539f5c830a65b34f">03340</a> <span class="keyword">function</span> &amp;<a class="code" href="group__php__wrappers_gac7eaf11b49995f7f539f5c830a65b34f.html#gac7eaf11b49995f7f539f5c830a65b34f" title="Registers a function for execution on shutdown.">drupal_register_shutdown_function</a>($callback = NULL) {
<a name="l03341"></a>03341   <span class="comment">// We cannot use drupal_static() here because the static cache is reset during</span>
<a name="l03342"></a>03342   <span class="comment">// batch processing, which breaks batch handling.</span>
<a name="l03343"></a>03343   <span class="keyword">static</span> $callbacks = array();
<a name="l03344"></a>03344 
<a name="l03345"></a>03345   <span class="keywordflow">if</span> (isset($callback)) {
<a name="l03346"></a>03346     <span class="comment">// Only register the internal shutdown function once.</span>
<a name="l03347"></a>03347     <span class="keywordflow">if</span> (empty($callbacks)) {
<a name="l03348"></a>03348       register_shutdown_function(<span class="stringliteral">&#39;_drupal_shutdown_function&#39;</span>);
<a name="l03349"></a>03349     }
<a name="l03350"></a>03350     $args = func_get_args();
<a name="l03351"></a>03351     array_shift($args);
<a name="l03352"></a>03352     <span class="comment">// Save callback and arguments</span>
<a name="l03353"></a>03353     $callbacks[] = array(<span class="stringliteral">&#39;callback&#39;</span> =&gt; $callback, <span class="stringliteral">&#39;arguments&#39;</span> =&gt; $args);
<a name="l03354"></a>03354   }
<a name="l03355"></a>03355   <span class="keywordflow">return</span> $callbacks;
<a name="l03356"></a>03356 }
<a name="l03357"></a>03357 
<a name="l03361"></a><a class="code" href="group__schemaapi_ga8da38564ce2a3c92aa5103da6ae2a315.html#ga8da38564ce2a3c92aa5103da6ae2a315">03361</a> <span class="keyword">function</span> <a class="code" href="group__schemaapi_ga8da38564ce2a3c92aa5103da6ae2a315.html#ga8da38564ce2a3c92aa5103da6ae2a315" title="Executes registered shutdown functions.">_drupal_shutdown_function</a>() {
<a name="l03362"></a>03362   $callbacks = &amp;<a class="code" href="group__php__wrappers_gac7eaf11b49995f7f539f5c830a65b34f.html#gac7eaf11b49995f7f539f5c830a65b34f" title="Registers a function for execution on shutdown.">drupal_register_shutdown_function</a>();
<a name="l03363"></a>03363 
<a name="l03364"></a>03364   <span class="comment">// Set the CWD to DRUPAL_ROOT as it is not guaranteed to be the same as it</span>
<a name="l03365"></a>03365   <span class="comment">// was in the normal context of execution.</span>
<a name="l03366"></a>03366   chdir(<a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a>);
<a name="l03367"></a>03367 
<a name="l03368"></a>03368   <span class="keywordflow">try</span> {
<a name="l03369"></a>03369     <span class="keywordflow">while</span> (list($key, $callback) = each($callbacks)) {
<a name="l03370"></a>03370       call_user_func_array($callback[<span class="stringliteral">&#39;callback&#39;</span>], $callback[<span class="stringliteral">&#39;arguments&#39;</span>]);
<a name="l03371"></a>03371     }
<a name="l03372"></a>03372   }
<a name="l03373"></a>03373   <span class="keywordflow">catch</span> (<a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> $exception) {
<a name="l03374"></a>03374     <span class="comment">// If we are displaying errors, then do so with no possibility of a further uncaught exception being thrown.</span>
<a name="l03375"></a>03375    require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/errors.inc&#39;</span>;
<a name="l03376"></a>03376    <span class="keywordflow">if</span> (<a class="code" href="errors_8inc_a84844a457938107e0ff1a1e5393feb8e.html#a84844a457938107e0ff1a1e5393feb8e" title="Determines whether an error should be displayed.">error_displayable</a>()) {
<a name="l03377"></a>03377       print <span class="stringliteral">&#39;&lt;h1&gt;Uncaught exception thrown in shutdown function.&lt;/h1&gt;&#39;</span>;
<a name="l03378"></a>03378       print <span class="stringliteral">&#39;&lt;p&gt;&#39;</span> . <a class="code" href="errors_8inc_a1f8bd68a322e820f9bed014cb6a9f1de.html#a1f8bd68a322e820f9bed014cb6a9f1de" title="Renders an exception error message without further exceptions.">_drupal_render_exception_safe</a>($exception) . <span class="stringliteral">&#39;&lt;/p&gt;&lt;hr /&gt;&#39;</span>;
<a name="l03379"></a>03379     }
<a name="l03380"></a>03380   }
<a name="l03381"></a>03381 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 22 2012 16:46:13 for Shopcart by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
