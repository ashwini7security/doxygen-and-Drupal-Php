<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Shopcart: includes/database/query.inc Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Shopcart
   &#160;<span id="projectnumber">version2.0</span>
   </div>
   <div id="projectbrief">Shoppingcart</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_5b89693129504707d608c5412e7b88d4.html">includes</a>      </li>
      <li class="navelem"><a class="el" href="dir_ef0f8d4c5d0deb89b62e2aae86c9d2d2.html">database</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">query.inc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="query_8inc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00016"></a><a class="code" href="interfaceQueryConditionInterface.html">00016</a> <span class="keyword">interface </span><a class="code" href="interfaceQueryConditionInterface.html" title="Interface for a conditional clause in a query.">QueryConditionInterface</a> {
<a name="l00017"></a>00017 
<a name="l00046"></a>00046   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceQueryConditionInterface_aa6d9d96fa17441b5222d1ffddd4c1799.html#aa6d9d96fa17441b5222d1ffddd4c1799" title="Helper function: builds the most common conditional clauses.">condition</a>($field, $value = NULL, $operator = NULL);
<a name="l00047"></a>00047 
<a name="l00060"></a>00060   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceQueryConditionInterface_a42c03c74dd81ef6d77041e67ec12e735.html#a42c03c74dd81ef6d77041e67ec12e735" title="Adds an arbitrary WHERE clause to the query.">where</a>($snippet, $args = array());
<a name="l00061"></a>00061 
<a name="l00071"></a>00071   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceQueryConditionInterface_a2978b536a3fe62b21e940366c9cb5923.html#a2978b536a3fe62b21e940366c9cb5923" title="Sets a condition that the specified field be NULL.">isNull</a>($field);
<a name="l00072"></a>00072 
<a name="l00082"></a>00082   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceQueryConditionInterface_a8bbb6acc9c72911b165cf6eb1dc31453.html#a8bbb6acc9c72911b165cf6eb1dc31453" title="Sets a condition that the specified field be NOT NULL.">isNotNull</a>($field);
<a name="l00083"></a>00083 
<a name="l00093"></a>00093   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceQueryConditionInterface_a27a52b6e84393275ad2c54eaf1bd764a.html#a27a52b6e84393275ad2c54eaf1bd764a" title="Sets a condition that the specified subquery returns values.">exists</a>(<a class="code" href="interfaceSelectQueryInterface.html" title="Interface definition for a Select Query object.">SelectQueryInterface</a> $select);
<a name="l00094"></a>00094   
<a name="l00104"></a>00104   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceQueryConditionInterface_a8aae11796846850edbf8caa3a9d4afcd.html#a8aae11796846850edbf8caa3a9d4afcd" title="Sets a condition that the specified subquery returns no values.">notExists</a>(<a class="code" href="interfaceSelectQueryInterface.html" title="Interface definition for a Select Query object.">SelectQueryInterface</a> $select);
<a name="l00105"></a>00105   
<a name="l00129"></a>00129   <span class="keyword">public</span> <span class="keyword">function</span> &amp;<a class="code" href="interfaceQueryConditionInterface_a894cc290ed61feb3693b1d459ae86888.html#a894cc290ed61feb3693b1d459ae86888" title="Gets a complete list of all conditions in this conditional clause.">conditions</a>();
<a name="l00130"></a>00130 
<a name="l00137"></a>00137   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceQueryConditionInterface_ac2349e02d5332412182cf472ba1a1b1e.html#ac2349e02d5332412182cf472ba1a1b1e" title="Gets a complete list of all values to insert into the prepared statement.">arguments</a>();
<a name="l00138"></a>00138 
<a name="l00151"></a>00151   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceQueryConditionInterface_ad409672ac9ac50787eec52ecdf5a60b1.html#ad409672ac9ac50787eec52ecdf5a60b1" title="Compiles the saved conditions for later retrieval.">compile</a>(<a class="code" href="classDatabaseConnection.html" title="Base Database API class.">DatabaseConnection</a> $connection, <a class="code" href="interfaceQueryPlaceholderInterface.html" title="Interface for a query that accepts placeholders.">QueryPlaceholderInterface</a> $queryPlaceholder);
<a name="l00152"></a>00152 
<a name="l00159"></a>00159   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceQueryConditionInterface_a4aac3f4505275edecad9c22351e591cb.html#a4aac3f4505275edecad9c22351e591cb" title="Check whether a condition has been previously compiled.">compiled</a>();
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 
<a name="l00166"></a><a class="code" href="interfaceQueryAlterableInterface.html">00166</a> <span class="keyword">interface </span><a class="code" href="interfaceQueryAlterableInterface.html" title="Interface for a query that can be manipulated via an alter hook.">QueryAlterableInterface</a> {
<a name="l00167"></a>00167 
<a name="l00183"></a>00183   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceQueryAlterableInterface_a86b5a64d7b1b34959666e9d5eada3940.html#a86b5a64d7b1b34959666e9d5eada3940" title="Adds a tag to a query.">addTag</a>($tag);
<a name="l00184"></a>00184 
<a name="l00194"></a>00194   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceQueryAlterableInterface_a1273bb283ebfe44b6c839d97b18056a9.html#a1273bb283ebfe44b6c839d97b18056a9" title="Determines if a given query has a given tag.">hasTag</a>($tag);
<a name="l00195"></a>00195 
<a name="l00206"></a>00206   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceQueryAlterableInterface_a752e1b07ff69e4807fcaeab1aa172c57.html#a752e1b07ff69e4807fcaeab1aa172c57" title="Determines if a given query has all specified tags.">hasAllTags</a>();
<a name="l00207"></a>00207 
<a name="l00218"></a>00218   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceQueryAlterableInterface_ae52ceaffc7ad7cf7f2b0542e8d55b3f1.html#ae52ceaffc7ad7cf7f2b0542e8d55b3f1" title="Determines if a given query has any specified tag.">hasAnyTag</a>();
<a name="l00219"></a>00219 
<a name="l00236"></a>00236   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceQueryAlterableInterface_a4551fab9d5d25eeed040fdac7c8be4ae.html#a4551fab9d5d25eeed040fdac7c8be4ae" title="Adds additional metadata to the query.">addMetaData</a>($key, $object);
<a name="l00237"></a>00237 
<a name="l00247"></a>00247   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceQueryAlterableInterface_aad1aabcc6d07374eafaf1b47f911121a.html#aad1aabcc6d07374eafaf1b47f911121a" title="Retrieves a given piece of metadata.">getMetaData</a>($key);
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249 
<a name="l00253"></a><a class="code" href="interfaceQueryPlaceholderInterface.html">00253</a> <span class="keyword">interface </span><a class="code" href="interfaceQueryPlaceholderInterface.html" title="Interface for a query that accepts placeholders.">QueryPlaceholderInterface</a> {
<a name="l00254"></a>00254 
<a name="l00258"></a>00258   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceQueryPlaceholderInterface_a5f4eb118f1894f0b5785d78d4dbe9847.html#a5f4eb118f1894f0b5785d78d4dbe9847" title="Returns a unique identifier for this object.">uniqueIdentifier</a>();
<a name="l00259"></a>00259 
<a name="l00266"></a>00266   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="interfaceQueryPlaceholderInterface_a6ec3008deb25380042178419cc601b37.html#a6ec3008deb25380042178419cc601b37" title="Returns the next placeholder ID for the query.">nextPlaceholder</a>();
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00275"></a><a class="code" href="classQuery.html">00275</a> <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="classQuery.html" title="Base class for query builders.">Query</a> <span class="keyword">implements</span> <a class="code" href="interfaceQueryPlaceholderInterface.html" title="Interface for a query that accepts placeholders.">QueryPlaceholderInterface</a> {
<a name="l00276"></a>00276 
<a name="l00282"></a><a class="code" href="classQuery_ad2260119848060bb535ca58390b10668.html#ad2260119848060bb535ca58390b10668">00282</a>   <span class="keyword">protected</span> <a class="code" href="classQuery_ad2260119848060bb535ca58390b10668.html#ad2260119848060bb535ca58390b10668">$connection</a>;
<a name="l00283"></a>00283 
<a name="l00289"></a><a class="code" href="classQuery_a402ec2b0a8f6e68e7c9fb0d012c5ef90.html#a402ec2b0a8f6e68e7c9fb0d012c5ef90">00289</a>   <span class="keyword">protected</span> <a class="code" href="classQuery_a402ec2b0a8f6e68e7c9fb0d012c5ef90.html#a402ec2b0a8f6e68e7c9fb0d012c5ef90">$connectionTarget</a>;
<a name="l00290"></a>00290 
<a name="l00296"></a><a class="code" href="classQuery_ad227c594a2d25a3f95e440fc3d33552d.html#ad227c594a2d25a3f95e440fc3d33552d">00296</a>   <span class="keyword">protected</span> <a class="code" href="classQuery_ad227c594a2d25a3f95e440fc3d33552d.html#ad227c594a2d25a3f95e440fc3d33552d">$connectionKey</a>;
<a name="l00297"></a>00297 
<a name="l00303"></a><a class="code" href="classQuery_ad889775600e408d503d79b55d4599ad5.html#ad889775600e408d503d79b55d4599ad5">00303</a>   <span class="keyword">protected</span> <a class="code" href="classQuery_ad889775600e408d503d79b55d4599ad5.html#ad889775600e408d503d79b55d4599ad5">$queryOptions</a>;
<a name="l00304"></a>00304 
<a name="l00308"></a><a class="code" href="classQuery_a964c5e7a55b10b57bd10a5667abd2a3c.html#a964c5e7a55b10b57bd10a5667abd2a3c">00308</a>   <span class="keyword">protected</span> <a class="code" href="classQuery_a964c5e7a55b10b57bd10a5667abd2a3c.html#a964c5e7a55b10b57bd10a5667abd2a3c" title="A unique identifier for this query object.">$uniqueIdentifier</a>;
<a name="l00309"></a>00309 
<a name="l00313"></a><a class="code" href="classQuery_a971abbb28ad6cffc0b3260a1ca6e867a.html#a971abbb28ad6cffc0b3260a1ca6e867a">00313</a>   <span class="keyword">protected</span> <a class="code" href="classQuery_a971abbb28ad6cffc0b3260a1ca6e867a.html#a971abbb28ad6cffc0b3260a1ca6e867a" title="The placeholder counter.">$nextPlaceholder</a> = 0;
<a name="l00314"></a>00314 
<a name="l00320"></a><a class="code" href="classQuery_ab545c0037b0e730712d965cd95f51d2e.html#ab545c0037b0e730712d965cd95f51d2e">00320</a>   <span class="keyword">protected</span> <a class="code" href="classQuery_ab545c0037b0e730712d965cd95f51d2e.html#ab545c0037b0e730712d965cd95f51d2e">$comments</a> = array();
<a name="l00321"></a>00321 
<a name="l00330"></a><a class="code" href="classQuery_a3fae0cd122cc9f885ec035b5e47c0e5b.html#a3fae0cd122cc9f885ec035b5e47c0e5b">00330</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classQuery_a3fae0cd122cc9f885ec035b5e47c0e5b.html#a3fae0cd122cc9f885ec035b5e47c0e5b" title="Constructs a Query object.">__construct</a>(<a class="code" href="classDatabaseConnection.html" title="Base Database API class.">DatabaseConnection</a> <a class="code" href="classQuery_ad2260119848060bb535ca58390b10668.html#ad2260119848060bb535ca58390b10668">$connection</a>, $options) {
<a name="l00331"></a>00331     $this-&gt;<a class="code" href="classQuery_afa7ba2c63e278d4d585bd1ff70e0c237.html#afa7ba2c63e278d4d585bd1ff70e0c237" title="Returns a unique identifier for this object.">uniqueIdentifier</a> = uniqid(<span class="stringliteral">&#39;&#39;</span>, TRUE);
<a name="l00332"></a>00332 
<a name="l00333"></a>00333     $this-&gt;connection = <a class="code" href="classQuery_ad2260119848060bb535ca58390b10668.html#ad2260119848060bb535ca58390b10668">$connection</a>;
<a name="l00334"></a>00334     $this-&gt;connectionKey = $this-&gt;connection-&gt;getKey();
<a name="l00335"></a>00335     $this-&gt;connectionTarget = $this-&gt;connection-&gt;getTarget();
<a name="l00336"></a>00336 
<a name="l00337"></a>00337     $this-&gt;queryOptions = $options;
<a name="l00338"></a>00338   }
<a name="l00339"></a>00339 
<a name="l00343"></a><a class="code" href="classQuery_ab98e075cab6448bdade84475771210c4.html#ab98e075cab6448bdade84475771210c4">00343</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classQuery_ab98e075cab6448bdade84475771210c4.html#ab98e075cab6448bdade84475771210c4" title="Implements the magic __sleep function to disconnect from the database.">__sleep</a>() {
<a name="l00344"></a>00344     $keys = get_object_vars($this);
<a name="l00345"></a>00345     unset($keys[<span class="stringliteral">&#39;connection&#39;</span>]);
<a name="l00346"></a>00346     <span class="keywordflow">return</span> array_keys($keys);
<a name="l00347"></a>00347   }
<a name="l00348"></a>00348 
<a name="l00352"></a><a class="code" href="classQuery_a1c06bc497d594036c08805b71ce32d05.html#a1c06bc497d594036c08805b71ce32d05">00352</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classQuery_a1c06bc497d594036c08805b71ce32d05.html#a1c06bc497d594036c08805b71ce32d05" title="Implements the magic __wakeup function to reconnect to the database.">__wakeup</a>() {
<a name="l00353"></a>00353     $this-&gt;connection = <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>($this-&gt;connectionTarget, $this-&gt;connectionKey);
<a name="l00354"></a>00354   }
<a name="l00355"></a>00355 
<a name="l00359"></a><a class="code" href="classQuery_a2a0fc84cd8f0b0ffd268de81ac2472c3.html#a2a0fc84cd8f0b0ffd268de81ac2472c3">00359</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classQuery_a2a0fc84cd8f0b0ffd268de81ac2472c3.html#a2a0fc84cd8f0b0ffd268de81ac2472c3" title="Implements the magic __clone function.">__clone</a>() {
<a name="l00360"></a>00360     $this-&gt;<a class="code" href="classQuery_afa7ba2c63e278d4d585bd1ff70e0c237.html#afa7ba2c63e278d4d585bd1ff70e0c237" title="Returns a unique identifier for this object.">uniqueIdentifier</a> = uniqid(<span class="stringliteral">&#39;&#39;</span>, TRUE);
<a name="l00361"></a>00361   }
<a name="l00362"></a>00362 
<a name="l00366"></a>00366   <span class="keyword">abstract</span> <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classQuery_a9f2326187a94f3337a7838687b1e6929.html#a9f2326187a94f3337a7838687b1e6929" title="Runs the query against the database.">execute</a>();
<a name="l00367"></a>00367 
<a name="l00377"></a>00377   <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classQuery_a16c3a3265666b784d49ce18a6fda9a8a.html#a16c3a3265666b784d49ce18a6fda9a8a" title="Implements PHP magic __toString method to convert the query to a string.">__toString</a>();
<a name="l00378"></a>00378 
<a name="l00382"></a><a class="code" href="classQuery_afa7ba2c63e278d4d585bd1ff70e0c237.html#afa7ba2c63e278d4d585bd1ff70e0c237">00382</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classQuery_afa7ba2c63e278d4d585bd1ff70e0c237.html#afa7ba2c63e278d4d585bd1ff70e0c237" title="Returns a unique identifier for this object.">uniqueIdentifier</a>() {
<a name="l00383"></a>00383     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classQuery_afa7ba2c63e278d4d585bd1ff70e0c237.html#afa7ba2c63e278d4d585bd1ff70e0c237" title="Returns a unique identifier for this object.">uniqueIdentifier</a>;
<a name="l00384"></a>00384   }
<a name="l00385"></a>00385 
<a name="l00392"></a><a class="code" href="classQuery_a6932a635e623d74c7ae111742818b6b8.html#a6932a635e623d74c7ae111742818b6b8">00392</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classQuery_a6932a635e623d74c7ae111742818b6b8.html#a6932a635e623d74c7ae111742818b6b8" title="Gets the next placeholder value for this query object.">nextPlaceholder</a>() {
<a name="l00393"></a>00393     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classQuery_a6932a635e623d74c7ae111742818b6b8.html#a6932a635e623d74c7ae111742818b6b8" title="Gets the next placeholder value for this query object.">nextPlaceholder</a>++;
<a name="l00394"></a>00394   }
<a name="l00395"></a>00395 
<a name="l00413"></a><a class="code" href="classQuery_a74f7d00d41c85568f37c828e20fcab32.html#a74f7d00d41c85568f37c828e20fcab32">00413</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classQuery_a74f7d00d41c85568f37c828e20fcab32.html#a74f7d00d41c85568f37c828e20fcab32" title="Adds a comment to the query.">comment</a>($comment) {
<a name="l00414"></a>00414     $this-&gt;comments[] = $comment;
<a name="l00415"></a>00415     <span class="keywordflow">return</span> $this;
<a name="l00416"></a>00416   }
<a name="l00417"></a>00417 
<a name="l00433"></a><a class="code" href="classQuery_a263e8b3192c41971060533b78dcf3a4d.html#a263e8b3192c41971060533b78dcf3a4d">00433</a>   <span class="keyword">public</span> <span class="keyword">function</span> &amp;<a class="code" href="classQuery_a263e8b3192c41971060533b78dcf3a4d.html#a263e8b3192c41971060533b78dcf3a4d" title="Returns a reference to the comments array for the query.">getComments</a>() {
<a name="l00434"></a>00434     <span class="keywordflow">return</span> $this-&gt;comments;
<a name="l00435"></a>00435   }
<a name="l00436"></a>00436 }
<a name="l00437"></a>00437 
<a name="l00441"></a><a class="code" href="classInsertQuery.html">00441</a> <span class="keyword">class </span><a class="code" href="classInsertQuery.html" title="General class for an abstracted INSERT query.">InsertQuery</a> <span class="keyword">extends</span> <a class="code" href="classQuery.html" title="Base class for query builders.">Query</a> {
<a name="l00442"></a>00442 
<a name="l00448"></a><a class="code" href="classInsertQuery_a43d33012f33b9bc6067f5ccb247105ca.html#a43d33012f33b9bc6067f5ccb247105ca">00448</a>   <span class="keyword">protected</span> <a class="code" href="classInsertQuery_a43d33012f33b9bc6067f5ccb247105ca.html#a43d33012f33b9bc6067f5ccb247105ca">$table</a>;
<a name="l00449"></a>00449 
<a name="l00455"></a><a class="code" href="classInsertQuery_af3562bbf40254228eb6392e8df1309dd.html#af3562bbf40254228eb6392e8df1309dd">00455</a>   <span class="keyword">protected</span> <a class="code" href="classInsertQuery_af3562bbf40254228eb6392e8df1309dd.html#af3562bbf40254228eb6392e8df1309dd">$insertFields</a> = array();
<a name="l00456"></a>00456 
<a name="l00462"></a><a class="code" href="classInsertQuery_a20210a70db8be3c64046a958c3b0436b.html#a20210a70db8be3c64046a958c3b0436b">00462</a>   <span class="keyword">protected</span> <a class="code" href="classInsertQuery_a20210a70db8be3c64046a958c3b0436b.html#a20210a70db8be3c64046a958c3b0436b">$defaultFields</a> = array();
<a name="l00463"></a>00463 
<a name="l00479"></a><a class="code" href="classInsertQuery_acf0cf4f082daa5a451bdfbd27a471b2c.html#acf0cf4f082daa5a451bdfbd27a471b2c">00479</a>   <span class="keyword">protected</span> <a class="code" href="classInsertQuery_acf0cf4f082daa5a451bdfbd27a471b2c.html#acf0cf4f082daa5a451bdfbd27a471b2c">$insertValues</a> = array();
<a name="l00480"></a>00480 
<a name="l00486"></a><a class="code" href="classInsertQuery_a82fee69eb0d2769190bf11edc8495e0e.html#a82fee69eb0d2769190bf11edc8495e0e">00486</a>   <span class="keyword">protected</span> <a class="code" href="classInsertQuery_a82fee69eb0d2769190bf11edc8495e0e.html#a82fee69eb0d2769190bf11edc8495e0e">$fromQuery</a>;
<a name="l00487"></a>00487 
<a name="l00498"></a><a class="code" href="classInsertQuery_a2a5dd9afb005a1f14877a18dd3c3429d.html#a2a5dd9afb005a1f14877a18dd3c3429d">00498</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classInsertQuery_a2a5dd9afb005a1f14877a18dd3c3429d.html#a2a5dd9afb005a1f14877a18dd3c3429d" title="Constructs an InsertQuery object.">__construct</a>(<a class="code" href="classQuery_ad2260119848060bb535ca58390b10668.html#ad2260119848060bb535ca58390b10668">$connection</a>, <a class="code" href="classInsertQuery_a43d33012f33b9bc6067f5ccb247105ca.html#a43d33012f33b9bc6067f5ccb247105ca">$table</a>, array $options = array()) {
<a name="l00499"></a>00499     <span class="keywordflow">if</span> (!isset($options[<span class="stringliteral">&#39;return&#39;</span>])) {
<a name="l00500"></a>00500       $options[<span class="stringliteral">&#39;return&#39;</span>] = <a class="code" href="classDatabase_a56dab08fbf70f81aaf6f55a71922f4ef.html#a56dab08fbf70f81aaf6f55a71922f4ef" title="Flag to indicate a query call should return the &quot;last insert id&quot;.">Database::RETURN_INSERT_ID</a>;
<a name="l00501"></a>00501     }
<a name="l00502"></a>00502     <a class="code" href="classInsertQuery_a2a5dd9afb005a1f14877a18dd3c3429d.html#a2a5dd9afb005a1f14877a18dd3c3429d" title="Constructs an InsertQuery object.">parent::__construct</a>(<a class="code" href="classQuery_ad2260119848060bb535ca58390b10668.html#ad2260119848060bb535ca58390b10668">$connection</a>, $options);
<a name="l00503"></a>00503     $this-&gt;table = <a class="code" href="classInsertQuery_a43d33012f33b9bc6067f5ccb247105ca.html#a43d33012f33b9bc6067f5ccb247105ca">$table</a>;
<a name="l00504"></a>00504   }
<a name="l00505"></a>00505 
<a name="l00526"></a><a class="code" href="classInsertQuery_a80eebdf6db8f9b25998d68217fb9ba69.html#a80eebdf6db8f9b25998d68217fb9ba69">00526</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classInsertQuery_a80eebdf6db8f9b25998d68217fb9ba69.html#a80eebdf6db8f9b25998d68217fb9ba69" title="Adds a set of field-&gt;value pairs to be inserted.">fields</a>(array $fields, array $values = array()) {
<a name="l00527"></a>00527     <span class="keywordflow">if</span> (empty($this-&gt;insertFields)) {
<a name="l00528"></a>00528       <span class="keywordflow">if</span> (empty($values)) {
<a name="l00529"></a>00529         <span class="keywordflow">if</span> (!is_numeric(key($fields))) {
<a name="l00530"></a>00530           $values = array_values($fields);
<a name="l00531"></a>00531           $fields = array_keys($fields);
<a name="l00532"></a>00532         }
<a name="l00533"></a>00533       }
<a name="l00534"></a>00534       $this-&gt;insertFields = $fields;
<a name="l00535"></a>00535       <span class="keywordflow">if</span> (!empty($values)) {
<a name="l00536"></a>00536         $this-&gt;insertValues[] = $values;
<a name="l00537"></a>00537       }
<a name="l00538"></a>00538     }
<a name="l00539"></a>00539 
<a name="l00540"></a>00540     <span class="keywordflow">return</span> $this;
<a name="l00541"></a>00541   }
<a name="l00542"></a>00542 
<a name="l00557"></a><a class="code" href="classInsertQuery_a7b248332d48bde48cfef6e18b1b6fb7c.html#a7b248332d48bde48cfef6e18b1b6fb7c">00557</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classInsertQuery_a7b248332d48bde48cfef6e18b1b6fb7c.html#a7b248332d48bde48cfef6e18b1b6fb7c" title="Adds another set of values to the query to be inserted.">values</a>(array $values) {
<a name="l00558"></a>00558     <span class="keywordflow">if</span> (is_numeric(key($values))) {
<a name="l00559"></a>00559       $this-&gt;insertValues[] = $values;
<a name="l00560"></a>00560     }
<a name="l00561"></a>00561     <span class="keywordflow">else</span> {
<a name="l00562"></a>00562       <span class="comment">// Reorder the submitted values to match the fields array.</span>
<a name="l00563"></a>00563       <span class="keywordflow">foreach</span> ($this-&gt;insertFields as $key) {
<a name="l00564"></a>00564         $insert_values[$key] = $values[$key];
<a name="l00565"></a>00565       }
<a name="l00566"></a>00566       <span class="comment">// For consistency, the values array is always numerically indexed.</span>
<a name="l00567"></a>00567       $this-&gt;insertValues[] = array_values($insert_values);
<a name="l00568"></a>00568     }
<a name="l00569"></a>00569     <span class="keywordflow">return</span> $this;
<a name="l00570"></a>00570   }
<a name="l00571"></a>00571 
<a name="l00591"></a><a class="code" href="classInsertQuery_a5d584ac1930b6a791e0c5701d556cb65.html#a5d584ac1930b6a791e0c5701d556cb65">00591</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classInsertQuery_a5d584ac1930b6a791e0c5701d556cb65.html#a5d584ac1930b6a791e0c5701d556cb65" title="Specifies fields for which the database defaults should be used.">useDefaults</a>(array $fields) {
<a name="l00592"></a>00592     $this-&gt;defaultFields = $fields;
<a name="l00593"></a>00593     <span class="keywordflow">return</span> $this;
<a name="l00594"></a>00594   }
<a name="l00595"></a>00595 
<a name="l00605"></a><a class="code" href="classInsertQuery_ad9ed6614e8443cfc515ef8b3e8031894.html#ad9ed6614e8443cfc515ef8b3e8031894">00605</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classInsertQuery_ad9ed6614e8443cfc515ef8b3e8031894.html#ad9ed6614e8443cfc515ef8b3e8031894" title="Sets the fromQuery on this InsertQuery object.">from</a>(<a class="code" href="interfaceSelectQueryInterface.html" title="Interface definition for a Select Query object.">SelectQueryInterface</a> $query) {
<a name="l00606"></a>00606     $this-&gt;fromQuery = $query;
<a name="l00607"></a>00607     <span class="keywordflow">return</span> $this;
<a name="l00608"></a>00608   }
<a name="l00609"></a>00609 
<a name="l00619"></a><a class="code" href="classInsertQuery_a9bcd2f989e2ae0173bd6f58b6ede12fc.html#a9bcd2f989e2ae0173bd6f58b6ede12fc">00619</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classInsertQuery_a9bcd2f989e2ae0173bd6f58b6ede12fc.html#a9bcd2f989e2ae0173bd6f58b6ede12fc" title="Executes the insert query.">execute</a>() {
<a name="l00620"></a>00620     <span class="comment">// If validation fails, simply return NULL. Note that validation routines</span>
<a name="l00621"></a>00621     <span class="comment">// in preExecute() may throw exceptions instead.</span>
<a name="l00622"></a>00622     <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="classInsertQuery_ae33303d3a1d2edf20a7d3f762a627a0a.html#ae33303d3a1d2edf20a7d3f762a627a0a" title="Preprocesses and validates the query.">preExecute</a>()) {
<a name="l00623"></a>00623       <span class="keywordflow">return</span> NULL;
<a name="l00624"></a>00624     }
<a name="l00625"></a>00625 
<a name="l00626"></a>00626     <span class="comment">// If we&#39;re selecting from a SelectQuery, finish building the query and</span>
<a name="l00627"></a>00627     <span class="comment">// pass it back, as any remaining options are irrelevant.</span>
<a name="l00628"></a>00628     <span class="keywordflow">if</span> (!empty($this-&gt;fromQuery)) {
<a name="l00629"></a>00629       $sql = (string) $this;
<a name="l00630"></a>00630       <span class="comment">// The SelectQuery may contain arguments, load and pass them through.</span>
<a name="l00631"></a>00631       <span class="keywordflow">return</span> $this-&gt;connection-&gt;query($sql, $this-&gt;fromQuery-&gt;getArguments(), $this-&gt;queryOptions);
<a name="l00632"></a>00632     }
<a name="l00633"></a>00633 
<a name="l00634"></a>00634     $last_insert_id = 0;
<a name="l00635"></a>00635 
<a name="l00636"></a>00636     <span class="comment">// Each insert happens in its own query in the degenerate case. However,</span>
<a name="l00637"></a>00637     <span class="comment">// we wrap it in a transaction so that it is atomic where possible. On many</span>
<a name="l00638"></a>00638     <span class="comment">// databases, such as SQLite, this is also a notable performance boost.</span>
<a name="l00639"></a>00639     $transaction = $this-&gt;connection-&gt;startTransaction();
<a name="l00640"></a>00640 
<a name="l00641"></a>00641     <span class="keywordflow">try</span> {
<a name="l00642"></a>00642       $sql = (string) $this;
<a name="l00643"></a>00643       <span class="keywordflow">foreach</span> ($this-&gt;insertValues as $insert_values) {
<a name="l00644"></a>00644         $last_insert_id = $this-&gt;connection-&gt;query($sql, $insert_values, $this-&gt;queryOptions);
<a name="l00645"></a>00645       }
<a name="l00646"></a>00646     }
<a name="l00647"></a>00647     <span class="keywordflow">catch</span> (<a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> $e) {
<a name="l00648"></a>00648       <span class="comment">// One of the INSERTs failed, rollback the whole batch.</span>
<a name="l00649"></a>00649       $transaction-&gt;rollback();
<a name="l00650"></a>00650       <span class="comment">// Rethrow the exception for the calling code.</span>
<a name="l00651"></a>00651       <span class="keywordflow">throw</span> $e;
<a name="l00652"></a>00652     }
<a name="l00653"></a>00653 
<a name="l00654"></a>00654     <span class="comment">// Re-initialize the values array so that we can re-use this query.</span>
<a name="l00655"></a>00655     $this-&gt;insertValues = array();
<a name="l00656"></a>00656 
<a name="l00657"></a>00657     <span class="comment">// Transaction commits here where $transaction looses scope.</span>
<a name="l00658"></a>00658 
<a name="l00659"></a>00659     <span class="keywordflow">return</span> $last_insert_id;
<a name="l00660"></a>00660   }
<a name="l00661"></a>00661 
<a name="l00668"></a><a class="code" href="classInsertQuery_a996fb0719632b8861284683c1ff711fa.html#a996fb0719632b8861284683c1ff711fa">00668</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classInsertQuery_a996fb0719632b8861284683c1ff711fa.html#a996fb0719632b8861284683c1ff711fa" title="Implements PHP magic __toString method to convert the query to a string.">__toString</a>() {
<a name="l00669"></a>00669     <span class="comment">// Create a sanitized comment string to prepend to the query.</span>
<a name="l00670"></a>00670     <a class="code" href="classQuery_ab545c0037b0e730712d965cd95f51d2e.html#ab545c0037b0e730712d965cd95f51d2e">$comments</a> = $this-&gt;connection-&gt;makeComment($this-&gt;comments);
<a name="l00671"></a>00671 
<a name="l00672"></a>00672     <span class="comment">// Default fields are always placed first for consistency.</span>
<a name="l00673"></a>00673     $insert_fields = array_merge($this-&gt;defaultFields, $this-&gt;insertFields);
<a name="l00674"></a>00674 
<a name="l00675"></a>00675     <span class="keywordflow">if</span> (!empty($this-&gt;fromQuery)) {
<a name="l00676"></a>00676       <span class="keywordflow">return</span> <a class="code" href="classQuery_ab545c0037b0e730712d965cd95f51d2e.html#ab545c0037b0e730712d965cd95f51d2e">$comments</a> . <span class="stringliteral">&#39;INSERT INTO {&#39;</span> . $this-&gt;table . <span class="stringliteral">&#39;} (&#39;</span> . implode(<span class="stringliteral">&#39;, &#39;</span>, $insert_fields) . <span class="stringliteral">&#39;) &#39;</span> . $this-&gt;fromQuery;
<a name="l00677"></a>00677     }
<a name="l00678"></a>00678 
<a name="l00679"></a>00679     <span class="comment">// For simplicity, we will use the $placeholders array to inject</span>
<a name="l00680"></a>00680     <span class="comment">// default keywords even though they are not, strictly speaking,</span>
<a name="l00681"></a>00681     <span class="comment">// placeholders for prepared statements.</span>
<a name="l00682"></a>00682     $placeholders = array();
<a name="l00683"></a>00683     $placeholders = array_pad($placeholders, count($this-&gt;defaultFields), <span class="stringliteral">&#39;default&#39;</span>);
<a name="l00684"></a>00684     $placeholders = array_pad($placeholders, count($this-&gt;insertFields), <span class="charliteral">&#39;?&#39;</span>);
<a name="l00685"></a>00685 
<a name="l00686"></a>00686     <span class="keywordflow">return</span> <a class="code" href="classQuery_ab545c0037b0e730712d965cd95f51d2e.html#ab545c0037b0e730712d965cd95f51d2e">$comments</a> . <span class="stringliteral">&#39;INSERT INTO {&#39;</span> . $this-&gt;table . <span class="stringliteral">&#39;} (&#39;</span> . implode(<span class="stringliteral">&#39;, &#39;</span>, $insert_fields) . <span class="stringliteral">&#39;) VALUES (&#39;</span> . implode(<span class="stringliteral">&#39;, &#39;</span>, $placeholders) . <span class="charliteral">&#39;)&#39;</span>;
<a name="l00687"></a>00687   }
<a name="l00688"></a>00688 
<a name="l00698"></a><a class="code" href="classInsertQuery_ae33303d3a1d2edf20a7d3f762a627a0a.html#ae33303d3a1d2edf20a7d3f762a627a0a">00698</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classInsertQuery_ae33303d3a1d2edf20a7d3f762a627a0a.html#ae33303d3a1d2edf20a7d3f762a627a0a" title="Preprocesses and validates the query.">preExecute</a>() {
<a name="l00699"></a>00699     <span class="comment">// Confirm that the user did not try to specify an identical</span>
<a name="l00700"></a>00700     <span class="comment">// field and default field.</span>
<a name="l00701"></a>00701     <span class="keywordflow">if</span> (array_intersect($this-&gt;insertFields, $this-&gt;defaultFields)) {
<a name="l00702"></a>00702       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classFieldsOverlapException.html" title="Exception thrown if an insert query specifies a field twice.">FieldsOverlapException</a>(<span class="stringliteral">&#39;You may not specify the same field to have a value and a schema-default value.&#39;</span>);
<a name="l00703"></a>00703     }
<a name="l00704"></a>00704 
<a name="l00705"></a>00705     <span class="keywordflow">if</span> (!empty($this-&gt;fromQuery)) {
<a name="l00706"></a>00706       <span class="comment">// We have to assume that the used aliases match the insert fields.</span>
<a name="l00707"></a>00707       <span class="comment">// Regular fields are added to the query before expressions, maintain the</span>
<a name="l00708"></a>00708       <span class="comment">// same order for the insert fields.</span>
<a name="l00709"></a>00709       <span class="comment">// This behavior can be overridden by calling fields() manually as only the</span>
<a name="l00710"></a>00710       <span class="comment">// first call to fields() does have an effect.</span>
<a name="l00711"></a>00711       $this-&gt;<a class="code" href="classInsertQuery_a80eebdf6db8f9b25998d68217fb9ba69.html#a80eebdf6db8f9b25998d68217fb9ba69" title="Adds a set of field-&gt;value pairs to be inserted.">fields</a>(array_merge(array_keys($this-&gt;fromQuery-&gt;getFields()), array_keys($this-&gt;fromQuery-&gt;getExpressions())));
<a name="l00712"></a>00712     }
<a name="l00713"></a>00713 
<a name="l00714"></a>00714     <span class="comment">// Don&#39;t execute query without fields.</span>
<a name="l00715"></a>00715     <span class="keywordflow">if</span> (count($this-&gt;insertFields) + count($this-&gt;defaultFields) == 0) {
<a name="l00716"></a>00716       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classNoFieldsException.html" title="Exception thrown if an insert query doesn&#39;t specify insert or default fields.">NoFieldsException</a>(<span class="stringliteral">&#39;There are no fields available to insert with.&#39;</span>);
<a name="l00717"></a>00717     }
<a name="l00718"></a>00718 
<a name="l00719"></a>00719     <span class="comment">// If no values have been added, silently ignore this query. This can happen</span>
<a name="l00720"></a>00720     <span class="comment">// if values are added conditionally, so we don&#39;t want to throw an</span>
<a name="l00721"></a>00721     <span class="comment">// exception.</span>
<a name="l00722"></a>00722     <span class="keywordflow">if</span> (!isset($this-&gt;insertValues[0]) &amp;&amp; count($this-&gt;insertFields) &gt; 0 &amp;&amp; empty($this-&gt;fromQuery)) {
<a name="l00723"></a>00723       <span class="keywordflow">return</span> FALSE;
<a name="l00724"></a>00724     }
<a name="l00725"></a>00725     <span class="keywordflow">return</span> TRUE;
<a name="l00726"></a>00726   }
<a name="l00727"></a>00727 }
<a name="l00728"></a>00728 
<a name="l00732"></a><a class="code" href="classDeleteQuery.html">00732</a> <span class="keyword">class </span><a class="code" href="classDeleteQuery.html" title="General class for an abstracted DELETE operation.">DeleteQuery</a> <span class="keyword">extends</span> <a class="code" href="classQuery.html" title="Base class for query builders.">Query</a> implements <a class="code" href="interfaceQueryConditionInterface.html" title="Interface for a conditional clause in a query.">QueryConditionInterface</a> {
<a name="l00733"></a>00733 
<a name="l00739"></a><a class="code" href="classDeleteQuery_a1549ecc70533817e5a755a42753df208.html#a1549ecc70533817e5a755a42753df208">00739</a>   <span class="keyword">protected</span> <a class="code" href="classDeleteQuery_a1549ecc70533817e5a755a42753df208.html#a1549ecc70533817e5a755a42753df208">$table</a>;
<a name="l00740"></a>00740 
<a name="l00748"></a><a class="code" href="classDeleteQuery_a317f9600bf1e922aafb770cf6a6f7443.html#a317f9600bf1e922aafb770cf6a6f7443">00748</a>   <span class="keyword">protected</span> <a class="code" href="classDeleteQuery_a317f9600bf1e922aafb770cf6a6f7443.html#a317f9600bf1e922aafb770cf6a6f7443">$condition</a>;
<a name="l00749"></a>00749 
<a name="l00760"></a><a class="code" href="classDeleteQuery_af2d5db5f72fff4100b0a1b175fd33e80.html#af2d5db5f72fff4100b0a1b175fd33e80">00760</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDeleteQuery_af2d5db5f72fff4100b0a1b175fd33e80.html#af2d5db5f72fff4100b0a1b175fd33e80" title="Constructs a DeleteQuery object.">__construct</a>(<a class="code" href="classDatabaseConnection.html" title="Base Database API class.">DatabaseConnection</a> <a class="code" href="classQuery_ad2260119848060bb535ca58390b10668.html#ad2260119848060bb535ca58390b10668">$connection</a>, <a class="code" href="classDeleteQuery_a1549ecc70533817e5a755a42753df208.html#a1549ecc70533817e5a755a42753df208">$table</a>, array $options = array()) {
<a name="l00761"></a>00761     $options[<span class="stringliteral">&#39;return&#39;</span>] = <a class="code" href="classDatabase_a557879c7732a573ed395f9196afeb898.html#a557879c7732a573ed395f9196afeb898" title="Flag to indicate a query call should return the number of affected rows.">Database::RETURN_AFFECTED</a>;
<a name="l00762"></a>00762     <a class="code" href="classDeleteQuery_af2d5db5f72fff4100b0a1b175fd33e80.html#af2d5db5f72fff4100b0a1b175fd33e80" title="Constructs a DeleteQuery object.">parent::__construct</a>($connection, $options);
<a name="l00763"></a>00763     $this-&gt;table = <a class="code" href="classDeleteQuery_a1549ecc70533817e5a755a42753df208.html#a1549ecc70533817e5a755a42753df208">$table</a>;
<a name="l00764"></a>00764 
<a name="l00765"></a>00765     $this-&gt;<a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277" title="Implements QueryConditionInterface::condition().">condition</a> = <span class="keyword">new</span> <a class="code" href="classDatabaseCondition.html" title="Generic class for a series of conditions in a query.">DatabaseCondition</a>(<span class="stringliteral">&#39;AND&#39;</span>);
<a name="l00766"></a>00766   }
<a name="l00767"></a>00767 
<a name="l00771"></a><a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277">00771</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277" title="Implements QueryConditionInterface::condition().">condition</a>($field, $value = NULL, $operator = NULL) {
<a name="l00772"></a>00772     $this-&gt;<a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;condition($field, $value, $operator);
<a name="l00773"></a>00773     <span class="keywordflow">return</span> $this;
<a name="l00774"></a>00774   }
<a name="l00775"></a>00775 
<a name="l00779"></a><a class="code" href="classDeleteQuery_a2b252e7602b7b0e677ef79ae33af7dcd.html#a2b252e7602b7b0e677ef79ae33af7dcd">00779</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDeleteQuery_a2b252e7602b7b0e677ef79ae33af7dcd.html#a2b252e7602b7b0e677ef79ae33af7dcd" title="Implements QueryConditionInterface::isNull().">isNull</a>($field) {
<a name="l00780"></a>00780     $this-&gt;<a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;isNull($field);
<a name="l00781"></a>00781     <span class="keywordflow">return</span> $this;
<a name="l00782"></a>00782   }
<a name="l00783"></a>00783 
<a name="l00787"></a><a class="code" href="classDeleteQuery_a673730f62b32a5111f4930d3a2e6cf89.html#a673730f62b32a5111f4930d3a2e6cf89">00787</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDeleteQuery_a673730f62b32a5111f4930d3a2e6cf89.html#a673730f62b32a5111f4930d3a2e6cf89" title="Implements QueryConditionInterface::isNotNull().">isNotNull</a>($field) {
<a name="l00788"></a>00788     $this-&gt;<a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;isNotNull($field);
<a name="l00789"></a>00789     <span class="keywordflow">return</span> $this;
<a name="l00790"></a>00790   }
<a name="l00791"></a>00791 
<a name="l00795"></a><a class="code" href="classDeleteQuery_a22517a3fa29261685dd9f4a26b8cbb37.html#a22517a3fa29261685dd9f4a26b8cbb37">00795</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDeleteQuery_a22517a3fa29261685dd9f4a26b8cbb37.html#a22517a3fa29261685dd9f4a26b8cbb37" title="Implements QueryConditionInterface::exists().">exists</a>(<a class="code" href="interfaceSelectQueryInterface.html" title="Interface definition for a Select Query object.">SelectQueryInterface</a> $select) {
<a name="l00796"></a>00796     $this-&gt;<a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;exists($select);
<a name="l00797"></a>00797     <span class="keywordflow">return</span> $this;
<a name="l00798"></a>00798   }
<a name="l00799"></a>00799 
<a name="l00803"></a><a class="code" href="classDeleteQuery_a026548cee31db2472b2b3b83c5c104c3.html#a026548cee31db2472b2b3b83c5c104c3">00803</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDeleteQuery_a026548cee31db2472b2b3b83c5c104c3.html#a026548cee31db2472b2b3b83c5c104c3" title="Implements QueryConditionInterface::notExists().">notExists</a>(<a class="code" href="interfaceSelectQueryInterface.html" title="Interface definition for a Select Query object.">SelectQueryInterface</a> $select) {
<a name="l00804"></a>00804     $this-&gt;<a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;notExists($select);
<a name="l00805"></a>00805     <span class="keywordflow">return</span> $this;
<a name="l00806"></a>00806   }
<a name="l00807"></a>00807   
<a name="l00811"></a><a class="code" href="classDeleteQuery_a6c7bf743c3747bc37fad92940fc8e753.html#a6c7bf743c3747bc37fad92940fc8e753">00811</a>   <span class="keyword">public</span> <span class="keyword">function</span> &amp;<a class="code" href="classDeleteQuery_a6c7bf743c3747bc37fad92940fc8e753.html#a6c7bf743c3747bc37fad92940fc8e753" title="Implements QueryConditionInterface::conditions().">conditions</a>() {
<a name="l00812"></a>00812     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;conditions();
<a name="l00813"></a>00813   }
<a name="l00814"></a>00814 
<a name="l00818"></a><a class="code" href="classDeleteQuery_a16b4a6f2068378e594ed3d99e8e05a98.html#a16b4a6f2068378e594ed3d99e8e05a98">00818</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDeleteQuery_a16b4a6f2068378e594ed3d99e8e05a98.html#a16b4a6f2068378e594ed3d99e8e05a98" title="Implements QueryConditionInterface::arguments().">arguments</a>() {
<a name="l00819"></a>00819     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;arguments();
<a name="l00820"></a>00820   }
<a name="l00821"></a>00821 
<a name="l00825"></a><a class="code" href="classDeleteQuery_a1f4a560d33adeeab405fee5302a4a92e.html#a1f4a560d33adeeab405fee5302a4a92e">00825</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDeleteQuery_a1f4a560d33adeeab405fee5302a4a92e.html#a1f4a560d33adeeab405fee5302a4a92e" title="Implements QueryConditionInterface::where().">where</a>($snippet, $args = array()) {
<a name="l00826"></a>00826     $this-&gt;<a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;where($snippet, $args);
<a name="l00827"></a>00827     <span class="keywordflow">return</span> $this;
<a name="l00828"></a>00828   }
<a name="l00829"></a>00829 
<a name="l00833"></a><a class="code" href="classDeleteQuery_a62db6fe45f790c20479b6844ba58ac83.html#a62db6fe45f790c20479b6844ba58ac83">00833</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDeleteQuery_a62db6fe45f790c20479b6844ba58ac83.html#a62db6fe45f790c20479b6844ba58ac83" title="Implements QueryConditionInterface::compile().">compile</a>(<a class="code" href="classDatabaseConnection.html" title="Base Database API class.">DatabaseConnection</a> $connection, <a class="code" href="interfaceQueryPlaceholderInterface.html" title="Interface for a query that accepts placeholders.">QueryPlaceholderInterface</a> $queryPlaceholder) {
<a name="l00834"></a>00834     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;compile($connection, $queryPlaceholder);
<a name="l00835"></a>00835   }
<a name="l00836"></a>00836 
<a name="l00840"></a><a class="code" href="classDeleteQuery_a5f30ca2a90863366b492bc1a3b09ae24.html#a5f30ca2a90863366b492bc1a3b09ae24">00840</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDeleteQuery_a5f30ca2a90863366b492bc1a3b09ae24.html#a5f30ca2a90863366b492bc1a3b09ae24" title="Implements QueryConditionInterface::compiled().">compiled</a>() {
<a name="l00841"></a>00841     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;compiled();
<a name="l00842"></a>00842   }
<a name="l00843"></a>00843 
<a name="l00850"></a><a class="code" href="classDeleteQuery_a77b0690ed162255ae8a765fed7db0766.html#a77b0690ed162255ae8a765fed7db0766">00850</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDeleteQuery_a77b0690ed162255ae8a765fed7db0766.html#a77b0690ed162255ae8a765fed7db0766" title="Executes the DELETE query.">execute</a>() {
<a name="l00851"></a>00851     $values = array();
<a name="l00852"></a>00852     <span class="keywordflow">if</span> (count($this-&gt;<a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277" title="Implements QueryConditionInterface::condition().">condition</a>)) {
<a name="l00853"></a>00853       $this-&gt;<a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;compile($this-&gt;connection, $this);
<a name="l00854"></a>00854       $values = $this-&gt;<a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;arguments();
<a name="l00855"></a>00855     }
<a name="l00856"></a>00856 
<a name="l00857"></a>00857     <span class="keywordflow">return</span> $this-&gt;connection-&gt;query((<span class="keywordtype">string</span>) $this, $values, $this-&gt;queryOptions);
<a name="l00858"></a>00858   }
<a name="l00859"></a>00859 
<a name="l00866"></a><a class="code" href="classDeleteQuery_a50b6319c4ee1f22b5a055d4ee2f910dc.html#a50b6319c4ee1f22b5a055d4ee2f910dc">00866</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDeleteQuery_a50b6319c4ee1f22b5a055d4ee2f910dc.html#a50b6319c4ee1f22b5a055d4ee2f910dc" title="Implements PHP magic __toString method to convert the query to a string.">__toString</a>() {
<a name="l00867"></a>00867     <span class="comment">// Create a sanitized comment string to prepend to the query.</span>
<a name="l00868"></a>00868     <a class="code" href="classQuery_ab545c0037b0e730712d965cd95f51d2e.html#ab545c0037b0e730712d965cd95f51d2e">$comments</a> = $this-&gt;connection-&gt;makeComment($this-&gt;comments);
<a name="l00869"></a>00869 
<a name="l00870"></a>00870     $query = <a class="code" href="classQuery_ab545c0037b0e730712d965cd95f51d2e.html#ab545c0037b0e730712d965cd95f51d2e">$comments</a> . <span class="stringliteral">&#39;DELETE FROM {&#39;</span> . $this-&gt;connection-&gt;escapeTable($this-&gt;table) . <span class="stringliteral">&#39;} &#39;</span>;
<a name="l00871"></a>00871 
<a name="l00872"></a>00872     <span class="keywordflow">if</span> (count($this-&gt;<a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277" title="Implements QueryConditionInterface::condition().">condition</a>)) {
<a name="l00873"></a>00873 
<a name="l00874"></a>00874       $this-&gt;<a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;compile($this-&gt;connection, $this);
<a name="l00875"></a>00875       $query .= <span class="stringliteral">&quot;\nWHERE &quot;</span> . $this-&gt;<a class="code" href="classDeleteQuery_ae88c47d15ce798fd7d62620361eb4277.html#ae88c47d15ce798fd7d62620361eb4277" title="Implements QueryConditionInterface::condition().">condition</a>;
<a name="l00876"></a>00876     }
<a name="l00877"></a>00877 
<a name="l00878"></a>00878     <span class="keywordflow">return</span> $query;
<a name="l00879"></a>00879   }
<a name="l00880"></a>00880 }
<a name="l00881"></a>00881 
<a name="l00882"></a>00882 
<a name="l00886"></a><a class="code" href="classTruncateQuery.html">00886</a> <span class="keyword">class </span><a class="code" href="classTruncateQuery.html" title="General class for an abstracted TRUNCATE operation.">TruncateQuery</a> <span class="keyword">extends</span> <a class="code" href="classQuery.html" title="Base class for query builders.">Query</a> {
<a name="l00887"></a>00887 
<a name="l00893"></a><a class="code" href="classTruncateQuery_a70129e81bd93d1b35678ef24f48a7aa5.html#a70129e81bd93d1b35678ef24f48a7aa5">00893</a>   <span class="keyword">protected</span> <a class="code" href="classTruncateQuery_a70129e81bd93d1b35678ef24f48a7aa5.html#a70129e81bd93d1b35678ef24f48a7aa5">$table</a>;
<a name="l00894"></a>00894 
<a name="l00905"></a><a class="code" href="classTruncateQuery_a10def81f62ada99bfb5d9f8124e8002b.html#a10def81f62ada99bfb5d9f8124e8002b">00905</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classTruncateQuery_a10def81f62ada99bfb5d9f8124e8002b.html#a10def81f62ada99bfb5d9f8124e8002b" title="Constructs a TruncateQuery object.">__construct</a>(<a class="code" href="classDatabaseConnection.html" title="Base Database API class.">DatabaseConnection</a> $connection, <a class="code" href="classTruncateQuery_a70129e81bd93d1b35678ef24f48a7aa5.html#a70129e81bd93d1b35678ef24f48a7aa5">$table</a>, array $options = array()) {
<a name="l00906"></a>00906     $options[<span class="stringliteral">&#39;return&#39;</span>] = <a class="code" href="classDatabase_a557879c7732a573ed395f9196afeb898.html#a557879c7732a573ed395f9196afeb898" title="Flag to indicate a query call should return the number of affected rows.">Database::RETURN_AFFECTED</a>;
<a name="l00907"></a>00907     <a class="code" href="classTruncateQuery_a10def81f62ada99bfb5d9f8124e8002b.html#a10def81f62ada99bfb5d9f8124e8002b" title="Constructs a TruncateQuery object.">parent::__construct</a>($connection, $options);
<a name="l00908"></a>00908     $this-&gt;table = <a class="code" href="classTruncateQuery_a70129e81bd93d1b35678ef24f48a7aa5.html#a70129e81bd93d1b35678ef24f48a7aa5">$table</a>;
<a name="l00909"></a>00909   }
<a name="l00910"></a>00910 
<a name="l00914"></a><a class="code" href="classTruncateQuery_a052d10a3c9d1089483ee94b30f65514a.html#a052d10a3c9d1089483ee94b30f65514a">00914</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classTruncateQuery_a052d10a3c9d1089483ee94b30f65514a.html#a052d10a3c9d1089483ee94b30f65514a" title="Implements QueryConditionInterface::compile().">compile</a>(<a class="code" href="classDatabaseConnection.html" title="Base Database API class.">DatabaseConnection</a> $connection, <a class="code" href="interfaceQueryPlaceholderInterface.html" title="Interface for a query that accepts placeholders.">QueryPlaceholderInterface</a> $queryPlaceholder) {
<a name="l00915"></a>00915     <span class="keywordflow">return</span> $this-&gt;condition-&gt;compile($connection, $queryPlaceholder);
<a name="l00916"></a>00916   }
<a name="l00917"></a>00917 
<a name="l00921"></a><a class="code" href="classTruncateQuery_ac29862ff0fcdc347618e2d79ddd94418.html#ac29862ff0fcdc347618e2d79ddd94418">00921</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classTruncateQuery_ac29862ff0fcdc347618e2d79ddd94418.html#ac29862ff0fcdc347618e2d79ddd94418" title="Implements QueryConditionInterface::compiled().">compiled</a>() {
<a name="l00922"></a>00922     <span class="keywordflow">return</span> $this-&gt;condition-&gt;compiled();
<a name="l00923"></a>00923   }
<a name="l00924"></a>00924 
<a name="l00931"></a><a class="code" href="classTruncateQuery_acc0ca130114686d1ddf4d3315f720c0e.html#acc0ca130114686d1ddf4d3315f720c0e">00931</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classTruncateQuery_acc0ca130114686d1ddf4d3315f720c0e.html#acc0ca130114686d1ddf4d3315f720c0e" title="Executes the TRUNCATE query.">execute</a>() {
<a name="l00932"></a>00932     <span class="keywordflow">return</span> $this-&gt;connection-&gt;query((<span class="keywordtype">string</span>) $this, array(), $this-&gt;queryOptions);
<a name="l00933"></a>00933   }
<a name="l00934"></a>00934 
<a name="l00941"></a><a class="code" href="classTruncateQuery_a4a18f66831b99b10cccd74c617fa6723.html#a4a18f66831b99b10cccd74c617fa6723">00941</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classTruncateQuery_a4a18f66831b99b10cccd74c617fa6723.html#a4a18f66831b99b10cccd74c617fa6723" title="Implements PHP magic __toString method to convert the query to a string.">__toString</a>() {
<a name="l00942"></a>00942     <span class="comment">// Create a sanitized comment string to prepend to the query.</span>
<a name="l00943"></a>00943     <a class="code" href="classQuery_ab545c0037b0e730712d965cd95f51d2e.html#ab545c0037b0e730712d965cd95f51d2e">$comments</a> = $this-&gt;connection-&gt;makeComment($this-&gt;comments);
<a name="l00944"></a>00944 
<a name="l00945"></a>00945     <span class="keywordflow">return</span> <a class="code" href="classQuery_ab545c0037b0e730712d965cd95f51d2e.html#ab545c0037b0e730712d965cd95f51d2e">$comments</a> . <span class="stringliteral">&#39;TRUNCATE {&#39;</span> . $this-&gt;connection-&gt;escapeTable($this-&gt;table) . <span class="stringliteral">&#39;} &#39;</span>;
<a name="l00946"></a>00946   }
<a name="l00947"></a>00947 }
<a name="l00948"></a>00948 
<a name="l00952"></a><a class="code" href="classUpdateQuery.html">00952</a> <span class="keyword">class </span><a class="code" href="classUpdateQuery.html" title="General class for an abstracted UPDATE operation.">UpdateQuery</a> <span class="keyword">extends</span> <a class="code" href="classQuery.html" title="Base class for query builders.">Query</a> implements <a class="code" href="interfaceQueryConditionInterface.html" title="Interface for a conditional clause in a query.">QueryConditionInterface</a> {
<a name="l00953"></a>00953 
<a name="l00959"></a><a class="code" href="classUpdateQuery_ae5bf8255e204fb23d89b19a95b016351.html#ae5bf8255e204fb23d89b19a95b016351">00959</a>   <span class="keyword">protected</span> <a class="code" href="classUpdateQuery_ae5bf8255e204fb23d89b19a95b016351.html#ae5bf8255e204fb23d89b19a95b016351">$table</a>;
<a name="l00960"></a>00960 
<a name="l00966"></a><a class="code" href="classUpdateQuery_ae3451ca3244bafac9956982e263a5105.html#ae3451ca3244bafac9956982e263a5105">00966</a>   <span class="keyword">protected</span> <a class="code" href="classUpdateQuery_ae3451ca3244bafac9956982e263a5105.html#ae3451ca3244bafac9956982e263a5105">$fields</a> = array();
<a name="l00967"></a>00967 
<a name="l00973"></a><a class="code" href="classUpdateQuery_a083ad60a980eb8b4bada7a63eff93bf1.html#a083ad60a980eb8b4bada7a63eff93bf1">00973</a>   <span class="keyword">protected</span> <a class="code" href="classUpdateQuery_a083ad60a980eb8b4bada7a63eff93bf1.html#a083ad60a980eb8b4bada7a63eff93bf1">$arguments</a> = array();
<a name="l00974"></a>00974 
<a name="l00982"></a><a class="code" href="classUpdateQuery_a146b6ccfe8250eccd6158fecd3253a20.html#a146b6ccfe8250eccd6158fecd3253a20">00982</a>   <span class="keyword">protected</span> <a class="code" href="classUpdateQuery_a146b6ccfe8250eccd6158fecd3253a20.html#a146b6ccfe8250eccd6158fecd3253a20">$condition</a>;
<a name="l00983"></a>00983 
<a name="l00997"></a><a class="code" href="classUpdateQuery_a7edafa4a4a01a3818a96b6521ef878db.html#a7edafa4a4a01a3818a96b6521ef878db">00997</a>   <span class="keyword">protected</span> <a class="code" href="classUpdateQuery_a7edafa4a4a01a3818a96b6521ef878db.html#a7edafa4a4a01a3818a96b6521ef878db">$expressionFields</a> = array();
<a name="l00998"></a>00998 
<a name="l01009"></a><a class="code" href="classUpdateQuery_a55a718df235cde8e96776d9c96d4574e.html#a55a718df235cde8e96776d9c96d4574e">01009</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classUpdateQuery_a55a718df235cde8e96776d9c96d4574e.html#a55a718df235cde8e96776d9c96d4574e" title="Constructs an UpdateQuery object.">__construct</a>(<a class="code" href="classDatabaseConnection.html" title="Base Database API class.">DatabaseConnection</a> $connection, <a class="code" href="classUpdateQuery_ae5bf8255e204fb23d89b19a95b016351.html#ae5bf8255e204fb23d89b19a95b016351">$table</a>, array $options = array()) {
<a name="l01010"></a>01010     $options[<span class="stringliteral">&#39;return&#39;</span>] = <a class="code" href="classDatabase_a557879c7732a573ed395f9196afeb898.html#a557879c7732a573ed395f9196afeb898" title="Flag to indicate a query call should return the number of affected rows.">Database::RETURN_AFFECTED</a>;
<a name="l01011"></a>01011     <a class="code" href="classUpdateQuery_a55a718df235cde8e96776d9c96d4574e.html#a55a718df235cde8e96776d9c96d4574e" title="Constructs an UpdateQuery object.">parent::__construct</a>($connection, $options);
<a name="l01012"></a>01012     $this-&gt;table = <a class="code" href="classUpdateQuery_ae5bf8255e204fb23d89b19a95b016351.html#ae5bf8255e204fb23d89b19a95b016351">$table</a>;
<a name="l01013"></a>01013 
<a name="l01014"></a>01014     $this-&gt;<a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2" title="Implements QueryConditionInterface::condition().">condition</a> = <span class="keyword">new</span> <a class="code" href="classDatabaseCondition.html" title="Generic class for a series of conditions in a query.">DatabaseCondition</a>(<span class="stringliteral">&#39;AND&#39;</span>);
<a name="l01015"></a>01015   }
<a name="l01016"></a>01016 
<a name="l01020"></a><a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2">01020</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2" title="Implements QueryConditionInterface::condition().">condition</a>($field, $value = NULL, $operator = NULL) {
<a name="l01021"></a>01021     $this-&gt;<a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;condition($field, $value, $operator);
<a name="l01022"></a>01022     <span class="keywordflow">return</span> $this;
<a name="l01023"></a>01023   }
<a name="l01024"></a>01024 
<a name="l01028"></a><a class="code" href="classUpdateQuery_a027756e0adb3f423fd0c19ecbb3ec751.html#a027756e0adb3f423fd0c19ecbb3ec751">01028</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classUpdateQuery_a027756e0adb3f423fd0c19ecbb3ec751.html#a027756e0adb3f423fd0c19ecbb3ec751" title="Implements QueryConditionInterface::isNull().">isNull</a>($field) {
<a name="l01029"></a>01029     $this-&gt;<a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;isNull($field);
<a name="l01030"></a>01030     <span class="keywordflow">return</span> $this;
<a name="l01031"></a>01031   }
<a name="l01032"></a>01032 
<a name="l01036"></a><a class="code" href="classUpdateQuery_a703cf7e16e0dd4e78c61e4c6ea948795.html#a703cf7e16e0dd4e78c61e4c6ea948795">01036</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classUpdateQuery_a703cf7e16e0dd4e78c61e4c6ea948795.html#a703cf7e16e0dd4e78c61e4c6ea948795" title="Implements QueryConditionInterface::isNotNull().">isNotNull</a>($field) {
<a name="l01037"></a>01037     $this-&gt;<a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;isNotNull($field);
<a name="l01038"></a>01038     <span class="keywordflow">return</span> $this;
<a name="l01039"></a>01039   }
<a name="l01040"></a>01040 
<a name="l01044"></a><a class="code" href="classUpdateQuery_a04537fd021194c135a33c2e2f15d8493.html#a04537fd021194c135a33c2e2f15d8493">01044</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classUpdateQuery_a04537fd021194c135a33c2e2f15d8493.html#a04537fd021194c135a33c2e2f15d8493" title="Implements QueryConditionInterface::exists().">exists</a>(<a class="code" href="interfaceSelectQueryInterface.html" title="Interface definition for a Select Query object.">SelectQueryInterface</a> $select) {
<a name="l01045"></a>01045     $this-&gt;<a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;exists($select);
<a name="l01046"></a>01046     <span class="keywordflow">return</span> $this;
<a name="l01047"></a>01047   }
<a name="l01048"></a>01048 
<a name="l01052"></a><a class="code" href="classUpdateQuery_a0fdac99cf74b86a774f31848d4f98206.html#a0fdac99cf74b86a774f31848d4f98206">01052</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classUpdateQuery_a0fdac99cf74b86a774f31848d4f98206.html#a0fdac99cf74b86a774f31848d4f98206" title="Implements QueryConditionInterface::notExists().">notExists</a>(<a class="code" href="interfaceSelectQueryInterface.html" title="Interface definition for a Select Query object.">SelectQueryInterface</a> $select) {
<a name="l01053"></a>01053     $this-&gt;<a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;notExists($select);
<a name="l01054"></a>01054     <span class="keywordflow">return</span> $this;
<a name="l01055"></a>01055   }
<a name="l01056"></a>01056   
<a name="l01060"></a><a class="code" href="classUpdateQuery_a3c2a934f164d518ab4aeb5182e770a24.html#a3c2a934f164d518ab4aeb5182e770a24">01060</a>   <span class="keyword">public</span> <span class="keyword">function</span> &amp;<a class="code" href="classUpdateQuery_a3c2a934f164d518ab4aeb5182e770a24.html#a3c2a934f164d518ab4aeb5182e770a24" title="Implements QueryConditionInterface::conditions().">conditions</a>() {
<a name="l01061"></a>01061     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;conditions();
<a name="l01062"></a>01062   }
<a name="l01063"></a>01063 
<a name="l01067"></a><a class="code" href="classUpdateQuery_a2c4a12ea4382257466781f78aa813d06.html#a2c4a12ea4382257466781f78aa813d06">01067</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classUpdateQuery_a2c4a12ea4382257466781f78aa813d06.html#a2c4a12ea4382257466781f78aa813d06" title="Implements QueryConditionInterface::arguments().">arguments</a>() {
<a name="l01068"></a>01068     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;arguments();
<a name="l01069"></a>01069   }
<a name="l01070"></a>01070 
<a name="l01074"></a><a class="code" href="classUpdateQuery_a67603f742b3130dd34fd786b69de7ec1.html#a67603f742b3130dd34fd786b69de7ec1">01074</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classUpdateQuery_a67603f742b3130dd34fd786b69de7ec1.html#a67603f742b3130dd34fd786b69de7ec1" title="Implements QueryConditionInterface::where().">where</a>($snippet, $args = array()) {
<a name="l01075"></a>01075     $this-&gt;<a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;where($snippet, $args);
<a name="l01076"></a>01076     <span class="keywordflow">return</span> $this;
<a name="l01077"></a>01077   }
<a name="l01078"></a>01078 
<a name="l01082"></a><a class="code" href="classUpdateQuery_aea38d2404c542788180cd7fc8867f39d.html#aea38d2404c542788180cd7fc8867f39d">01082</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classUpdateQuery_aea38d2404c542788180cd7fc8867f39d.html#aea38d2404c542788180cd7fc8867f39d" title="Implements QueryConditionInterface::compile().">compile</a>(<a class="code" href="classDatabaseConnection.html" title="Base Database API class.">DatabaseConnection</a> $connection, <a class="code" href="interfaceQueryPlaceholderInterface.html" title="Interface for a query that accepts placeholders.">QueryPlaceholderInterface</a> $queryPlaceholder) {
<a name="l01083"></a>01083     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;compile($connection, $queryPlaceholder);
<a name="l01084"></a>01084   }
<a name="l01085"></a>01085 
<a name="l01089"></a><a class="code" href="classUpdateQuery_aa094828d0014df9d6893ddc61ea00852.html#aa094828d0014df9d6893ddc61ea00852">01089</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classUpdateQuery_aa094828d0014df9d6893ddc61ea00852.html#aa094828d0014df9d6893ddc61ea00852" title="Implements QueryConditionInterface::compiled().">compiled</a>() {
<a name="l01090"></a>01090     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;compiled();
<a name="l01091"></a>01091   }
<a name="l01092"></a>01092 
<a name="l01103"></a><a class="code" href="classUpdateQuery_a5d02f111de8cfe803a352c8ef0f89789.html#a5d02f111de8cfe803a352c8ef0f89789">01103</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classUpdateQuery_a5d02f111de8cfe803a352c8ef0f89789.html#a5d02f111de8cfe803a352c8ef0f89789" title="Adds a set of field-&gt;value pairs to be updated.">fields</a>(array <a class="code" href="classUpdateQuery_ae3451ca3244bafac9956982e263a5105.html#ae3451ca3244bafac9956982e263a5105">$fields</a>) {
<a name="l01104"></a>01104     $this-&gt;<a class="code" href="classUpdateQuery_a5d02f111de8cfe803a352c8ef0f89789.html#a5d02f111de8cfe803a352c8ef0f89789" title="Adds a set of field-&gt;value pairs to be updated.">fields</a> = <a class="code" href="classUpdateQuery_ae3451ca3244bafac9956982e263a5105.html#ae3451ca3244bafac9956982e263a5105">$fields</a>;
<a name="l01105"></a>01105     <span class="keywordflow">return</span> $this;
<a name="l01106"></a>01106   }
<a name="l01107"></a>01107 
<a name="l01126"></a><a class="code" href="classUpdateQuery_a57dc3eee898b5c5ddc21cb70e3978d3f.html#a57dc3eee898b5c5ddc21cb70e3978d3f">01126</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classUpdateQuery_a57dc3eee898b5c5ddc21cb70e3978d3f.html#a57dc3eee898b5c5ddc21cb70e3978d3f" title="Specifies fields to be updated as an expression.">expression</a>($field, $expression, array <a class="code" href="classUpdateQuery_a083ad60a980eb8b4bada7a63eff93bf1.html#a083ad60a980eb8b4bada7a63eff93bf1">$arguments</a> = NULL) {
<a name="l01127"></a>01127     $this-&gt;expressionFields[$field] = array(
<a name="l01128"></a>01128       <span class="stringliteral">&#39;expression&#39;</span> =&gt; $expression,
<a name="l01129"></a>01129       <span class="stringliteral">&#39;arguments&#39;</span> =&gt; <a class="code" href="classUpdateQuery_a083ad60a980eb8b4bada7a63eff93bf1.html#a083ad60a980eb8b4bada7a63eff93bf1">$arguments</a>,
<a name="l01130"></a>01130     );
<a name="l01131"></a>01131 
<a name="l01132"></a>01132     <span class="keywordflow">return</span> $this;
<a name="l01133"></a>01133   }
<a name="l01134"></a>01134 
<a name="l01141"></a><a class="code" href="classUpdateQuery_a8a90104d1f7aa75cda332b569fd566b9.html#a8a90104d1f7aa75cda332b569fd566b9">01141</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classUpdateQuery_a8a90104d1f7aa75cda332b569fd566b9.html#a8a90104d1f7aa75cda332b569fd566b9" title="Executes the UPDATE query.">execute</a>() {
<a name="l01142"></a>01142 
<a name="l01143"></a>01143     <span class="comment">// Expressions take priority over literal fields, so we process those first</span>
<a name="l01144"></a>01144     <span class="comment">// and remove any literal fields that conflict.</span>
<a name="l01145"></a>01145     <a class="code" href="classUpdateQuery_ae3451ca3244bafac9956982e263a5105.html#ae3451ca3244bafac9956982e263a5105">$fields</a> = $this-&gt;<a class="code" href="classUpdateQuery_a5d02f111de8cfe803a352c8ef0f89789.html#a5d02f111de8cfe803a352c8ef0f89789" title="Adds a set of field-&gt;value pairs to be updated.">fields</a>;
<a name="l01146"></a>01146     $update_values = array();
<a name="l01147"></a>01147     <span class="keywordflow">foreach</span> ($this-&gt;expressionFields as $field =&gt; $data) {
<a name="l01148"></a>01148       <span class="keywordflow">if</span> (!empty($data[<span class="stringliteral">&#39;arguments&#39;</span>])) {
<a name="l01149"></a>01149         $update_values += $data[<span class="stringliteral">&#39;arguments&#39;</span>];
<a name="l01150"></a>01150       }
<a name="l01151"></a>01151       unset(<a class="code" href="classUpdateQuery_ae3451ca3244bafac9956982e263a5105.html#ae3451ca3244bafac9956982e263a5105">$fields</a>[$field]);
<a name="l01152"></a>01152     }
<a name="l01153"></a>01153 
<a name="l01154"></a>01154     <span class="comment">// Because we filter $fields the same way here and in __toString(), the</span>
<a name="l01155"></a>01155     <span class="comment">// placeholders will all match up properly.</span>
<a name="l01156"></a>01156     $max_placeholder = 0;
<a name="l01157"></a>01157     <span class="keywordflow">foreach</span> (<a class="code" href="classUpdateQuery_ae3451ca3244bafac9956982e263a5105.html#ae3451ca3244bafac9956982e263a5105">$fields</a> as $field =&gt; $value) {
<a name="l01158"></a>01158       $update_values[<span class="stringliteral">&#39;:db_update_placeholder_&#39;</span> . ($max_placeholder++)] = $value;
<a name="l01159"></a>01159     }
<a name="l01160"></a>01160 
<a name="l01161"></a>01161     <span class="keywordflow">if</span> (count($this-&gt;<a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2" title="Implements QueryConditionInterface::condition().">condition</a>)) {
<a name="l01162"></a>01162       $this-&gt;<a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;compile($this-&gt;connection, $this);
<a name="l01163"></a>01163       $update_values = array_merge($update_values, $this-&gt;<a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;arguments());
<a name="l01164"></a>01164     }
<a name="l01165"></a>01165 
<a name="l01166"></a>01166     <span class="keywordflow">return</span> $this-&gt;connection-&gt;query((<span class="keywordtype">string</span>) $this, $update_values, $this-&gt;queryOptions);
<a name="l01167"></a>01167   }
<a name="l01168"></a>01168 
<a name="l01175"></a><a class="code" href="classUpdateQuery_ac85d757de811a3563119e453e8b356a0.html#ac85d757de811a3563119e453e8b356a0">01175</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classUpdateQuery_ac85d757de811a3563119e453e8b356a0.html#ac85d757de811a3563119e453e8b356a0" title="Implements PHP magic __toString method to convert the query to a string.">__toString</a>() {
<a name="l01176"></a>01176     <span class="comment">// Create a sanitized comment string to prepend to the query.</span>
<a name="l01177"></a>01177     <a class="code" href="classQuery_ab545c0037b0e730712d965cd95f51d2e.html#ab545c0037b0e730712d965cd95f51d2e">$comments</a> = $this-&gt;connection-&gt;makeComment($this-&gt;comments);
<a name="l01178"></a>01178 
<a name="l01179"></a>01179     <span class="comment">// Expressions take priority over literal fields, so we process those first</span>
<a name="l01180"></a>01180     <span class="comment">// and remove any literal fields that conflict.</span>
<a name="l01181"></a>01181     <a class="code" href="classUpdateQuery_ae3451ca3244bafac9956982e263a5105.html#ae3451ca3244bafac9956982e263a5105">$fields</a> = $this-&gt;<a class="code" href="classUpdateQuery_a5d02f111de8cfe803a352c8ef0f89789.html#a5d02f111de8cfe803a352c8ef0f89789" title="Adds a set of field-&gt;value pairs to be updated.">fields</a>;
<a name="l01182"></a>01182     $update_fields = array();
<a name="l01183"></a>01183     <span class="keywordflow">foreach</span> ($this-&gt;expressionFields as $field =&gt; $data) {
<a name="l01184"></a>01184       $update_fields[] = $field . <span class="charliteral">&#39;=&#39;</span> . $data[<span class="stringliteral">&#39;expression&#39;</span>];
<a name="l01185"></a>01185       unset(<a class="code" href="classUpdateQuery_ae3451ca3244bafac9956982e263a5105.html#ae3451ca3244bafac9956982e263a5105">$fields</a>[$field]);
<a name="l01186"></a>01186     }
<a name="l01187"></a>01187 
<a name="l01188"></a>01188     $max_placeholder = 0;
<a name="l01189"></a>01189     <span class="keywordflow">foreach</span> (<a class="code" href="classUpdateQuery_ae3451ca3244bafac9956982e263a5105.html#ae3451ca3244bafac9956982e263a5105">$fields</a> as $field =&gt; $value) {
<a name="l01190"></a>01190       $update_fields[] = $field . <span class="stringliteral">&#39;=:db_update_placeholder_&#39;</span> . ($max_placeholder++);
<a name="l01191"></a>01191     }
<a name="l01192"></a>01192 
<a name="l01193"></a>01193     $query = <a class="code" href="classQuery_ab545c0037b0e730712d965cd95f51d2e.html#ab545c0037b0e730712d965cd95f51d2e">$comments</a> . <span class="stringliteral">&#39;UPDATE {&#39;</span> . $this-&gt;connection-&gt;escapeTable($this-&gt;table) . <span class="stringliteral">&#39;} SET &#39;</span> . implode(<span class="stringliteral">&#39;, &#39;</span>, $update_fields);
<a name="l01194"></a>01194 
<a name="l01195"></a>01195     <span class="keywordflow">if</span> (count($this-&gt;<a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2" title="Implements QueryConditionInterface::condition().">condition</a>)) {
<a name="l01196"></a>01196       $this-&gt;<a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;compile($this-&gt;connection, $this);
<a name="l01197"></a>01197       <span class="comment">// There is an implicit string cast on $this-&gt;condition.</span>
<a name="l01198"></a>01198       $query .= <span class="stringliteral">&quot;\nWHERE &quot;</span> . $this-&gt;<a class="code" href="classUpdateQuery_a850350cb972f539accbecf07daec23d2.html#a850350cb972f539accbecf07daec23d2" title="Implements QueryConditionInterface::condition().">condition</a>;
<a name="l01199"></a>01199     }
<a name="l01200"></a>01200 
<a name="l01201"></a>01201     <span class="keywordflow">return</span> $query;
<a name="l01202"></a>01202   }
<a name="l01203"></a>01203 
<a name="l01204"></a>01204 }
<a name="l01205"></a>01205 
<a name="l01243"></a><a class="code" href="classMergeQuery.html">01243</a> <span class="keyword">class </span><a class="code" href="classMergeQuery.html" title="General class for an abstracted MERGE query operation.">MergeQuery</a> <span class="keyword">extends</span> <a class="code" href="classQuery.html" title="Base class for query builders.">Query</a> implements <a class="code" href="interfaceQueryConditionInterface.html" title="Interface for a conditional clause in a query.">QueryConditionInterface</a> {
<a name="l01247"></a><a class="code" href="classMergeQuery_a42f1aad21544decc65082fc10fd2d68a.html#a42f1aad21544decc65082fc10fd2d68a">01247</a>   <span class="keyword">const</span> <a class="code" href="classMergeQuery_a42f1aad21544decc65082fc10fd2d68a.html#a42f1aad21544decc65082fc10fd2d68a" title="Returned by execute() if an INSERT query has been executed.">STATUS_INSERT</a> = 1;
<a name="l01248"></a>01248 
<a name="l01252"></a><a class="code" href="classMergeQuery_ad79d3ece9a03a3a63bef6560e90fc776.html#ad79d3ece9a03a3a63bef6560e90fc776">01252</a>   <span class="keyword">const</span> <a class="code" href="classMergeQuery_ad79d3ece9a03a3a63bef6560e90fc776.html#ad79d3ece9a03a3a63bef6560e90fc776" title="Returned by execute() if an UPDATE query has been executed.">STATUS_UPDATE</a> = 2;
<a name="l01253"></a>01253 
<a name="l01259"></a><a class="code" href="classMergeQuery_ae375df4f0a8f48bf72fe6ab37260fd80.html#ae375df4f0a8f48bf72fe6ab37260fd80">01259</a>   <span class="keyword">protected</span> <a class="code" href="classMergeQuery_ae375df4f0a8f48bf72fe6ab37260fd80.html#ae375df4f0a8f48bf72fe6ab37260fd80">$table</a>;
<a name="l01260"></a>01260 
<a name="l01264"></a><a class="code" href="classMergeQuery_a8f593caec31bdbc33f24bd741a58a6e5.html#a8f593caec31bdbc33f24bd741a58a6e5">01264</a>   <span class="keyword">protected</span> <a class="code" href="classMergeQuery_a8f593caec31bdbc33f24bd741a58a6e5.html#a8f593caec31bdbc33f24bd741a58a6e5" title="The table or subquery to be used for the condition.">$conditionTable</a>;
<a name="l01265"></a>01265 
<a name="l01271"></a><a class="code" href="classMergeQuery_a9e1b39641ffd4d38d1a2841093e9e7a2.html#a9e1b39641ffd4d38d1a2841093e9e7a2">01271</a>   <span class="keyword">protected</span> <a class="code" href="classMergeQuery_a9e1b39641ffd4d38d1a2841093e9e7a2.html#a9e1b39641ffd4d38d1a2841093e9e7a2">$insertFields</a> = array();
<a name="l01272"></a>01272 
<a name="l01280"></a><a class="code" href="classMergeQuery_aeb3068d044d43b3e42e79a669fa12d2b.html#aeb3068d044d43b3e42e79a669fa12d2b">01280</a>   <span class="keyword">protected</span> <a class="code" href="classMergeQuery_aeb3068d044d43b3e42e79a669fa12d2b.html#aeb3068d044d43b3e42e79a669fa12d2b">$defaultFields</a> = array();
<a name="l01281"></a>01281 
<a name="l01287"></a><a class="code" href="classMergeQuery_aac37e8468f4dcc9c32d4f9cc35500a63.html#aac37e8468f4dcc9c32d4f9cc35500a63">01287</a>   <span class="keyword">protected</span> <a class="code" href="classMergeQuery_aac37e8468f4dcc9c32d4f9cc35500a63.html#aac37e8468f4dcc9c32d4f9cc35500a63">$insertValues</a> = array();
<a name="l01288"></a>01288 
<a name="l01294"></a><a class="code" href="classMergeQuery_af645d2050434800e71ad0752f2bd7733.html#af645d2050434800e71ad0752f2bd7733">01294</a>   <span class="keyword">protected</span> <a class="code" href="classMergeQuery_af645d2050434800e71ad0752f2bd7733.html#af645d2050434800e71ad0752f2bd7733">$updateFields</a> = array();
<a name="l01295"></a>01295 
<a name="l01309"></a><a class="code" href="classMergeQuery_a6f164b0b45b4b6b87b3cdee3e33d6a1d.html#a6f164b0b45b4b6b87b3cdee3e33d6a1d">01309</a>   <span class="keyword">protected</span> <a class="code" href="classMergeQuery_a6f164b0b45b4b6b87b3cdee3e33d6a1d.html#a6f164b0b45b4b6b87b3cdee3e33d6a1d">$expressionFields</a> = array();
<a name="l01310"></a>01310 
<a name="l01316"></a><a class="code" href="classMergeQuery_a2aa680e4b114585b291446f9f0d887e4.html#a2aa680e4b114585b291446f9f0d887e4">01316</a>   <span class="keyword">protected</span> <a class="code" href="classMergeQuery_a2aa680e4b114585b291446f9f0d887e4.html#a2aa680e4b114585b291446f9f0d887e4">$needsUpdate</a> = FALSE;
<a name="l01317"></a>01317 
<a name="l01328"></a><a class="code" href="classMergeQuery_a05ba5cf13796317567a0344cf58a028c.html#a05ba5cf13796317567a0344cf58a028c">01328</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_a05ba5cf13796317567a0344cf58a028c.html#a05ba5cf13796317567a0344cf58a028c" title="Constructs a MergeQuery object.">__construct</a>(<a class="code" href="classDatabaseConnection.html" title="Base Database API class.">DatabaseConnection</a> $connection, <a class="code" href="classMergeQuery_ae375df4f0a8f48bf72fe6ab37260fd80.html#ae375df4f0a8f48bf72fe6ab37260fd80">$table</a>, array $options = array()) {
<a name="l01329"></a>01329     $options[<span class="stringliteral">&#39;return&#39;</span>] = <a class="code" href="classDatabase_a557879c7732a573ed395f9196afeb898.html#a557879c7732a573ed395f9196afeb898" title="Flag to indicate a query call should return the number of affected rows.">Database::RETURN_AFFECTED</a>;
<a name="l01330"></a>01330     <a class="code" href="classMergeQuery_a05ba5cf13796317567a0344cf58a028c.html#a05ba5cf13796317567a0344cf58a028c" title="Constructs a MergeQuery object.">parent::__construct</a>($connection, $options);
<a name="l01331"></a>01331     $this-&gt;table = <a class="code" href="classMergeQuery_ae375df4f0a8f48bf72fe6ab37260fd80.html#ae375df4f0a8f48bf72fe6ab37260fd80">$table</a>;
<a name="l01332"></a>01332     $this-&gt;<a class="code" href="classMergeQuery_a0dbb5c2ac711fede2344a02cc49b0efb.html#a0dbb5c2ac711fede2344a02cc49b0efb" title="Sets the table or subquery to be used for the condition.">conditionTable</a> = <a class="code" href="classMergeQuery_ae375df4f0a8f48bf72fe6ab37260fd80.html#ae375df4f0a8f48bf72fe6ab37260fd80">$table</a>;
<a name="l01333"></a>01333     $this-&gt;<a class="code" href="classMergeQuery_a40d55b36952248da6d8eabb0eb1a8430.html#a40d55b36952248da6d8eabb0eb1a8430" title="Implements QueryConditionInterface::condition().">condition</a> = <span class="keyword">new</span> <a class="code" href="classDatabaseCondition.html" title="Generic class for a series of conditions in a query.">DatabaseCondition</a>(<span class="stringliteral">&#39;AND&#39;</span>);
<a name="l01334"></a>01334   }
<a name="l01335"></a>01335 
<a name="l01346"></a><a class="code" href="classMergeQuery_a0dbb5c2ac711fede2344a02cc49b0efb.html#a0dbb5c2ac711fede2344a02cc49b0efb">01346</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_a0dbb5c2ac711fede2344a02cc49b0efb.html#a0dbb5c2ac711fede2344a02cc49b0efb" title="Sets the table or subquery to be used for the condition.">conditionTable</a>(<a class="code" href="classMergeQuery_ae375df4f0a8f48bf72fe6ab37260fd80.html#ae375df4f0a8f48bf72fe6ab37260fd80">$table</a>) {
<a name="l01347"></a>01347     $this-&gt;<a class="code" href="classMergeQuery_a0dbb5c2ac711fede2344a02cc49b0efb.html#a0dbb5c2ac711fede2344a02cc49b0efb" title="Sets the table or subquery to be used for the condition.">conditionTable</a> = <a class="code" href="classMergeQuery_ae375df4f0a8f48bf72fe6ab37260fd80.html#ae375df4f0a8f48bf72fe6ab37260fd80">$table</a>;
<a name="l01348"></a>01348     <span class="keywordflow">return</span> $this;
<a name="l01349"></a>01349   }
<a name="l01350"></a>01350 
<a name="l01361"></a><a class="code" href="classMergeQuery_ad5b51b48eaec3821181cf8e6c09bf29e.html#ad5b51b48eaec3821181cf8e6c09bf29e">01361</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_ad5b51b48eaec3821181cf8e6c09bf29e.html#ad5b51b48eaec3821181cf8e6c09bf29e" title="Adds a set of field-&gt;value pairs to be updated.">updateFields</a>(array $fields) {
<a name="l01362"></a>01362     $this-&gt;<a class="code" href="classMergeQuery_ad5b51b48eaec3821181cf8e6c09bf29e.html#ad5b51b48eaec3821181cf8e6c09bf29e" title="Adds a set of field-&gt;value pairs to be updated.">updateFields</a> = $fields;
<a name="l01363"></a>01363     $this-&gt;needsUpdate = TRUE;
<a name="l01364"></a>01364     <span class="keywordflow">return</span> $this;
<a name="l01365"></a>01365   }
<a name="l01366"></a>01366 
<a name="l01386"></a><a class="code" href="classMergeQuery_a09f35077e2adc871dcdd75efedbeabe0.html#a09f35077e2adc871dcdd75efedbeabe0">01386</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_a09f35077e2adc871dcdd75efedbeabe0.html#a09f35077e2adc871dcdd75efedbeabe0" title="Specifies fields to be updated as an expression.">expression</a>($field, $expression, array $arguments = NULL) {
<a name="l01387"></a>01387     $this-&gt;expressionFields[$field] = array(
<a name="l01388"></a>01388       <span class="stringliteral">&#39;expression&#39;</span> =&gt; $expression,
<a name="l01389"></a>01389       <span class="stringliteral">&#39;arguments&#39;</span> =&gt; $arguments,
<a name="l01390"></a>01390     );
<a name="l01391"></a>01391     $this-&gt;needsUpdate = TRUE;
<a name="l01392"></a>01392     <span class="keywordflow">return</span> $this;
<a name="l01393"></a>01393   }
<a name="l01394"></a>01394 
<a name="l01411"></a><a class="code" href="classMergeQuery_a1c1fef20258dad469a0853fdaddaae4e.html#a1c1fef20258dad469a0853fdaddaae4e">01411</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_a1c1fef20258dad469a0853fdaddaae4e.html#a1c1fef20258dad469a0853fdaddaae4e" title="Adds a set of field-&gt;value pairs to be inserted.">insertFields</a>(array $fields, array $values = array()) {
<a name="l01412"></a>01412     <span class="keywordflow">if</span> ($values) {
<a name="l01413"></a>01413       $fields = array_combine($fields, $values);
<a name="l01414"></a>01414     }
<a name="l01415"></a>01415     $this-&gt;<a class="code" href="classMergeQuery_a1c1fef20258dad469a0853fdaddaae4e.html#a1c1fef20258dad469a0853fdaddaae4e" title="Adds a set of field-&gt;value pairs to be inserted.">insertFields</a> = $fields;
<a name="l01416"></a>01416     <span class="keywordflow">return</span> $this;
<a name="l01417"></a>01417   }
<a name="l01418"></a>01418 
<a name="l01438"></a><a class="code" href="classMergeQuery_a630cdd152352b1229cc712ec261139cf.html#a630cdd152352b1229cc712ec261139cf">01438</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_a630cdd152352b1229cc712ec261139cf.html#a630cdd152352b1229cc712ec261139cf" title="Specifies fields for which the database-defaults should be used.">useDefaults</a>(array $fields) {
<a name="l01439"></a>01439     $this-&gt;defaultFields = $fields;
<a name="l01440"></a>01440     <span class="keywordflow">return</span> $this;
<a name="l01441"></a>01441   }
<a name="l01442"></a>01442 
<a name="l01464"></a><a class="code" href="classMergeQuery_ae58f2865c72dfc4c310ec4c17fd4e72d.html#ae58f2865c72dfc4c310ec4c17fd4e72d">01464</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_ae58f2865c72dfc4c310ec4c17fd4e72d.html#ae58f2865c72dfc4c310ec4c17fd4e72d" title="Sets common field-value pairs in the INSERT and UPDATE query parts.">fields</a>(array $fields, array $values = array()) {
<a name="l01465"></a>01465     <span class="keywordflow">if</span> ($values) {
<a name="l01466"></a>01466       $fields = array_combine($fields, $values);
<a name="l01467"></a>01467     }
<a name="l01468"></a>01468     <span class="keywordflow">foreach</span> ($fields as $key =&gt; $value) {
<a name="l01469"></a>01469       $this-&gt;<a class="code" href="classMergeQuery_a1c1fef20258dad469a0853fdaddaae4e.html#a1c1fef20258dad469a0853fdaddaae4e" title="Adds a set of field-&gt;value pairs to be inserted.">insertFields</a>[$key] = $value;
<a name="l01470"></a>01470       $this-&gt;<a class="code" href="classMergeQuery_ad5b51b48eaec3821181cf8e6c09bf29e.html#ad5b51b48eaec3821181cf8e6c09bf29e" title="Adds a set of field-&gt;value pairs to be updated.">updateFields</a>[$key] = $value;
<a name="l01471"></a>01471     }
<a name="l01472"></a>01472     $this-&gt;needsUpdate = TRUE;
<a name="l01473"></a>01473     <span class="keywordflow">return</span> $this;
<a name="l01474"></a>01474   }
<a name="l01475"></a>01475 
<a name="l01498"></a><a class="code" href="classMergeQuery_aa34f8ac97b0571d49fbc20557dfce97b.html#aa34f8ac97b0571d49fbc20557dfce97b">01498</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_aa34f8ac97b0571d49fbc20557dfce97b.html#aa34f8ac97b0571d49fbc20557dfce97b" title="Sets the key field(s) to be used as conditions for this query.">key</a>(array $fields, array $values = array()) {
<a name="l01499"></a>01499     <span class="keywordflow">if</span> ($values) {
<a name="l01500"></a>01500       $fields = array_combine($fields, $values);
<a name="l01501"></a>01501     }
<a name="l01502"></a>01502     <span class="keywordflow">foreach</span> ($fields as $key =&gt; $value) {
<a name="l01503"></a>01503       $this-&gt;<a class="code" href="classMergeQuery_a1c1fef20258dad469a0853fdaddaae4e.html#a1c1fef20258dad469a0853fdaddaae4e" title="Adds a set of field-&gt;value pairs to be inserted.">insertFields</a>[$key] = $value;
<a name="l01504"></a>01504       $this-&gt;<a class="code" href="classMergeQuery_a40d55b36952248da6d8eabb0eb1a8430.html#a40d55b36952248da6d8eabb0eb1a8430" title="Implements QueryConditionInterface::condition().">condition</a>($key, $value);
<a name="l01505"></a>01505     }
<a name="l01506"></a>01506     <span class="keywordflow">return</span> $this;
<a name="l01507"></a>01507   }
<a name="l01508"></a>01508 
<a name="l01512"></a><a class="code" href="classMergeQuery_a40d55b36952248da6d8eabb0eb1a8430.html#a40d55b36952248da6d8eabb0eb1a8430">01512</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_a40d55b36952248da6d8eabb0eb1a8430.html#a40d55b36952248da6d8eabb0eb1a8430" title="Implements QueryConditionInterface::condition().">condition</a>($field, $value = NULL, $operator = NULL) {
<a name="l01513"></a>01513     $this-&gt;<a class="code" href="classMergeQuery_a40d55b36952248da6d8eabb0eb1a8430.html#a40d55b36952248da6d8eabb0eb1a8430" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;condition($field, $value, $operator);
<a name="l01514"></a>01514     <span class="keywordflow">return</span> $this;
<a name="l01515"></a>01515   }
<a name="l01516"></a>01516 
<a name="l01520"></a><a class="code" href="classMergeQuery_a010c4f710e0e242d9d89383a49573376.html#a010c4f710e0e242d9d89383a49573376">01520</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_a010c4f710e0e242d9d89383a49573376.html#a010c4f710e0e242d9d89383a49573376" title="Implements QueryConditionInterface::isNull().">isNull</a>($field) {
<a name="l01521"></a>01521     $this-&gt;<a class="code" href="classMergeQuery_a40d55b36952248da6d8eabb0eb1a8430.html#a40d55b36952248da6d8eabb0eb1a8430" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;isNull($field);
<a name="l01522"></a>01522     <span class="keywordflow">return</span> $this;
<a name="l01523"></a>01523   }
<a name="l01524"></a>01524 
<a name="l01528"></a><a class="code" href="classMergeQuery_a6eda0759442dcb9cfa940e5ced5cc7ba.html#a6eda0759442dcb9cfa940e5ced5cc7ba">01528</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_a6eda0759442dcb9cfa940e5ced5cc7ba.html#a6eda0759442dcb9cfa940e5ced5cc7ba" title="Implements QueryConditionInterface::isNotNull().">isNotNull</a>($field) {
<a name="l01529"></a>01529     $this-&gt;<a class="code" href="classMergeQuery_a40d55b36952248da6d8eabb0eb1a8430.html#a40d55b36952248da6d8eabb0eb1a8430" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;isNotNull($field);
<a name="l01530"></a>01530     <span class="keywordflow">return</span> $this;
<a name="l01531"></a>01531   }
<a name="l01532"></a>01532 
<a name="l01536"></a><a class="code" href="classMergeQuery_a0a92a08ad6933ecc4a796e9d50ea85f5.html#a0a92a08ad6933ecc4a796e9d50ea85f5">01536</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_a0a92a08ad6933ecc4a796e9d50ea85f5.html#a0a92a08ad6933ecc4a796e9d50ea85f5" title="Implements QueryConditionInterface::exists().">exists</a>(<a class="code" href="interfaceSelectQueryInterface.html" title="Interface definition for a Select Query object.">SelectQueryInterface</a> $select) {
<a name="l01537"></a>01537     $this-&gt;<a class="code" href="classMergeQuery_a40d55b36952248da6d8eabb0eb1a8430.html#a40d55b36952248da6d8eabb0eb1a8430" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;exists($select);
<a name="l01538"></a>01538     <span class="keywordflow">return</span> $this;
<a name="l01539"></a>01539   }
<a name="l01540"></a>01540 
<a name="l01544"></a><a class="code" href="classMergeQuery_a3749f7ccb2e71b8ff1570161418cbf2b.html#a3749f7ccb2e71b8ff1570161418cbf2b">01544</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_a3749f7ccb2e71b8ff1570161418cbf2b.html#a3749f7ccb2e71b8ff1570161418cbf2b" title="Implements QueryConditionInterface::notExists().">notExists</a>(<a class="code" href="interfaceSelectQueryInterface.html" title="Interface definition for a Select Query object.">SelectQueryInterface</a> $select) {
<a name="l01545"></a>01545     $this-&gt;<a class="code" href="classMergeQuery_a40d55b36952248da6d8eabb0eb1a8430.html#a40d55b36952248da6d8eabb0eb1a8430" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;notExists($select);
<a name="l01546"></a>01546     <span class="keywordflow">return</span> $this;
<a name="l01547"></a>01547   }
<a name="l01548"></a>01548   
<a name="l01552"></a><a class="code" href="classMergeQuery_a759f840d106e79a119d9130d09123b8d.html#a759f840d106e79a119d9130d09123b8d">01552</a>   <span class="keyword">public</span> <span class="keyword">function</span> &amp;<a class="code" href="classMergeQuery_a759f840d106e79a119d9130d09123b8d.html#a759f840d106e79a119d9130d09123b8d" title="Implements QueryConditionInterface::conditions().">conditions</a>() {
<a name="l01553"></a>01553     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classMergeQuery_a40d55b36952248da6d8eabb0eb1a8430.html#a40d55b36952248da6d8eabb0eb1a8430" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;conditions();
<a name="l01554"></a>01554   }
<a name="l01555"></a>01555 
<a name="l01559"></a><a class="code" href="classMergeQuery_aa059b4fd2916e10075582091bfa03975.html#aa059b4fd2916e10075582091bfa03975">01559</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_aa059b4fd2916e10075582091bfa03975.html#aa059b4fd2916e10075582091bfa03975" title="Implements QueryConditionInterface::arguments().">arguments</a>() {
<a name="l01560"></a>01560     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classMergeQuery_a40d55b36952248da6d8eabb0eb1a8430.html#a40d55b36952248da6d8eabb0eb1a8430" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;arguments();
<a name="l01561"></a>01561   }
<a name="l01562"></a>01562 
<a name="l01566"></a><a class="code" href="classMergeQuery_a1d46b2fc285ec9f402ac53800e3cd58f.html#a1d46b2fc285ec9f402ac53800e3cd58f">01566</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_a1d46b2fc285ec9f402ac53800e3cd58f.html#a1d46b2fc285ec9f402ac53800e3cd58f" title="Implements QueryConditionInterface::where().">where</a>($snippet, $args = array()) {
<a name="l01567"></a>01567     $this-&gt;<a class="code" href="classMergeQuery_a40d55b36952248da6d8eabb0eb1a8430.html#a40d55b36952248da6d8eabb0eb1a8430" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;where($snippet, $args);
<a name="l01568"></a>01568     <span class="keywordflow">return</span> $this;
<a name="l01569"></a>01569   }
<a name="l01570"></a>01570 
<a name="l01574"></a><a class="code" href="classMergeQuery_a33436167b6e2ddc710b2a51db146ea67.html#a33436167b6e2ddc710b2a51db146ea67">01574</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_a33436167b6e2ddc710b2a51db146ea67.html#a33436167b6e2ddc710b2a51db146ea67" title="Implements QueryConditionInterface::compile().">compile</a>(<a class="code" href="classDatabaseConnection.html" title="Base Database API class.">DatabaseConnection</a> $connection, <a class="code" href="interfaceQueryPlaceholderInterface.html" title="Interface for a query that accepts placeholders.">QueryPlaceholderInterface</a> $queryPlaceholder) {
<a name="l01575"></a>01575     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classMergeQuery_a40d55b36952248da6d8eabb0eb1a8430.html#a40d55b36952248da6d8eabb0eb1a8430" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;compile($connection, $queryPlaceholder);
<a name="l01576"></a>01576   }
<a name="l01577"></a>01577 
<a name="l01581"></a><a class="code" href="classMergeQuery_ab6c0c905db976734e61d6ef997bd3a6a.html#ab6c0c905db976734e61d6ef997bd3a6a">01581</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_ab6c0c905db976734e61d6ef997bd3a6a.html#ab6c0c905db976734e61d6ef997bd3a6a" title="Implements QueryConditionInterface::compiled().">compiled</a>() {
<a name="l01582"></a>01582     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classMergeQuery_a40d55b36952248da6d8eabb0eb1a8430.html#a40d55b36952248da6d8eabb0eb1a8430" title="Implements QueryConditionInterface::condition().">condition</a>-&gt;compiled();
<a name="l01583"></a>01583   }
<a name="l01584"></a>01584 
<a name="l01594"></a><a class="code" href="classMergeQuery_a66c98a8761c91bb633c4ea09ce0c467c.html#a66c98a8761c91bb633c4ea09ce0c467c">01594</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_a66c98a8761c91bb633c4ea09ce0c467c.html#a66c98a8761c91bb633c4ea09ce0c467c" title="Implements PHP magic __toString method to convert the query to a string.">__toString</a>() {
<a name="l01595"></a>01595   }
<a name="l01596"></a>01596 
<a name="l01597"></a><a class="code" href="classMergeQuery_aeea46fdb119752efd2048d66b9fe8de8.html#aeea46fdb119752efd2048d66b9fe8de8">01597</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classMergeQuery_aeea46fdb119752efd2048d66b9fe8de8.html#aeea46fdb119752efd2048d66b9fe8de8" title="Runs the query against the database.">execute</a>() {
<a name="l01598"></a>01598     <span class="comment">// Wrap multiple queries in a transaction, if the database supports it.</span>
<a name="l01599"></a>01599     $transaction = $this-&gt;connection-&gt;startTransaction();
<a name="l01600"></a>01600     <span class="keywordflow">try</span> {
<a name="l01601"></a>01601       <span class="keywordflow">if</span> (!count($this-&gt;<a class="code" href="classMergeQuery_a40d55b36952248da6d8eabb0eb1a8430.html#a40d55b36952248da6d8eabb0eb1a8430" title="Implements QueryConditionInterface::condition().">condition</a>)) {
<a name="l01602"></a>01602         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classInvalidMergeQueryException.html" title="Exception thrown for merge queries that do not make semantic sense.">InvalidMergeQueryException</a>(<a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;Invalid merge query: no conditions&#39;</span>));
<a name="l01603"></a>01603       }
<a name="l01604"></a>01604       $select = $this-&gt;connection-&gt;select($this-&gt;<a class="code" href="classMergeQuery_a0dbb5c2ac711fede2344a02cc49b0efb.html#a0dbb5c2ac711fede2344a02cc49b0efb" title="Sets the table or subquery to be used for the condition.">conditionTable</a>)
<a name="l01605"></a>01605         -&gt;condition($this-&gt;<a class="code" href="classMergeQuery_a40d55b36952248da6d8eabb0eb1a8430.html#a40d55b36952248da6d8eabb0eb1a8430" title="Implements QueryConditionInterface::condition().">condition</a>)
<a name="l01606"></a>01606         -&gt;forUpdate();
<a name="l01607"></a>01607       $select-&gt;addExpression(<span class="charliteral">&#39;1&#39;</span>);
<a name="l01608"></a>01608       <span class="keywordflow">if</span> (!$select-&gt;execute()-&gt;fetchField()) {
<a name="l01609"></a>01609         <span class="keywordflow">try</span> {
<a name="l01610"></a>01610           $insert = $this-&gt;connection-&gt;insert($this-&gt;table)-&gt;fields($this-&gt;<a class="code" href="classMergeQuery_a1c1fef20258dad469a0853fdaddaae4e.html#a1c1fef20258dad469a0853fdaddaae4e" title="Adds a set of field-&gt;value pairs to be inserted.">insertFields</a>);
<a name="l01611"></a>01611           <span class="keywordflow">if</span> ($this-&gt;defaultFields) {
<a name="l01612"></a>01612             $insert-&gt;useDefaults($this-&gt;defaultFields);
<a name="l01613"></a>01613           }
<a name="l01614"></a>01614           $insert-&gt;execute();
<a name="l01615"></a>01615           <span class="keywordflow">return</span> <a class="code" href="classMergeQuery_a42f1aad21544decc65082fc10fd2d68a.html#a42f1aad21544decc65082fc10fd2d68a" title="Returned by execute() if an INSERT query has been executed.">MergeQuery::STATUS_INSERT</a>;
<a name="l01616"></a>01616         }
<a name="l01617"></a>01617         <span class="keywordflow">catch</span> (<a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> $e) {
<a name="l01618"></a>01618           <span class="comment">// The insert query failed, maybe it&#39;s because a racing insert query</span>
<a name="l01619"></a>01619           <span class="comment">// beat us in inserting the same row. Retry the select query, if it</span>
<a name="l01620"></a>01620           <span class="comment">// returns a row, ignore the error and continue with the update</span>
<a name="l01621"></a>01621           <span class="comment">// query below.</span>
<a name="l01622"></a>01622           <span class="keywordflow">if</span> (!$select-&gt;execute()-&gt;fetchField()) {
<a name="l01623"></a>01623             <span class="keywordflow">throw</span> $e;
<a name="l01624"></a>01624           }
<a name="l01625"></a>01625         }
<a name="l01626"></a>01626       }
<a name="l01627"></a>01627       <span class="keywordflow">if</span> ($this-&gt;needsUpdate) {
<a name="l01628"></a>01628         $update = $this-&gt;connection-&gt;update($this-&gt;table)
<a name="l01629"></a>01629           -&gt;fields($this-&gt;<a class="code" href="classMergeQuery_ad5b51b48eaec3821181cf8e6c09bf29e.html#ad5b51b48eaec3821181cf8e6c09bf29e" title="Adds a set of field-&gt;value pairs to be updated.">updateFields</a>)
<a name="l01630"></a>01630           -&gt;condition($this-&gt;<a class="code" href="classMergeQuery_a40d55b36952248da6d8eabb0eb1a8430.html#a40d55b36952248da6d8eabb0eb1a8430" title="Implements QueryConditionInterface::condition().">condition</a>);
<a name="l01631"></a>01631         <span class="keywordflow">if</span> ($this-&gt;expressionFields) {
<a name="l01632"></a>01632           <span class="keywordflow">foreach</span> ($this-&gt;expressionFields as $field =&gt; $data) {
<a name="l01633"></a>01633             $update-&gt;expression($field, $data[<span class="stringliteral">&#39;expression&#39;</span>], $data[<span class="stringliteral">&#39;arguments&#39;</span>]);
<a name="l01634"></a>01634           }
<a name="l01635"></a>01635         }
<a name="l01636"></a>01636         $update-&gt;execute();
<a name="l01637"></a>01637         <span class="keywordflow">return</span> <a class="code" href="classMergeQuery_ad79d3ece9a03a3a63bef6560e90fc776.html#ad79d3ece9a03a3a63bef6560e90fc776" title="Returned by execute() if an UPDATE query has been executed.">MergeQuery::STATUS_UPDATE</a>;
<a name="l01638"></a>01638       }
<a name="l01639"></a>01639     }
<a name="l01640"></a>01640     <span class="keywordflow">catch</span> (<a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> $e) {
<a name="l01641"></a>01641       <span class="comment">// Something really wrong happened here, bubble up the exception to the</span>
<a name="l01642"></a>01642       <span class="comment">// caller.</span>
<a name="l01643"></a>01643       $transaction-&gt;rollback();
<a name="l01644"></a>01644       <span class="keywordflow">throw</span> $e;
<a name="l01645"></a>01645     }
<a name="l01646"></a>01646     <span class="comment">// Transaction commits here where $transaction looses scope.</span>
<a name="l01647"></a>01647   }
<a name="l01648"></a>01648 }
<a name="l01649"></a>01649 
<a name="l01653"></a><a class="code" href="classDatabaseCondition.html">01653</a> <span class="keyword">class </span><a class="code" href="classDatabaseCondition.html" title="Generic class for a series of conditions in a query.">DatabaseCondition</a> <span class="keyword">implements</span> <a class="code" href="interfaceQueryConditionInterface.html" title="Interface for a conditional clause in a query.">QueryConditionInterface</a>, Countable {
<a name="l01654"></a>01654 
<a name="l01660"></a><a class="code" href="classDatabaseCondition_adfeee786f36c04ab6872755932bfeec5.html#adfeee786f36c04ab6872755932bfeec5">01660</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseCondition_adfeee786f36c04ab6872755932bfeec5.html#adfeee786f36c04ab6872755932bfeec5">$conditions</a> = array();
<a name="l01661"></a>01661 
<a name="l01667"></a><a class="code" href="classDatabaseCondition_ae233af91e5b9fbb483439bfd97a03c71.html#ae233af91e5b9fbb483439bfd97a03c71">01667</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseCondition_ae233af91e5b9fbb483439bfd97a03c71.html#ae233af91e5b9fbb483439bfd97a03c71">$arguments</a> = array();
<a name="l01668"></a>01668 
<a name="l01677"></a><a class="code" href="classDatabaseCondition_a55b7976ace5a04d766941ebd08793cab.html#a55b7976ace5a04d766941ebd08793cab">01677</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseCondition_a55b7976ace5a04d766941ebd08793cab.html#a55b7976ace5a04d766941ebd08793cab">$changed</a> = TRUE;
<a name="l01678"></a>01678 
<a name="l01682"></a><a class="code" href="classDatabaseCondition_a282f36ef640252385cb9e1d7872151b1.html#a282f36ef640252385cb9e1d7872151b1">01682</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseCondition_a282f36ef640252385cb9e1d7872151b1.html#a282f36ef640252385cb9e1d7872151b1" title="The identifier of the query placeholder this condition has been compiled against.">$queryPlaceholderIdentifier</a>;
<a name="l01683"></a>01683 
<a name="l01690"></a><a class="code" href="classDatabaseCondition_aa5312271d36dcf3d3719cc44563a1056.html#aa5312271d36dcf3d3719cc44563a1056">01690</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseCondition_aa5312271d36dcf3d3719cc44563a1056.html#aa5312271d36dcf3d3719cc44563a1056" title="Constructs a DataBaseCondition object.">__construct</a>($conjunction) {
<a name="l01691"></a>01691     $this-&gt;<a class="code" href="classDatabaseCondition_a9a399f85011d31611a0a01f9d2b30f10.html#a9a399f85011d31611a0a01f9d2b30f10" title="Implements QueryConditionInterface::conditions().">conditions</a>[<span class="stringliteral">&#39;#conjunction&#39;</span>] = $conjunction;
<a name="l01692"></a>01692   }
<a name="l01693"></a>01693 
<a name="l01701"></a><a class="code" href="classDatabaseCondition_a5eafb9a93459b1f1da6e93c1104c3a1c.html#a5eafb9a93459b1f1da6e93c1104c3a1c">01701</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseCondition_a5eafb9a93459b1f1da6e93c1104c3a1c.html#a5eafb9a93459b1f1da6e93c1104c3a1c" title="Implements Countable::count().">count</a>() {
<a name="l01702"></a>01702     <span class="keywordflow">return</span> <a class="code" href="classDatabaseCondition_a5eafb9a93459b1f1da6e93c1104c3a1c.html#a5eafb9a93459b1f1da6e93c1104c3a1c" title="Implements Countable::count().">count</a>($this-&gt;<a class="code" href="classDatabaseCondition_a9a399f85011d31611a0a01f9d2b30f10.html#a9a399f85011d31611a0a01f9d2b30f10" title="Implements QueryConditionInterface::conditions().">conditions</a>) - 1;
<a name="l01703"></a>01703   }
<a name="l01704"></a>01704 
<a name="l01708"></a><a class="code" href="classDatabaseCondition_a0cb79d38e9978eb08eb863f6564d0b1d.html#a0cb79d38e9978eb08eb863f6564d0b1d">01708</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseCondition_a0cb79d38e9978eb08eb863f6564d0b1d.html#a0cb79d38e9978eb08eb863f6564d0b1d" title="Implements QueryConditionInterface::condition().">condition</a>($field, $value = NULL, $operator = NULL) {
<a name="l01709"></a>01709     <span class="keywordflow">if</span> (!isset($operator)) {
<a name="l01710"></a>01710       <span class="keywordflow">if</span> (is_array($value)) {
<a name="l01711"></a>01711         $operator = <span class="stringliteral">&#39;IN&#39;</span>;
<a name="l01712"></a>01712       }
<a name="l01713"></a>01713       elseif (!isset($value)) {
<a name="l01714"></a>01714         $operator = <span class="stringliteral">&#39;IS NULL&#39;</span>;
<a name="l01715"></a>01715       }
<a name="l01716"></a>01716       <span class="keywordflow">else</span> {
<a name="l01717"></a>01717         $operator = <span class="charliteral">&#39;=&#39;</span>;
<a name="l01718"></a>01718       }
<a name="l01719"></a>01719     }
<a name="l01720"></a>01720     $this-&gt;<a class="code" href="classDatabaseCondition_a9a399f85011d31611a0a01f9d2b30f10.html#a9a399f85011d31611a0a01f9d2b30f10" title="Implements QueryConditionInterface::conditions().">conditions</a>[] = array(
<a name="l01721"></a>01721       <span class="stringliteral">&#39;field&#39;</span> =&gt; $field,
<a name="l01722"></a>01722       <span class="stringliteral">&#39;value&#39;</span> =&gt; $value,
<a name="l01723"></a>01723       <span class="stringliteral">&#39;operator&#39;</span> =&gt; $operator,
<a name="l01724"></a>01724     );
<a name="l01725"></a>01725 
<a name="l01726"></a>01726     $this-&gt;changed = TRUE;
<a name="l01727"></a>01727 
<a name="l01728"></a>01728     <span class="keywordflow">return</span> $this;
<a name="l01729"></a>01729   }
<a name="l01730"></a>01730 
<a name="l01734"></a><a class="code" href="classDatabaseCondition_ade864c6825d48205a1a6ec6fb1c3076f.html#ade864c6825d48205a1a6ec6fb1c3076f">01734</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseCondition_ade864c6825d48205a1a6ec6fb1c3076f.html#ade864c6825d48205a1a6ec6fb1c3076f" title="Implements QueryConditionInterface::where().">where</a>($snippet, $args = array()) {
<a name="l01735"></a>01735     $this-&gt;<a class="code" href="classDatabaseCondition_a9a399f85011d31611a0a01f9d2b30f10.html#a9a399f85011d31611a0a01f9d2b30f10" title="Implements QueryConditionInterface::conditions().">conditions</a>[] = array(
<a name="l01736"></a>01736       <span class="stringliteral">&#39;field&#39;</span> =&gt; $snippet,
<a name="l01737"></a>01737       <span class="stringliteral">&#39;value&#39;</span> =&gt; $args,
<a name="l01738"></a>01738       <span class="stringliteral">&#39;operator&#39;</span> =&gt; NULL,
<a name="l01739"></a>01739     );
<a name="l01740"></a>01740     $this-&gt;changed = TRUE;
<a name="l01741"></a>01741 
<a name="l01742"></a>01742     <span class="keywordflow">return</span> $this;
<a name="l01743"></a>01743   }
<a name="l01744"></a>01744 
<a name="l01748"></a><a class="code" href="classDatabaseCondition_af4ff7dba8bee46426fbc8b5930d860f0.html#af4ff7dba8bee46426fbc8b5930d860f0">01748</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseCondition_af4ff7dba8bee46426fbc8b5930d860f0.html#af4ff7dba8bee46426fbc8b5930d860f0" title="Implements QueryConditionInterface::isNull().">isNull</a>($field) {
<a name="l01749"></a>01749     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDatabaseCondition_a0cb79d38e9978eb08eb863f6564d0b1d.html#a0cb79d38e9978eb08eb863f6564d0b1d" title="Implements QueryConditionInterface::condition().">condition</a>($field);
<a name="l01750"></a>01750   }
<a name="l01751"></a>01751 
<a name="l01755"></a><a class="code" href="classDatabaseCondition_aa7499e52cbf791273890fe3e1c47177b.html#aa7499e52cbf791273890fe3e1c47177b">01755</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseCondition_aa7499e52cbf791273890fe3e1c47177b.html#aa7499e52cbf791273890fe3e1c47177b" title="Implements QueryConditionInterface::isNotNull().">isNotNull</a>($field) {
<a name="l01756"></a>01756     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDatabaseCondition_a0cb79d38e9978eb08eb863f6564d0b1d.html#a0cb79d38e9978eb08eb863f6564d0b1d" title="Implements QueryConditionInterface::condition().">condition</a>($field, NULL, <span class="stringliteral">&#39;IS NOT NULL&#39;</span>);
<a name="l01757"></a>01757   }
<a name="l01758"></a>01758 
<a name="l01762"></a><a class="code" href="classDatabaseCondition_ab3f1025c61cd359b097f3c1e949d4b05.html#ab3f1025c61cd359b097f3c1e949d4b05">01762</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseCondition_ab3f1025c61cd359b097f3c1e949d4b05.html#ab3f1025c61cd359b097f3c1e949d4b05" title="Implements QueryConditionInterface::exists().">exists</a>(<a class="code" href="interfaceSelectQueryInterface.html" title="Interface definition for a Select Query object.">SelectQueryInterface</a> $select) {
<a name="l01763"></a>01763     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDatabaseCondition_a0cb79d38e9978eb08eb863f6564d0b1d.html#a0cb79d38e9978eb08eb863f6564d0b1d" title="Implements QueryConditionInterface::condition().">condition</a>(<span class="stringliteral">&#39;&#39;</span>, $select, <span class="stringliteral">&#39;EXISTS&#39;</span>);
<a name="l01764"></a>01764   }
<a name="l01765"></a>01765   
<a name="l01769"></a><a class="code" href="classDatabaseCondition_a435abef28b40645e5939eb521ac5407b.html#a435abef28b40645e5939eb521ac5407b">01769</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseCondition_a435abef28b40645e5939eb521ac5407b.html#a435abef28b40645e5939eb521ac5407b" title="Implements QueryConditionInterface::notExists().">notExists</a>(<a class="code" href="interfaceSelectQueryInterface.html" title="Interface definition for a Select Query object.">SelectQueryInterface</a> $select) {
<a name="l01770"></a>01770     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDatabaseCondition_a0cb79d38e9978eb08eb863f6564d0b1d.html#a0cb79d38e9978eb08eb863f6564d0b1d" title="Implements QueryConditionInterface::condition().">condition</a>(<span class="stringliteral">&#39;&#39;</span>, $select, <span class="stringliteral">&#39;NOT EXISTS&#39;</span>);
<a name="l01771"></a>01771   }
<a name="l01772"></a>01772   
<a name="l01776"></a><a class="code" href="classDatabaseCondition_a9a399f85011d31611a0a01f9d2b30f10.html#a9a399f85011d31611a0a01f9d2b30f10">01776</a>   <span class="keyword">public</span> <span class="keyword">function</span> &amp;<a class="code" href="classDatabaseCondition_a9a399f85011d31611a0a01f9d2b30f10.html#a9a399f85011d31611a0a01f9d2b30f10" title="Implements QueryConditionInterface::conditions().">conditions</a>() {
<a name="l01777"></a>01777     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDatabaseCondition_a9a399f85011d31611a0a01f9d2b30f10.html#a9a399f85011d31611a0a01f9d2b30f10" title="Implements QueryConditionInterface::conditions().">conditions</a>;
<a name="l01778"></a>01778   }
<a name="l01779"></a>01779 
<a name="l01783"></a><a class="code" href="classDatabaseCondition_abfffa491de7087f1521e9868915f0169.html#abfffa491de7087f1521e9868915f0169">01783</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseCondition_abfffa491de7087f1521e9868915f0169.html#abfffa491de7087f1521e9868915f0169" title="Implements QueryConditionInterface::arguments().">arguments</a>() {
<a name="l01784"></a>01784     <span class="comment">// If the caller forgot to call compile() first, refuse to run.</span>
<a name="l01785"></a>01785     <span class="keywordflow">if</span> ($this-&gt;changed) {
<a name="l01786"></a>01786       <span class="keywordflow">return</span> NULL;
<a name="l01787"></a>01787     }
<a name="l01788"></a>01788     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDatabaseCondition_abfffa491de7087f1521e9868915f0169.html#abfffa491de7087f1521e9868915f0169" title="Implements QueryConditionInterface::arguments().">arguments</a>;
<a name="l01789"></a>01789   }
<a name="l01790"></a>01790 
<a name="l01794"></a><a class="code" href="classDatabaseCondition_a286df1af0dfaa7ab6b8b30ed4e96a830.html#a286df1af0dfaa7ab6b8b30ed4e96a830">01794</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseCondition_a286df1af0dfaa7ab6b8b30ed4e96a830.html#a286df1af0dfaa7ab6b8b30ed4e96a830" title="Implements QueryConditionInterface::compile().">compile</a>(<a class="code" href="classDatabaseConnection.html" title="Base Database API class.">DatabaseConnection</a> $connection, <a class="code" href="interfaceQueryPlaceholderInterface.html" title="Interface for a query that accepts placeholders.">QueryPlaceholderInterface</a> $queryPlaceholder) {
<a name="l01795"></a>01795     <span class="comment">// Re-compile if this condition changed or if we are compiled against a</span>
<a name="l01796"></a>01796     <span class="comment">// different query placeholder object.</span>
<a name="l01797"></a>01797     <span class="keywordflow">if</span> ($this-&gt;changed || isset($this-&gt;queryPlaceholderIdentifier) &amp;&amp; ($this-&gt;queryPlaceholderIdentifier != $queryPlaceholder-&gt;<a class="code" href="interfaceQueryPlaceholderInterface_a5f4eb118f1894f0b5785d78d4dbe9847.html#a5f4eb118f1894f0b5785d78d4dbe9847" title="Returns a unique identifier for this object.">uniqueIdentifier</a>())) {
<a name="l01798"></a>01798       $this-&gt;queryPlaceholderIdentifier = $queryPlaceholder-&gt;<a class="code" href="interfaceQueryPlaceholderInterface_a5f4eb118f1894f0b5785d78d4dbe9847.html#a5f4eb118f1894f0b5785d78d4dbe9847" title="Returns a unique identifier for this object.">uniqueIdentifier</a>();
<a name="l01799"></a>01799 
<a name="l01800"></a>01800       $condition_fragments = array();
<a name="l01801"></a>01801       <a class="code" href="classDatabaseCondition_ae233af91e5b9fbb483439bfd97a03c71.html#ae233af91e5b9fbb483439bfd97a03c71">$arguments</a> = array();
<a name="l01802"></a>01802 
<a name="l01803"></a>01803       <a class="code" href="classDatabaseCondition_adfeee786f36c04ab6872755932bfeec5.html#adfeee786f36c04ab6872755932bfeec5">$conditions</a> = $this-&gt;<a class="code" href="classDatabaseCondition_a9a399f85011d31611a0a01f9d2b30f10.html#a9a399f85011d31611a0a01f9d2b30f10" title="Implements QueryConditionInterface::conditions().">conditions</a>;
<a name="l01804"></a>01804       $conjunction = <a class="code" href="classDatabaseCondition_adfeee786f36c04ab6872755932bfeec5.html#adfeee786f36c04ab6872755932bfeec5">$conditions</a>[<span class="stringliteral">&#39;#conjunction&#39;</span>];
<a name="l01805"></a>01805       unset(<a class="code" href="classDatabaseCondition_adfeee786f36c04ab6872755932bfeec5.html#adfeee786f36c04ab6872755932bfeec5">$conditions</a>[<span class="stringliteral">&#39;#conjunction&#39;</span>]);
<a name="l01806"></a>01806       <span class="keywordflow">foreach</span> (<a class="code" href="classDatabaseCondition_adfeee786f36c04ab6872755932bfeec5.html#adfeee786f36c04ab6872755932bfeec5">$conditions</a> as $condition) {
<a name="l01807"></a>01807         <span class="keywordflow">if</span> (empty($condition[<span class="stringliteral">&#39;operator&#39;</span>])) {
<a name="l01808"></a>01808           <span class="comment">// This condition is a literal string, so let it through as is.</span>
<a name="l01809"></a>01809           $condition_fragments[] = <span class="stringliteral">&#39; (&#39;</span> . $condition[<span class="stringliteral">&#39;field&#39;</span>] . <span class="stringliteral">&#39;) &#39;</span>;
<a name="l01810"></a>01810           <a class="code" href="classDatabaseCondition_ae233af91e5b9fbb483439bfd97a03c71.html#ae233af91e5b9fbb483439bfd97a03c71">$arguments</a> += $condition[<span class="stringliteral">&#39;value&#39;</span>];
<a name="l01811"></a>01811         }
<a name="l01812"></a>01812         <span class="keywordflow">else</span> {
<a name="l01813"></a>01813           <span class="comment">// It&#39;s a structured condition, so parse it out accordingly.</span>
<a name="l01814"></a>01814           <span class="comment">// Note that $condition[&#39;field&#39;] will only be an object for a dependent</span>
<a name="l01815"></a>01815           <span class="comment">// DatabaseCondition object, not for a dependent subquery.</span>
<a name="l01816"></a>01816           <span class="keywordflow">if</span> ($condition[<span class="stringliteral">&#39;field&#39;</span>] instanceof <a class="code" href="interfaceQueryConditionInterface.html" title="Interface for a conditional clause in a query.">QueryConditionInterface</a>) {
<a name="l01817"></a>01817             <span class="comment">// Compile the sub-condition recursively and add it to the list.</span>
<a name="l01818"></a>01818             $condition[<span class="stringliteral">&#39;field&#39;</span>]-&gt;compile($connection, $queryPlaceholder);
<a name="l01819"></a>01819             $condition_fragments[] = <span class="charliteral">&#39;(&#39;</span> . (string) $condition[<span class="stringliteral">&#39;field&#39;</span>] . <span class="charliteral">&#39;)&#39;</span>;
<a name="l01820"></a>01820             <a class="code" href="classDatabaseCondition_ae233af91e5b9fbb483439bfd97a03c71.html#ae233af91e5b9fbb483439bfd97a03c71">$arguments</a> += $condition[<span class="stringliteral">&#39;field&#39;</span>]-&gt;arguments();
<a name="l01821"></a>01821           }
<a name="l01822"></a>01822           <span class="keywordflow">else</span> {
<a name="l01823"></a>01823             <span class="comment">// For simplicity, we treat all operators as the same data structure.</span>
<a name="l01824"></a>01824             <span class="comment">// In the typical degenerate case, this won&#39;t get changed.</span>
<a name="l01825"></a>01825             $operator_defaults = array(
<a name="l01826"></a>01826               <span class="stringliteral">&#39;prefix&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l01827"></a>01827               <span class="stringliteral">&#39;postfix&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l01828"></a>01828               <span class="stringliteral">&#39;delimiter&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l01829"></a>01829               <span class="stringliteral">&#39;operator&#39;</span> =&gt; $condition[<span class="stringliteral">&#39;operator&#39;</span>],
<a name="l01830"></a>01830               <span class="stringliteral">&#39;use_value&#39;</span> =&gt; TRUE,
<a name="l01831"></a>01831             );
<a name="l01832"></a>01832             $operator = $connection-&gt;<a class="code" href="classDatabaseConnection_aef82436b30fa08a6c81c34e11f3b1717.html#aef82436b30fa08a6c81c34e11f3b1717" title="Gets any special processing requirements for the condition operator.">mapConditionOperator</a>($condition[<span class="stringliteral">&#39;operator&#39;</span>]);
<a name="l01833"></a>01833             <span class="keywordflow">if</span> (!isset($operator)) {
<a name="l01834"></a>01834               $operator = $this-&gt;<a class="code" href="classDatabaseCondition_afb4e820b6d1719bf940526beef27dc7a.html#afb4e820b6d1719bf940526beef27dc7a" title="Gets any special processing requirements for the condition operator.">mapConditionOperator</a>($condition[<span class="stringliteral">&#39;operator&#39;</span>]);
<a name="l01835"></a>01835             }
<a name="l01836"></a>01836             $operator += $operator_defaults;
<a name="l01837"></a>01837 
<a name="l01838"></a>01838             $placeholders = array();
<a name="l01839"></a>01839             <span class="keywordflow">if</span> ($condition[<span class="stringliteral">&#39;value&#39;</span>] instanceof <a class="code" href="interfaceSelectQueryInterface.html" title="Interface definition for a Select Query object.">SelectQueryInterface</a>) {
<a name="l01840"></a>01840               $condition[<span class="stringliteral">&#39;value&#39;</span>]-&gt;compile($connection, $queryPlaceholder);
<a name="l01841"></a>01841               $placeholders[] = (string) $condition[<span class="stringliteral">&#39;value&#39;</span>];
<a name="l01842"></a>01842               <a class="code" href="classDatabaseCondition_ae233af91e5b9fbb483439bfd97a03c71.html#ae233af91e5b9fbb483439bfd97a03c71">$arguments</a> += $condition[<span class="stringliteral">&#39;value&#39;</span>]-&gt;arguments();
<a name="l01843"></a>01843               <span class="comment">// Subqueries are the actual value of the operator, we don&#39;t</span>
<a name="l01844"></a>01844               <span class="comment">// need to add another below.</span>
<a name="l01845"></a>01845               $operator[<span class="stringliteral">&#39;use_value&#39;</span>] = FALSE;
<a name="l01846"></a>01846             }
<a name="l01847"></a>01847             <span class="comment">// We assume that if there is a delimiter, then the value is an</span>
<a name="l01848"></a>01848             <span class="comment">// array. If not, it is a scalar. For simplicity, we first convert</span>
<a name="l01849"></a>01849             <span class="comment">// up to an array so that we can build the placeholders in the same way.</span>
<a name="l01850"></a>01850             elseif (!$operator[<span class="stringliteral">&#39;delimiter&#39;</span>]) {
<a name="l01851"></a>01851               $condition[<span class="stringliteral">&#39;value&#39;</span>] = array($condition[<span class="stringliteral">&#39;value&#39;</span>]);
<a name="l01852"></a>01852             }
<a name="l01853"></a>01853             <span class="keywordflow">if</span> ($operator[<span class="stringliteral">&#39;use_value&#39;</span>]) {
<a name="l01854"></a>01854               <span class="keywordflow">foreach</span> ($condition[<span class="stringliteral">&#39;value&#39;</span>] as $value) {
<a name="l01855"></a>01855                 $placeholder = <span class="stringliteral">&#39;:db_condition_placeholder_&#39;</span> . $queryPlaceholder-&gt;<a class="code" href="interfaceQueryPlaceholderInterface_a6ec3008deb25380042178419cc601b37.html#a6ec3008deb25380042178419cc601b37" title="Returns the next placeholder ID for the query.">nextPlaceholder</a>();
<a name="l01856"></a>01856                 <a class="code" href="classDatabaseCondition_ae233af91e5b9fbb483439bfd97a03c71.html#ae233af91e5b9fbb483439bfd97a03c71">$arguments</a>[$placeholder] = $value;
<a name="l01857"></a>01857                 $placeholders[] = $placeholder;
<a name="l01858"></a>01858               }
<a name="l01859"></a>01859             }
<a name="l01860"></a>01860             $condition_fragments[] = <span class="stringliteral">&#39; (&#39;</span> . $connection-&gt;<a class="code" href="classDatabaseConnection_aae6a7cba6988731b2b84d645ea4de11c.html#aae6a7cba6988731b2b84d645ea4de11c" title="Escapes a field name string.">escapeField</a>($condition[<span class="stringliteral">&#39;field&#39;</span>]) . <span class="charliteral">&#39; &#39;</span> . $operator[<span class="stringliteral">&#39;operator&#39;</span>] . <span class="charliteral">&#39; &#39;</span> . $operator[<span class="stringliteral">&#39;prefix&#39;</span>] . implode($operator[<span class="stringliteral">&#39;delimiter&#39;</span>], $placeholders) . $operator[<span class="stringliteral">&#39;postfix&#39;</span>] . <span class="stringliteral">&#39;) &#39;</span>;
<a name="l01861"></a>01861           }
<a name="l01862"></a>01862         }
<a name="l01863"></a>01863       }
<a name="l01864"></a>01864 
<a name="l01865"></a>01865       $this-&gt;changed = FALSE;
<a name="l01866"></a>01866       $this-&gt;stringVersion = implode($conjunction, $condition_fragments);
<a name="l01867"></a>01867       $this-&gt;<a class="code" href="classDatabaseCondition_abfffa491de7087f1521e9868915f0169.html#abfffa491de7087f1521e9868915f0169" title="Implements QueryConditionInterface::arguments().">arguments</a> = <a class="code" href="classDatabaseCondition_ae233af91e5b9fbb483439bfd97a03c71.html#ae233af91e5b9fbb483439bfd97a03c71">$arguments</a>;
<a name="l01868"></a>01868     }
<a name="l01869"></a>01869   }
<a name="l01870"></a>01870 
<a name="l01874"></a><a class="code" href="classDatabaseCondition_ac084ec53fb54ca89446acffda50b2e6a.html#ac084ec53fb54ca89446acffda50b2e6a">01874</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseCondition_ac084ec53fb54ca89446acffda50b2e6a.html#ac084ec53fb54ca89446acffda50b2e6a" title="Implements QueryConditionInterface::compiled().">compiled</a>() {
<a name="l01875"></a>01875     <span class="keywordflow">return</span> !$this-&gt;changed;
<a name="l01876"></a>01876   }
<a name="l01877"></a>01877 
<a name="l01884"></a><a class="code" href="classDatabaseCondition_ac892cebcde8a71570e3a22c35fa98592.html#ac892cebcde8a71570e3a22c35fa98592">01884</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseCondition_ac892cebcde8a71570e3a22c35fa98592.html#ac892cebcde8a71570e3a22c35fa98592" title="Implements PHP magic __toString method to convert the conditions to string.">__toString</a>() {
<a name="l01885"></a>01885     <span class="comment">// If the caller forgot to call compile() first, refuse to run.</span>
<a name="l01886"></a>01886     <span class="keywordflow">if</span> ($this-&gt;changed) {
<a name="l01887"></a>01887       <span class="keywordflow">return</span> NULL;
<a name="l01888"></a>01888     }
<a name="l01889"></a>01889     <span class="keywordflow">return</span> $this-&gt;stringVersion;
<a name="l01890"></a>01890   }
<a name="l01891"></a>01891 
<a name="l01898"></a><a class="code" href="classDatabaseCondition_a7d229e52b09544a9ecd3a875f186f1b9.html#a7d229e52b09544a9ecd3a875f186f1b9">01898</a>   <span class="keyword">function</span> <a class="code" href="classDatabaseCondition_a7d229e52b09544a9ecd3a875f186f1b9.html#a7d229e52b09544a9ecd3a875f186f1b9" title="PHP magic __clone() method.">__clone</a>() {
<a name="l01899"></a>01899     $this-&gt;changed = TRUE;
<a name="l01900"></a>01900     <span class="keywordflow">foreach</span> ($this-&gt;<a class="code" href="classDatabaseCondition_a9a399f85011d31611a0a01f9d2b30f10.html#a9a399f85011d31611a0a01f9d2b30f10" title="Implements QueryConditionInterface::conditions().">conditions</a> as $key =&gt; $condition) {
<a name="l01901"></a>01901       <span class="keywordflow">if</span> ($key !== <span class="stringliteral">&#39;#conjunction&#39;</span> &amp;&amp; $condition[<span class="stringliteral">&#39;field&#39;</span>] instanceOf <a class="code" href="interfaceQueryConditionInterface.html" title="Interface for a conditional clause in a query.">QueryConditionInterface</a>) {
<a name="l01902"></a>01902         $this-&gt;<a class="code" href="classDatabaseCondition_a9a399f85011d31611a0a01f9d2b30f10.html#a9a399f85011d31611a0a01f9d2b30f10" title="Implements QueryConditionInterface::conditions().">conditions</a>[$key][<span class="stringliteral">&#39;field&#39;</span>] = clone($condition[<span class="stringliteral">&#39;field&#39;</span>]);
<a name="l01903"></a>01903       }
<a name="l01904"></a>01904     }
<a name="l01905"></a>01905   }
<a name="l01906"></a>01906 
<a name="l01920"></a><a class="code" href="classDatabaseCondition_afb4e820b6d1719bf940526beef27dc7a.html#afb4e820b6d1719bf940526beef27dc7a">01920</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classDatabaseCondition_afb4e820b6d1719bf940526beef27dc7a.html#afb4e820b6d1719bf940526beef27dc7a" title="Gets any special processing requirements for the condition operator.">mapConditionOperator</a>($operator) {
<a name="l01921"></a>01921     <span class="comment">// $specials does not use drupal_static as its value never changes.</span>
<a name="l01922"></a>01922     <span class="keyword">static</span> $specials = array(
<a name="l01923"></a>01923       <span class="stringliteral">&#39;BETWEEN&#39;</span> =&gt; array(<span class="stringliteral">&#39;delimiter&#39;</span> =&gt; <span class="stringliteral">&#39; AND &#39;</span>),
<a name="l01924"></a>01924       <span class="stringliteral">&#39;IN&#39;</span> =&gt; array(<span class="stringliteral">&#39;delimiter&#39;</span> =&gt; <span class="stringliteral">&#39;, &#39;</span>, <span class="stringliteral">&#39;prefix&#39;</span> =&gt; <span class="stringliteral">&#39; (&#39;</span>, <span class="stringliteral">&#39;postfix&#39;</span> =&gt; <span class="charliteral">&#39;)&#39;</span>),
<a name="l01925"></a>01925       <span class="stringliteral">&#39;NOT IN&#39;</span> =&gt; array(<span class="stringliteral">&#39;delimiter&#39;</span> =&gt; <span class="stringliteral">&#39;, &#39;</span>, <span class="stringliteral">&#39;prefix&#39;</span> =&gt; <span class="stringliteral">&#39; (&#39;</span>, <span class="stringliteral">&#39;postfix&#39;</span> =&gt; <span class="charliteral">&#39;)&#39;</span>),
<a name="l01926"></a>01926       <span class="stringliteral">&#39;EXISTS&#39;</span> =&gt; array(<span class="stringliteral">&#39;prefix&#39;</span> =&gt; <span class="stringliteral">&#39; (&#39;</span>, <span class="stringliteral">&#39;postfix&#39;</span> =&gt; <span class="charliteral">&#39;)&#39;</span>),
<a name="l01927"></a>01927       <span class="stringliteral">&#39;NOT EXISTS&#39;</span> =&gt; array(<span class="stringliteral">&#39;prefix&#39;</span> =&gt; <span class="stringliteral">&#39; (&#39;</span>, <span class="stringliteral">&#39;postfix&#39;</span> =&gt; <span class="charliteral">&#39;)&#39;</span>),
<a name="l01928"></a>01928       <span class="stringliteral">&#39;IS NULL&#39;</span> =&gt; array(<span class="stringliteral">&#39;use_value&#39;</span> =&gt; FALSE),
<a name="l01929"></a>01929       <span class="stringliteral">&#39;IS NOT NULL&#39;</span> =&gt; array(<span class="stringliteral">&#39;use_value&#39;</span> =&gt; FALSE),
<a name="l01930"></a>01930       <span class="comment">// Use backslash for escaping wildcard characters.</span>
<a name="l01931"></a>01931       <span class="stringliteral">&#39;LIKE&#39;</span> =&gt; array(<span class="stringliteral">&#39;postfix&#39;</span> =&gt; <span class="stringliteral">&quot; ESCAPE &#39;\\\\&#39;&quot;</span>),
<a name="l01932"></a>01932       <span class="stringliteral">&#39;NOT LIKE&#39;</span> =&gt; array(<span class="stringliteral">&#39;postfix&#39;</span> =&gt; <span class="stringliteral">&quot; ESCAPE &#39;\\\\&#39;&quot;</span>),
<a name="l01933"></a>01933       <span class="comment">// These ones are here for performance reasons.</span>
<a name="l01934"></a>01934       <span class="charliteral">&#39;=&#39;</span> =&gt; array(),
<a name="l01935"></a>01935       <span class="charliteral">&#39;&lt;&#39;</span> =&gt; array(),
<a name="l01936"></a>01936       <span class="charliteral">&#39;&gt;&#39;</span> =&gt; array(),
<a name="l01937"></a>01937       <span class="stringliteral">&#39;&gt;=&#39;</span> =&gt; array(),
<a name="l01938"></a>01938       <span class="stringliteral">&#39;&lt;=&#39;</span> =&gt; array(),
<a name="l01939"></a>01939     );
<a name="l01940"></a>01940     <span class="keywordflow">if</span> (isset($specials[$operator])) {
<a name="l01941"></a>01941       $return = $specials[$operator];
<a name="l01942"></a>01942     }
<a name="l01943"></a>01943     <span class="keywordflow">else</span> {
<a name="l01944"></a>01944       <span class="comment">// We need to upper case because PHP index matches are case sensitive but</span>
<a name="l01945"></a>01945       <span class="comment">// do not need the more expensive drupal_strtoupper because SQL statements are ASCII.</span>
<a name="l01946"></a>01946       $operator = strtoupper($operator);
<a name="l01947"></a>01947       $return = isset($specials[$operator]) ? $specials[$operator] : array();
<a name="l01948"></a>01948     }
<a name="l01949"></a>01949 
<a name="l01950"></a>01950     $return += array(<span class="stringliteral">&#39;operator&#39;</span> =&gt; $operator);
<a name="l01951"></a>01951 
<a name="l01952"></a>01952     <span class="keywordflow">return</span> $return;
<a name="l01953"></a>01953   }
<a name="l01954"></a>01954 
<a name="l01955"></a>01955 }
<a name="l01956"></a>01956 
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 22 2012 16:46:14 for Shopcart by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
