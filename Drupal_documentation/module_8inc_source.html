<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Shopcart: includes/module.inc Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Shopcart
   &#160;<span id="projectnumber">version2.0</span>
   </div>
   <div id="projectbrief">Shoppingcart</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_5b89693129504707d608c5412e7b88d4.html">includes</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">module.inc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="module_8inc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00019"></a><a class="code" href="module_8inc_a76db4bd7c4962f254d6cc9bed5f0e1f6.html#a76db4bd7c4962f254d6cc9bed5f0e1f6">00019</a> <span class="keyword">function</span> <a class="code" href="module_8inc_a76db4bd7c4962f254d6cc9bed5f0e1f6.html#a76db4bd7c4962f254d6cc9bed5f0e1f6" title="Load all the modules that have been enabled in the system table.">module_load_all</a>($bootstrap = FALSE) {
<a name="l00020"></a>00020   <span class="keyword">static</span> $has_run = FALSE;
<a name="l00021"></a>00021 
<a name="l00022"></a>00022   <span class="keywordflow">if</span> (isset($bootstrap)) {
<a name="l00023"></a>00023     <span class="keywordflow">foreach</span> (<a class="code" href="module_8inc_ad4ef444bbb8e56724e12908cf9b6e1aa.html#ad4ef444bbb8e56724e12908cf9b6e1aa" title="Returns a list of currently active modules.">module_list</a>(TRUE, $bootstrap) as $module) {
<a name="l00024"></a>00024       <a class="code" href="bootstrap_8inc_a13a2254228f213a980dc1f09886b8802.html#a13a2254228f213a980dc1f09886b8802" title="Includes a file with the provided type and name.">drupal_load</a>(<span class="stringliteral">&#39;module&#39;</span>, $module);
<a name="l00025"></a>00025     }
<a name="l00026"></a>00026     <span class="comment">// $has_run will be TRUE if $bootstrap is FALSE.</span>
<a name="l00027"></a>00027     $has_run = !$bootstrap;
<a name="l00028"></a>00028   }
<a name="l00029"></a>00029   <span class="keywordflow">return</span> $has_run;
<a name="l00030"></a>00030 }
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 
<a name="l00066"></a><a class="code" href="module_8inc_ad4ef444bbb8e56724e12908cf9b6e1aa.html#ad4ef444bbb8e56724e12908cf9b6e1aa">00066</a> <span class="keyword">function</span> <a class="code" href="module_8inc_ad4ef444bbb8e56724e12908cf9b6e1aa.html#ad4ef444bbb8e56724e12908cf9b6e1aa" title="Returns a list of currently active modules.">module_list</a>($refresh = FALSE, $bootstrap_refresh = FALSE, $sort = FALSE, $fixed_list = NULL) {
<a name="l00067"></a>00067   <span class="keyword">static</span> $list = array(), $sorted_list;
<a name="l00068"></a>00068 
<a name="l00069"></a>00069   <span class="keywordflow">if</span> (empty($list) || $refresh || $fixed_list) {
<a name="l00070"></a>00070     $list = array();
<a name="l00071"></a>00071     $sorted_list = NULL;
<a name="l00072"></a>00072     <span class="keywordflow">if</span> ($fixed_list) {
<a name="l00073"></a>00073       <span class="keywordflow">foreach</span> ($fixed_list as $name =&gt; $module) {
<a name="l00074"></a>00074         <a class="code" href="bootstrap_8inc_ae2af73b6b16cc9d723e931748aa6c853.html#ae2af73b6b16cc9d723e931748aa6c853" title="Returns and optionally sets the filename for a system resource.">drupal_get_filename</a>(<span class="stringliteral">&#39;module&#39;</span>, $name, $module[<span class="stringliteral">&#39;filename&#39;</span>]);
<a name="l00075"></a>00075         $list[$name] = $name;
<a name="l00076"></a>00076       }
<a name="l00077"></a>00077     }
<a name="l00078"></a>00078     <span class="keywordflow">else</span> {
<a name="l00079"></a>00079       <span class="keywordflow">if</span> ($refresh) {
<a name="l00080"></a>00080         <span class="comment">// For the $refresh case, make sure that system_list() returns fresh</span>
<a name="l00081"></a>00081         <span class="comment">// data.</span>
<a name="l00082"></a>00082         <a class="code" href="group__schemaapi_ga714b5ed0b14c43b61eef0c895598c5c4.html#ga714b5ed0b14c43b61eef0c895598c5c4" title="Resets one or all centrally stored static variable(s).">drupal_static_reset</a>(<span class="stringliteral">&#39;system_list&#39;</span>);
<a name="l00083"></a>00083       }
<a name="l00084"></a>00084       <span class="keywordflow">if</span> ($bootstrap_refresh) {
<a name="l00085"></a>00085         $list = <a class="code" href="module_8inc_a807821e98f8d626a7043923080ba6438.html#a807821e98f8d626a7043923080ba6438" title="Build a list of bootstrap modules and enabled modules and themes.">system_list</a>(<span class="stringliteral">&#39;bootstrap&#39;</span>);
<a name="l00086"></a>00086       }
<a name="l00087"></a>00087       <span class="keywordflow">else</span> {
<a name="l00088"></a>00088         <span class="comment">// Not using drupal_map_assoc() here as that requires common.inc.</span>
<a name="l00089"></a>00089         $list = array_keys(<a class="code" href="module_8inc_a807821e98f8d626a7043923080ba6438.html#a807821e98f8d626a7043923080ba6438" title="Build a list of bootstrap modules and enabled modules and themes.">system_list</a>(<span class="stringliteral">&#39;module_enabled&#39;</span>));
<a name="l00090"></a>00090         $list = (!empty($list) ? array_combine($list, $list) : array());
<a name="l00091"></a>00091       }
<a name="l00092"></a>00092     }
<a name="l00093"></a>00093   }
<a name="l00094"></a>00094   <span class="keywordflow">if</span> ($sort) {
<a name="l00095"></a>00095     <span class="keywordflow">if</span> (!isset($sorted_list)) {
<a name="l00096"></a>00096       $sorted_list = $list;
<a name="l00097"></a>00097       ksort($sorted_list);
<a name="l00098"></a>00098     }
<a name="l00099"></a>00099     <span class="keywordflow">return</span> $sorted_list;
<a name="l00100"></a>00100   }
<a name="l00101"></a>00101   <span class="keywordflow">return</span> $list;
<a name="l00102"></a>00102 }
<a name="l00103"></a>00103 
<a name="l00122"></a><a class="code" href="module_8inc_a807821e98f8d626a7043923080ba6438.html#a807821e98f8d626a7043923080ba6438">00122</a> <span class="keyword">function</span> <a class="code" href="module_8inc_a807821e98f8d626a7043923080ba6438.html#a807821e98f8d626a7043923080ba6438" title="Build a list of bootstrap modules and enabled modules and themes.">system_list</a>($type) {
<a name="l00123"></a>00123   $lists = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__);
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   <span class="comment">// For bootstrap modules, attempt to fetch the list from cache if possible.</span>
<a name="l00126"></a>00126   <span class="comment">// if not fetch only the required information to fire bootstrap hooks</span>
<a name="l00127"></a>00127   <span class="comment">// in case we are going to serve the page from cache.</span>
<a name="l00128"></a>00128   <span class="keywordflow">if</span> ($type == <span class="stringliteral">&#39;bootstrap&#39;</span>) {
<a name="l00129"></a>00129     <span class="keywordflow">if</span> (isset($lists[<span class="stringliteral">&#39;bootstrap&#39;</span>])) {
<a name="l00130"></a>00130       <span class="keywordflow">return</span> $lists[<span class="stringliteral">&#39;bootstrap&#39;</span>];
<a name="l00131"></a>00131     }
<a name="l00132"></a>00132     <span class="keywordflow">if</span> ($cached = <a class="code" href="cache_8inc_a9d873815c28909b61c3a6188b383f8a3.html#a9d873815c28909b61c3a6188b383f8a3" title="Returns data from the persistent cache.">cache_get</a>(<span class="stringliteral">&#39;bootstrap_modules&#39;</span>, <span class="stringliteral">&#39;cache_bootstrap&#39;</span>)) {
<a name="l00133"></a>00133       $bootstrap_list = $cached-&gt;data;
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135     <span class="keywordflow">else</span> {
<a name="l00136"></a>00136       $bootstrap_list = <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&quot;SELECT name, filename FROM {system} WHERE status = 1 AND bootstrap = 1 AND type = &#39;module&#39; ORDER BY weight ASC, name ASC&quot;</span>)-&gt;fetchAllAssoc(<span class="stringliteral">&#39;name&#39;</span>);
<a name="l00137"></a>00137       <a class="code" href="cache_8inc_a48081f36334909f561ef4f538fa640d2.html#a48081f36334909f561ef4f538fa640d2" title="Stores data in the persistent cache.">cache_set</a>(<span class="stringliteral">&#39;bootstrap_modules&#39;</span>, $bootstrap_list, <span class="stringliteral">&#39;cache_bootstrap&#39;</span>);
<a name="l00138"></a>00138     }
<a name="l00139"></a>00139     <span class="comment">// To avoid a separate database lookup for the filepath, prime the</span>
<a name="l00140"></a>00140     <span class="comment">// drupal_get_filename() static cache for bootstrap modules only.</span>
<a name="l00141"></a>00141     <span class="comment">// The rest is stored separately to keep the bootstrap module cache small.</span>
<a name="l00142"></a>00142     <span class="keywordflow">foreach</span> ($bootstrap_list as $module) {
<a name="l00143"></a>00143       <a class="code" href="bootstrap_8inc_ae2af73b6b16cc9d723e931748aa6c853.html#ae2af73b6b16cc9d723e931748aa6c853" title="Returns and optionally sets the filename for a system resource.">drupal_get_filename</a>(<span class="stringliteral">&#39;module&#39;</span>, $module-&gt;name, $module-&gt;filename);
<a name="l00144"></a>00144     }
<a name="l00145"></a>00145     <span class="comment">// We only return the module names here since module_list() doesn&#39;t need</span>
<a name="l00146"></a>00146     <span class="comment">// the filename itself.</span>
<a name="l00147"></a>00147     $lists[<span class="stringliteral">&#39;bootstrap&#39;</span>] = array_keys($bootstrap_list);
<a name="l00148"></a>00148   }
<a name="l00149"></a>00149   <span class="comment">// Otherwise build the list for enabled modules and themes.</span>
<a name="l00150"></a>00150   elseif (!isset($lists[<span class="stringliteral">&#39;module_enabled&#39;</span>])) {
<a name="l00151"></a>00151     <span class="keywordflow">if</span> ($cached = <a class="code" href="cache_8inc_a9d873815c28909b61c3a6188b383f8a3.html#a9d873815c28909b61c3a6188b383f8a3" title="Returns data from the persistent cache.">cache_get</a>(<span class="stringliteral">&#39;system_list&#39;</span>, <span class="stringliteral">&#39;cache_bootstrap&#39;</span>)) {
<a name="l00152"></a>00152       $lists = $cached-&gt;data;
<a name="l00153"></a>00153     }
<a name="l00154"></a>00154     <span class="keywordflow">else</span> {
<a name="l00155"></a>00155       $lists = array(
<a name="l00156"></a>00156         <span class="stringliteral">&#39;module_enabled&#39;</span> =&gt; array(),
<a name="l00157"></a>00157         <span class="stringliteral">&#39;theme&#39;</span> =&gt; array(),
<a name="l00158"></a>00158         <span class="stringliteral">&#39;filepaths&#39;</span> =&gt; array(),
<a name="l00159"></a>00159       );
<a name="l00160"></a>00160       <span class="comment">// The module name (rather than the filename) is used as the fallback</span>
<a name="l00161"></a>00161       <span class="comment">// weighting in order to guarantee consistent behavior across different</span>
<a name="l00162"></a>00162       <span class="comment">// Drupal installations, which might have modules installed in different</span>
<a name="l00163"></a>00163       <span class="comment">// locations in the file system. The ordering here must also be</span>
<a name="l00164"></a>00164       <span class="comment">// consistent with the one used in module_implements().</span>
<a name="l00165"></a>00165       $result = <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&quot;SELECT * FROM {system} WHERE type = &#39;theme&#39; OR (type = &#39;module&#39; AND status = 1) ORDER BY weight ASC, name ASC&quot;</span>);
<a name="l00166"></a>00166       <span class="keywordflow">foreach</span> ($result as $record) {
<a name="l00167"></a>00167         $record-&gt;info = unserialize($record-&gt;info);
<a name="l00168"></a>00168         <span class="comment">// Build a list of all enabled modules.</span>
<a name="l00169"></a>00169         <span class="keywordflow">if</span> ($record-&gt;type == <span class="stringliteral">&#39;module&#39;</span>) {
<a name="l00170"></a>00170           $lists[<span class="stringliteral">&#39;module_enabled&#39;</span>][$record-&gt;name] = $record;
<a name="l00171"></a>00171         }
<a name="l00172"></a>00172         <span class="comment">// Build a list of themes.</span>
<a name="l00173"></a>00173         <span class="keywordflow">if</span> ($record-&gt;type == <span class="stringliteral">&#39;theme&#39;</span>) {
<a name="l00174"></a>00174           $lists[<span class="stringliteral">&#39;theme&#39;</span>][$record-&gt;name] = $record;
<a name="l00175"></a>00175         }
<a name="l00176"></a>00176         <span class="comment">// Build a list of filenames so drupal_get_filename can use it.</span>
<a name="l00177"></a>00177         <span class="keywordflow">if</span> ($record-&gt;status) {
<a name="l00178"></a>00178           $lists[<span class="stringliteral">&#39;filepaths&#39;</span>][] = array(<span class="stringliteral">&#39;type&#39;</span> =&gt; $record-&gt;type, <span class="stringliteral">&#39;name&#39;</span> =&gt; $record-&gt;name, <span class="stringliteral">&#39;filepath&#39;</span> =&gt; $record-&gt;filename);
<a name="l00179"></a>00179         }
<a name="l00180"></a>00180       }
<a name="l00181"></a>00181       <span class="keywordflow">foreach</span> ($lists[<span class="stringliteral">&#39;theme&#39;</span>] as $key =&gt; $theme) {
<a name="l00182"></a>00182         <span class="keywordflow">if</span> (!empty($theme-&gt;info[<span class="stringliteral">&#39;base theme&#39;</span>])) {
<a name="l00183"></a>00183           <span class="comment">// Make a list of the theme&#39;s base themes.</span>
<a name="l00184"></a>00184           $lists[<span class="stringliteral">&#39;theme&#39;</span>][$key]-&gt;base_themes = <a class="code" href="theme_8inc_ab9b1b3016f42a43d21096d650ffe7ec1.html#ab9b1b3016f42a43d21096d650ffe7ec1" title="Find all the base themes for the specified theme.">drupal_find_base_themes</a>($lists[<span class="stringliteral">&#39;theme&#39;</span>], $key);
<a name="l00185"></a>00185           <span class="comment">// Don&#39;t proceed if there was a problem with the root base theme.</span>
<a name="l00186"></a>00186           <span class="keywordflow">if</span> (!current($lists[<span class="stringliteral">&#39;theme&#39;</span>][$key]-&gt;base_themes)) {
<a name="l00187"></a>00187             <span class="keywordflow">continue</span>;
<a name="l00188"></a>00188           }
<a name="l00189"></a>00189           <span class="comment">// Determine the root base theme.</span>
<a name="l00190"></a>00190           $base_key = key($lists[<span class="stringliteral">&#39;theme&#39;</span>][$key]-&gt;base_themes);
<a name="l00191"></a>00191           <span class="comment">// Add to the list of sub-themes for each of the theme&#39;s base themes.</span>
<a name="l00192"></a>00192           <span class="keywordflow">foreach</span> (array_keys($lists[<span class="stringliteral">&#39;theme&#39;</span>][$key]-&gt;base_themes) as $base_theme) {
<a name="l00193"></a>00193             $lists[<span class="stringliteral">&#39;theme&#39;</span>][$base_theme]-&gt;sub_themes[$key] = $lists[<span class="stringliteral">&#39;theme&#39;</span>][$key]-&gt;info[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00194"></a>00194           }
<a name="l00195"></a>00195           <span class="comment">// Add the base theme&#39;s theme engine info.</span>
<a name="l00196"></a>00196           $lists[<span class="stringliteral">&#39;theme&#39;</span>][$key]-&gt;info[<span class="stringliteral">&#39;engine&#39;</span>] = isset($lists[<span class="stringliteral">&#39;theme&#39;</span>][$base_key]-&gt;info[<span class="stringliteral">&#39;engine&#39;</span>]) ? $lists[<span class="stringliteral">&#39;theme&#39;</span>][$base_key]-&gt;info[<span class="stringliteral">&#39;engine&#39;</span>] : <span class="stringliteral">&#39;theme&#39;</span>;
<a name="l00197"></a>00197         }
<a name="l00198"></a>00198         <span class="keywordflow">else</span> {
<a name="l00199"></a>00199           <span class="comment">// A plain theme is its own engine.</span>
<a name="l00200"></a>00200           $base_key = $key;
<a name="l00201"></a>00201           <span class="keywordflow">if</span> (!isset($lists[<span class="stringliteral">&#39;theme&#39;</span>][$key]-&gt;info[<span class="stringliteral">&#39;engine&#39;</span>])) {
<a name="l00202"></a>00202             $lists[<span class="stringliteral">&#39;theme&#39;</span>][$key]-&gt;info[<span class="stringliteral">&#39;engine&#39;</span>] = <span class="stringliteral">&#39;theme&#39;</span>;
<a name="l00203"></a>00203           }
<a name="l00204"></a>00204         }
<a name="l00205"></a>00205         <span class="comment">// Set the theme engine prefix.</span>
<a name="l00206"></a>00206         $lists[<span class="stringliteral">&#39;theme&#39;</span>][$key]-&gt;prefix = ($lists[<span class="stringliteral">&#39;theme&#39;</span>][$key]-&gt;info[<span class="stringliteral">&#39;engine&#39;</span>] == <span class="stringliteral">&#39;theme&#39;</span>) ? $base_key : $lists[<span class="stringliteral">&#39;theme&#39;</span>][$key]-&gt;info[<span class="stringliteral">&#39;engine&#39;</span>];
<a name="l00207"></a>00207       }
<a name="l00208"></a>00208       <a class="code" href="cache_8inc_a48081f36334909f561ef4f538fa640d2.html#a48081f36334909f561ef4f538fa640d2" title="Stores data in the persistent cache.">cache_set</a>(<span class="stringliteral">&#39;system_list&#39;</span>, $lists, <span class="stringliteral">&#39;cache_bootstrap&#39;</span>);
<a name="l00209"></a>00209     }
<a name="l00210"></a>00210     <span class="comment">// To avoid a separate database lookup for the filepath, prime the</span>
<a name="l00211"></a>00211     <span class="comment">// drupal_get_filename() static cache with all enabled modules and themes.</span>
<a name="l00212"></a>00212     <span class="keywordflow">foreach</span> ($lists[<span class="stringliteral">&#39;filepaths&#39;</span>] as $item) {
<a name="l00213"></a>00213       <a class="code" href="bootstrap_8inc_ae2af73b6b16cc9d723e931748aa6c853.html#ae2af73b6b16cc9d723e931748aa6c853" title="Returns and optionally sets the filename for a system resource.">drupal_get_filename</a>($item[<span class="stringliteral">&#39;type&#39;</span>], $item[<span class="stringliteral">&#39;name&#39;</span>], $item[<span class="stringliteral">&#39;filepath&#39;</span>]);
<a name="l00214"></a>00214     }
<a name="l00215"></a>00215   }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217   <span class="keywordflow">return</span> $lists[$type];
<a name="l00218"></a>00218 }
<a name="l00219"></a>00219 
<a name="l00223"></a><a class="code" href="module_8inc_ac141d5e0a5817eda15b376a5737dec3d.html#ac141d5e0a5817eda15b376a5737dec3d">00223</a> <span class="keyword">function</span> <a class="code" href="module_8inc_ac141d5e0a5817eda15b376a5737dec3d.html#ac141d5e0a5817eda15b376a5737dec3d" title="Reset all system_list() caches.">system_list_reset</a>() {
<a name="l00224"></a>00224   <a class="code" href="group__schemaapi_ga714b5ed0b14c43b61eef0c895598c5c4.html#ga714b5ed0b14c43b61eef0c895598c5c4" title="Resets one or all centrally stored static variable(s).">drupal_static_reset</a>(<span class="stringliteral">&#39;system_list&#39;</span>);
<a name="l00225"></a>00225   <a class="code" href="group__schemaapi_ga714b5ed0b14c43b61eef0c895598c5c4.html#ga714b5ed0b14c43b61eef0c895598c5c4" title="Resets one or all centrally stored static variable(s).">drupal_static_reset</a>(<span class="stringliteral">&#39;system_rebuild_module_data&#39;</span>);
<a name="l00226"></a>00226   <a class="code" href="group__schemaapi_ga714b5ed0b14c43b61eef0c895598c5c4.html#ga714b5ed0b14c43b61eef0c895598c5c4" title="Resets one or all centrally stored static variable(s).">drupal_static_reset</a>(<span class="stringliteral">&#39;list_themes&#39;</span>);
<a name="l00227"></a>00227   <a class="code" href="cache_8inc_a409b34dd629640d791a11736a9de8125.html#a409b34dd629640d791a11736a9de8125" title="Expires data from the cache.">cache_clear_all</a>(<span class="stringliteral">&#39;bootstrap_modules&#39;</span>, <span class="stringliteral">&#39;cache_bootstrap&#39;</span>);
<a name="l00228"></a>00228   <a class="code" href="cache_8inc_a409b34dd629640d791a11736a9de8125.html#a409b34dd629640d791a11736a9de8125" title="Expires data from the cache.">cache_clear_all</a>(<span class="stringliteral">&#39;system_list&#39;</span>, <span class="stringliteral">&#39;cache_bootstrap&#39;</span>);
<a name="l00229"></a>00229 }
<a name="l00230"></a>00230 
<a name="l00244"></a><a class="code" href="module_8inc_a4a43fd8278bb4e660eff9a74aaba3dd4.html#a4a43fd8278bb4e660eff9a74aaba3dd4">00244</a> <span class="keyword">function</span> <a class="code" href="module_8inc_a4a43fd8278bb4e660eff9a74aaba3dd4.html#a4a43fd8278bb4e660eff9a74aaba3dd4" title="Find dependencies any level deep and fill in required by information too.">_module_build_dependencies</a>($files) {
<a name="l00245"></a>00245   require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/graph.inc&#39;</span>;
<a name="l00246"></a>00246   <span class="keywordflow">foreach</span> ($files as $filename =&gt; $file) {
<a name="l00247"></a>00247     $graph[$file-&gt;name][<span class="stringliteral">&#39;edges&#39;</span>] = array();
<a name="l00248"></a>00248     <span class="keywordflow">if</span> (isset($file-&gt;info[<span class="stringliteral">&#39;dependencies&#39;</span>]) &amp;&amp; is_array($file-&gt;info[<span class="stringliteral">&#39;dependencies&#39;</span>])) {
<a name="l00249"></a>00249       <span class="keywordflow">foreach</span> ($file-&gt;info[<span class="stringliteral">&#39;dependencies&#39;</span>] as $dependency) {
<a name="l00250"></a>00250         $dependency_data = <a class="code" href="common_8inc_a4e06efa27b45d3aa8670a8553d0194d6.html#a4e06efa27b45d3aa8670a8553d0194d6" title="Parses a dependency for comparison by drupal_check_incompatibility().">drupal_parse_dependency</a>($dependency);
<a name="l00251"></a>00251         $graph[$file-&gt;name][<span class="stringliteral">&#39;edges&#39;</span>][$dependency_data[<span class="stringliteral">&#39;name&#39;</span>]] = $dependency_data;
<a name="l00252"></a>00252       }
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254   }
<a name="l00255"></a>00255   <a class="code" href="graph_8inc_ab1e9257090d35212bd3dd3eba7706471.html#ab1e9257090d35212bd3dd3eba7706471" title="Performs a depth-first search and sort on a directed acyclic graph.">drupal_depth_first_search</a>($graph);
<a name="l00256"></a>00256   <span class="keywordflow">foreach</span> ($graph as $module =&gt; $data) {
<a name="l00257"></a>00257     $files[$module]-&gt;required_by = isset($data[<span class="stringliteral">&#39;reverse_paths&#39;</span>]) ? $data[<span class="stringliteral">&#39;reverse_paths&#39;</span>] : array();
<a name="l00258"></a>00258     $files[$module]-&gt;requires = isset($data[<span class="stringliteral">&#39;paths&#39;</span>]) ? $data[<span class="stringliteral">&#39;paths&#39;</span>] : array();
<a name="l00259"></a>00259     $files[$module]-&gt;sort = $data[<span class="stringliteral">&#39;weight&#39;</span>];
<a name="l00260"></a>00260   }
<a name="l00261"></a>00261   <span class="keywordflow">return</span> $files;
<a name="l00262"></a>00262 }
<a name="l00263"></a>00263 
<a name="l00273"></a><a class="code" href="module_8inc_a83bfe4eac372da50ff3eaf949b1b6ff8.html#a83bfe4eac372da50ff3eaf949b1b6ff8">00273</a> <span class="keyword">function</span> <a class="code" href="module_8inc_a83bfe4eac372da50ff3eaf949b1b6ff8.html#a83bfe4eac372da50ff3eaf949b1b6ff8" title="Determine whether a given module exists.">module_exists</a>($module) {
<a name="l00274"></a>00274   $list = <a class="code" href="module_8inc_ad4ef444bbb8e56724e12908cf9b6e1aa.html#ad4ef444bbb8e56724e12908cf9b6e1aa" title="Returns a list of currently active modules.">module_list</a>();
<a name="l00275"></a>00275   <span class="keywordflow">return</span> isset($list[$module]);
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00287"></a><a class="code" href="module_8inc_a77a6101f363c066eafbe29b26af5bfd3.html#a77a6101f363c066eafbe29b26af5bfd3">00287</a> <span class="keyword">function</span> <a class="code" href="module_8inc_a77a6101f363c066eafbe29b26af5bfd3.html#a77a6101f363c066eafbe29b26af5bfd3" title="Load a module&#39;s installation hooks.">module_load_install</a>($module) {
<a name="l00288"></a>00288   <span class="comment">// Make sure the installation API is available</span>
<a name="l00289"></a>00289   include_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/install.inc&#39;</span>;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291   <span class="keywordflow">return</span> <a class="code" href="module_8inc_a49098ed4d33650ee5ab52aab40982423.html#a49098ed4d33650ee5ab52aab40982423" title="Load a module include file.">module_load_include</a>(<span class="stringliteral">&#39;install&#39;</span>, $module);
<a name="l00292"></a>00292 }
<a name="l00293"></a>00293 
<a name="l00321"></a><a class="code" href="module_8inc_a49098ed4d33650ee5ab52aab40982423.html#a49098ed4d33650ee5ab52aab40982423">00321</a> <span class="keyword">function</span> <a class="code" href="module_8inc_a49098ed4d33650ee5ab52aab40982423.html#a49098ed4d33650ee5ab52aab40982423" title="Load a module include file.">module_load_include</a>($type, $module, $name = NULL) {
<a name="l00322"></a>00322   <span class="keywordflow">if</span> (!isset($name)) {
<a name="l00323"></a>00323     $name = $module;
<a name="l00324"></a>00324   }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326   <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;drupal_get_path&#39;</span>)) {
<a name="l00327"></a>00327     $file = <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . <a class="code" href="common_8inc_ae3bbe8f97bf07bb0eaf4580c98f9bf94.html#ae3bbe8f97bf07bb0eaf4580c98f9bf94" title="Returns the path to a system item (module, theme, etc.).">drupal_get_path</a>(<span class="stringliteral">&#39;module&#39;</span>, $module) . <span class="stringliteral">&quot;/$name.$type&quot;</span>;
<a name="l00328"></a>00328     <span class="keywordflow">if</span> (is_file($file)) {
<a name="l00329"></a>00329       require_once $file;
<a name="l00330"></a>00330       <span class="keywordflow">return</span> $file;
<a name="l00331"></a>00331     }
<a name="l00332"></a>00332   }
<a name="l00333"></a>00333   <span class="keywordflow">return</span> FALSE;
<a name="l00334"></a>00334 }
<a name="l00335"></a>00335 
<a name="l00340"></a><a class="code" href="module_8inc_a4e2123e44529b4d307fc1ac78519e966.html#a4e2123e44529b4d307fc1ac78519e966">00340</a> <span class="keyword">function</span> <a class="code" href="module_8inc_a4e2123e44529b4d307fc1ac78519e966.html#a4e2123e44529b4d307fc1ac78519e966" title="Load an include file for each of the modules that have been enabled in the system table...">module_load_all_includes</a>($type, $name = NULL) {
<a name="l00341"></a>00341   $modules = <a class="code" href="module_8inc_ad4ef444bbb8e56724e12908cf9b6e1aa.html#ad4ef444bbb8e56724e12908cf9b6e1aa" title="Returns a list of currently active modules.">module_list</a>();
<a name="l00342"></a>00342   <span class="keywordflow">foreach</span> ($modules as $module) {
<a name="l00343"></a>00343     <a class="code" href="module_8inc_a49098ed4d33650ee5ab52aab40982423.html#a49098ed4d33650ee5ab52aab40982423" title="Load a module include file.">module_load_include</a>($type, $module, $name);
<a name="l00344"></a>00344   }
<a name="l00345"></a>00345 }
<a name="l00346"></a>00346 
<a name="l00383"></a><a class="code" href="module_8inc_a4b2c9ea60d7c88595eaebfc4abd5f1bf.html#a4b2c9ea60d7c88595eaebfc4abd5f1bf">00383</a> <span class="keyword">function</span> <a class="code" href="module_8inc_a4b2c9ea60d7c88595eaebfc4abd5f1bf.html#a4b2c9ea60d7c88595eaebfc4abd5f1bf" title="Enables or installs a given list of modules.">module_enable</a>(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>, $enable_dependencies = TRUE) {
<a name="l00384"></a>00384   <span class="keywordflow">if</span> ($enable_dependencies) {
<a name="l00385"></a>00385     <span class="comment">// Get all module data so we can find dependencies and sort.</span>
<a name="l00386"></a>00386     $module_data = system_rebuild_module_data();
<a name="l00387"></a>00387     <span class="comment">// Create an associative array with weights as values.</span>
<a name="l00388"></a>00388     <a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a> = array_flip(array_values(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>));
<a name="l00389"></a>00389 
<a name="l00390"></a>00390     <span class="keywordflow">while</span> (list($module) = each(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>)) {
<a name="l00391"></a>00391       <span class="keywordflow">if</span> (!isset($module_data[$module])) {
<a name="l00392"></a>00392         <span class="comment">// This module is not found in the filesystem, abort.</span>
<a name="l00393"></a>00393         <span class="keywordflow">return</span> FALSE;
<a name="l00394"></a>00394       }
<a name="l00395"></a>00395       <span class="keywordflow">if</span> ($module_data[$module]-&gt;status) {
<a name="l00396"></a>00396         <span class="comment">// Skip already enabled modules.</span>
<a name="l00397"></a>00397         unset(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>[$module]);
<a name="l00398"></a>00398         <span class="keywordflow">continue</span>;
<a name="l00399"></a>00399       }
<a name="l00400"></a>00400       <a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>[$module] = $module_data[$module]-&gt;sort;
<a name="l00401"></a>00401 
<a name="l00402"></a>00402       <span class="comment">// Add dependencies to the list, with a placeholder weight.</span>
<a name="l00403"></a>00403       <span class="comment">// The new modules will be processed as the while loop continues.</span>
<a name="l00404"></a>00404       <span class="keywordflow">foreach</span> (array_keys($module_data[$module]-&gt;requires) as $dependency) {
<a name="l00405"></a>00405         <span class="keywordflow">if</span> (!isset(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>[$dependency])) {
<a name="l00406"></a>00406           <a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>[$dependency] = 0;
<a name="l00407"></a>00407         }
<a name="l00408"></a>00408       }
<a name="l00409"></a>00409     }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411     <span class="keywordflow">if</span> (!<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>) {
<a name="l00412"></a>00412       <span class="comment">// Nothing to do. All modules already enabled.</span>
<a name="l00413"></a>00413       <span class="keywordflow">return</span> TRUE;
<a name="l00414"></a>00414     }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     <span class="comment">// Sort the module list by pre-calculated weights.</span>
<a name="l00417"></a>00417     arsort(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>);
<a name="l00418"></a>00418     <a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a> = array_keys(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>);
<a name="l00419"></a>00419   }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421   <span class="comment">// Required for module installation checks.</span>
<a name="l00422"></a>00422   include_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/install.inc&#39;</span>;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424   $modules_installed = array();
<a name="l00425"></a>00425   $modules_enabled = array();
<a name="l00426"></a>00426   <span class="keywordflow">foreach</span> (<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a> as $module) {
<a name="l00427"></a>00427     <span class="comment">// Only process modules that are not already enabled.</span>
<a name="l00428"></a>00428     $existing = <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&quot;SELECT status FROM {system} WHERE type = :type AND name = :name&quot;</span>, array(
<a name="l00429"></a>00429       <span class="stringliteral">&#39;:type&#39;</span> =&gt; <span class="stringliteral">&#39;module&#39;</span>,
<a name="l00430"></a>00430       <span class="stringliteral">&#39;:name&#39;</span> =&gt; $module))
<a name="l00431"></a>00431       -&gt;fetchObject();
<a name="l00432"></a>00432     <span class="keywordflow">if</span> ($existing-&gt;status == 0) {
<a name="l00433"></a>00433       <span class="comment">// Load the module&#39;s code.</span>
<a name="l00434"></a>00434       <a class="code" href="bootstrap_8inc_a13a2254228f213a980dc1f09886b8802.html#a13a2254228f213a980dc1f09886b8802" title="Includes a file with the provided type and name.">drupal_load</a>(<span class="stringliteral">&#39;module&#39;</span>, $module);
<a name="l00435"></a>00435       <a class="code" href="module_8inc_a77a6101f363c066eafbe29b26af5bfd3.html#a77a6101f363c066eafbe29b26af5bfd3" title="Load a module&#39;s installation hooks.">module_load_install</a>($module);
<a name="l00436"></a>00436 
<a name="l00437"></a>00437       <span class="comment">// Update the database and module list to reflect the new module. This</span>
<a name="l00438"></a>00438       <span class="comment">// needs to be done first so that the module&#39;s hook implementations,</span>
<a name="l00439"></a>00439       <span class="comment">// hook_schema() in particular, can be called while it is being</span>
<a name="l00440"></a>00440       <span class="comment">// installed.</span>
<a name="l00441"></a>00441       <a class="code" href="group__database_ga40967197ee5d6a23a5c5a77e627067fe.html#ga40967197ee5d6a23a5c5a77e627067fe" title="Returns a new UpdateQuery object for the active database.">db_update</a>(<span class="stringliteral">&#39;system&#39;</span>)
<a name="l00442"></a>00442         -&gt;fields(array(<span class="stringliteral">&#39;status&#39;</span> =&gt; 1))
<a name="l00443"></a>00443         -&gt;condition(<span class="stringliteral">&#39;type&#39;</span>, <span class="stringliteral">&#39;module&#39;</span>)
<a name="l00444"></a>00444         -&gt;condition(<span class="stringliteral">&#39;name&#39;</span>, $module)
<a name="l00445"></a>00445         -&gt;execute();
<a name="l00446"></a>00446       <span class="comment">// Refresh the module list to include it.</span>
<a name="l00447"></a>00447       <a class="code" href="module_8inc_ac141d5e0a5817eda15b376a5737dec3d.html#ac141d5e0a5817eda15b376a5737dec3d" title="Reset all system_list() caches.">system_list_reset</a>();
<a name="l00448"></a>00448       <a class="code" href="module_8inc_ad4ef444bbb8e56724e12908cf9b6e1aa.html#ad4ef444bbb8e56724e12908cf9b6e1aa" title="Returns a list of currently active modules.">module_list</a>(TRUE);
<a name="l00449"></a>00449       <a class="code" href="group__hooks_ga9191200072f2a641829e9d3c2759561f.html#ga9191200072f2a641829e9d3c2759561f" title="Determine which modules are implementing a hook.">module_implements</a>(<span class="stringliteral">&#39;&#39;</span>, FALSE, TRUE);
<a name="l00450"></a>00450       _system_update_bootstrap_status();
<a name="l00451"></a>00451       <span class="comment">// Update the registry to include it.</span>
<a name="l00452"></a>00452       <a class="code" href="group__registry_gaab1bcea9fb061684c700676aa5ebe608.html#gaab1bcea9fb061684c700676aa5ebe608" title="Updates the registry based on the latest files listed in the database.">registry_update</a>();
<a name="l00453"></a>00453       <span class="comment">// Refresh the schema to include it.</span>
<a name="l00454"></a>00454       <a class="code" href="group__schemaapi_ga979670bd6bd2e34337ffc5f0810f2d71.html#ga979670bd6bd2e34337ffc5f0810f2d71" title="Gets the schema definition of a table, or the whole database schema.">drupal_get_schema</a>(NULL, TRUE);
<a name="l00455"></a>00455       <span class="comment">// Update the theme registry to include it.</span>
<a name="l00456"></a>00456       <a class="code" href="theme_8inc_a39fec3ccb5c90369be7b5df7961d47ed.html#a39fec3ccb5c90369be7b5df7961d47ed" title="Force the system to rebuild the theme registry; this should be called when modules are added to the s...">drupal_theme_rebuild</a>();
<a name="l00457"></a>00457       <span class="comment">// Clear entity cache.</span>
<a name="l00458"></a>00458       <a class="code" href="common_8inc_a1905abb5de031d0030e680de4634fc66.html#a1905abb5de031d0030e680de4634fc66" title="Resets the cached information about entity types.">entity_info_cache_clear</a>();
<a name="l00459"></a>00459 
<a name="l00460"></a>00460       <span class="comment">// Now install the module if necessary.</span>
<a name="l00461"></a>00461       <span class="keywordflow">if</span> (<a class="code" href="install_8inc_a7702ece36adbef6e165e6f9c2bde5953.html#a7702ece36adbef6e165e6f9c2bde5953" title="Returns the currently installed schema version for a module.">drupal_get_installed_schema_version</a>($module, TRUE) == <a class="code" href="install_8inc_ab2f11b038ed6a537bfdd257be863075f.html#ab2f11b038ed6a537bfdd257be863075f" title="Indicates that a module has not been installed yet.">SCHEMA_UNINSTALLED</a>) {
<a name="l00462"></a>00462         <a class="code" href="group__schemaapi_ga9706b8d6ecdac10302d83bd50935a698.html#ga9706b8d6ecdac10302d83bd50935a698" title="Creates all tables defined in a module&#39;s hook_schema().">drupal_install_schema</a>($module);
<a name="l00463"></a>00463 
<a name="l00464"></a>00464         <span class="comment">// Set the schema version to the number of the last update provided</span>
<a name="l00465"></a>00465         <span class="comment">// by the module.</span>
<a name="l00466"></a>00466         $versions = <a class="code" href="install_8inc_a1e68a61662f821bde8606568fda7bf58.html#a1e68a61662f821bde8606568fda7bf58" title="Returns an array of available schema versions for a module.">drupal_get_schema_versions</a>($module);
<a name="l00467"></a>00467         $version = $versions ? max($versions) : <a class="code" href="install_8inc_aaa1b441be0b54ef62f6ea8d391f9cc99.html#aaa1b441be0b54ef62f6ea8d391f9cc99" title="Indicates that a module has been installed.">SCHEMA_INSTALLED</a>;
<a name="l00468"></a>00468 
<a name="l00469"></a>00469         <span class="comment">// If the module has no current updates, but has some that were</span>
<a name="l00470"></a>00470         <span class="comment">// previously removed, set the version to the value of</span>
<a name="l00471"></a>00471         <span class="comment">// hook_update_last_removed().</span>
<a name="l00472"></a>00472         <span class="keywordflow">if</span> ($last_removed = <a class="code" href="group__hooks_ga7547905cff161d057f9e71088ec67f05.html#ga7547905cff161d057f9e71088ec67f05" title="Invoke a hook in a particular module.">module_invoke</a>($module, <span class="stringliteral">&#39;update_last_removed&#39;</span>)) {
<a name="l00473"></a>00473           $version = max($version, $last_removed);
<a name="l00474"></a>00474         }
<a name="l00475"></a>00475         <a class="code" href="install_8inc_a2bc19b43e5872bf61c359839ccaec97b.html#a2bc19b43e5872bf61c359839ccaec97b" title="Update the installed version information for a module.">drupal_set_installed_schema_version</a>($module, $version);
<a name="l00476"></a>00476         <span class="comment">// Allow the module to perform install tasks.</span>
<a name="l00477"></a>00477         <a class="code" href="group__hooks_ga7547905cff161d057f9e71088ec67f05.html#ga7547905cff161d057f9e71088ec67f05" title="Invoke a hook in a particular module.">module_invoke</a>($module, <span class="stringliteral">&#39;install&#39;</span>);
<a name="l00478"></a>00478         <span class="comment">// Record the fact that it was installed.</span>
<a name="l00479"></a>00479         $modules_installed[] = $module;
<a name="l00480"></a>00480         <a class="code" href="bootstrap_8inc_acb7338e6740302727043d64e3ae1257b.html#acb7338e6740302727043d64e3ae1257b" title="Logs a system message.">watchdog</a>(<span class="stringliteral">&#39;system&#39;</span>, <span class="stringliteral">&#39;%module module installed.&#39;</span>, array(<span class="stringliteral">&#39;%module&#39;</span> =&gt; $module), <a class="code" href="group__logging__severity__levels_ga9629ff808fd20ce4abb297db5976af4d.html#ga9629ff808fd20ce4abb297db5976af4d" title="Log message severity -- Informational messages.">WATCHDOG_INFO</a>);
<a name="l00481"></a>00481       }
<a name="l00482"></a>00482 
<a name="l00483"></a>00483       <span class="comment">// Enable the module.</span>
<a name="l00484"></a>00484       <a class="code" href="group__hooks_ga7547905cff161d057f9e71088ec67f05.html#ga7547905cff161d057f9e71088ec67f05" title="Invoke a hook in a particular module.">module_invoke</a>($module, <span class="stringliteral">&#39;enable&#39;</span>);
<a name="l00485"></a>00485 
<a name="l00486"></a>00486       <span class="comment">// Record the fact that it was enabled.</span>
<a name="l00487"></a>00487       $modules_enabled[] = $module;
<a name="l00488"></a>00488       <a class="code" href="bootstrap_8inc_acb7338e6740302727043d64e3ae1257b.html#acb7338e6740302727043d64e3ae1257b" title="Logs a system message.">watchdog</a>(<span class="stringliteral">&#39;system&#39;</span>, <span class="stringliteral">&#39;%module module enabled.&#39;</span>, array(<span class="stringliteral">&#39;%module&#39;</span> =&gt; $module), <a class="code" href="group__logging__severity__levels_ga9629ff808fd20ce4abb297db5976af4d.html#ga9629ff808fd20ce4abb297db5976af4d" title="Log message severity -- Informational messages.">WATCHDOG_INFO</a>);
<a name="l00489"></a>00489     }
<a name="l00490"></a>00490   }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492   <span class="comment">// If any modules were newly installed, invoke hook_modules_installed().</span>
<a name="l00493"></a>00493   <span class="keywordflow">if</span> (!empty($modules_installed)) {
<a name="l00494"></a>00494     <a class="code" href="group__hooks_gabedb5f566ef5faaa5768dd15125b111c.html#gabedb5f566ef5faaa5768dd15125b111c" title="Invoke a hook in all enabled modules that implement it.">module_invoke_all</a>(<span class="stringliteral">&#39;modules_installed&#39;</span>, $modules_installed);
<a name="l00495"></a>00495   }
<a name="l00496"></a>00496 
<a name="l00497"></a>00497   <span class="comment">// If any modules were newly enabled, invoke hook_modules_enabled().</span>
<a name="l00498"></a>00498   <span class="keywordflow">if</span> (!empty($modules_enabled)) {
<a name="l00499"></a>00499     <a class="code" href="group__hooks_gabedb5f566ef5faaa5768dd15125b111c.html#gabedb5f566ef5faaa5768dd15125b111c" title="Invoke a hook in all enabled modules that implement it.">module_invoke_all</a>(<span class="stringliteral">&#39;modules_enabled&#39;</span>, $modules_enabled);
<a name="l00500"></a>00500   }
<a name="l00501"></a>00501 
<a name="l00502"></a>00502   <span class="keywordflow">return</span> TRUE;
<a name="l00503"></a>00503 }
<a name="l00504"></a>00504 
<a name="l00515"></a><a class="code" href="module_8inc_a0378d5f56db255c18ca59fc54cd52a94.html#a0378d5f56db255c18ca59fc54cd52a94">00515</a> <span class="keyword">function</span> <a class="code" href="module_8inc_a0378d5f56db255c18ca59fc54cd52a94.html#a0378d5f56db255c18ca59fc54cd52a94" title="Disable a given set of modules.">module_disable</a>(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>, $disable_dependents = TRUE) {
<a name="l00516"></a>00516   <span class="keywordflow">if</span> ($disable_dependents) {
<a name="l00517"></a>00517     <span class="comment">// Get all module data so we can find dependents and sort.</span>
<a name="l00518"></a>00518     $module_data = system_rebuild_module_data();
<a name="l00519"></a>00519     <span class="comment">// Create an associative array with weights as values.</span>
<a name="l00520"></a>00520     <a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a> = array_flip(array_values(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>));
<a name="l00521"></a>00521 
<a name="l00522"></a>00522     $profile = <a class="code" href="common_8inc_a4128f0023ccec2d1a9a40987f0131d83.html#a4128f0023ccec2d1a9a40987f0131d83" title="Gets the name of the currently active install profile.">drupal_get_profile</a>();
<a name="l00523"></a>00523     <span class="keywordflow">while</span> (list($module) = each(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>)) {
<a name="l00524"></a>00524       <span class="keywordflow">if</span> (!isset($module_data[$module]) || !$module_data[$module]-&gt;status) {
<a name="l00525"></a>00525         <span class="comment">// This module doesn&#39;t exist or is already disabled, skip it.</span>
<a name="l00526"></a>00526         unset(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>[$module]);
<a name="l00527"></a>00527         <span class="keywordflow">continue</span>;
<a name="l00528"></a>00528       }
<a name="l00529"></a>00529       <a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>[$module] = $module_data[$module]-&gt;sort;
<a name="l00530"></a>00530 
<a name="l00531"></a>00531       <span class="comment">// Add dependent modules to the list, with a placeholder weight.</span>
<a name="l00532"></a>00532       <span class="comment">// The new modules will be processed as the while loop continues.</span>
<a name="l00533"></a>00533       <span class="keywordflow">foreach</span> ($module_data[$module]-&gt;required_by as $dependent =&gt; $dependent_data) {
<a name="l00534"></a>00534         <span class="keywordflow">if</span> (!isset(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>[$dependent]) &amp;&amp; $dependent != $profile) {
<a name="l00535"></a>00535           <a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>[$dependent] = 0;
<a name="l00536"></a>00536         }
<a name="l00537"></a>00537       }
<a name="l00538"></a>00538     }
<a name="l00539"></a>00539 
<a name="l00540"></a>00540     <span class="comment">// Sort the module list by pre-calculated weights.</span>
<a name="l00541"></a>00541     asort(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>);
<a name="l00542"></a>00542     <a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a> = array_keys(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>);
<a name="l00543"></a>00543   }
<a name="l00544"></a>00544 
<a name="l00545"></a>00545   $invoke_modules = array();
<a name="l00546"></a>00546 
<a name="l00547"></a>00547   <span class="keywordflow">foreach</span> (<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a> as $module) {
<a name="l00548"></a>00548     <span class="keywordflow">if</span> (<a class="code" href="module_8inc_a83bfe4eac372da50ff3eaf949b1b6ff8.html#a83bfe4eac372da50ff3eaf949b1b6ff8" title="Determine whether a given module exists.">module_exists</a>($module)) {
<a name="l00549"></a>00549       <span class="comment">// Check if node_access table needs rebuilding.</span>
<a name="l00550"></a>00550       <span class="keywordflow">if</span> (!node_access_needs_rebuild() &amp;&amp; <a class="code" href="group__hooks_ga0d7a0b03039c561b63424b2a6cf6103f.html#ga0d7a0b03039c561b63424b2a6cf6103f" title="Determine whether a module implements a hook.">module_hook</a>($module, <span class="stringliteral">&#39;node_grants&#39;</span>)) {
<a name="l00551"></a>00551         node_access_needs_rebuild(TRUE);
<a name="l00552"></a>00552       }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554       <a class="code" href="module_8inc_a77a6101f363c066eafbe29b26af5bfd3.html#a77a6101f363c066eafbe29b26af5bfd3" title="Load a module&#39;s installation hooks.">module_load_install</a>($module);
<a name="l00555"></a>00555       <a class="code" href="group__hooks_ga7547905cff161d057f9e71088ec67f05.html#ga7547905cff161d057f9e71088ec67f05" title="Invoke a hook in a particular module.">module_invoke</a>($module, <span class="stringliteral">&#39;disable&#39;</span>);
<a name="l00556"></a>00556       <a class="code" href="group__database_ga40967197ee5d6a23a5c5a77e627067fe.html#ga40967197ee5d6a23a5c5a77e627067fe" title="Returns a new UpdateQuery object for the active database.">db_update</a>(<span class="stringliteral">&#39;system&#39;</span>)
<a name="l00557"></a>00557         -&gt;fields(array(<span class="stringliteral">&#39;status&#39;</span> =&gt; 0))
<a name="l00558"></a>00558         -&gt;condition(<span class="stringliteral">&#39;type&#39;</span>, <span class="stringliteral">&#39;module&#39;</span>)
<a name="l00559"></a>00559         -&gt;condition(<span class="stringliteral">&#39;name&#39;</span>, $module)
<a name="l00560"></a>00560         -&gt;execute();
<a name="l00561"></a>00561       $invoke_modules[] = $module;
<a name="l00562"></a>00562       <a class="code" href="bootstrap_8inc_acb7338e6740302727043d64e3ae1257b.html#acb7338e6740302727043d64e3ae1257b" title="Logs a system message.">watchdog</a>(<span class="stringliteral">&#39;system&#39;</span>, <span class="stringliteral">&#39;%module module disabled.&#39;</span>, array(<span class="stringliteral">&#39;%module&#39;</span> =&gt; $module), <a class="code" href="group__logging__severity__levels_ga9629ff808fd20ce4abb297db5976af4d.html#ga9629ff808fd20ce4abb297db5976af4d" title="Log message severity -- Informational messages.">WATCHDOG_INFO</a>);
<a name="l00563"></a>00563     }
<a name="l00564"></a>00564   }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566   <span class="keywordflow">if</span> (!empty($invoke_modules)) {
<a name="l00567"></a>00567     <span class="comment">// Refresh the module list to exclude the disabled modules.</span>
<a name="l00568"></a>00568     <a class="code" href="module_8inc_ac141d5e0a5817eda15b376a5737dec3d.html#ac141d5e0a5817eda15b376a5737dec3d" title="Reset all system_list() caches.">system_list_reset</a>();
<a name="l00569"></a>00569     <a class="code" href="module_8inc_ad4ef444bbb8e56724e12908cf9b6e1aa.html#ad4ef444bbb8e56724e12908cf9b6e1aa" title="Returns a list of currently active modules.">module_list</a>(TRUE);
<a name="l00570"></a>00570     <a class="code" href="group__hooks_ga9191200072f2a641829e9d3c2759561f.html#ga9191200072f2a641829e9d3c2759561f" title="Determine which modules are implementing a hook.">module_implements</a>(<span class="stringliteral">&#39;&#39;</span>, FALSE, TRUE);
<a name="l00571"></a>00571     <a class="code" href="common_8inc_a1905abb5de031d0030e680de4634fc66.html#a1905abb5de031d0030e680de4634fc66" title="Resets the cached information about entity types.">entity_info_cache_clear</a>();
<a name="l00572"></a>00572     <span class="comment">// Invoke hook_modules_disabled before disabling modules,</span>
<a name="l00573"></a>00573     <span class="comment">// so we can still call module hooks to get information.</span>
<a name="l00574"></a>00574     <a class="code" href="group__hooks_gabedb5f566ef5faaa5768dd15125b111c.html#gabedb5f566ef5faaa5768dd15125b111c" title="Invoke a hook in all enabled modules that implement it.">module_invoke_all</a>(<span class="stringliteral">&#39;modules_disabled&#39;</span>, $invoke_modules);
<a name="l00575"></a>00575     <span class="comment">// Update the registry to remove the newly-disabled module.</span>
<a name="l00576"></a>00576     <a class="code" href="group__registry_gaab1bcea9fb061684c700676aa5ebe608.html#gaab1bcea9fb061684c700676aa5ebe608" title="Updates the registry based on the latest files listed in the database.">registry_update</a>();
<a name="l00577"></a>00577     _system_update_bootstrap_status();
<a name="l00578"></a>00578     <span class="comment">// Update the theme registry to remove the newly-disabled module.</span>
<a name="l00579"></a>00579     <a class="code" href="theme_8inc_a39fec3ccb5c90369be7b5df7961d47ed.html#a39fec3ccb5c90369be7b5df7961d47ed" title="Force the system to rebuild the theme registry; this should be called when modules are added to the s...">drupal_theme_rebuild</a>();
<a name="l00580"></a>00580   }
<a name="l00581"></a>00581 
<a name="l00582"></a>00582   <span class="comment">// If there remains no more node_access module, rebuilding will be</span>
<a name="l00583"></a>00583   <span class="comment">// straightforward, we can do it right now.</span>
<a name="l00584"></a>00584   <span class="keywordflow">if</span> (node_access_needs_rebuild() &amp;&amp; count(<a class="code" href="group__hooks_ga9191200072f2a641829e9d3c2759561f.html#ga9191200072f2a641829e9d3c2759561f" title="Determine which modules are implementing a hook.">module_implements</a>(<span class="stringliteral">&#39;node_grants&#39;</span>)) == 0) {
<a name="l00585"></a>00585     node_access_rebuild();
<a name="l00586"></a>00586   }
<a name="l00587"></a>00587 }
<a name="l00588"></a>00588 
<a name="l00628"></a><a class="code" href="group__hooks_ga0d7a0b03039c561b63424b2a6cf6103f.html#ga0d7a0b03039c561b63424b2a6cf6103f">00628</a> <span class="keyword">function</span> <a class="code" href="group__hooks_ga0d7a0b03039c561b63424b2a6cf6103f.html#ga0d7a0b03039c561b63424b2a6cf6103f" title="Determine whether a module implements a hook.">module_hook</a>($module, $hook) {
<a name="l00629"></a>00629   $function = $module . <span class="charliteral">&#39;_&#39;</span> . $hook;
<a name="l00630"></a>00630   <span class="keywordflow">if</span> (function_exists($function)) {
<a name="l00631"></a>00631     <span class="keywordflow">return</span> TRUE;
<a name="l00632"></a>00632   }
<a name="l00633"></a>00633   <span class="comment">// If the hook implementation does not exist, check whether it may live in an</span>
<a name="l00634"></a>00634   <span class="comment">// optional include file registered via hook_hook_info().</span>
<a name="l00635"></a>00635   $hook_info = <a class="code" href="group__hooks_ga30e72b1391cfa4c282fe98e0dabe02f9.html#ga30e72b1391cfa4c282fe98e0dabe02f9" title="Retrieve a list of what hooks are explicitly declared.">module_hook_info</a>();
<a name="l00636"></a>00636   <span class="keywordflow">if</span> (isset($hook_info[$hook][<span class="stringliteral">&#39;group&#39;</span>])) {
<a name="l00637"></a>00637     <a class="code" href="module_8inc_a49098ed4d33650ee5ab52aab40982423.html#a49098ed4d33650ee5ab52aab40982423" title="Load a module include file.">module_load_include</a>(<span class="stringliteral">&#39;inc&#39;</span>, $module, $module . <span class="charliteral">&#39;.&#39;</span> . $hook_info[$hook][<span class="stringliteral">&#39;group&#39;</span>]);
<a name="l00638"></a>00638     <span class="keywordflow">if</span> (function_exists($function)) {
<a name="l00639"></a>00639       <span class="keywordflow">return</span> TRUE;
<a name="l00640"></a>00640     }
<a name="l00641"></a>00641   }
<a name="l00642"></a>00642   <span class="keywordflow">return</span> FALSE;
<a name="l00643"></a>00643 }
<a name="l00644"></a>00644 
<a name="l00663"></a><a class="code" href="group__hooks_ga9191200072f2a641829e9d3c2759561f.html#ga9191200072f2a641829e9d3c2759561f">00663</a> <span class="keyword">function</span> <a class="code" href="group__hooks_ga9191200072f2a641829e9d3c2759561f.html#ga9191200072f2a641829e9d3c2759561f" title="Determine which modules are implementing a hook.">module_implements</a>($hook, $sort = FALSE, $reset = FALSE) {
<a name="l00664"></a>00664   <span class="comment">// Use the advanced drupal_static() pattern, since this is called very often.</span>
<a name="l00665"></a>00665   <span class="keyword">static</span> $drupal_static_fast;
<a name="l00666"></a>00666   <span class="keywordflow">if</span> (!isset($drupal_static_fast)) {
<a name="l00667"></a>00667     $drupal_static_fast[<span class="stringliteral">&#39;implementations&#39;</span>] = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__);
<a name="l00668"></a>00668   }
<a name="l00669"></a>00669   $implementations = &amp;$drupal_static_fast[<span class="stringliteral">&#39;implementations&#39;</span>];
<a name="l00670"></a>00670 
<a name="l00671"></a>00671   <span class="comment">// We maintain a persistent cache of hook implementations in addition to the</span>
<a name="l00672"></a>00672   <span class="comment">// static cache to avoid looping through every module and every hook on each</span>
<a name="l00673"></a>00673   <span class="comment">// request. Benchmarks show that the benefit of this caching outweighs the</span>
<a name="l00674"></a>00674   <span class="comment">// additional database hit even when using the default database caching</span>
<a name="l00675"></a>00675   <span class="comment">// backend and only a small number of modules are enabled. The cost of the</span>
<a name="l00676"></a>00676   <span class="comment">// cache_get() is more or less constant and reduced further when non-database</span>
<a name="l00677"></a>00677   <span class="comment">// caching backends are used, so there will be more significant gains when a</span>
<a name="l00678"></a>00678   <span class="comment">// large number of modules are installed or hooks invoked, since this can</span>
<a name="l00679"></a>00679   <span class="comment">// quickly lead to module_hook() being called several thousand times</span>
<a name="l00680"></a>00680   <span class="comment">// per request.</span>
<a name="l00681"></a>00681   <span class="keywordflow">if</span> ($reset) {
<a name="l00682"></a>00682     $implementations = array();
<a name="l00683"></a>00683     <a class="code" href="cache_8inc_a48081f36334909f561ef4f538fa640d2.html#a48081f36334909f561ef4f538fa640d2" title="Stores data in the persistent cache.">cache_set</a>(<span class="stringliteral">&#39;module_implements&#39;</span>, array(), <span class="stringliteral">&#39;cache_bootstrap&#39;</span>);
<a name="l00684"></a>00684     <a class="code" href="group__schemaapi_ga714b5ed0b14c43b61eef0c895598c5c4.html#ga714b5ed0b14c43b61eef0c895598c5c4" title="Resets one or all centrally stored static variable(s).">drupal_static_reset</a>(<span class="stringliteral">&#39;module_hook_info&#39;</span>);
<a name="l00685"></a>00685     <a class="code" href="group__schemaapi_ga714b5ed0b14c43b61eef0c895598c5c4.html#ga714b5ed0b14c43b61eef0c895598c5c4" title="Resets one or all centrally stored static variable(s).">drupal_static_reset</a>(<span class="stringliteral">&#39;drupal_alter&#39;</span>);
<a name="l00686"></a>00686     <a class="code" href="cache_8inc_a409b34dd629640d791a11736a9de8125.html#a409b34dd629640d791a11736a9de8125" title="Expires data from the cache.">cache_clear_all</a>(<span class="stringliteral">&#39;hook_info&#39;</span>, <span class="stringliteral">&#39;cache_bootstrap&#39;</span>);
<a name="l00687"></a>00687     <span class="keywordflow">return</span>;
<a name="l00688"></a>00688   }
<a name="l00689"></a>00689 
<a name="l00690"></a>00690   <span class="comment">// Fetch implementations from cache.</span>
<a name="l00691"></a>00691   <span class="keywordflow">if</span> (empty($implementations)) {
<a name="l00692"></a>00692     $implementations = <a class="code" href="cache_8inc_a9d873815c28909b61c3a6188b383f8a3.html#a9d873815c28909b61c3a6188b383f8a3" title="Returns data from the persistent cache.">cache_get</a>(<span class="stringliteral">&#39;module_implements&#39;</span>, <span class="stringliteral">&#39;cache_bootstrap&#39;</span>);
<a name="l00693"></a>00693     <span class="keywordflow">if</span> ($implementations === FALSE) {
<a name="l00694"></a>00694       $implementations = array();
<a name="l00695"></a>00695     }
<a name="l00696"></a>00696     <span class="keywordflow">else</span> {
<a name="l00697"></a>00697       $implementations = $implementations-&gt;data;
<a name="l00698"></a>00698     }
<a name="l00699"></a>00699   }
<a name="l00700"></a>00700 
<a name="l00701"></a>00701   <span class="keywordflow">if</span> (!isset($implementations[$hook])) {
<a name="l00702"></a>00702     <span class="comment">// The hook is not cached, so ensure that whether or not it has</span>
<a name="l00703"></a>00703     <span class="comment">// implementations, that the cache is updated at the end of the request.</span>
<a name="l00704"></a>00704     $implementations[<span class="stringliteral">&#39;#write_cache&#39;</span>] = TRUE;
<a name="l00705"></a>00705     $hook_info = <a class="code" href="group__hooks_ga30e72b1391cfa4c282fe98e0dabe02f9.html#ga30e72b1391cfa4c282fe98e0dabe02f9" title="Retrieve a list of what hooks are explicitly declared.">module_hook_info</a>();
<a name="l00706"></a>00706     $implementations[$hook] = array();
<a name="l00707"></a>00707     $list = <a class="code" href="module_8inc_ad4ef444bbb8e56724e12908cf9b6e1aa.html#ad4ef444bbb8e56724e12908cf9b6e1aa" title="Returns a list of currently active modules.">module_list</a>(FALSE, FALSE, $sort);
<a name="l00708"></a>00708     <span class="keywordflow">foreach</span> ($list as $module) {
<a name="l00709"></a>00709       $include_file = isset($hook_info[$hook][<span class="stringliteral">&#39;group&#39;</span>]) &amp;&amp; <a class="code" href="module_8inc_a49098ed4d33650ee5ab52aab40982423.html#a49098ed4d33650ee5ab52aab40982423" title="Load a module include file.">module_load_include</a>(<span class="stringliteral">&#39;inc&#39;</span>, $module, $module . <span class="charliteral">&#39;.&#39;</span> . $hook_info[$hook][<span class="stringliteral">&#39;group&#39;</span>]);
<a name="l00710"></a>00710       <span class="comment">// Since module_hook() may needlessly try to load the include file again,</span>
<a name="l00711"></a>00711       <span class="comment">// function_exists() is used directly here.</span>
<a name="l00712"></a>00712       <span class="keywordflow">if</span> (function_exists($module . <span class="charliteral">&#39;_&#39;</span> . $hook)) {
<a name="l00713"></a>00713         $implementations[$hook][$module] = $include_file ? $hook_info[$hook][<span class="stringliteral">&#39;group&#39;</span>] : FALSE;
<a name="l00714"></a>00714       }
<a name="l00715"></a>00715     }
<a name="l00716"></a>00716     <span class="comment">// Allow modules to change the weight of specific implementations but avoid</span>
<a name="l00717"></a>00717     <span class="comment">// an infinite loop.</span>
<a name="l00718"></a>00718     <span class="keywordflow">if</span> ($hook != <span class="stringliteral">&#39;module_implements_alter&#39;</span>) {
<a name="l00719"></a>00719       <a class="code" href="module_8inc_a9badfa1d68b90764aa160aee0e58b4ef.html#a9badfa1d68b90764aa160aee0e58b4ef" title="Hands off alterable variables to type-specific *_alter implementations.">drupal_alter</a>(<span class="stringliteral">&#39;module_implements&#39;</span>, $implementations[$hook], $hook);
<a name="l00720"></a>00720     }
<a name="l00721"></a>00721   }
<a name="l00722"></a>00722   <span class="keywordflow">else</span> {
<a name="l00723"></a>00723     <span class="keywordflow">foreach</span> ($implementations[$hook] as $module =&gt; $group) {
<a name="l00724"></a>00724       <span class="comment">// If this hook implementation is stored in a lazy-loaded file, so include</span>
<a name="l00725"></a>00725       <span class="comment">// that file first.</span>
<a name="l00726"></a>00726       <span class="keywordflow">if</span> ($group) {
<a name="l00727"></a>00727         <a class="code" href="module_8inc_a49098ed4d33650ee5ab52aab40982423.html#a49098ed4d33650ee5ab52aab40982423" title="Load a module include file.">module_load_include</a>(<span class="stringliteral">&#39;inc&#39;</span>, $module, <span class="stringliteral">&quot;$module.$group&quot;</span>);
<a name="l00728"></a>00728       }
<a name="l00729"></a>00729       <span class="comment">// It is possible that a module removed a hook implementation without the</span>
<a name="l00730"></a>00730       <span class="comment">// implementations cache being rebuilt yet, so we check whether the</span>
<a name="l00731"></a>00731       <span class="comment">// function exists on each request to avoid undefined function errors.</span>
<a name="l00732"></a>00732       <span class="comment">// Since module_hook() may needlessly try to load the include file again,</span>
<a name="l00733"></a>00733       <span class="comment">// function_exists() is used directly here.</span>
<a name="l00734"></a>00734       <span class="keywordflow">if</span> (!function_exists($module . <span class="charliteral">&#39;_&#39;</span> . $hook)) {
<a name="l00735"></a>00735         <span class="comment">// Clear out the stale implementation from the cache and force a cache</span>
<a name="l00736"></a>00736         <span class="comment">// refresh to forget about no longer existing hook implementations.</span>
<a name="l00737"></a>00737         unset($implementations[$hook][$module]);
<a name="l00738"></a>00738         $implementations[<span class="stringliteral">&#39;#write_cache&#39;</span>] = TRUE;
<a name="l00739"></a>00739       }
<a name="l00740"></a>00740     }
<a name="l00741"></a>00741   }
<a name="l00742"></a>00742 
<a name="l00743"></a>00743   <span class="keywordflow">return</span> array_keys($implementations[$hook]);
<a name="l00744"></a>00744 }
<a name="l00745"></a>00745 
<a name="l00749"></a><a class="code" href="group__hooks_ga30e72b1391cfa4c282fe98e0dabe02f9.html#ga30e72b1391cfa4c282fe98e0dabe02f9">00749</a> <span class="keyword">function</span> <a class="code" href="group__hooks_ga30e72b1391cfa4c282fe98e0dabe02f9.html#ga30e72b1391cfa4c282fe98e0dabe02f9" title="Retrieve a list of what hooks are explicitly declared.">module_hook_info</a>() {
<a name="l00750"></a>00750   <span class="comment">// This function is indirectly invoked from bootstrap_invoke_all(), in which</span>
<a name="l00751"></a>00751   <span class="comment">// case common.inc, subsystems, and modules are not loaded yet, so it does not</span>
<a name="l00752"></a>00752   <span class="comment">// make sense to support hook groups resp. lazy-loaded include files prior to</span>
<a name="l00753"></a>00753   <span class="comment">// full bootstrap.</span>
<a name="l00754"></a>00754   <span class="keywordflow">if</span> (<a class="code" href="bootstrap_8inc_a8dcad7737ed560086bcdd9998a020a93.html#a8dcad7737ed560086bcdd9998a020a93" title="Ensures Drupal is bootstrapped to the specified phase.">drupal_bootstrap</a>(NULL, FALSE) != <a class="code" href="bootstrap_8inc_a2c8ac509af1924cf2fa7420a22e1b048.html#a2c8ac509af1924cf2fa7420a22e1b048" title="Final bootstrap phase: Drupal is fully loaded; validate and fix input data.">DRUPAL_BOOTSTRAP_FULL</a>) {
<a name="l00755"></a>00755     <span class="keywordflow">return</span> array();
<a name="l00756"></a>00756   }
<a name="l00757"></a>00757   $hook_info = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__);
<a name="l00758"></a>00758 
<a name="l00759"></a>00759   <span class="keywordflow">if</span> (!isset($hook_info)) {
<a name="l00760"></a>00760     $hook_info = array();
<a name="l00761"></a>00761     $cache = <a class="code" href="cache_8inc_a9d873815c28909b61c3a6188b383f8a3.html#a9d873815c28909b61c3a6188b383f8a3" title="Returns data from the persistent cache.">cache_get</a>(<span class="stringliteral">&#39;hook_info&#39;</span>, <span class="stringliteral">&#39;cache_bootstrap&#39;</span>);
<a name="l00762"></a>00762     <span class="keywordflow">if</span> ($cache === FALSE) {
<a name="l00763"></a>00763       <span class="comment">// Rebuild the cache and save it.</span>
<a name="l00764"></a>00764       <span class="comment">// We can&#39;t use module_invoke_all() here or it would cause an infinite</span>
<a name="l00765"></a>00765       <span class="comment">// loop.</span>
<a name="l00766"></a>00766       <span class="keywordflow">foreach</span> (<a class="code" href="module_8inc_ad4ef444bbb8e56724e12908cf9b6e1aa.html#ad4ef444bbb8e56724e12908cf9b6e1aa" title="Returns a list of currently active modules.">module_list</a>() as $module) {
<a name="l00767"></a>00767         $function = $module . <span class="stringliteral">&#39;_hook_info&#39;</span>;
<a name="l00768"></a>00768         <span class="keywordflow">if</span> (function_exists($function)) {
<a name="l00769"></a>00769           $result = $function();
<a name="l00770"></a>00770           <span class="keywordflow">if</span> (isset($result) &amp;&amp; is_array($result)) {
<a name="l00771"></a>00771             $hook_info = array_merge_recursive($hook_info, $result);
<a name="l00772"></a>00772           }
<a name="l00773"></a>00773         }
<a name="l00774"></a>00774       }
<a name="l00775"></a>00775       <span class="comment">// We can&#39;t use drupal_alter() for the same reason as above.</span>
<a name="l00776"></a>00776       <span class="keywordflow">foreach</span> (<a class="code" href="module_8inc_ad4ef444bbb8e56724e12908cf9b6e1aa.html#ad4ef444bbb8e56724e12908cf9b6e1aa" title="Returns a list of currently active modules.">module_list</a>() as $module) {
<a name="l00777"></a>00777         $function = $module . <span class="stringliteral">&#39;_hook_info_alter&#39;</span>;
<a name="l00778"></a>00778         <span class="keywordflow">if</span> (function_exists($function)) {
<a name="l00779"></a>00779           $function($hook_info);
<a name="l00780"></a>00780         }
<a name="l00781"></a>00781       }
<a name="l00782"></a>00782       <a class="code" href="cache_8inc_a48081f36334909f561ef4f538fa640d2.html#a48081f36334909f561ef4f538fa640d2" title="Stores data in the persistent cache.">cache_set</a>(<span class="stringliteral">&#39;hook_info&#39;</span>, $hook_info, <span class="stringliteral">&#39;cache_bootstrap&#39;</span>);
<a name="l00783"></a>00783     }
<a name="l00784"></a>00784     <span class="keywordflow">else</span> {
<a name="l00785"></a>00785       $hook_info = $cache-&gt;data;
<a name="l00786"></a>00786     }
<a name="l00787"></a>00787   }
<a name="l00788"></a>00788 
<a name="l00789"></a>00789   <span class="keywordflow">return</span> $hook_info;
<a name="l00790"></a>00790 }
<a name="l00791"></a>00791 
<a name="l00797"></a><a class="code" href="group__hooks_ga993e46e78bf9dfb0e940c0dcccf5e33d.html#ga993e46e78bf9dfb0e940c0dcccf5e33d">00797</a> <span class="keyword">function</span> <a class="code" href="group__hooks_ga993e46e78bf9dfb0e940c0dcccf5e33d.html#ga993e46e78bf9dfb0e940c0dcccf5e33d" title="Writes the hook implementation cache.">module_implements_write_cache</a>() {
<a name="l00798"></a>00798   $implementations = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(<span class="stringliteral">&#39;module_implements&#39;</span>);
<a name="l00799"></a>00799   <span class="comment">// Check whether we need to write the cache. We do not want to cache hooks</span>
<a name="l00800"></a>00800   <span class="comment">// which are only invoked on HTTP POST requests since these do not need to be</span>
<a name="l00801"></a>00801   <span class="comment">// optimized as tightly, and not doing so keeps the cache entry smaller.</span>
<a name="l00802"></a>00802   <span class="keywordflow">if</span> (isset($implementations[<span class="stringliteral">&#39;#write_cache&#39;</span>]) &amp;&amp; ($_SERVER[<span class="stringliteral">&#39;REQUEST_METHOD&#39;</span>] == <span class="stringliteral">&#39;GET&#39;</span> || $_SERVER[<span class="stringliteral">&#39;REQUEST_METHOD&#39;</span>] == <span class="stringliteral">&#39;HEAD&#39;</span>)) {
<a name="l00803"></a>00803     unset($implementations[<span class="stringliteral">&#39;#write_cache&#39;</span>]);
<a name="l00804"></a>00804     <a class="code" href="cache_8inc_a48081f36334909f561ef4f538fa640d2.html#a48081f36334909f561ef4f538fa640d2" title="Stores data in the persistent cache.">cache_set</a>(<span class="stringliteral">&#39;module_implements&#39;</span>, $implementations, <span class="stringliteral">&#39;cache_bootstrap&#39;</span>);
<a name="l00805"></a>00805   }
<a name="l00806"></a>00806 }
<a name="l00807"></a>00807 
<a name="l00821"></a><a class="code" href="group__hooks_ga7547905cff161d057f9e71088ec67f05.html#ga7547905cff161d057f9e71088ec67f05">00821</a> <span class="keyword">function</span> <a class="code" href="group__hooks_ga7547905cff161d057f9e71088ec67f05.html#ga7547905cff161d057f9e71088ec67f05" title="Invoke a hook in a particular module.">module_invoke</a>($module, $hook) {
<a name="l00822"></a>00822   $args = func_get_args();
<a name="l00823"></a>00823   <span class="comment">// Remove $module and $hook from the arguments.</span>
<a name="l00824"></a>00824   unset($args[0], $args[1]);
<a name="l00825"></a>00825   <span class="keywordflow">if</span> (<a class="code" href="group__hooks_ga0d7a0b03039c561b63424b2a6cf6103f.html#ga0d7a0b03039c561b63424b2a6cf6103f" title="Determine whether a module implements a hook.">module_hook</a>($module, $hook)) {
<a name="l00826"></a>00826     <span class="keywordflow">return</span> call_user_func_array($module . <span class="charliteral">&#39;_&#39;</span> . $hook, $args);
<a name="l00827"></a>00827   }
<a name="l00828"></a>00828 }
<a name="l00829"></a>00829 
<a name="l00842"></a><a class="code" href="group__hooks_gabedb5f566ef5faaa5768dd15125b111c.html#gabedb5f566ef5faaa5768dd15125b111c">00842</a> <span class="keyword">function</span> <a class="code" href="group__hooks_gabedb5f566ef5faaa5768dd15125b111c.html#gabedb5f566ef5faaa5768dd15125b111c" title="Invoke a hook in all enabled modules that implement it.">module_invoke_all</a>($hook) {
<a name="l00843"></a>00843   $args = func_get_args();
<a name="l00844"></a>00844   <span class="comment">// Remove $hook from the arguments.</span>
<a name="l00845"></a>00845   unset($args[0]);
<a name="l00846"></a>00846   $return = array();
<a name="l00847"></a>00847   <span class="keywordflow">foreach</span> (<a class="code" href="group__hooks_ga9191200072f2a641829e9d3c2759561f.html#ga9191200072f2a641829e9d3c2759561f" title="Determine which modules are implementing a hook.">module_implements</a>($hook) as $module) {
<a name="l00848"></a>00848     $function = $module . <span class="charliteral">&#39;_&#39;</span> . $hook;
<a name="l00849"></a>00849     <span class="keywordflow">if</span> (function_exists($function)) {
<a name="l00850"></a>00850       $result = call_user_func_array($function, $args);
<a name="l00851"></a>00851       <span class="keywordflow">if</span> (isset($result) &amp;&amp; is_array($result)) {
<a name="l00852"></a>00852         $return = array_merge_recursive($return, $result);
<a name="l00853"></a>00853       }
<a name="l00854"></a>00854       elseif (isset($result)) {
<a name="l00855"></a>00855         $return[] = $result;
<a name="l00856"></a>00856       }
<a name="l00857"></a>00857     }
<a name="l00858"></a>00858   }
<a name="l00859"></a>00859 
<a name="l00860"></a>00860   <span class="keywordflow">return</span> $return;
<a name="l00861"></a>00861 }
<a name="l00862"></a>00862 
<a name="l00870"></a><a class="code" href="module_8inc_a029be29693701bd21b6810e8d047c5a8.html#a029be29693701bd21b6810e8d047c5a8">00870</a> <span class="keyword">function</span> <a class="code" href="module_8inc_a029be29693701bd21b6810e8d047c5a8.html#a029be29693701bd21b6810e8d047c5a8" title="End of &quot;defgroup hooks&quot;.">drupal_required_modules</a>() {
<a name="l00871"></a>00871   $files = <a class="code" href="common_8inc_a60d1237b23d4e84a59656003596add4b.html#a60d1237b23d4e84a59656003596add4b" title="Returns information about system object files (modules, themes, etc.).">drupal_system_listing</a>(<span class="stringliteral">&#39;/^&#39;</span> . <a class="code" href="bootstrap_8inc_ac2b8a8a3549cb6839c538ebc812ecf8c.html#ac2b8a8a3549cb6839c538ebc812ecf8c" title="Regular expression to match PHP function names.">DRUPAL_PHP_FUNCTION_PATTERN</a> . <span class="stringliteral">&#39;\.info$/&#39;</span>, <span class="stringliteral">&#39;modules&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>, 0);
<a name="l00872"></a>00872   $required = array();
<a name="l00873"></a>00873 
<a name="l00874"></a>00874   <span class="comment">// An install profile is required and one must always be loaded.</span>
<a name="l00875"></a>00875   $required[] = <a class="code" href="common_8inc_a4128f0023ccec2d1a9a40987f0131d83.html#a4128f0023ccec2d1a9a40987f0131d83" title="Gets the name of the currently active install profile.">drupal_get_profile</a>();
<a name="l00876"></a>00876 
<a name="l00877"></a>00877   <span class="keywordflow">foreach</span> ($files as $name =&gt; $file) {
<a name="l00878"></a>00878     $info = <a class="code" href="common_8inc_a277955232059631211fcfde533ea89d6.html#a277955232059631211fcfde533ea89d6" title="End of &quot;addtogroup schemaapi&quot;.">drupal_parse_info_file</a>($file-&gt;uri);
<a name="l00879"></a>00879     <span class="keywordflow">if</span> (!empty($info) &amp;&amp; !empty($info[<span class="stringliteral">&#39;required&#39;</span>]) &amp;&amp; $info[<span class="stringliteral">&#39;required&#39;</span>]) {
<a name="l00880"></a>00880       $required[] = $name;
<a name="l00881"></a>00881     }
<a name="l00882"></a>00882   }
<a name="l00883"></a>00883 
<a name="l00884"></a>00884   <span class="keywordflow">return</span> $required;
<a name="l00885"></a>00885 }
<a name="l00886"></a>00886 
<a name="l00936"></a><a class="code" href="module_8inc_a9badfa1d68b90764aa160aee0e58b4ef.html#a9badfa1d68b90764aa160aee0e58b4ef">00936</a> <span class="keyword">function</span> <a class="code" href="module_8inc_a9badfa1d68b90764aa160aee0e58b4ef.html#a9badfa1d68b90764aa160aee0e58b4ef" title="Hands off alterable variables to type-specific *_alter implementations.">drupal_alter</a>($type, &amp;$data, &amp;$context1 = NULL, &amp;$context2 = NULL) {
<a name="l00937"></a>00937   <span class="comment">// Use the advanced drupal_static() pattern, since this is called very often.</span>
<a name="l00938"></a>00938   <span class="keyword">static</span> $drupal_static_fast;
<a name="l00939"></a>00939   <span class="keywordflow">if</span> (!isset($drupal_static_fast)) {
<a name="l00940"></a>00940     $drupal_static_fast[<span class="stringliteral">&#39;functions&#39;</span>] = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__);
<a name="l00941"></a>00941   }
<a name="l00942"></a>00942   $functions = &amp;$drupal_static_fast[<span class="stringliteral">&#39;functions&#39;</span>];
<a name="l00943"></a>00943 
<a name="l00944"></a>00944   <span class="comment">// Most of the time, $type is passed as a string, so for performance,</span>
<a name="l00945"></a>00945   <span class="comment">// normalize it to that. When passed as an array, usually the first item in</span>
<a name="l00946"></a>00946   <span class="comment">// the array is a generic type, and additional items in the array are more</span>
<a name="l00947"></a>00947   <span class="comment">// specific variants of it, as in the case of array(&#39;form&#39;, &#39;form_FORM_ID&#39;).</span>
<a name="l00948"></a>00948   <span class="keywordflow">if</span> (is_array($type)) {
<a name="l00949"></a>00949     $cid = implode(<span class="charliteral">&#39;,&#39;</span>, $type);
<a name="l00950"></a>00950     $extra_types = $type;
<a name="l00951"></a>00951     $type = array_shift($extra_types);
<a name="l00952"></a>00952     <span class="comment">// Allow if statements in this function to use the faster isset() rather</span>
<a name="l00953"></a>00953     <span class="comment">// than !empty() both when $type is passed as a string, or as an array with</span>
<a name="l00954"></a>00954     <span class="comment">// one item.</span>
<a name="l00955"></a>00955     <span class="keywordflow">if</span> (empty($extra_types)) {
<a name="l00956"></a>00956       unset($extra_types);
<a name="l00957"></a>00957     }
<a name="l00958"></a>00958   }
<a name="l00959"></a>00959   <span class="keywordflow">else</span> {
<a name="l00960"></a>00960     $cid = $type;
<a name="l00961"></a>00961   }
<a name="l00962"></a>00962 
<a name="l00963"></a>00963   <span class="comment">// Some alter hooks are invoked many times per page request, so statically</span>
<a name="l00964"></a>00964   <span class="comment">// cache the list of functions to call, and on subsequent calls, iterate</span>
<a name="l00965"></a>00965   <span class="comment">// through them quickly.</span>
<a name="l00966"></a>00966   <span class="keywordflow">if</span> (!isset($functions[$cid])) {
<a name="l00967"></a>00967     $functions[$cid] = array();
<a name="l00968"></a>00968     $hook = $type . <span class="stringliteral">&#39;_alter&#39;</span>;
<a name="l00969"></a>00969     $modules = <a class="code" href="group__hooks_ga9191200072f2a641829e9d3c2759561f.html#ga9191200072f2a641829e9d3c2759561f" title="Determine which modules are implementing a hook.">module_implements</a>($hook);
<a name="l00970"></a>00970     <span class="keywordflow">if</span> (!isset($extra_types)) {
<a name="l00971"></a>00971       <span class="comment">// For the more common case of a single hook, we do not need to call</span>
<a name="l00972"></a>00972       <span class="comment">// function_exists(), since module_implements() returns only modules with</span>
<a name="l00973"></a>00973       <span class="comment">// implementations.</span>
<a name="l00974"></a>00974       <span class="keywordflow">foreach</span> ($modules as $module) {
<a name="l00975"></a>00975         $functions[$cid][] = $module . <span class="charliteral">&#39;_&#39;</span> . $hook;
<a name="l00976"></a>00976       }
<a name="l00977"></a>00977     }
<a name="l00978"></a>00978     <span class="keywordflow">else</span> {
<a name="l00979"></a>00979       <span class="comment">// For multiple hooks, we need $modules to contain every module that</span>
<a name="l00980"></a>00980       <span class="comment">// implements at least one of them.</span>
<a name="l00981"></a>00981       $extra_modules = array();
<a name="l00982"></a>00982       <span class="keywordflow">foreach</span> ($extra_types as $extra_type) {
<a name="l00983"></a>00983         $extra_modules = array_merge($extra_modules, <a class="code" href="group__hooks_ga9191200072f2a641829e9d3c2759561f.html#ga9191200072f2a641829e9d3c2759561f" title="Determine which modules are implementing a hook.">module_implements</a>($extra_type . <span class="stringliteral">&#39;_alter&#39;</span>));
<a name="l00984"></a>00984       }
<a name="l00985"></a>00985       <span class="comment">// If any modules implement one of the extra hooks that do not implement</span>
<a name="l00986"></a>00986       <span class="comment">// the primary hook, we need to add them to the $modules array in their</span>
<a name="l00987"></a>00987       <span class="comment">// appropriate order. module_implements() can only return ordered</span>
<a name="l00988"></a>00988       <span class="comment">// implementations of a single hook. To get the ordered implementations</span>
<a name="l00989"></a>00989       <span class="comment">// of multiple hooks, we mimic the module_implements() logic of first</span>
<a name="l00990"></a>00990       <span class="comment">// ordering by module_list(), and then calling</span>
<a name="l00991"></a>00991       <span class="comment">// drupal_alter(&#39;module_implements&#39;).</span>
<a name="l00992"></a>00992       <span class="keywordflow">if</span> (array_diff($extra_modules, $modules)) {
<a name="l00993"></a>00993         <span class="comment">// Merge the arrays and order by module_list().</span>
<a name="l00994"></a>00994         $modules = array_intersect(<a class="code" href="module_8inc_ad4ef444bbb8e56724e12908cf9b6e1aa.html#ad4ef444bbb8e56724e12908cf9b6e1aa" title="Returns a list of currently active modules.">module_list</a>(), array_merge($modules, $extra_modules));
<a name="l00995"></a>00995         <span class="comment">// Since module_implements() already took care of loading the necessary</span>
<a name="l00996"></a>00996         <span class="comment">// include files, we can safely pass FALSE for the array values.</span>
<a name="l00997"></a>00997         $implementations = array_fill_keys($modules, FALSE);
<a name="l00998"></a>00998         <span class="comment">// Let modules adjust the order solely based on the primary hook. This</span>
<a name="l00999"></a>00999         <span class="comment">// ensures the same module order regardless of whether this if block</span>
<a name="l01000"></a>01000         <span class="comment">// runs. Calling drupal_alter() recursively in this way does not result</span>
<a name="l01001"></a>01001         <span class="comment">// in an infinite loop, because this call is for a single $type, so we</span>
<a name="l01002"></a>01002         <span class="comment">// won&#39;t end up in this code block again.</span>
<a name="l01003"></a>01003         <a class="code" href="module_8inc_a9badfa1d68b90764aa160aee0e58b4ef.html#a9badfa1d68b90764aa160aee0e58b4ef" title="Hands off alterable variables to type-specific *_alter implementations.">drupal_alter</a>(<span class="stringliteral">&#39;module_implements&#39;</span>, $implementations, $hook);
<a name="l01004"></a>01004         $modules = array_keys($implementations);
<a name="l01005"></a>01005       }
<a name="l01006"></a>01006       <span class="keywordflow">foreach</span> ($modules as $module) {
<a name="l01007"></a>01007         <span class="comment">// Since $modules is a merged array, for any given module, we do not</span>
<a name="l01008"></a>01008         <span class="comment">// know whether it has any particular implementation, so we need a</span>
<a name="l01009"></a>01009         <span class="comment">// function_exists().</span>
<a name="l01010"></a>01010         $function = $module . <span class="charliteral">&#39;_&#39;</span> . $hook;
<a name="l01011"></a>01011         <span class="keywordflow">if</span> (function_exists($function)) {
<a name="l01012"></a>01012           $functions[$cid][] = $function;
<a name="l01013"></a>01013         }
<a name="l01014"></a>01014         <span class="keywordflow">foreach</span> ($extra_types as $extra_type) {
<a name="l01015"></a>01015           $function = $module . <span class="charliteral">&#39;_&#39;</span> . $extra_type . <span class="stringliteral">&#39;_alter&#39;</span>;
<a name="l01016"></a>01016           <span class="keywordflow">if</span> (function_exists($function)) {
<a name="l01017"></a>01017             $functions[$cid][] = $function;
<a name="l01018"></a>01018           }
<a name="l01019"></a>01019         }
<a name="l01020"></a>01020       }
<a name="l01021"></a>01021     }
<a name="l01022"></a>01022     <span class="comment">// Allow the theme to alter variables after the theme system has been</span>
<a name="l01023"></a>01023     <span class="comment">// initialized.</span>
<a name="l01024"></a>01024     global $theme, $base_theme_info;
<a name="l01025"></a>01025     <span class="keywordflow">if</span> (isset($theme)) {
<a name="l01026"></a>01026       $theme_keys = array();
<a name="l01027"></a>01027       <span class="keywordflow">foreach</span> ($base_theme_info as $base) {
<a name="l01028"></a>01028         $theme_keys[] = $base-&gt;name;
<a name="l01029"></a>01029       }
<a name="l01030"></a>01030       $theme_keys[] = $theme;
<a name="l01031"></a>01031       <span class="keywordflow">foreach</span> ($theme_keys as $theme_key) {
<a name="l01032"></a>01032         $function = $theme_key . <span class="charliteral">&#39;_&#39;</span> . $hook;
<a name="l01033"></a>01033         <span class="keywordflow">if</span> (function_exists($function)) {
<a name="l01034"></a>01034           $functions[$cid][] = $function;
<a name="l01035"></a>01035         }
<a name="l01036"></a>01036         <span class="keywordflow">if</span> (isset($extra_types)) {
<a name="l01037"></a>01037           <span class="keywordflow">foreach</span> ($extra_types as $extra_type) {
<a name="l01038"></a>01038             $function = $theme_key . <span class="charliteral">&#39;_&#39;</span> . $extra_type . <span class="stringliteral">&#39;_alter&#39;</span>;
<a name="l01039"></a>01039             <span class="keywordflow">if</span> (function_exists($function)) {
<a name="l01040"></a>01040               $functions[$cid][] = $function;
<a name="l01041"></a>01041             }
<a name="l01042"></a>01042           }
<a name="l01043"></a>01043         }
<a name="l01044"></a>01044       }
<a name="l01045"></a>01045     }
<a name="l01046"></a>01046   }
<a name="l01047"></a>01047 
<a name="l01048"></a>01048   <span class="keywordflow">foreach</span> ($functions[$cid] as $function) {
<a name="l01049"></a>01049     $function($data, $context1, $context2);
<a name="l01050"></a>01050   }
<a name="l01051"></a>01051 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 22 2012 16:46:14 for Shopcart by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
