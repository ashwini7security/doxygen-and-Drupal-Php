<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Shopcart: includes/filetransfer/filetransfer.inc Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Shopcart
   &#160;<span id="projectnumber">version2.0</span>
   </div>
   <div id="projectbrief">Shoppingcart</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_5b89693129504707d608c5412e7b88d4.html">includes</a>      </li>
      <li class="navelem"><a class="el" href="dir_5bc269211dd09b02455451e4d44bbfad.html">filetransfer</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">filetransfer.inc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="filetransfer_8inc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">/*</span>
<a name="l00004"></a>00004 <span class="comment"> * Base FileTransfer class.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * Classes extending this class perform file operations on directories not</span>
<a name="l00007"></a>00007 <span class="comment"> * writable by the webserver. To achieve this, the class should connect back</span>
<a name="l00008"></a>00008 <span class="comment"> * to the server using some backend (for example FTP or SSH). To keep security,</span>
<a name="l00009"></a>00009 <span class="comment"> * the password should always be asked from the user and never stored. For</span>
<a name="l00010"></a>00010 <span class="comment"> * safety, all methods operate only inside a &quot;jail&quot;, by default the Drupal root.</span>
<a name="l00011"></a>00011 <span class="comment"> */</span>
<a name="l00012"></a><a class="code" href="classFileTransfer.html">00012</a> <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="classFileTransfer.html">FileTransfer</a> {
<a name="l00013"></a><a class="code" href="classFileTransfer_a92b6ce04b602409c11b03e35b9e6eaae.html#a92b6ce04b602409c11b03e35b9e6eaae">00013</a>   <span class="keyword">protected</span> <a class="code" href="classFileTransfer_a92b6ce04b602409c11b03e35b9e6eaae.html#a92b6ce04b602409c11b03e35b9e6eaae">$username</a>;
<a name="l00014"></a><a class="code" href="classFileTransfer_ad0357585e341207778a3f64257bae48d.html#ad0357585e341207778a3f64257bae48d">00014</a>   <span class="keyword">protected</span> <a class="code" href="classFileTransfer_ad0357585e341207778a3f64257bae48d.html#ad0357585e341207778a3f64257bae48d">$password</a>;
<a name="l00015"></a><a class="code" href="classFileTransfer_ac527b9faea32dd027fa4c8af52a52bd2.html#ac527b9faea32dd027fa4c8af52a52bd2">00015</a>   <span class="keyword">protected</span> <a class="code" href="classFileTransfer_ac527b9faea32dd027fa4c8af52a52bd2.html#ac527b9faea32dd027fa4c8af52a52bd2">$hostname</a> = <span class="stringliteral">&#39;localhost&#39;</span>;
<a name="l00016"></a><a class="code" href="classFileTransfer_a05cd703bd2e637177736a743efcbbfd8.html#a05cd703bd2e637177736a743efcbbfd8">00016</a>   <span class="keyword">protected</span> <a class="code" href="classFileTransfer_a05cd703bd2e637177736a743efcbbfd8.html#a05cd703bd2e637177736a743efcbbfd8">$port</a>;
<a name="l00017"></a>00017 
<a name="l00022"></a><a class="code" href="classFileTransfer_a179fa76ea4a6f5e3206184cc947a3781.html#a179fa76ea4a6f5e3206184cc947a3781">00022</a>   <span class="keyword">function</span> <a class="code" href="classFileTransfer_a179fa76ea4a6f5e3206184cc947a3781.html#a179fa76ea4a6f5e3206184cc947a3781" title="The constructor for the UpdateConnection class.">__construct</a>($jail) {
<a name="l00023"></a>00023     $this-&gt;jail = $jail;
<a name="l00024"></a>00024   }
<a name="l00025"></a>00025 
<a name="l00040"></a><a class="code" href="classFileTransfer_aed740d2f6e0780134b2b29a174ad05f2.html#aed740d2f6e0780134b2b29a174ad05f2">00040</a>   <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classFileTransfer_aed740d2f6e0780134b2b29a174ad05f2.html#aed740d2f6e0780134b2b29a174ad05f2" title="Classes that extend this class must override the factory() static method.">factory</a>($jail, $settings) {
<a name="l00041"></a>00041     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classFileTransferException.html" title="FileTransferException class.">FileTransferException</a>(<span class="stringliteral">&#39;FileTransfer::factory() static method not overridden by FileTransfer subclass.&#39;</span>);
<a name="l00042"></a>00042   }
<a name="l00043"></a>00043 
<a name="l00051"></a><a class="code" href="classFileTransfer_a78d103c4fac668da6049bfd4ab713b2f.html#a78d103c4fac668da6049bfd4ab713b2f">00051</a>   <span class="keyword">function</span> <a class="code" href="classFileTransfer_a78d103c4fac668da6049bfd4ab713b2f.html#a78d103c4fac668da6049bfd4ab713b2f" title="Implementation of the magic __get() method.">__get</a>($name) {
<a name="l00052"></a>00052     <span class="keywordflow">if</span> ($name == <span class="stringliteral">&#39;connection&#39;</span>) {
<a name="l00053"></a>00053       $this-&gt;<a class="code" href="classFileTransfer_a78b9b9fdd3029295f73a5a41e052e311.html#a78b9b9fdd3029295f73a5a41e052e311" title="Connect to the server.">connect</a>();
<a name="l00054"></a>00054       <span class="keywordflow">return</span> $this-&gt;connection;
<a name="l00055"></a>00055     }
<a name="l00056"></a>00056 
<a name="l00057"></a>00057     <span class="keywordflow">if</span> ($name == <span class="stringliteral">&#39;chroot&#39;</span>) {
<a name="l00058"></a>00058       $this-&gt;<a class="code" href="classFileTransfer_a09ee9c27162826be5c39d9db3494c1f2.html#a09ee9c27162826be5c39d9db3494c1f2" title="Sets the chroot and changes the jail to match the correct path scheme.">setChroot</a>();
<a name="l00059"></a>00059       <span class="keywordflow">return</span> $this-&gt;chroot;
<a name="l00060"></a>00060     }
<a name="l00061"></a>00061   }
<a name="l00062"></a>00062 
<a name="l00066"></a>00066   <span class="keyword">abstract</span> <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classFileTransfer_a78b9b9fdd3029295f73a5a41e052e311.html#a78b9b9fdd3029295f73a5a41e052e311" title="Connect to the server.">connect</a>();
<a name="l00067"></a>00067 
<a name="l00076"></a><a class="code" href="classFileTransfer_a85afa98d3b1e04536d298d23bf8c0ceb.html#a85afa98d3b1e04536d298d23bf8c0ceb">00076</a>   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">function</span> <a class="code" href="classFileTransfer_a85afa98d3b1e04536d298d23bf8c0ceb.html#a85afa98d3b1e04536d298d23bf8c0ceb" title="Copies a directory.">copyDirectory</a>($source, $destination) {
<a name="l00077"></a>00077     $source = $this-&gt;<a class="code" href="classFileTransfer_a66b62fbb6a66ffd8f9a986e85aefc98d.html#a66b62fbb6a66ffd8f9a986e85aefc98d" title="Changes backslashes to slashes, also removes a trailing slash.">sanitizePath</a>($source);
<a name="l00078"></a>00078     $destination = $this-&gt;<a class="code" href="classFileTransfer_aeb01984e5d0dfab6959a0ac717578786.html#aeb01984e5d0dfab6959a0ac717578786" title="Returns a modified path suitable for passing to the server.">fixRemotePath</a>($destination);
<a name="l00079"></a>00079     $this-&gt;<a class="code" href="classFileTransfer_a1bd7f1c3b5431c3b53236f7aae0c1460.html#a1bd7f1c3b5431c3b53236f7aae0c1460" title="Checks that the path is inside the jail and throws an exception if not.">checkPath</a>($destination);
<a name="l00080"></a>00080     $this-&gt;<a class="code" href="classFileTransfer_a004c3757d055356cbbb99d122a5d686c.html#a004c3757d055356cbbb99d122a5d686c" title="Copies a directory.">copyDirectoryJailed</a>($source, $destination);
<a name="l00081"></a>00081   }
<a name="l00082"></a>00082 
<a name="l00090"></a><a class="code" href="classFileTransfer_a7c49554b3cce3ab7cc03e2f45f9934b1.html#a7c49554b3cce3ab7cc03e2f45f9934b1">00090</a>   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">function</span> <a class="code" href="classFileTransfer_a7c49554b3cce3ab7cc03e2f45f9934b1.html#a7c49554b3cce3ab7cc03e2f45f9934b1">chmod</a>($path, $mode, $recursive = FALSE) {
<a name="l00091"></a>00091     <span class="keywordflow">if</span> (!in_array(<span class="stringliteral">&#39;FileTransferChmodInterface&#39;</span>, class_implements(get_class($this)))) {
<a name="l00092"></a>00092       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classFileTransferException.html" title="FileTransferException class.">FileTransferException</a>(<span class="stringliteral">&#39;Unable to change file permissions&#39;</span>);
<a name="l00093"></a>00093     }
<a name="l00094"></a>00094     $path = $this-&gt;<a class="code" href="classFileTransfer_a66b62fbb6a66ffd8f9a986e85aefc98d.html#a66b62fbb6a66ffd8f9a986e85aefc98d" title="Changes backslashes to slashes, also removes a trailing slash.">sanitizePath</a>($path);
<a name="l00095"></a>00095     $path = $this-&gt;<a class="code" href="classFileTransfer_aeb01984e5d0dfab6959a0ac717578786.html#aeb01984e5d0dfab6959a0ac717578786" title="Returns a modified path suitable for passing to the server.">fixRemotePath</a>($path);
<a name="l00096"></a>00096     $this-&gt;<a class="code" href="classFileTransfer_a1bd7f1c3b5431c3b53236f7aae0c1460.html#a1bd7f1c3b5431c3b53236f7aae0c1460" title="Checks that the path is inside the jail and throws an exception if not.">checkPath</a>($path);
<a name="l00097"></a>00097     $this-&gt;chmodJailed($path, $mode, $recursive);
<a name="l00098"></a>00098   }
<a name="l00099"></a>00099 
<a name="l00106"></a><a class="code" href="classFileTransfer_a8d63f097ba6bf3334420bd8dcccb4898.html#a8d63f097ba6bf3334420bd8dcccb4898">00106</a>   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">function</span> <a class="code" href="classFileTransfer_a8d63f097ba6bf3334420bd8dcccb4898.html#a8d63f097ba6bf3334420bd8dcccb4898" title="Creates a directory.">createDirectory</a>($directory) {
<a name="l00107"></a>00107     $directory = $this-&gt;<a class="code" href="classFileTransfer_aeb01984e5d0dfab6959a0ac717578786.html#aeb01984e5d0dfab6959a0ac717578786" title="Returns a modified path suitable for passing to the server.">fixRemotePath</a>($directory);
<a name="l00108"></a>00108     $this-&gt;<a class="code" href="classFileTransfer_a1bd7f1c3b5431c3b53236f7aae0c1460.html#a1bd7f1c3b5431c3b53236f7aae0c1460" title="Checks that the path is inside the jail and throws an exception if not.">checkPath</a>($directory);
<a name="l00109"></a>00109     $this-&gt;<a class="code" href="classFileTransfer_a585c6cfab189aabbee70a624a50af975.html#a585c6cfab189aabbee70a624a50af975" title="Creates a directory.">createDirectoryJailed</a>($directory);
<a name="l00110"></a>00110   }
<a name="l00111"></a>00111 
<a name="l00118"></a><a class="code" href="classFileTransfer_ace033d9eb68691f41d040cc527b0ea5e.html#ace033d9eb68691f41d040cc527b0ea5e">00118</a>   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">function</span> <a class="code" href="classFileTransfer_ace033d9eb68691f41d040cc527b0ea5e.html#ace033d9eb68691f41d040cc527b0ea5e" title="Removes a directory.">removeDirectory</a>($directory) {
<a name="l00119"></a>00119     $directory = $this-&gt;<a class="code" href="classFileTransfer_aeb01984e5d0dfab6959a0ac717578786.html#aeb01984e5d0dfab6959a0ac717578786" title="Returns a modified path suitable for passing to the server.">fixRemotePath</a>($directory);
<a name="l00120"></a>00120     $this-&gt;<a class="code" href="classFileTransfer_a1bd7f1c3b5431c3b53236f7aae0c1460.html#a1bd7f1c3b5431c3b53236f7aae0c1460" title="Checks that the path is inside the jail and throws an exception if not.">checkPath</a>($directory);
<a name="l00121"></a>00121     $this-&gt;<a class="code" href="classFileTransfer_a9b9a21556d191235b3a5f85c15878789.html#a9b9a21556d191235b3a5f85c15878789" title="Removes a directory.">removeDirectoryJailed</a>($directory);
<a name="l00122"></a>00122   }
<a name="l00123"></a>00123 
<a name="l00132"></a><a class="code" href="classFileTransfer_a8b2a75cd29bb8941663dc51da6a4550c.html#a8b2a75cd29bb8941663dc51da6a4550c">00132</a>   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">function</span> <a class="code" href="classFileTransfer_a8b2a75cd29bb8941663dc51da6a4550c.html#a8b2a75cd29bb8941663dc51da6a4550c" title="Copies a file.">copyFile</a>($source, $destination) {
<a name="l00133"></a>00133     $source = $this-&gt;<a class="code" href="classFileTransfer_a66b62fbb6a66ffd8f9a986e85aefc98d.html#a66b62fbb6a66ffd8f9a986e85aefc98d" title="Changes backslashes to slashes, also removes a trailing slash.">sanitizePath</a>($source);
<a name="l00134"></a>00134     $destination = $this-&gt;<a class="code" href="classFileTransfer_aeb01984e5d0dfab6959a0ac717578786.html#aeb01984e5d0dfab6959a0ac717578786" title="Returns a modified path suitable for passing to the server.">fixRemotePath</a>($destination);
<a name="l00135"></a>00135     $this-&gt;<a class="code" href="classFileTransfer_a1bd7f1c3b5431c3b53236f7aae0c1460.html#a1bd7f1c3b5431c3b53236f7aae0c1460" title="Checks that the path is inside the jail and throws an exception if not.">checkPath</a>($destination);
<a name="l00136"></a>00136     $this-&gt;<a class="code" href="classFileTransfer_a9ca65dc0107476d044cf18c0873f4a90.html#a9ca65dc0107476d044cf18c0873f4a90" title="Copies a file.">copyFileJailed</a>($source, $destination);
<a name="l00137"></a>00137   }
<a name="l00138"></a>00138 
<a name="l00145"></a><a class="code" href="classFileTransfer_a3e9fa3033b038b42c8f190da9d6915ab.html#a3e9fa3033b038b42c8f190da9d6915ab">00145</a>   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">function</span> <a class="code" href="classFileTransfer_a3e9fa3033b038b42c8f190da9d6915ab.html#a3e9fa3033b038b42c8f190da9d6915ab" title="Removes a file.">removeFile</a>($destination) {
<a name="l00146"></a>00146     $destination = $this-&gt;<a class="code" href="classFileTransfer_aeb01984e5d0dfab6959a0ac717578786.html#aeb01984e5d0dfab6959a0ac717578786" title="Returns a modified path suitable for passing to the server.">fixRemotePath</a>($destination);
<a name="l00147"></a>00147     $this-&gt;<a class="code" href="classFileTransfer_a1bd7f1c3b5431c3b53236f7aae0c1460.html#a1bd7f1c3b5431c3b53236f7aae0c1460" title="Checks that the path is inside the jail and throws an exception if not.">checkPath</a>($destination);
<a name="l00148"></a>00148     $this-&gt;<a class="code" href="classFileTransfer_aa699cbea5def346f1d5ce818b0fa7ea7.html#aa699cbea5def346f1d5ce818b0fa7ea7" title="Removes a file.">removeFileJailed</a>($destination);
<a name="l00149"></a>00149   }
<a name="l00150"></a>00150 
<a name="l00157"></a><a class="code" href="classFileTransfer_a1bd7f1c3b5431c3b53236f7aae0c1460.html#a1bd7f1c3b5431c3b53236f7aae0c1460">00157</a>   <span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">function</span> <a class="code" href="classFileTransfer_a1bd7f1c3b5431c3b53236f7aae0c1460.html#a1bd7f1c3b5431c3b53236f7aae0c1460" title="Checks that the path is inside the jail and throws an exception if not.">checkPath</a>($path) {
<a name="l00158"></a>00158     $full_jail = $this-&gt;chroot . $this-&gt;jail;
<a name="l00159"></a>00159     $full_path = <a class="code" href="group__php__wrappers_gafaa5b186c9e78f53b39aae12633eea44.html#gafaa5b186c9e78f53b39aae12633eea44" title="Returns the absolute local filesystem path of a stream URI.">drupal_realpath</a>(substr($this-&gt;chroot . $path, 0, strlen($full_jail)));
<a name="l00160"></a>00160     $full_path = $this-&gt;<a class="code" href="classFileTransfer_aeb01984e5d0dfab6959a0ac717578786.html#aeb01984e5d0dfab6959a0ac717578786" title="Returns a modified path suitable for passing to the server.">fixRemotePath</a>($full_path, FALSE);
<a name="l00161"></a>00161     <span class="keywordflow">if</span> ($full_jail !== $full_path) {
<a name="l00162"></a>00162       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classFileTransferException.html" title="FileTransferException class.">FileTransferException</a>(<span class="stringliteral">&#39;@directory is outside of the @jail&#39;</span>, NULL, array(<span class="stringliteral">&#39;@directory&#39;</span> =&gt; $path, <span class="stringliteral">&#39;@jail&#39;</span> =&gt; $this-&gt;jail));
<a name="l00163"></a>00163     }
<a name="l00164"></a>00164   }
<a name="l00165"></a>00165 
<a name="l00177"></a><a class="code" href="classFileTransfer_aeb01984e5d0dfab6959a0ac717578786.html#aeb01984e5d0dfab6959a0ac717578786">00177</a>   <span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">function</span> <a class="code" href="classFileTransfer_aeb01984e5d0dfab6959a0ac717578786.html#aeb01984e5d0dfab6959a0ac717578786" title="Returns a modified path suitable for passing to the server.">fixRemotePath</a>($path, $strip_chroot = TRUE) {
<a name="l00178"></a>00178     $path = $this-&gt;<a class="code" href="classFileTransfer_a66b62fbb6a66ffd8f9a986e85aefc98d.html#a66b62fbb6a66ffd8f9a986e85aefc98d" title="Changes backslashes to slashes, also removes a trailing slash.">sanitizePath</a>($path);
<a name="l00179"></a>00179     $path = preg_replace(<span class="stringliteral">&#39;|^([a-z]{1}):|i&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $path); <span class="comment">// Strip out windows driveletter if its there.</span>
<a name="l00180"></a>00180     <span class="keywordflow">if</span> ($strip_chroot) {
<a name="l00181"></a>00181       <span class="keywordflow">if</span> ($this-&gt;chroot &amp;&amp; strpos($path, $this-&gt;chroot) === 0) {
<a name="l00182"></a>00182         $path = ($path == $this-&gt;chroot) ? <span class="stringliteral">&#39;&#39;</span> : substr($path, strlen($this-&gt;chroot));
<a name="l00183"></a>00183       }
<a name="l00184"></a>00184     }
<a name="l00185"></a>00185     <span class="keywordflow">return</span> $path;
<a name="l00186"></a>00186   }
<a name="l00187"></a>00187 
<a name="l00194"></a><a class="code" href="classFileTransfer_a66b62fbb6a66ffd8f9a986e85aefc98d.html#a66b62fbb6a66ffd8f9a986e85aefc98d">00194</a>   <span class="keyword">function</span> <a class="code" href="classFileTransfer_a66b62fbb6a66ffd8f9a986e85aefc98d.html#a66b62fbb6a66ffd8f9a986e85aefc98d" title="Changes backslashes to slashes, also removes a trailing slash.">sanitizePath</a>($path) {
<a name="l00195"></a>00195     $path = str_replace(<span class="charliteral">&#39;\\&#39;</span>, <span class="charliteral">&#39;/&#39;</span>, $path); <span class="comment">// Windows path sanitization.</span>
<a name="l00196"></a>00196     <span class="keywordflow">if</span> (substr($path, -1) == <span class="charliteral">&#39;/&#39;</span>) {
<a name="l00197"></a>00197       $path = substr($path, 0, -1);
<a name="l00198"></a>00198     }
<a name="l00199"></a>00199     <span class="keywordflow">return</span> $path;
<a name="l00200"></a>00200   }
<a name="l00201"></a>00201 
<a name="l00212"></a><a class="code" href="classFileTransfer_a004c3757d055356cbbb99d122a5d686c.html#a004c3757d055356cbbb99d122a5d686c">00212</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classFileTransfer_a004c3757d055356cbbb99d122a5d686c.html#a004c3757d055356cbbb99d122a5d686c" title="Copies a directory.">copyDirectoryJailed</a>($source, $destination) {
<a name="l00213"></a>00213     <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classFileTransfer_a86c4289cfeccacf9bd2bcae8961889ab.html#a86c4289cfeccacf9bd2bcae8961889ab" title="Checks if a particular path is a directory.">isDirectory</a>($destination)) {
<a name="l00214"></a>00214       $destination = $destination . <span class="charliteral">&#39;/&#39;</span> . <a class="code" href="group__php__wrappers_ga0125d5e205f50be86146a8df58c2bc5f.html#ga0125d5e205f50be86146a8df58c2bc5f" title="Gets the filename from a given path.">drupal_basename</a>($source);
<a name="l00215"></a>00215     }
<a name="l00216"></a>00216     $this-&gt;<a class="code" href="classFileTransfer_a8d63f097ba6bf3334420bd8dcccb4898.html#a8d63f097ba6bf3334420bd8dcccb4898" title="Creates a directory.">createDirectory</a>($destination);
<a name="l00217"></a>00217     <span class="keywordflow">foreach</span> (<span class="keyword">new</span> RecursiveIteratorIterator(<span class="keyword">new</span> <a class="code" href="classSkipDotsRecursiveDirectoryIterator.html" title="Provides an interface for iterating recursively over filesystem directories.">SkipDotsRecursiveDirectoryIterator</a>($source), RecursiveIteratorIterator::SELF_FIRST) as $filename =&gt; $file) {
<a name="l00218"></a>00218       $relative_path = substr($filename, strlen($source));
<a name="l00219"></a>00219       <span class="keywordflow">if</span> ($file-&gt;isDir()) {
<a name="l00220"></a>00220         $this-&gt;<a class="code" href="classFileTransfer_a8d63f097ba6bf3334420bd8dcccb4898.html#a8d63f097ba6bf3334420bd8dcccb4898" title="Creates a directory.">createDirectory</a>($destination . $relative_path);
<a name="l00221"></a>00221       }
<a name="l00222"></a>00222       <span class="keywordflow">else</span> {
<a name="l00223"></a>00223         $this-&gt;<a class="code" href="classFileTransfer_a8b2a75cd29bb8941663dc51da6a4550c.html#a8b2a75cd29bb8941663dc51da6a4550c" title="Copies a file.">copyFile</a>($file-&gt;getPathName(), $destination . $relative_path);
<a name="l00224"></a>00224       }
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226   }
<a name="l00227"></a>00227 
<a name="l00234"></a>00234   <span class="keyword">abstract</span> <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classFileTransfer_a585c6cfab189aabbee70a624a50af975.html#a585c6cfab189aabbee70a624a50af975" title="Creates a directory.">createDirectoryJailed</a>($directory);
<a name="l00235"></a>00235 
<a name="l00242"></a>00242   <span class="keyword">abstract</span> <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classFileTransfer_a9b9a21556d191235b3a5f85c15878789.html#a9b9a21556d191235b3a5f85c15878789" title="Removes a directory.">removeDirectoryJailed</a>($directory);
<a name="l00243"></a>00243 
<a name="l00252"></a>00252   <span class="keyword">abstract</span> <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classFileTransfer_a9ca65dc0107476d044cf18c0873f4a90.html#a9ca65dc0107476d044cf18c0873f4a90" title="Copies a file.">copyFileJailed</a>($source, $destination);
<a name="l00253"></a>00253 
<a name="l00260"></a>00260   <span class="keyword">abstract</span> <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classFileTransfer_aa699cbea5def346f1d5ce818b0fa7ea7.html#aa699cbea5def346f1d5ce818b0fa7ea7" title="Removes a file.">removeFileJailed</a>($destination);
<a name="l00261"></a>00261 
<a name="l00270"></a>00270   <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classFileTransfer_a86c4289cfeccacf9bd2bcae8961889ab.html#a86c4289cfeccacf9bd2bcae8961889ab" title="Checks if a particular path is a directory.">isDirectory</a>($path);
<a name="l00271"></a>00271 
<a name="l00280"></a>00280   <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classFileTransfer_a0522f0f47d022f2cf8fe375b983d4e39.html#a0522f0f47d022f2cf8fe375b983d4e39" title="Checks if a particular path is a file (not a directory).">isFile</a>($path);
<a name="l00281"></a>00281 
<a name="l00291"></a><a class="code" href="classFileTransfer_aafd33ce71a2e77955e172cf6fc204b00.html#aafd33ce71a2e77955e172cf6fc204b00">00291</a>   <span class="keyword">function</span> <a class="code" href="classFileTransfer_aafd33ce71a2e77955e172cf6fc204b00.html#aafd33ce71a2e77955e172cf6fc204b00" title="Return the chroot property for this connection.">findChroot</a>() {
<a name="l00292"></a>00292     <span class="comment">// If the file exists as is, there is no chroot.</span>
<a name="l00293"></a>00293     $path = __FILE__;
<a name="l00294"></a>00294     $path = $this-&gt;<a class="code" href="classFileTransfer_aeb01984e5d0dfab6959a0ac717578786.html#aeb01984e5d0dfab6959a0ac717578786" title="Returns a modified path suitable for passing to the server.">fixRemotePath</a>($path, FALSE);
<a name="l00295"></a>00295     <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classFileTransfer_a0522f0f47d022f2cf8fe375b983d4e39.html#a0522f0f47d022f2cf8fe375b983d4e39" title="Checks if a particular path is a file (not a directory).">isFile</a>($path)) {
<a name="l00296"></a>00296       <span class="keywordflow">return</span> FALSE;
<a name="l00297"></a>00297     }
<a name="l00298"></a>00298 
<a name="l00299"></a>00299     $path = dirname(__FILE__);
<a name="l00300"></a>00300     $path = $this-&gt;<a class="code" href="classFileTransfer_aeb01984e5d0dfab6959a0ac717578786.html#aeb01984e5d0dfab6959a0ac717578786" title="Returns a modified path suitable for passing to the server.">fixRemotePath</a>($path, FALSE);
<a name="l00301"></a>00301     $parts = explode(<span class="charliteral">&#39;/&#39;</span>, $path);
<a name="l00302"></a>00302     $chroot = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00303"></a>00303     <span class="keywordflow">while</span> (count($parts)) {
<a name="l00304"></a>00304       $check = implode($parts, <span class="charliteral">&#39;/&#39;</span>);
<a name="l00305"></a>00305       <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classFileTransfer_a0522f0f47d022f2cf8fe375b983d4e39.html#a0522f0f47d022f2cf8fe375b983d4e39" title="Checks if a particular path is a file (not a directory).">isFile</a>($check . <span class="charliteral">&#39;/&#39;</span> . <a class="code" href="group__php__wrappers_ga0125d5e205f50be86146a8df58c2bc5f.html#ga0125d5e205f50be86146a8df58c2bc5f" title="Gets the filename from a given path.">drupal_basename</a>(__FILE__))) {
<a name="l00306"></a>00306         <span class="comment">// Remove the trailing slash.</span>
<a name="l00307"></a>00307         <span class="keywordflow">return</span> substr($chroot, 0, -1);
<a name="l00308"></a>00308       }
<a name="l00309"></a>00309       $chroot .= array_shift($parts) . <span class="charliteral">&#39;/&#39;</span>;
<a name="l00310"></a>00310     }
<a name="l00311"></a>00311     <span class="keywordflow">return</span> FALSE;
<a name="l00312"></a>00312   }
<a name="l00313"></a>00313 
<a name="l00318"></a><a class="code" href="classFileTransfer_a09ee9c27162826be5c39d9db3494c1f2.html#a09ee9c27162826be5c39d9db3494c1f2">00318</a>   <span class="keyword">function</span> <a class="code" href="classFileTransfer_a09ee9c27162826be5c39d9db3494c1f2.html#a09ee9c27162826be5c39d9db3494c1f2" title="Sets the chroot and changes the jail to match the correct path scheme.">setChroot</a>() {
<a name="l00319"></a>00319     $this-&gt;chroot = $this-&gt;<a class="code" href="classFileTransfer_aafd33ce71a2e77955e172cf6fc204b00.html#aafd33ce71a2e77955e172cf6fc204b00" title="Return the chroot property for this connection.">findChroot</a>();
<a name="l00320"></a>00320     $this-&gt;jail = $this-&gt;<a class="code" href="classFileTransfer_aeb01984e5d0dfab6959a0ac717578786.html#aeb01984e5d0dfab6959a0ac717578786" title="Returns a modified path suitable for passing to the server.">fixRemotePath</a>($this-&gt;jail);
<a name="l00321"></a>00321   }
<a name="l00322"></a>00322 
<a name="l00329"></a><a class="code" href="classFileTransfer_a3b5e843b16814bdbe43dfecda17bae33.html#a3b5e843b16814bdbe43dfecda17bae33">00329</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classFileTransfer_a3b5e843b16814bdbe43dfecda17bae33.html#a3b5e843b16814bdbe43dfecda17bae33" title="Returns a form to collect connection settings credentials.">getSettingsForm</a>() {
<a name="l00330"></a>00330     $form[<span class="stringliteral">&#39;username&#39;</span>] = array(
<a name="l00331"></a>00331       <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;textfield&#39;</span>,
<a name="l00332"></a>00332       <span class="stringliteral">&#39;#title&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;Username&#39;</span>),
<a name="l00333"></a>00333     );
<a name="l00334"></a>00334     $form[<span class="stringliteral">&#39;password&#39;</span>] = array(
<a name="l00335"></a>00335       <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;password&#39;</span>,
<a name="l00336"></a>00336       <span class="stringliteral">&#39;#title&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;Password&#39;</span>),
<a name="l00337"></a>00337       <span class="stringliteral">&#39;#description&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;Your password is not saved in the database and is only used to establish a connection.&#39;</span>),
<a name="l00338"></a>00338     );
<a name="l00339"></a>00339     $form[<span class="stringliteral">&#39;advanced&#39;</span>] = array(
<a name="l00340"></a>00340       <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;fieldset&#39;</span>,
<a name="l00341"></a>00341       <span class="stringliteral">&#39;#title&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;Advanced settings&#39;</span>),
<a name="l00342"></a>00342       <span class="stringliteral">&#39;#collapsible&#39;</span> =&gt; TRUE,
<a name="l00343"></a>00343       <span class="stringliteral">&#39;#collapsed&#39;</span> =&gt; TRUE,
<a name="l00344"></a>00344     );
<a name="l00345"></a>00345     $form[<span class="stringliteral">&#39;advanced&#39;</span>][<span class="stringliteral">&#39;hostname&#39;</span>] = array(
<a name="l00346"></a>00346       <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;textfield&#39;</span>,
<a name="l00347"></a>00347       <span class="stringliteral">&#39;#title&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;Host&#39;</span>),
<a name="l00348"></a>00348       <span class="stringliteral">&#39;#default_value&#39;</span> =&gt; <span class="stringliteral">&#39;localhost&#39;</span>,
<a name="l00349"></a>00349       <span class="stringliteral">&#39;#description&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;The connection will be created between your web server and the machine hosting the web server files. In the vast majority of cases, this will be the same machine, and &quot;localhost&quot; is correct.&#39;</span>),
<a name="l00350"></a>00350     );
<a name="l00351"></a>00351     $form[<span class="stringliteral">&#39;advanced&#39;</span>][<span class="stringliteral">&#39;port&#39;</span>] = array(
<a name="l00352"></a>00352       <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;textfield&#39;</span>,
<a name="l00353"></a>00353       <span class="stringliteral">&#39;#title&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;Port&#39;</span>),
<a name="l00354"></a>00354       <span class="stringliteral">&#39;#default_value&#39;</span> =&gt; NULL,
<a name="l00355"></a>00355     );
<a name="l00356"></a>00356     <span class="keywordflow">return</span> $form;
<a name="l00357"></a>00357   }
<a name="l00358"></a>00358 }
<a name="l00359"></a>00359 
<a name="l00363"></a><a class="code" href="classFileTransferException.html">00363</a> <span class="keyword">class </span><a class="code" href="classFileTransferException.html" title="FileTransferException class.">FileTransferException</a> <span class="keyword">extends</span> <a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> {
<a name="l00364"></a><a class="code" href="classFileTransferException_aa540db4a51461e918abe9356fcc9fbb2.html#aa540db4a51461e918abe9356fcc9fbb2">00364</a>   <span class="keyword">public</span> <a class="code" href="classFileTransferException_aa540db4a51461e918abe9356fcc9fbb2.html#aa540db4a51461e918abe9356fcc9fbb2">$arguments</a>;
<a name="l00365"></a>00365 
<a name="l00366"></a><a class="code" href="classFileTransferException_a88a4fb6187129b45c751436a61774362.html#a88a4fb6187129b45c751436a61774362">00366</a>   <span class="keyword">function</span> <a class="code" href="classFileTransferException_a88a4fb6187129b45c751436a61774362.html#a88a4fb6187129b45c751436a61774362">__construct</a>($message, $code = 0, <a class="code" href="classFileTransferException_aa540db4a51461e918abe9356fcc9fbb2.html#aa540db4a51461e918abe9356fcc9fbb2">$arguments</a> = array()) {
<a name="l00367"></a>00367     <a class="code" href="classFileTransferException_a88a4fb6187129b45c751436a61774362.html#a88a4fb6187129b45c751436a61774362">parent::__construct</a>($message, $code);
<a name="l00368"></a>00368     $this-&gt;arguments = <a class="code" href="classFileTransferException_aa540db4a51461e918abe9356fcc9fbb2.html#aa540db4a51461e918abe9356fcc9fbb2">$arguments</a>;
<a name="l00369"></a>00369   }
<a name="l00370"></a>00370 }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372 
<a name="l00376"></a><a class="code" href="interfaceFileTransferChmodInterface.html">00376</a> <span class="keyword">interface </span><a class="code" href="interfaceFileTransferChmodInterface.html" title="A FileTransfer Class implementing this interface can be used to chmod files.">FileTransferChmodInterface</a> {
<a name="l00377"></a>00377 
<a name="l00388"></a>00388   <span class="keyword">function</span> <a class="code" href="interfaceFileTransferChmodInterface_a031e451823be199251562369d1f760f0.html#a031e451823be199251562369d1f760f0" title="Changes the permissions of the file / directory specified in $path.">chmodJailed</a>($path, $mode, $recursive);
<a name="l00389"></a>00389 }
<a name="l00390"></a>00390 
<a name="l00400"></a><a class="code" href="classSkipDotsRecursiveDirectoryIterator.html">00400</a> <span class="keyword">class </span><a class="code" href="classSkipDotsRecursiveDirectoryIterator.html" title="Provides an interface for iterating recursively over filesystem directories.">SkipDotsRecursiveDirectoryIterator</a> <span class="keyword">extends</span> RecursiveDirectoryIterator {
<a name="l00407"></a><a class="code" href="classSkipDotsRecursiveDirectoryIterator_a88cbeecb3801d63b0a6cb15e1d7445a1.html#a88cbeecb3801d63b0a6cb15e1d7445a1">00407</a>   <span class="keyword">function</span> <a class="code" href="classSkipDotsRecursiveDirectoryIterator_a88cbeecb3801d63b0a6cb15e1d7445a1.html#a88cbeecb3801d63b0a6cb15e1d7445a1" title="Constructs a SkipDotsRecursiveDirectoryIterator.">__construct</a>($path) {
<a name="l00408"></a>00408     <a class="code" href="classSkipDotsRecursiveDirectoryIterator_a88cbeecb3801d63b0a6cb15e1d7445a1.html#a88cbeecb3801d63b0a6cb15e1d7445a1" title="Constructs a SkipDotsRecursiveDirectoryIterator.">parent::__construct</a>($path);
<a name="l00409"></a>00409   }
<a name="l00410"></a>00410 
<a name="l00411"></a><a class="code" href="classSkipDotsRecursiveDirectoryIterator_a663a851362654c814a94917b0088761d.html#a663a851362654c814a94917b0088761d">00411</a>   <span class="keyword">function</span> <a class="code" href="classSkipDotsRecursiveDirectoryIterator_a663a851362654c814a94917b0088761d.html#a663a851362654c814a94917b0088761d">next</a>() {
<a name="l00412"></a>00412     <a class="code" href="classSkipDotsRecursiveDirectoryIterator_a663a851362654c814a94917b0088761d.html#a663a851362654c814a94917b0088761d">parent::next</a>();
<a name="l00413"></a>00413     <span class="keywordflow">while</span> ($this-&gt;isDot()) {
<a name="l00414"></a>00414       <a class="code" href="classSkipDotsRecursiveDirectoryIterator_a663a851362654c814a94917b0088761d.html#a663a851362654c814a94917b0088761d">parent::next</a>();
<a name="l00415"></a>00415     }
<a name="l00416"></a>00416   }
<a name="l00417"></a>00417 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 22 2012 16:46:14 for Shopcart by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
