<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Shopcart: includes/theme.inc Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Shopcart
   &#160;<span id="projectnumber">version2.0</span>
   </div>
   <div id="projectbrief">Shoppingcart</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_5b89693129504707d608c5412e7b88d4.html">includes</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">theme.inc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="theme_8inc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00021"></a><a class="code" href="group__content__flags_ga72684c074c0ade1909bad72841c48614.html#ga72684c074c0ade1909bad72841c48614">00021</a> define(<span class="stringliteral">&#39;MARK_READ&#39;</span>, 0);
<a name="l00022"></a>00022 
<a name="l00026"></a><a class="code" href="group__content__flags_ga44d42cbfa50b553ad2439e19478d0d3d.html#ga44d42cbfa50b553ad2439e19478d0d3d">00026</a> define(<span class="stringliteral">&#39;MARK_NEW&#39;</span>, 1);
<a name="l00027"></a>00027 
<a name="l00031"></a><a class="code" href="group__content__flags_ga6e9f0d9282433b9f08f025aaca43e1fe.html#ga6e9f0d9282433b9f08f025aaca43e1fe">00031</a> define(<span class="stringliteral">&#39;MARK_UPDATED&#39;</span>, 2);
<a name="l00032"></a>00032 
<a name="l00047"></a><a class="code" href="theme_8inc_a8585432498ca31ecec1292096a0dce3e.html#a8585432498ca31ecec1292096a0dce3e">00047</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a8585432498ca31ecec1292096a0dce3e.html#a8585432498ca31ecec1292096a0dce3e" title="End of &quot;Content markers&quot;.">drupal_theme_access</a>($theme) {
<a name="l00048"></a>00048   <span class="keywordflow">if</span> (is_object($theme)) {
<a name="l00049"></a>00049     <span class="keywordflow">return</span> <a class="code" href="theme_8inc_a0cdacdc488fa9d7d67b2e7a8c20b9ecc.html#a0cdacdc488fa9d7d67b2e7a8c20b9ecc" title="Helper function for determining access to a theme.">_drupal_theme_access</a>($theme);
<a name="l00050"></a>00050   }
<a name="l00051"></a>00051   <span class="keywordflow">else</span> {
<a name="l00052"></a>00052     $themes = <a class="code" href="theme_8inc_a48d5521b10139d745626435d804353a4.html#a48d5521b10139d745626435d804353a4" title="Return a list of all currently available themes.">list_themes</a>();
<a name="l00053"></a>00053     <span class="keywordflow">return</span> isset($themes[$theme]) &amp;&amp; <a class="code" href="theme_8inc_a0cdacdc488fa9d7d67b2e7a8c20b9ecc.html#a0cdacdc488fa9d7d67b2e7a8c20b9ecc" title="Helper function for determining access to a theme.">_drupal_theme_access</a>($themes[$theme]);
<a name="l00054"></a>00054   }
<a name="l00055"></a>00055 }
<a name="l00056"></a>00056 
<a name="l00062"></a><a class="code" href="theme_8inc_a0cdacdc488fa9d7d67b2e7a8c20b9ecc.html#a0cdacdc488fa9d7d67b2e7a8c20b9ecc">00062</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a0cdacdc488fa9d7d67b2e7a8c20b9ecc.html#a0cdacdc488fa9d7d67b2e7a8c20b9ecc" title="Helper function for determining access to a theme.">_drupal_theme_access</a>($theme) {
<a name="l00063"></a>00063   $admin_theme = <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;admin_theme&#39;</span>);
<a name="l00064"></a>00064   <span class="keywordflow">return</span> !empty($theme-&gt;status) || ($admin_theme &amp;&amp; $theme-&gt;name == $admin_theme);
<a name="l00065"></a>00065 }
<a name="l00066"></a>00066 
<a name="l00070"></a><a class="code" href="theme_8inc_a9e48961b3be3ca78f434b047fbb8463f.html#a9e48961b3be3ca78f434b047fbb8463f">00070</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a9e48961b3be3ca78f434b047fbb8463f.html#a9e48961b3be3ca78f434b047fbb8463f" title="Initialize the theme system by loading the theme.">drupal_theme_initialize</a>() {
<a name="l00071"></a>00071   global $theme, $user, $theme_key;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073   <span class="comment">// If $theme is already set, assume the others are set, too, and do nothing</span>
<a name="l00074"></a>00074   <span class="keywordflow">if</span> (isset($theme)) {
<a name="l00075"></a>00075     <span class="keywordflow">return</span>;
<a name="l00076"></a>00076   }
<a name="l00077"></a>00077 
<a name="l00078"></a>00078   <a class="code" href="bootstrap_8inc_a8dcad7737ed560086bcdd9998a020a93.html#a8dcad7737ed560086bcdd9998a020a93" title="Ensures Drupal is bootstrapped to the specified phase.">drupal_bootstrap</a>(<a class="code" href="bootstrap_8inc_a693d842eaaf448b1e6c37cc4ef068e3a.html#a693d842eaaf448b1e6c37cc4ef068e3a" title="Third bootstrap phase: initialize database layer.">DRUPAL_BOOTSTRAP_DATABASE</a>);
<a name="l00079"></a>00079   $themes = <a class="code" href="theme_8inc_a48d5521b10139d745626435d804353a4.html#a48d5521b10139d745626435d804353a4" title="Return a list of all currently available themes.">list_themes</a>();
<a name="l00080"></a>00080 
<a name="l00081"></a>00081   <span class="comment">// Only select the user selected theme if it is available in the</span>
<a name="l00082"></a>00082   <span class="comment">// list of themes that can be accessed.</span>
<a name="l00083"></a>00083   $theme = !empty($user-&gt;theme) &amp;&amp; <a class="code" href="theme_8inc_a8585432498ca31ecec1292096a0dce3e.html#a8585432498ca31ecec1292096a0dce3e" title="End of &quot;Content markers&quot;.">drupal_theme_access</a>($user-&gt;theme) ? $user-&gt;theme : <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;theme_default&#39;</span>, <span class="stringliteral">&#39;bartik&#39;</span>);
<a name="l00084"></a>00084 
<a name="l00085"></a>00085   <span class="comment">// Allow modules to override the theme. Validation has already been performed</span>
<a name="l00086"></a>00086   <span class="comment">// inside menu_get_custom_theme(), so we do not need to check it again here.</span>
<a name="l00087"></a>00087   $custom_theme = <a class="code" href="group__menu_gaf00aa2604e9ad7c0ff0faa6cbc301da8.html#gaf00aa2604e9ad7c0ff0faa6cbc301da8" title="Gets the custom theme for the current page, if there is one.">menu_get_custom_theme</a>();
<a name="l00088"></a>00088   $theme = !empty($custom_theme) ? $custom_theme : $theme;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090   <span class="comment">// Store the identifier for retrieving theme settings with.</span>
<a name="l00091"></a>00091   $theme_key = $theme;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093   <span class="comment">// Find all our ancestor themes and put them in an array.</span>
<a name="l00094"></a>00094   $base_theme = array();
<a name="l00095"></a>00095   $ancestor = $theme;
<a name="l00096"></a>00096   <span class="keywordflow">while</span> ($ancestor &amp;&amp; isset($themes[$ancestor]-&gt;base_theme)) {
<a name="l00097"></a>00097     $ancestor = $themes[$ancestor]-&gt;base_theme;
<a name="l00098"></a>00098     $base_theme[] = $themes[$ancestor];
<a name="l00099"></a>00099   }
<a name="l00100"></a>00100   <a class="code" href="theme_8inc_a3fe8f5fcec2fa4c93ee68b59beac38c9.html#a3fe8f5fcec2fa4c93ee68b59beac38c9" title="Initialize the theme system given already loaded information.">_drupal_theme_initialize</a>($themes[$theme], array_reverse($base_theme));
<a name="l00101"></a>00101 
<a name="l00102"></a>00102   <span class="comment">// Themes can have alter functions, so reset the drupal_alter() cache.</span>
<a name="l00103"></a>00103   <a class="code" href="group__schemaapi_ga714b5ed0b14c43b61eef0c895598c5c4.html#ga714b5ed0b14c43b61eef0c895598c5c4" title="Resets one or all centrally stored static variable(s).">drupal_static_reset</a>(<span class="stringliteral">&#39;drupal_alter&#39;</span>);
<a name="l00104"></a>00104 
<a name="l00105"></a>00105   <span class="comment">// Provide the page with information about the theme that&#39;s used, so that a</span>
<a name="l00106"></a>00106   <span class="comment">// later Ajax request can be rendered using the same theme.</span>
<a name="l00107"></a>00107   <span class="comment">// @see ajax_base_page_theme()</span>
<a name="l00108"></a>00108   $setting[<span class="stringliteral">&#39;ajaxPageState&#39;</span>] = array(
<a name="l00109"></a>00109     <span class="stringliteral">&#39;theme&#39;</span> =&gt; $theme_key,
<a name="l00110"></a>00110     <span class="stringliteral">&#39;theme_token&#39;</span> =&gt; <a class="code" href="common_8inc_a16989177d9fa05df9b45e8797ce04994.html#a16989177d9fa05df9b45e8797ce04994" title="Generates a token based on $value, the user session, and the private key.">drupal_get_token</a>($theme_key),
<a name="l00111"></a>00111   );
<a name="l00112"></a>00112   <a class="code" href="common_8inc_a623370a2c3c2de0390dab078d17dca02.html#a623370a2c3c2de0390dab078d17dca02" title="Adds a JavaScript file, setting, or inline code to the page.">drupal_add_js</a>($setting, <span class="stringliteral">&#39;setting&#39;</span>);
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 
<a name="l00140"></a><a class="code" href="theme_8inc_a3fe8f5fcec2fa4c93ee68b59beac38c9.html#a3fe8f5fcec2fa4c93ee68b59beac38c9">00140</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a3fe8f5fcec2fa4c93ee68b59beac38c9.html#a3fe8f5fcec2fa4c93ee68b59beac38c9" title="Initialize the theme system given already loaded information.">_drupal_theme_initialize</a>($theme, $base_theme = array(), $registry_callback = <span class="stringliteral">&#39;_theme_load_registry&#39;</span>) {
<a name="l00141"></a>00141   global $theme_info, $base_theme_info, $theme_engine, $theme_path;
<a name="l00142"></a>00142   $theme_info = $theme;
<a name="l00143"></a>00143   $base_theme_info = $base_theme;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145   $theme_path = dirname($theme-&gt;filename);
<a name="l00146"></a>00146 
<a name="l00147"></a>00147   <span class="comment">// Prepare stylesheets from this theme as well as all ancestor themes.</span>
<a name="l00148"></a>00148   <span class="comment">// We work it this way so that we can have child themes override parent</span>
<a name="l00149"></a>00149   <span class="comment">// theme stylesheets easily.</span>
<a name="l00150"></a>00150   $final_stylesheets = array();
<a name="l00151"></a>00151 
<a name="l00152"></a>00152   <span class="comment">// Grab stylesheets from base theme</span>
<a name="l00153"></a>00153   <span class="keywordflow">foreach</span> ($base_theme as $base) {
<a name="l00154"></a>00154     <span class="keywordflow">if</span> (!empty($base-&gt;stylesheets)) {
<a name="l00155"></a>00155       <span class="keywordflow">foreach</span> ($base-&gt;stylesheets as $media =&gt; $stylesheets) {
<a name="l00156"></a>00156         <span class="keywordflow">foreach</span> ($stylesheets as $name =&gt; $stylesheet) {
<a name="l00157"></a>00157           $final_stylesheets[$media][$name] = $stylesheet;
<a name="l00158"></a>00158         }
<a name="l00159"></a>00159       }
<a name="l00160"></a>00160     }
<a name="l00161"></a>00161   }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163   <span class="comment">// Add stylesheets used by this theme.</span>
<a name="l00164"></a>00164   <span class="keywordflow">if</span> (!empty($theme-&gt;stylesheets)) {
<a name="l00165"></a>00165     <span class="keywordflow">foreach</span> ($theme-&gt;stylesheets as $media =&gt; $stylesheets) {
<a name="l00166"></a>00166       <span class="keywordflow">foreach</span> ($stylesheets as $name =&gt; $stylesheet) {
<a name="l00167"></a>00167         $final_stylesheets[$media][$name] = $stylesheet;
<a name="l00168"></a>00168       }
<a name="l00169"></a>00169     }
<a name="l00170"></a>00170   }
<a name="l00171"></a>00171 
<a name="l00172"></a>00172   <span class="comment">// And now add the stylesheets properly</span>
<a name="l00173"></a>00173   <span class="keywordflow">foreach</span> ($final_stylesheets as $media =&gt; $stylesheets) {
<a name="l00174"></a>00174     <span class="keywordflow">foreach</span> ($stylesheets as $stylesheet) {
<a name="l00175"></a>00175       <a class="code" href="common_8inc_a2c5bb2667efb44b02f1a105c0bfdebe5.html#a2c5bb2667efb44b02f1a105c0bfdebe5" title="Adds a cascading stylesheet to the stylesheet queue.">drupal_add_css</a>($stylesheet, array(<span class="stringliteral">&#39;group&#39;</span> =&gt; <a class="code" href="common_8inc_ad9e230079d79c5c4affbd4ce0b64b7d7.html#ad9e230079d79c5c4affbd4ce0b64b7d7" title="The default group for theme CSS files added to the page.">CSS_THEME</a>, <span class="stringliteral">&#39;every_page&#39;</span> =&gt; TRUE, <span class="stringliteral">&#39;media&#39;</span> =&gt; $media));
<a name="l00176"></a>00176     }
<a name="l00177"></a>00177   }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179   <span class="comment">// Do basically the same as the above for scripts</span>
<a name="l00180"></a>00180   $final_scripts = array();
<a name="l00181"></a>00181 
<a name="l00182"></a>00182   <span class="comment">// Grab scripts from base theme</span>
<a name="l00183"></a>00183   <span class="keywordflow">foreach</span> ($base_theme as $base) {
<a name="l00184"></a>00184     <span class="keywordflow">if</span> (!empty($base-&gt;scripts)) {
<a name="l00185"></a>00185       <span class="keywordflow">foreach</span> ($base-&gt;scripts as $name =&gt; $script) {
<a name="l00186"></a>00186         $final_scripts[$name] = $script;
<a name="l00187"></a>00187       }
<a name="l00188"></a>00188     }
<a name="l00189"></a>00189   }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191   <span class="comment">// Add scripts used by this theme.</span>
<a name="l00192"></a>00192   <span class="keywordflow">if</span> (!empty($theme-&gt;scripts)) {
<a name="l00193"></a>00193     <span class="keywordflow">foreach</span> ($theme-&gt;scripts as $name =&gt; $script) {
<a name="l00194"></a>00194       $final_scripts[$name] = $script;
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196   }
<a name="l00197"></a>00197 
<a name="l00198"></a>00198   <span class="comment">// Add scripts used by this theme.</span>
<a name="l00199"></a>00199   <span class="keywordflow">foreach</span> ($final_scripts as $script) {
<a name="l00200"></a>00200     <a class="code" href="common_8inc_a623370a2c3c2de0390dab078d17dca02.html#a623370a2c3c2de0390dab078d17dca02" title="Adds a JavaScript file, setting, or inline code to the page.">drupal_add_js</a>($script, array(<span class="stringliteral">&#39;group&#39;</span> =&gt; <a class="code" href="common_8inc_a8d0998ffbec2cf7f8c2da3a80185fad2.html#a8d0998ffbec2cf7f8c2da3a80185fad2" title="The default group for theme JavaScript code added to the page.">JS_THEME</a>, <span class="stringliteral">&#39;every_page&#39;</span> =&gt; TRUE));
<a name="l00201"></a>00201   }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203   $theme_engine = NULL;
<a name="l00204"></a>00204 
<a name="l00205"></a>00205   <span class="comment">// Initialize the theme.</span>
<a name="l00206"></a>00206   <span class="keywordflow">if</span> (isset($theme-&gt;engine)) {
<a name="l00207"></a>00207     <span class="comment">// Include the engine.</span>
<a name="l00208"></a>00208     include_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $theme-&gt;owner;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210     $theme_engine = $theme-&gt;engine;
<a name="l00211"></a>00211     <span class="keywordflow">if</span> (function_exists($theme_engine . <span class="stringliteral">&#39;_init&#39;</span>)) {
<a name="l00212"></a>00212       <span class="keywordflow">foreach</span> ($base_theme as $base) {
<a name="l00213"></a>00213         call_user_func($theme_engine . <span class="stringliteral">&#39;_init&#39;</span>, $base);
<a name="l00214"></a>00214       }
<a name="l00215"></a>00215       call_user_func($theme_engine . <span class="stringliteral">&#39;_init&#39;</span>, $theme);
<a name="l00216"></a>00216     }
<a name="l00217"></a>00217   }
<a name="l00218"></a>00218   <span class="keywordflow">else</span> {
<a name="l00219"></a>00219     <span class="comment">// include non-engine theme files</span>
<a name="l00220"></a>00220     <span class="keywordflow">foreach</span> ($base_theme as $base) {
<a name="l00221"></a>00221       <span class="comment">// Include the theme file or the engine.</span>
<a name="l00222"></a>00222       <span class="keywordflow">if</span> (!empty($base-&gt;owner)) {
<a name="l00223"></a>00223         include_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $base-&gt;owner;
<a name="l00224"></a>00224       }
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226     <span class="comment">// and our theme gets one too.</span>
<a name="l00227"></a>00227     <span class="keywordflow">if</span> (!empty($theme-&gt;owner)) {
<a name="l00228"></a>00228       include_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $theme-&gt;owner;
<a name="l00229"></a>00229     }
<a name="l00230"></a>00230   }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232   <span class="keywordflow">if</span> (isset($registry_callback)) {
<a name="l00233"></a>00233     <a class="code" href="theme_8inc_a7b2a2d8890b8af591d8f7760fb56ab02.html#a7b2a2d8890b8af591d8f7760fb56ab02" title="Set the callback that will be used by theme_get_registry() to fetch the registry.">_theme_registry_callback</a>($registry_callback, array($theme, $base_theme, $theme_engine));
<a name="l00234"></a>00234   }
<a name="l00235"></a>00235 }
<a name="l00236"></a>00236 
<a name="l00254"></a><a class="code" href="theme_8inc_ae532c57b7a0288c1a359da1e2a70a0b1.html#ae532c57b7a0288c1a359da1e2a70a0b1">00254</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_ae532c57b7a0288c1a359da1e2a70a0b1.html#ae532c57b7a0288c1a359da1e2a70a0b1" title="Get the theme registry.">theme_get_registry</a>($complete = TRUE) {
<a name="l00255"></a>00255   <span class="comment">// Use the advanced drupal_static() pattern, since this is called very often.</span>
<a name="l00256"></a>00256   <span class="keyword">static</span> $drupal_static_fast;
<a name="l00257"></a>00257   <span class="keywordflow">if</span> (!isset($drupal_static_fast)) {
<a name="l00258"></a>00258     $drupal_static_fast[<span class="stringliteral">&#39;registry&#39;</span>] = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(<span class="stringliteral">&#39;theme_get_registry&#39;</span>);
<a name="l00259"></a>00259   }
<a name="l00260"></a>00260   $theme_registry = &amp;$drupal_static_fast[<span class="stringliteral">&#39;registry&#39;</span>];
<a name="l00261"></a>00261 
<a name="l00262"></a>00262   <span class="comment">// Initialize the theme, if this is called early in the bootstrap, or after</span>
<a name="l00263"></a>00263   <span class="comment">// static variables have been reset.</span>
<a name="l00264"></a>00264   <span class="keywordflow">if</span> (!is_array($theme_registry)) {
<a name="l00265"></a>00265     <a class="code" href="theme_8inc_a9e48961b3be3ca78f434b047fbb8463f.html#a9e48961b3be3ca78f434b047fbb8463f" title="Initialize the theme system by loading the theme.">drupal_theme_initialize</a>();
<a name="l00266"></a>00266     $theme_registry = array();
<a name="l00267"></a>00267   }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269   $key = (int) $complete;
<a name="l00270"></a>00270 
<a name="l00271"></a>00271   <span class="keywordflow">if</span> (!isset($theme_registry[$key])) {
<a name="l00272"></a>00272     list($callback, $arguments) = <a class="code" href="theme_8inc_a7b2a2d8890b8af591d8f7760fb56ab02.html#a7b2a2d8890b8af591d8f7760fb56ab02" title="Set the callback that will be used by theme_get_registry() to fetch the registry.">_theme_registry_callback</a>();
<a name="l00273"></a>00273     <span class="keywordflow">if</span> (!$complete) {
<a name="l00274"></a>00274       $arguments[] = FALSE;
<a name="l00275"></a>00275     }
<a name="l00276"></a>00276     $theme_registry[$key] = call_user_func_array($callback, $arguments);
<a name="l00277"></a>00277   }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279   <span class="keywordflow">return</span> $theme_registry[$key];
<a name="l00280"></a>00280 }
<a name="l00281"></a>00281 
<a name="l00290"></a><a class="code" href="theme_8inc_a7b2a2d8890b8af591d8f7760fb56ab02.html#a7b2a2d8890b8af591d8f7760fb56ab02">00290</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a7b2a2d8890b8af591d8f7760fb56ab02.html#a7b2a2d8890b8af591d8f7760fb56ab02" title="Set the callback that will be used by theme_get_registry() to fetch the registry.">_theme_registry_callback</a>($callback = NULL, array $arguments = array()) {
<a name="l00291"></a>00291   <span class="keyword">static</span> $stored;
<a name="l00292"></a>00292   <span class="keywordflow">if</span> (isset($callback)) {
<a name="l00293"></a>00293     $stored = array($callback, $arguments);
<a name="l00294"></a>00294   }
<a name="l00295"></a>00295   <span class="keywordflow">return</span> $stored;
<a name="l00296"></a>00296 }
<a name="l00297"></a>00297 
<a name="l00315"></a><a class="code" href="theme_8inc_a67aaff43a866a3e65962408f323de8eb.html#a67aaff43a866a3e65962408f323de8eb">00315</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a67aaff43a866a3e65962408f323de8eb.html#a67aaff43a866a3e65962408f323de8eb" title="Get the theme_registry cache; if it doesn&#39;t exist, build it.">_theme_load_registry</a>($theme, $base_theme = NULL, $theme_engine = NULL, $complete = TRUE) {
<a name="l00316"></a>00316   <span class="keywordflow">if</span> ($complete) {
<a name="l00317"></a>00317     <span class="comment">// Check the theme registry cache; if it exists, use it.</span>
<a name="l00318"></a>00318     $cached = <a class="code" href="cache_8inc_a9d873815c28909b61c3a6188b383f8a3.html#a9d873815c28909b61c3a6188b383f8a3" title="Returns data from the persistent cache.">cache_get</a>(<span class="stringliteral">&quot;theme_registry:$theme-&gt;name&quot;</span>);
<a name="l00319"></a>00319     <span class="keywordflow">if</span> (isset($cached-&gt;data)) {
<a name="l00320"></a>00320       $registry = $cached-&gt;data;
<a name="l00321"></a>00321     }
<a name="l00322"></a>00322     <span class="keywordflow">else</span> {
<a name="l00323"></a>00323       <span class="comment">// If not, build one and cache it.</span>
<a name="l00324"></a>00324       $registry = <a class="code" href="theme_8inc_a4a1f9a033ff57b119d18697763909f3d.html#a4a1f9a033ff57b119d18697763909f3d" title="Build the theme registry cache.">_theme_build_registry</a>($theme, $base_theme, $theme_engine);
<a name="l00325"></a>00325       <span class="comment">// Only persist this registry if all modules are loaded. This assures a</span>
<a name="l00326"></a>00326       <span class="comment">// complete set of theme hooks.</span>
<a name="l00327"></a>00327       <span class="keywordflow">if</span> (<a class="code" href="module_8inc_a76db4bd7c4962f254d6cc9bed5f0e1f6.html#a76db4bd7c4962f254d6cc9bed5f0e1f6" title="Load all the modules that have been enabled in the system table.">module_load_all</a>(NULL)) {
<a name="l00328"></a>00328         <a class="code" href="theme_8inc_aa74b1ecea2de39ca0413a1a661167d39.html#aa74b1ecea2de39ca0413a1a661167d39" title="Write the theme_registry cache into the database.">_theme_save_registry</a>($theme, $registry);
<a name="l00329"></a>00329       }
<a name="l00330"></a>00330     }
<a name="l00331"></a>00331     <span class="keywordflow">return</span> $registry;
<a name="l00332"></a>00332   }
<a name="l00333"></a>00333   <span class="keywordflow">else</span> {
<a name="l00334"></a>00334     <span class="keywordflow">return</span> <span class="keyword">new</span> ThemeRegistry(<span class="stringliteral">&#39;theme_registry:runtime:&#39;</span> . $theme-&gt;name, <span class="stringliteral">&#39;cache&#39;</span>);
<a name="l00335"></a>00335   }
<a name="l00336"></a>00336 }
<a name="l00337"></a>00337 
<a name="l00341"></a><a class="code" href="theme_8inc_aa74b1ecea2de39ca0413a1a661167d39.html#aa74b1ecea2de39ca0413a1a661167d39">00341</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_aa74b1ecea2de39ca0413a1a661167d39.html#aa74b1ecea2de39ca0413a1a661167d39" title="Write the theme_registry cache into the database.">_theme_save_registry</a>($theme, $registry) {
<a name="l00342"></a>00342   <a class="code" href="cache_8inc_a48081f36334909f561ef4f538fa640d2.html#a48081f36334909f561ef4f538fa640d2" title="Stores data in the persistent cache.">cache_set</a>(<span class="stringliteral">&quot;theme_registry:$theme-&gt;name&quot;</span>, $registry);
<a name="l00343"></a>00343 }
<a name="l00344"></a>00344 
<a name="l00350"></a><a class="code" href="theme_8inc_a39fec3ccb5c90369be7b5df7961d47ed.html#a39fec3ccb5c90369be7b5df7961d47ed">00350</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a39fec3ccb5c90369be7b5df7961d47ed.html#a39fec3ccb5c90369be7b5df7961d47ed" title="Force the system to rebuild the theme registry; this should be called when modules are added to the s...">drupal_theme_rebuild</a>() {
<a name="l00351"></a>00351   <a class="code" href="group__schemaapi_ga714b5ed0b14c43b61eef0c895598c5c4.html#ga714b5ed0b14c43b61eef0c895598c5c4" title="Resets one or all centrally stored static variable(s).">drupal_static_reset</a>(<span class="stringliteral">&#39;theme_get_registry&#39;</span>);
<a name="l00352"></a>00352   <a class="code" href="cache_8inc_a409b34dd629640d791a11736a9de8125.html#a409b34dd629640d791a11736a9de8125" title="Expires data from the cache.">cache_clear_all</a>(<span class="stringliteral">&#39;theme_registry&#39;</span>, <span class="stringliteral">&#39;cache&#39;</span>, TRUE);
<a name="l00353"></a>00353 }
<a name="l00354"></a>00354 
<a name="l00363"></a>00363 <span class="keyword">class </span>ThemeRegistry Extends <a class="code" href="classDrupalCacheArray.html" title="Provides a caching wrapper to be used in place of large array structures.">DrupalCacheArray</a> {
<a name="l00364"></a>00364 
<a name="l00372"></a><a class="code" href="classDrupalCacheArray_a7e5f106aba0180abc924fee9b2137dd3.html#a7e5f106aba0180abc924fee9b2137dd3">00372</a>   <span class="keyword">protected</span> <a class="code" href="classDrupalCacheArray_a7e5f106aba0180abc924fee9b2137dd3.html#a7e5f106aba0180abc924fee9b2137dd3" title="Whether the partial registry can be persisted to the cache.">$persistable</a>;
<a name="l00373"></a>00373 
<a name="l00377"></a><a class="code" href="classDrupalCacheArray_a31477bbed77e94f393202701a2179643.html#a31477bbed77e94f393202701a2179643">00377</a>   <span class="keyword">protected</span> <a class="code" href="classDrupalCacheArray_a31477bbed77e94f393202701a2179643.html#a31477bbed77e94f393202701a2179643" title="The complete theme registry array.">$completeRegistry</a>;
<a name="l00378"></a>00378 
<a name="l00379"></a><a class="code" href="classDrupalCacheArray_adbc374d9057276944d38062e769a1a99.html#adbc374d9057276944d38062e769a1a99">00379</a>   <span class="keyword">function</span> <a class="code" href="classDrupalCacheArray_adbc374d9057276944d38062e769a1a99.html#adbc374d9057276944d38062e769a1a99">__construct</a>($cid, $bin) {
<a name="l00380"></a>00380     $this-&gt;cid = $cid;
<a name="l00381"></a>00381     $this-&gt;bin = $bin;
<a name="l00382"></a>00382     $this-&gt;persistable = <a class="code" href="module_8inc_a76db4bd7c4962f254d6cc9bed5f0e1f6.html#a76db4bd7c4962f254d6cc9bed5f0e1f6" title="Load all the modules that have been enabled in the system table.">module_load_all</a>(NULL) &amp;&amp; $_SERVER[<span class="stringliteral">&#39;REQUEST_METHOD&#39;</span>] == <span class="stringliteral">&#39;GET&#39;</span>;
<a name="l00383"></a>00383 
<a name="l00384"></a>00384     $data = array();
<a name="l00385"></a>00385     <span class="keywordflow">if</span> ($this-&gt;persistable &amp;&amp; $cached = <a class="code" href="cache_8inc_a9d873815c28909b61c3a6188b383f8a3.html#a9d873815c28909b61c3a6188b383f8a3" title="Returns data from the persistent cache.">cache_get</a>($this-&gt;cid, $this-&gt;bin)) {
<a name="l00386"></a>00386       $data = $cached-&gt;data;
<a name="l00387"></a>00387     }
<a name="l00388"></a>00388     <span class="keywordflow">else</span> {
<a name="l00389"></a>00389       <span class="comment">// If there is no runtime cache stored, fetch the full theme registry,</span>
<a name="l00390"></a>00390       <span class="comment">// but then initialize each value to NULL. This allows offsetExists()</span>
<a name="l00391"></a>00391       <span class="comment">// to function correctly on non-registered theme hooks without triggering</span>
<a name="l00392"></a>00392       <span class="comment">// a call to resolveCacheMiss().</span>
<a name="l00393"></a>00393       $data = $this-&gt;initializeRegistry();
<a name="l00394"></a>00394       <span class="keywordflow">if</span> ($this-&gt;persistable) {
<a name="l00395"></a>00395         $this-&gt;<span class="keyword">set</span>($data);
<a name="l00396"></a>00396       }
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398     $this-&gt;storage = $data;
<a name="l00399"></a>00399   }
<a name="l00400"></a>00400 
<a name="l00408"></a><a class="code" href="classDrupalCacheArray_a0d87b8b0e005c00bbf7fa6ed11cd1e26.html#a0d87b8b0e005c00bbf7fa6ed11cd1e26">00408</a>   <span class="keyword">function</span> <a class="code" href="classDrupalCacheArray_a0d87b8b0e005c00bbf7fa6ed11cd1e26.html#a0d87b8b0e005c00bbf7fa6ed11cd1e26" title="Initializes the full theme registry.">initializeRegistry</a>() {
<a name="l00409"></a>00409     $this-&gt;completeRegistry = <a class="code" href="theme_8inc_ae532c57b7a0288c1a359da1e2a70a0b1.html#ae532c57b7a0288c1a359da1e2a70a0b1" title="Get the theme registry.">theme_get_registry</a>();
<a name="l00410"></a>00410 
<a name="l00411"></a>00411     <span class="keywordflow">return</span> array_fill_keys(array_keys($this-&gt;completeRegistry), NULL);
<a name="l00412"></a>00412   }
<a name="l00413"></a>00413 
<a name="l00414"></a><a class="code" href="classDrupalCacheArray_abec90ca8c02f7c14dfbf66fd9e6bb5dd.html#abec90ca8c02f7c14dfbf66fd9e6bb5dd">00414</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDrupalCacheArray_abec90ca8c02f7c14dfbf66fd9e6bb5dd.html#abec90ca8c02f7c14dfbf66fd9e6bb5dd">offsetExists</a>($offset) {
<a name="l00415"></a>00415     <span class="comment">// Since the theme registry allows for theme hooks to be requested that</span>
<a name="l00416"></a>00416     <span class="comment">// are not registered, just check the existence of the key in the registry.</span>
<a name="l00417"></a>00417     <span class="comment">// Use array_key_exists() here since a NULL value indicates that the theme</span>
<a name="l00418"></a>00418     <span class="comment">// hook exists but has not yet been requested.</span>
<a name="l00419"></a>00419     <span class="keywordflow">return</span> array_key_exists($offset, $this-&gt;storage);
<a name="l00420"></a>00420   }
<a name="l00421"></a>00421 
<a name="l00422"></a><a class="code" href="classDrupalCacheArray_a57be4d1b39bee68ee1c395c1cd9a2de5.html#a57be4d1b39bee68ee1c395c1cd9a2de5">00422</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDrupalCacheArray_a57be4d1b39bee68ee1c395c1cd9a2de5.html#a57be4d1b39bee68ee1c395c1cd9a2de5">offsetGet</a>($offset) {
<a name="l00423"></a>00423     <span class="comment">// If the offset is set but empty, it is a registered theme hook that has</span>
<a name="l00424"></a>00424     <span class="comment">// not yet been requested. Offsets that do not exist at all were not</span>
<a name="l00425"></a>00425     <span class="comment">// registered in hook_theme().</span>
<a name="l00426"></a>00426     <span class="keywordflow">if</span> (isset($this-&gt;storage[$offset])) {
<a name="l00427"></a>00427       <span class="keywordflow">return</span> $this-&gt;storage[$offset];
<a name="l00428"></a>00428     }
<a name="l00429"></a>00429     elseif (array_key_exists($offset, $this-&gt;storage)) {
<a name="l00430"></a>00430       <span class="keywordflow">return</span> $this-&gt;resolveCacheMiss($offset);
<a name="l00431"></a>00431     }
<a name="l00432"></a>00432   }
<a name="l00433"></a>00433 
<a name="l00434"></a><a class="code" href="classDrupalCacheArray_a33d892a839b353177e2483f6946178e9.html#a33d892a839b353177e2483f6946178e9">00434</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDrupalCacheArray_a33d892a839b353177e2483f6946178e9.html#a33d892a839b353177e2483f6946178e9">resolveCacheMiss</a>($offset) {
<a name="l00435"></a>00435     <span class="keywordflow">if</span> (!isset($this-&gt;completeRegistry)) {
<a name="l00436"></a>00436       $this-&gt;completeRegistry = <a class="code" href="theme_8inc_ae532c57b7a0288c1a359da1e2a70a0b1.html#ae532c57b7a0288c1a359da1e2a70a0b1" title="Get the theme registry.">theme_get_registry</a>();
<a name="l00437"></a>00437     }
<a name="l00438"></a>00438     $this-&gt;storage[$offset] = $this-&gt;completeRegistry[$offset];
<a name="l00439"></a>00439     <span class="keywordflow">if</span> ($this-&gt;persistable) {
<a name="l00440"></a>00440       $this-&gt;persist($offset);
<a name="l00441"></a>00441     }
<a name="l00442"></a>00442     <span class="keywordflow">return</span> $this-&gt;storage[$offset];
<a name="l00443"></a>00443   }
<a name="l00444"></a>00444 
<a name="l00445"></a><a class="code" href="classDrupalCacheArray_a9d99af903ba2660c09ca835e63c79118.html#a9d99af903ba2660c09ca835e63c79118">00445</a>   <span class="keyword">public</span> <span class="keyword">function</span> <span class="keyword">set</span>($data, $lock = TRUE) {
<a name="l00446"></a>00446     $lock_name = $this-&gt;cid . <span class="charliteral">&#39;:&#39;</span> . $this-&gt;bin;
<a name="l00447"></a>00447     <span class="keywordflow">if</span> (!$lock || <a class="code" href="group__lock_gac67a4b1061491f7a869646f47b66e998.html#gac67a4b1061491f7a869646f47b66e998" title="Acquire (or renew) a lock, but do not block if it fails.">lock_acquire</a>($lock_name)) {
<a name="l00448"></a>00448       <span class="keywordflow">if</span> ($cached = <a class="code" href="cache_8inc_a9d873815c28909b61c3a6188b383f8a3.html#a9d873815c28909b61c3a6188b383f8a3" title="Returns data from the persistent cache.">cache_get</a>($this-&gt;cid, $this-&gt;bin)) {
<a name="l00449"></a>00449         <span class="comment">// Use array merge instead of union so that filled in values in $data</span>
<a name="l00450"></a>00450         <span class="comment">// overwrite empty values in the current cache.</span>
<a name="l00451"></a>00451         $data = array_merge($cached-&gt;data, $data);
<a name="l00452"></a>00452       }
<a name="l00453"></a>00453       <span class="keywordflow">else</span> {
<a name="l00454"></a>00454         $registry = $this-&gt;initializeRegistry();
<a name="l00455"></a>00455         $data = array_merge($registry, $data);
<a name="l00456"></a>00456       }
<a name="l00457"></a>00457       <a class="code" href="cache_8inc_a48081f36334909f561ef4f538fa640d2.html#a48081f36334909f561ef4f538fa640d2" title="Stores data in the persistent cache.">cache_set</a>($this-&gt;cid, $data, $this-&gt;bin);
<a name="l00458"></a>00458       <span class="keywordflow">if</span> ($lock) {
<a name="l00459"></a>00459         <a class="code" href="group__lock_ga73e1456861f9aff1a506a650f43aceb0.html#ga73e1456861f9aff1a506a650f43aceb0" title="Release a lock previously acquired by lock_acquire().">lock_release</a>($lock_name);
<a name="l00460"></a>00460       }
<a name="l00461"></a>00461     }
<a name="l00462"></a>00462   }
<a name="l00463"></a>00463 }
<a name="l00464"></a>00464 
<a name="l00513"></a><a class="code" href="theme_8inc_a473fae348447b091f0d8e677820d30c3.html#a473fae348447b091f0d8e677820d30c3">00513</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a473fae348447b091f0d8e677820d30c3.html#a473fae348447b091f0d8e677820d30c3" title="Process a single implementation of hook_theme().">_theme_process_registry</a>(&amp;$cache, $name, $type, $theme, $path) {
<a name="l00514"></a>00514   $result = array();
<a name="l00515"></a>00515 
<a name="l00516"></a>00516   <span class="comment">// Processor functions work in two distinct phases with the process</span>
<a name="l00517"></a>00517   <span class="comment">// functions always being executed after the preprocess functions.</span>
<a name="l00518"></a>00518   $variable_process_phases = array(
<a name="l00519"></a>00519     <span class="stringliteral">&#39;preprocess functions&#39;</span> =&gt; <span class="stringliteral">&#39;preprocess&#39;</span>,
<a name="l00520"></a>00520     <span class="stringliteral">&#39;process functions&#39;</span>    =&gt; <span class="stringliteral">&#39;process&#39;</span>,
<a name="l00521"></a>00521   );
<a name="l00522"></a>00522 
<a name="l00523"></a>00523   $hook_defaults = array(
<a name="l00524"></a>00524     <span class="stringliteral">&#39;variables&#39;</span> =&gt; TRUE,
<a name="l00525"></a>00525     <span class="stringliteral">&#39;render element&#39;</span> =&gt; TRUE,
<a name="l00526"></a>00526     <span class="stringliteral">&#39;pattern&#39;</span> =&gt; TRUE,
<a name="l00527"></a>00527     <span class="stringliteral">&#39;base hook&#39;</span> =&gt; TRUE,
<a name="l00528"></a>00528   );
<a name="l00529"></a>00529 
<a name="l00530"></a>00530   <span class="comment">// Invoke the hook_theme() implementation, process what is returned, and</span>
<a name="l00531"></a>00531   <span class="comment">// merge it into $cache.</span>
<a name="l00532"></a>00532   $function = $name . <span class="stringliteral">&#39;_theme&#39;</span>;
<a name="l00533"></a>00533   <span class="keywordflow">if</span> (function_exists($function)) {
<a name="l00534"></a>00534     $result = $function($cache, $type, $theme, $path);
<a name="l00535"></a>00535     <span class="keywordflow">foreach</span> ($result as $hook =&gt; $info) {
<a name="l00536"></a>00536       <span class="comment">// When a theme or engine overrides a module&#39;s theme function</span>
<a name="l00537"></a>00537       <span class="comment">// $result[$hook] will only contain key/value pairs for information being</span>
<a name="l00538"></a>00538       <span class="comment">// overridden.  Pull the rest of the information from what was defined by</span>
<a name="l00539"></a>00539       <span class="comment">// an earlier hook.</span>
<a name="l00540"></a>00540 
<a name="l00541"></a>00541       <span class="comment">// Fill in the type and path of the module, theme, or engine that</span>
<a name="l00542"></a>00542       <span class="comment">// implements this theme function.</span>
<a name="l00543"></a>00543       $result[$hook][<span class="stringliteral">&#39;type&#39;</span>] = $type;
<a name="l00544"></a>00544       $result[$hook][<span class="stringliteral">&#39;theme path&#39;</span>] = $path;
<a name="l00545"></a>00545 
<a name="l00546"></a>00546       <span class="comment">// If function and file are omitted, default to standard naming</span>
<a name="l00547"></a>00547       <span class="comment">// conventions.</span>
<a name="l00548"></a>00548       <span class="keywordflow">if</span> (!isset($info[<span class="stringliteral">&#39;template&#39;</span>]) &amp;&amp; !isset($info[<span class="stringliteral">&#39;function&#39;</span>])) {
<a name="l00549"></a>00549         $result[$hook][<span class="stringliteral">&#39;function&#39;</span>] = ($type == <span class="stringliteral">&#39;module&#39;</span> ? <span class="stringliteral">&#39;theme_&#39;</span> : $name . <span class="charliteral">&#39;_&#39;</span>) . $hook;
<a name="l00550"></a>00550       }
<a name="l00551"></a>00551 
<a name="l00552"></a>00552       <span class="keywordflow">if</span> (isset($cache[$hook][<span class="stringliteral">&#39;includes&#39;</span>])) {
<a name="l00553"></a>00553         $result[$hook][<span class="stringliteral">&#39;includes&#39;</span>] = $cache[$hook][<span class="stringliteral">&#39;includes&#39;</span>];
<a name="l00554"></a>00554       }
<a name="l00555"></a>00555 
<a name="l00556"></a>00556       <span class="comment">// If the theme implementation defines a file, then also use the path</span>
<a name="l00557"></a>00557       <span class="comment">// that it defined. Otherwise use the default path. This allows</span>
<a name="l00558"></a>00558       <span class="comment">// system.module to declare theme functions on behalf of core .include</span>
<a name="l00559"></a>00559       <span class="comment">// files.</span>
<a name="l00560"></a>00560       <span class="keywordflow">if</span> (isset($info[<span class="stringliteral">&#39;file&#39;</span>])) {
<a name="l00561"></a>00561         $include_file = isset($info[<span class="stringliteral">&#39;path&#39;</span>]) ? $info[<span class="stringliteral">&#39;path&#39;</span>] : $path;
<a name="l00562"></a>00562         $include_file .= <span class="charliteral">&#39;/&#39;</span> . $info[<span class="stringliteral">&#39;file&#39;</span>];
<a name="l00563"></a>00563         include_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $include_file;
<a name="l00564"></a>00564         $result[$hook][<span class="stringliteral">&#39;includes&#39;</span>][] = $include_file;
<a name="l00565"></a>00565       }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567       <span class="comment">// If the default keys are not set, use the default values registered</span>
<a name="l00568"></a>00568       <span class="comment">// by the module.</span>
<a name="l00569"></a>00569       <span class="keywordflow">if</span> (isset($cache[$hook])) {
<a name="l00570"></a>00570         $result[$hook] += array_intersect_key($cache[$hook], $hook_defaults);
<a name="l00571"></a>00571       }
<a name="l00572"></a>00572 
<a name="l00573"></a>00573       <span class="comment">// The following apply only to theming hooks implemented as templates.</span>
<a name="l00574"></a>00574       <span class="keywordflow">if</span> (isset($info[<span class="stringliteral">&#39;template&#39;</span>])) {
<a name="l00575"></a>00575         <span class="comment">// Prepend the current theming path when none is set.</span>
<a name="l00576"></a>00576         <span class="keywordflow">if</span> (!isset($info[<span class="stringliteral">&#39;path&#39;</span>])) {
<a name="l00577"></a>00577           $result[$hook][<span class="stringliteral">&#39;template&#39;</span>] = $path . <span class="charliteral">&#39;/&#39;</span> . $info[<span class="stringliteral">&#39;template&#39;</span>];
<a name="l00578"></a>00578         }
<a name="l00579"></a>00579       }
<a name="l00580"></a>00580 
<a name="l00581"></a>00581       <span class="comment">// Allow variable processors for all theming hooks, whether the hook is</span>
<a name="l00582"></a>00582       <span class="comment">// implemented as a template or as a function.</span>
<a name="l00583"></a>00583       <span class="keywordflow">foreach</span> ($variable_process_phases as $phase_key =&gt; $phase) {
<a name="l00584"></a>00584         <span class="comment">// Check for existing variable processors. Ensure arrayness.</span>
<a name="l00585"></a>00585         <span class="keywordflow">if</span> (!isset($info[$phase_key]) || !is_array($info[$phase_key])) {
<a name="l00586"></a>00586           $info[$phase_key] = array();
<a name="l00587"></a>00587           $prefixes = array();
<a name="l00588"></a>00588           <span class="keywordflow">if</span> ($type == <span class="stringliteral">&#39;module&#39;</span>) {
<a name="l00589"></a>00589             <span class="comment">// Default variable processor prefix.</span>
<a name="l00590"></a>00590             $prefixes[] = <span class="stringliteral">&#39;template&#39;</span>;
<a name="l00591"></a>00591             <span class="comment">// Add all modules so they can intervene with their own variable</span>
<a name="l00592"></a>00592             <span class="comment">// processors. This allows them to provide variable processors even</span>
<a name="l00593"></a>00593             <span class="comment">// if they are not the owner of the current hook.</span>
<a name="l00594"></a>00594             $prefixes += <a class="code" href="module_8inc_ad4ef444bbb8e56724e12908cf9b6e1aa.html#ad4ef444bbb8e56724e12908cf9b6e1aa" title="Returns a list of currently active modules.">module_list</a>();
<a name="l00595"></a>00595           }
<a name="l00596"></a>00596           elseif ($type == <span class="stringliteral">&#39;theme_engine&#39;</span> || $type == <span class="stringliteral">&#39;base_theme_engine&#39;</span>) {
<a name="l00597"></a>00597             <span class="comment">// Theme engines get an extra set that come before the normally</span>
<a name="l00598"></a>00598             <span class="comment">// named variable processors.</span>
<a name="l00599"></a>00599             $prefixes[] = $name . <span class="stringliteral">&#39;_engine&#39;</span>;
<a name="l00600"></a>00600             <span class="comment">// The theme engine registers on behalf of the theme using the</span>
<a name="l00601"></a>00601             <span class="comment">// theme&#39;s name.</span>
<a name="l00602"></a>00602             $prefixes[] = $theme;
<a name="l00603"></a>00603           }
<a name="l00604"></a>00604           <span class="keywordflow">else</span> {
<a name="l00605"></a>00605             <span class="comment">// This applies when the theme manually registers their own variable</span>
<a name="l00606"></a>00606             <span class="comment">// processors.</span>
<a name="l00607"></a>00607             $prefixes[] = $name;
<a name="l00608"></a>00608           }
<a name="l00609"></a>00609           <span class="keywordflow">foreach</span> ($prefixes as $prefix) {
<a name="l00610"></a>00610             <span class="comment">// Only use non-hook-specific variable processors for theming hooks</span>
<a name="l00611"></a>00611             <span class="comment">// implemented as templates. See theme().</span>
<a name="l00612"></a>00612             <span class="keywordflow">if</span> (isset($info[<span class="stringliteral">&#39;template&#39;</span>]) &amp;&amp; function_exists($prefix . <span class="charliteral">&#39;_&#39;</span> . $phase)) {
<a name="l00613"></a>00613               $info[$phase_key][] = $prefix . <span class="charliteral">&#39;_&#39;</span> . $phase;
<a name="l00614"></a>00614             }
<a name="l00615"></a>00615             <span class="keywordflow">if</span> (function_exists($prefix . <span class="charliteral">&#39;_&#39;</span> . $phase . <span class="charliteral">&#39;_&#39;</span> . $hook)) {
<a name="l00616"></a>00616               $info[$phase_key][] = $prefix . <span class="charliteral">&#39;_&#39;</span> . $phase . <span class="charliteral">&#39;_&#39;</span> . $hook;
<a name="l00617"></a>00617             }
<a name="l00618"></a>00618           }
<a name="l00619"></a>00619         }
<a name="l00620"></a>00620         <span class="comment">// Check for the override flag and prevent the cached variable</span>
<a name="l00621"></a>00621         <span class="comment">// processors from being used. This allows themes or theme engines to</span>
<a name="l00622"></a>00622         <span class="comment">// remove variable processors set earlier in the registry build.</span>
<a name="l00623"></a>00623         <span class="keywordflow">if</span> (!empty($info[<span class="stringliteral">&#39;override &#39;</span> . $phase_key])) {
<a name="l00624"></a>00624           <span class="comment">// Flag not needed inside the registry.</span>
<a name="l00625"></a>00625           unset($result[$hook][<span class="stringliteral">&#39;override &#39;</span> . $phase_key]);
<a name="l00626"></a>00626         }
<a name="l00627"></a>00627         elseif (isset($cache[$hook][$phase_key]) &amp;&amp; is_array($cache[$hook][$phase_key])) {
<a name="l00628"></a>00628           $info[$phase_key] = array_merge($cache[$hook][$phase_key], $info[$phase_key]);
<a name="l00629"></a>00629         }
<a name="l00630"></a>00630         $result[$hook][$phase_key] = $info[$phase_key];
<a name="l00631"></a>00631       }
<a name="l00632"></a>00632     }
<a name="l00633"></a>00633 
<a name="l00634"></a>00634     <span class="comment">// Merge the newly created theme hooks into the existing cache.</span>
<a name="l00635"></a>00635     $cache = $result + $cache;
<a name="l00636"></a>00636   }
<a name="l00637"></a>00637 
<a name="l00638"></a>00638   <span class="comment">// Let themes have variable processors even if they didn&#39;t register a template.</span>
<a name="l00639"></a>00639   <span class="keywordflow">if</span> ($type == <span class="stringliteral">&#39;theme&#39;</span> || $type == <span class="stringliteral">&#39;base_theme&#39;</span>) {
<a name="l00640"></a>00640     <span class="keywordflow">foreach</span> ($cache as $hook =&gt; $info) {
<a name="l00641"></a>00641       <span class="comment">// Check only if not registered by the theme or engine.</span>
<a name="l00642"></a>00642       <span class="keywordflow">if</span> (empty($result[$hook])) {
<a name="l00643"></a>00643         <span class="keywordflow">foreach</span> ($variable_process_phases as $phase_key =&gt; $phase) {
<a name="l00644"></a>00644           <span class="keywordflow">if</span> (!isset($info[$phase_key])) {
<a name="l00645"></a>00645             $cache[$hook][$phase_key] = array();
<a name="l00646"></a>00646           }
<a name="l00647"></a>00647           <span class="comment">// Only use non-hook-specific variable processors for theming hooks</span>
<a name="l00648"></a>00648           <span class="comment">// implemented as templates. See theme().</span>
<a name="l00649"></a>00649           <span class="keywordflow">if</span> (isset($info[<span class="stringliteral">&#39;template&#39;</span>]) &amp;&amp; function_exists($name . <span class="charliteral">&#39;_&#39;</span> . $phase)) {
<a name="l00650"></a>00650             $cache[$hook][$phase_key][] = $name . <span class="charliteral">&#39;_&#39;</span> . $phase;
<a name="l00651"></a>00651           }
<a name="l00652"></a>00652           <span class="keywordflow">if</span> (function_exists($name . <span class="charliteral">&#39;_&#39;</span> . $phase . <span class="charliteral">&#39;_&#39;</span> . $hook)) {
<a name="l00653"></a>00653             $cache[$hook][$phase_key][] = $name . <span class="charliteral">&#39;_&#39;</span> . $phase . <span class="charliteral">&#39;_&#39;</span> . $hook;
<a name="l00654"></a>00654             $cache[$hook][<span class="stringliteral">&#39;theme path&#39;</span>] = $path;
<a name="l00655"></a>00655           }
<a name="l00656"></a>00656           <span class="comment">// Ensure uniqueness.</span>
<a name="l00657"></a>00657           $cache[$hook][$phase_key] = array_unique($cache[$hook][$phase_key]);
<a name="l00658"></a>00658         }
<a name="l00659"></a>00659       }
<a name="l00660"></a>00660     }
<a name="l00661"></a>00661   }
<a name="l00662"></a>00662 }
<a name="l00663"></a>00663 
<a name="l00675"></a><a class="code" href="theme_8inc_a4a1f9a033ff57b119d18697763909f3d.html#a4a1f9a033ff57b119d18697763909f3d">00675</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a4a1f9a033ff57b119d18697763909f3d.html#a4a1f9a033ff57b119d18697763909f3d" title="Build the theme registry cache.">_theme_build_registry</a>($theme, $base_theme, $theme_engine) {
<a name="l00676"></a>00676   $cache = array();
<a name="l00677"></a>00677   <span class="comment">// First, process the theme hooks advertised by modules. This will</span>
<a name="l00678"></a>00678   <span class="comment">// serve as the basic registry. Since the list of enabled modules is the same</span>
<a name="l00679"></a>00679   <span class="comment">// regardless of the theme used, this is cached in its own entry to save</span>
<a name="l00680"></a>00680   <span class="comment">// building it for every theme.</span>
<a name="l00681"></a>00681   <span class="keywordflow">if</span> ($cached = <a class="code" href="cache_8inc_a9d873815c28909b61c3a6188b383f8a3.html#a9d873815c28909b61c3a6188b383f8a3" title="Returns data from the persistent cache.">cache_get</a>(<span class="stringliteral">&#39;theme_registry:build:modules&#39;</span>)) {
<a name="l00682"></a>00682     $cache = $cached-&gt;data;
<a name="l00683"></a>00683   }
<a name="l00684"></a>00684   <span class="keywordflow">else</span> {
<a name="l00685"></a>00685     <span class="keywordflow">foreach</span> (<a class="code" href="group__hooks_ga9191200072f2a641829e9d3c2759561f.html#ga9191200072f2a641829e9d3c2759561f" title="Determine which modules are implementing a hook.">module_implements</a>(<span class="stringliteral">&#39;theme&#39;</span>) as $module) {
<a name="l00686"></a>00686       <a class="code" href="theme_8inc_a473fae348447b091f0d8e677820d30c3.html#a473fae348447b091f0d8e677820d30c3" title="Process a single implementation of hook_theme().">_theme_process_registry</a>($cache, $module, <span class="stringliteral">&#39;module&#39;</span>, $module, <a class="code" href="common_8inc_ae3bbe8f97bf07bb0eaf4580c98f9bf94.html#ae3bbe8f97bf07bb0eaf4580c98f9bf94" title="Returns the path to a system item (module, theme, etc.).">drupal_get_path</a>(<span class="stringliteral">&#39;module&#39;</span>, $module));
<a name="l00687"></a>00687     }
<a name="l00688"></a>00688     <span class="comment">// Only cache this registry if all modules are loaded.</span>
<a name="l00689"></a>00689     <span class="keywordflow">if</span> (<a class="code" href="module_8inc_a76db4bd7c4962f254d6cc9bed5f0e1f6.html#a76db4bd7c4962f254d6cc9bed5f0e1f6" title="Load all the modules that have been enabled in the system table.">module_load_all</a>(NULL)) {
<a name="l00690"></a>00690       <a class="code" href="cache_8inc_a48081f36334909f561ef4f538fa640d2.html#a48081f36334909f561ef4f538fa640d2" title="Stores data in the persistent cache.">cache_set</a>(<span class="stringliteral">&#39;theme_registry:build:modules&#39;</span>, $cache);
<a name="l00691"></a>00691     }
<a name="l00692"></a>00692   }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694   <span class="comment">// Process each base theme.</span>
<a name="l00695"></a>00695   <span class="keywordflow">foreach</span> ($base_theme as $base) {
<a name="l00696"></a>00696     <span class="comment">// If the base theme uses a theme engine, process its hooks.</span>
<a name="l00697"></a>00697     $base_path = dirname($base-&gt;filename);
<a name="l00698"></a>00698     <span class="keywordflow">if</span> ($theme_engine) {
<a name="l00699"></a>00699       <a class="code" href="theme_8inc_a473fae348447b091f0d8e677820d30c3.html#a473fae348447b091f0d8e677820d30c3" title="Process a single implementation of hook_theme().">_theme_process_registry</a>($cache, $theme_engine, <span class="stringliteral">&#39;base_theme_engine&#39;</span>, $base-&gt;name, $base_path);
<a name="l00700"></a>00700     }
<a name="l00701"></a>00701     <a class="code" href="theme_8inc_a473fae348447b091f0d8e677820d30c3.html#a473fae348447b091f0d8e677820d30c3" title="Process a single implementation of hook_theme().">_theme_process_registry</a>($cache, $base-&gt;name, <span class="stringliteral">&#39;base_theme&#39;</span>, $base-&gt;name, $base_path);
<a name="l00702"></a>00702   }
<a name="l00703"></a>00703 
<a name="l00704"></a>00704   <span class="comment">// And then the same thing, but for the theme.</span>
<a name="l00705"></a>00705   <span class="keywordflow">if</span> ($theme_engine) {
<a name="l00706"></a>00706     <a class="code" href="theme_8inc_a473fae348447b091f0d8e677820d30c3.html#a473fae348447b091f0d8e677820d30c3" title="Process a single implementation of hook_theme().">_theme_process_registry</a>($cache, $theme_engine, <span class="stringliteral">&#39;theme_engine&#39;</span>, $theme-&gt;name, dirname($theme-&gt;filename));
<a name="l00707"></a>00707   }
<a name="l00708"></a>00708 
<a name="l00709"></a>00709   <span class="comment">// Finally, hooks provided by the theme itself.</span>
<a name="l00710"></a>00710   <a class="code" href="theme_8inc_a473fae348447b091f0d8e677820d30c3.html#a473fae348447b091f0d8e677820d30c3" title="Process a single implementation of hook_theme().">_theme_process_registry</a>($cache, $theme-&gt;name, <span class="stringliteral">&#39;theme&#39;</span>, $theme-&gt;name, dirname($theme-&gt;filename));
<a name="l00711"></a>00711 
<a name="l00712"></a>00712   <span class="comment">// Let modules alter the registry.</span>
<a name="l00713"></a>00713   <a class="code" href="module_8inc_a9badfa1d68b90764aa160aee0e58b4ef.html#a9badfa1d68b90764aa160aee0e58b4ef" title="Hands off alterable variables to type-specific *_alter implementations.">drupal_alter</a>(<span class="stringliteral">&#39;theme_registry&#39;</span>, $cache);
<a name="l00714"></a>00714 
<a name="l00715"></a>00715   <span class="comment">// Optimize the registry to not have empty arrays for functions.</span>
<a name="l00716"></a>00716   <span class="keywordflow">foreach</span> ($cache as $hook =&gt; $info) {
<a name="l00717"></a>00717     <span class="keywordflow">foreach</span> (array(<span class="stringliteral">&#39;preprocess functions&#39;</span>, <span class="stringliteral">&#39;process functions&#39;</span>) as $phase) {
<a name="l00718"></a>00718       <span class="keywordflow">if</span> (empty($info[$phase])) {
<a name="l00719"></a>00719         unset($cache[$hook][$phase]);
<a name="l00720"></a>00720       }
<a name="l00721"></a>00721     }
<a name="l00722"></a>00722   }
<a name="l00723"></a>00723   <span class="keywordflow">return</span> $cache;
<a name="l00724"></a>00724 }
<a name="l00725"></a>00725 
<a name="l00771"></a><a class="code" href="theme_8inc_a48d5521b10139d745626435d804353a4.html#a48d5521b10139d745626435d804353a4">00771</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a48d5521b10139d745626435d804353a4.html#a48d5521b10139d745626435d804353a4" title="Return a list of all currently available themes.">list_themes</a>($refresh = FALSE) {
<a name="l00772"></a>00772   $list = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__, array());
<a name="l00773"></a>00773 
<a name="l00774"></a>00774   <span class="keywordflow">if</span> ($refresh) {
<a name="l00775"></a>00775     $list = array();
<a name="l00776"></a>00776     <a class="code" href="module_8inc_ac141d5e0a5817eda15b376a5737dec3d.html#ac141d5e0a5817eda15b376a5737dec3d" title="Reset all system_list() caches.">system_list_reset</a>();
<a name="l00777"></a>00777   }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779   <span class="keywordflow">if</span> (empty($list)) {
<a name="l00780"></a>00780     $list = array();
<a name="l00781"></a>00781     $themes = array();
<a name="l00782"></a>00782     <span class="comment">// Extract from the database only when it is available.</span>
<a name="l00783"></a>00783     <span class="comment">// Also check that the site is not in the middle of an install or update.</span>
<a name="l00784"></a>00784     <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;MAINTENANCE_MODE&#39;</span>)) {
<a name="l00785"></a>00785       <span class="keywordflow">try</span> {
<a name="l00786"></a>00786         $themes = <a class="code" href="module_8inc_a807821e98f8d626a7043923080ba6438.html#a807821e98f8d626a7043923080ba6438" title="Build a list of bootstrap modules and enabled modules and themes.">system_list</a>(<span class="stringliteral">&#39;theme&#39;</span>);
<a name="l00787"></a>00787       }
<a name="l00788"></a>00788       <span class="keywordflow">catch</span> (<a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> $e) {
<a name="l00789"></a>00789         <span class="comment">// If the database is not available, rebuild the theme data.</span>
<a name="l00790"></a>00790         $themes = _system_rebuild_theme_data();
<a name="l00791"></a>00791       }
<a name="l00792"></a>00792     }
<a name="l00793"></a>00793     <span class="keywordflow">else</span> {
<a name="l00794"></a>00794       <span class="comment">// Scan the installation when the database should not be read.</span>
<a name="l00795"></a>00795       $themes = _system_rebuild_theme_data();
<a name="l00796"></a>00796     }
<a name="l00797"></a>00797 
<a name="l00798"></a>00798     <span class="keywordflow">foreach</span> ($themes as $theme) {
<a name="l00799"></a>00799       <span class="keywordflow">foreach</span> ($theme-&gt;info[<span class="stringliteral">&#39;stylesheets&#39;</span>] as $media =&gt; $stylesheets) {
<a name="l00800"></a>00800         <span class="keywordflow">foreach</span> ($stylesheets as $stylesheet =&gt; $path) {
<a name="l00801"></a>00801           $theme-&gt;stylesheets[$media][$stylesheet] = $path;
<a name="l00802"></a>00802         }
<a name="l00803"></a>00803       }
<a name="l00804"></a>00804       <span class="keywordflow">foreach</span> ($theme-&gt;info[<span class="stringliteral">&#39;scripts&#39;</span>] as $script =&gt; $path) {
<a name="l00805"></a>00805         $theme-&gt;scripts[$script] = $path;
<a name="l00806"></a>00806       }
<a name="l00807"></a>00807       <span class="keywordflow">if</span> (isset($theme-&gt;info[<span class="stringliteral">&#39;engine&#39;</span>])) {
<a name="l00808"></a>00808         $theme-&gt;engine = $theme-&gt;info[<span class="stringliteral">&#39;engine&#39;</span>];
<a name="l00809"></a>00809       }
<a name="l00810"></a>00810       <span class="keywordflow">if</span> (isset($theme-&gt;info[<span class="stringliteral">&#39;base theme&#39;</span>])) {
<a name="l00811"></a>00811         $theme-&gt;base_theme = $theme-&gt;info[<span class="stringliteral">&#39;base theme&#39;</span>];
<a name="l00812"></a>00812       }
<a name="l00813"></a>00813       <span class="comment">// Status is normally retrieved from the database. Add zero values when</span>
<a name="l00814"></a>00814       <span class="comment">// read from the installation directory to prevent notices.</span>
<a name="l00815"></a>00815       <span class="keywordflow">if</span> (!isset($theme-&gt;status)) {
<a name="l00816"></a>00816         $theme-&gt;status = 0;
<a name="l00817"></a>00817       }
<a name="l00818"></a>00818       $list[$theme-&gt;name] = $theme;
<a name="l00819"></a>00819     }
<a name="l00820"></a>00820   }
<a name="l00821"></a>00821 
<a name="l00822"></a>00822   <span class="keywordflow">return</span> $list;
<a name="l00823"></a>00823 }
<a name="l00824"></a>00824 
<a name="l00840"></a><a class="code" href="theme_8inc_ab9b1b3016f42a43d21096d650ffe7ec1.html#ab9b1b3016f42a43d21096d650ffe7ec1">00840</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_ab9b1b3016f42a43d21096d650ffe7ec1.html#ab9b1b3016f42a43d21096d650ffe7ec1" title="Find all the base themes for the specified theme.">drupal_find_base_themes</a>($themes, $key, $used_keys = array()) {
<a name="l00841"></a>00841   $base_key = $themes[$key]-&gt;info[<span class="stringliteral">&#39;base theme&#39;</span>];
<a name="l00842"></a>00842   <span class="comment">// Does the base theme exist?</span>
<a name="l00843"></a>00843   <span class="keywordflow">if</span> (!isset($themes[$base_key])) {
<a name="l00844"></a>00844     <span class="keywordflow">return</span> array($base_key =&gt; NULL);
<a name="l00845"></a>00845   }
<a name="l00846"></a>00846 
<a name="l00847"></a>00847   $current_base_theme = array($base_key =&gt; $themes[$base_key]-&gt;info[<span class="stringliteral">&#39;name&#39;</span>]);
<a name="l00848"></a>00848 
<a name="l00849"></a>00849   <span class="comment">// Is the base theme itself a child of another theme?</span>
<a name="l00850"></a>00850   <span class="keywordflow">if</span> (isset($themes[$base_key]-&gt;info[<span class="stringliteral">&#39;base theme&#39;</span>])) {
<a name="l00851"></a>00851     <span class="comment">// Do we already know the base themes of this theme?</span>
<a name="l00852"></a>00852     <span class="keywordflow">if</span> (isset($themes[$base_key]-&gt;base_themes)) {
<a name="l00853"></a>00853       <span class="keywordflow">return</span> $themes[$base_key]-&gt;base_themes + $current_base_theme;
<a name="l00854"></a>00854     }
<a name="l00855"></a>00855     <span class="comment">// Prevent loops.</span>
<a name="l00856"></a>00856     <span class="keywordflow">if</span> (!empty($used_keys[$base_key])) {
<a name="l00857"></a>00857       <span class="keywordflow">return</span> array($base_key =&gt; NULL);
<a name="l00858"></a>00858     }
<a name="l00859"></a>00859     $used_keys[$base_key] = TRUE;
<a name="l00860"></a>00860     <span class="keywordflow">return</span> <a class="code" href="theme_8inc_ab9b1b3016f42a43d21096d650ffe7ec1.html#ab9b1b3016f42a43d21096d650ffe7ec1" title="Find all the base themes for the specified theme.">drupal_find_base_themes</a>($themes, $base_key, $used_keys) + $current_base_theme;
<a name="l00861"></a>00861   }
<a name="l00862"></a>00862   <span class="comment">// If we get here, then this is our parent theme.</span>
<a name="l00863"></a>00863   <span class="keywordflow">return</span> $current_base_theme;
<a name="l00864"></a>00864 }
<a name="l00865"></a>00865 
<a name="l00997"></a><a class="code" href="theme_8inc_a7c25609a935874541a19657affd30fff.html#a7c25609a935874541a19657affd30fff">00997</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a7c25609a935874541a19657affd30fff.html#a7c25609a935874541a19657affd30fff" title="Generates themed output.">theme</a>($hook, $variables = array()) {
<a name="l00998"></a>00998   <span class="comment">// If called before all modules are loaded, we do not necessarily have a full</span>
<a name="l00999"></a>00999   <span class="comment">// theme registry to work with, and therefore cannot process the theme</span>
<a name="l01000"></a>01000   <span class="comment">// request properly. See also _theme_load_registry().</span>
<a name="l01001"></a>01001   <span class="keywordflow">if</span> (!<a class="code" href="module_8inc_a76db4bd7c4962f254d6cc9bed5f0e1f6.html#a76db4bd7c4962f254d6cc9bed5f0e1f6" title="Load all the modules that have been enabled in the system table.">module_load_all</a>(NULL) &amp;&amp; !defined(<span class="stringliteral">&#39;MAINTENANCE_MODE&#39;</span>)) {
<a name="l01002"></a>01002     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a>(<a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;theme() may not be called until all modules are loaded.&#39;</span>));
<a name="l01003"></a>01003   }
<a name="l01004"></a>01004 
<a name="l01005"></a>01005   $hooks = <a class="code" href="theme_8inc_ae532c57b7a0288c1a359da1e2a70a0b1.html#ae532c57b7a0288c1a359da1e2a70a0b1" title="Get the theme registry.">theme_get_registry</a>(FALSE);
<a name="l01006"></a>01006 
<a name="l01007"></a>01007   <span class="comment">// If an array of hook candidates were passed, use the first one that has an</span>
<a name="l01008"></a>01008   <span class="comment">// implementation.</span>
<a name="l01009"></a>01009   <span class="keywordflow">if</span> (is_array($hook)) {
<a name="l01010"></a>01010     <span class="keywordflow">foreach</span> ($hook as $candidate) {
<a name="l01011"></a>01011       <span class="keywordflow">if</span> (isset($hooks[$candidate])) {
<a name="l01012"></a>01012         <span class="keywordflow">break</span>;
<a name="l01013"></a>01013       }
<a name="l01014"></a>01014     }
<a name="l01015"></a>01015     $hook = $candidate;
<a name="l01016"></a>01016   }
<a name="l01017"></a>01017 
<a name="l01018"></a>01018   <span class="comment">// If there&#39;s no implementation, check for more generic fallbacks. If there&#39;s</span>
<a name="l01019"></a>01019   <span class="comment">// still no implementation, log an error and return an empty string.</span>
<a name="l01020"></a>01020   <span class="keywordflow">if</span> (!isset($hooks[$hook])) {
<a name="l01021"></a>01021     <span class="comment">// Iteratively strip everything after the last &#39;__&#39; delimiter, until an</span>
<a name="l01022"></a>01022     <span class="comment">// implementation is found.</span>
<a name="l01023"></a>01023     <span class="keywordflow">while</span> ($pos = strrpos($hook, <span class="stringliteral">&#39;__&#39;</span>)) {
<a name="l01024"></a>01024       $hook = substr($hook, 0, $pos);
<a name="l01025"></a>01025       <span class="keywordflow">if</span> (isset($hooks[$hook])) {
<a name="l01026"></a>01026         <span class="keywordflow">break</span>;
<a name="l01027"></a>01027       }
<a name="l01028"></a>01028     }
<a name="l01029"></a>01029     <span class="keywordflow">if</span> (!isset($hooks[$hook])) {
<a name="l01030"></a>01030       <span class="comment">// Only log a message when not trying theme suggestions ($hook being an</span>
<a name="l01031"></a>01031       <span class="comment">// array).</span>
<a name="l01032"></a>01032       <span class="keywordflow">if</span> (!isset($candidate)) {
<a name="l01033"></a>01033         <a class="code" href="bootstrap_8inc_acb7338e6740302727043d64e3ae1257b.html#acb7338e6740302727043d64e3ae1257b" title="Logs a system message.">watchdog</a>(<span class="stringliteral">&#39;theme&#39;</span>, <span class="stringliteral">&#39;Theme key &quot;@key&quot; not found.&#39;</span>, array(<span class="stringliteral">&#39;@key&#39;</span> =&gt; $hook), <a class="code" href="group__logging__severity__levels_ga5361f835e10b39b553ee73c1b9414bf1.html#ga5361f835e10b39b553ee73c1b9414bf1" title="Log message severity -- Warning conditions.">WATCHDOG_WARNING</a>);
<a name="l01034"></a>01034       }
<a name="l01035"></a>01035       <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l01036"></a>01036     }
<a name="l01037"></a>01037   }
<a name="l01038"></a>01038 
<a name="l01039"></a>01039   $info = $hooks[$hook];
<a name="l01040"></a>01040   global $theme_path;
<a name="l01041"></a>01041   $temp = $theme_path;
<a name="l01042"></a>01042   <span class="comment">// point path_to_theme() to the currently used theme path:</span>
<a name="l01043"></a>01043   $theme_path = $info[<span class="stringliteral">&#39;theme path&#39;</span>];
<a name="l01044"></a>01044 
<a name="l01045"></a>01045   <span class="comment">// Include a file if the theme function or variable processor is held elsewhere.</span>
<a name="l01046"></a>01046   <span class="keywordflow">if</span> (!empty($info[<span class="stringliteral">&#39;includes&#39;</span>])) {
<a name="l01047"></a>01047     <span class="keywordflow">foreach</span> ($info[<span class="stringliteral">&#39;includes&#39;</span>] as $include_file) {
<a name="l01048"></a>01048       include_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $include_file;
<a name="l01049"></a>01049     }
<a name="l01050"></a>01050   }
<a name="l01051"></a>01051 
<a name="l01052"></a>01052   <span class="comment">// If a renderable array is passed as $variables, then set $variables to</span>
<a name="l01053"></a>01053   <span class="comment">// the arguments expected by the theme function.</span>
<a name="l01054"></a>01054   <span class="keywordflow">if</span> (isset($variables[<span class="stringliteral">&#39;#theme&#39;</span>]) || isset($variables[<span class="stringliteral">&#39;#theme_wrappers&#39;</span>])) {
<a name="l01055"></a>01055     $element = $variables;
<a name="l01056"></a>01056     $variables = array();
<a name="l01057"></a>01057     <span class="keywordflow">if</span> (isset($info[<span class="stringliteral">&#39;variables&#39;</span>])) {
<a name="l01058"></a>01058       <span class="keywordflow">foreach</span> (array_keys($info[<span class="stringliteral">&#39;variables&#39;</span>]) as $name) {
<a name="l01059"></a>01059         <span class="keywordflow">if</span> (isset($element[<span class="stringliteral">&quot;#$name&quot;</span>])) {
<a name="l01060"></a>01060           $variables[$name] = $element[<span class="stringliteral">&quot;#$name&quot;</span>];
<a name="l01061"></a>01061         }
<a name="l01062"></a>01062       }
<a name="l01063"></a>01063     }
<a name="l01064"></a>01064     <span class="keywordflow">else</span> {
<a name="l01065"></a>01065       $variables[$info[<span class="stringliteral">&#39;render element&#39;</span>]] = $element;
<a name="l01066"></a>01066     }
<a name="l01067"></a>01067   }
<a name="l01068"></a>01068 
<a name="l01069"></a>01069   <span class="comment">// Merge in argument defaults.</span>
<a name="l01070"></a>01070   <span class="keywordflow">if</span> (!empty($info[<span class="stringliteral">&#39;variables&#39;</span>])) {
<a name="l01071"></a>01071     $variables += $info[<span class="stringliteral">&#39;variables&#39;</span>];
<a name="l01072"></a>01072   }
<a name="l01073"></a>01073   elseif (!empty($info[<span class="stringliteral">&#39;render element&#39;</span>])) {
<a name="l01074"></a>01074     $variables += array($info[<span class="stringliteral">&#39;render element&#39;</span>] =&gt; array());
<a name="l01075"></a>01075   }
<a name="l01076"></a>01076 
<a name="l01077"></a>01077   <span class="comment">// Invoke the variable processors, if any. The processors may specify</span>
<a name="l01078"></a>01078   <span class="comment">// alternate suggestions for which hook&#39;s template/function to use. If the</span>
<a name="l01079"></a>01079   <span class="comment">// hook is a suggestion of a base hook, invoke the variable processors of</span>
<a name="l01080"></a>01080   <span class="comment">// the base hook, but retain the suggestion as a high priority suggestion to</span>
<a name="l01081"></a>01081   <span class="comment">// be used unless overridden by a variable processor function.</span>
<a name="l01082"></a>01082   <span class="keywordflow">if</span> (isset($info[<span class="stringliteral">&#39;base hook&#39;</span>])) {
<a name="l01083"></a>01083     $base_hook = $info[<span class="stringliteral">&#39;base hook&#39;</span>];
<a name="l01084"></a>01084     $base_hook_info = $hooks[$base_hook];
<a name="l01085"></a>01085     <span class="comment">// Include files required by the base hook, since its variable processors</span>
<a name="l01086"></a>01086     <span class="comment">// might reside there.</span>
<a name="l01087"></a>01087     <span class="keywordflow">if</span> (!empty($base_hook_info[<span class="stringliteral">&#39;includes&#39;</span>])) {
<a name="l01088"></a>01088       <span class="keywordflow">foreach</span> ($base_hook_info[<span class="stringliteral">&#39;includes&#39;</span>] as $include_file) {
<a name="l01089"></a>01089         include_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $include_file;
<a name="l01090"></a>01090       }
<a name="l01091"></a>01091     }
<a name="l01092"></a>01092     <span class="keywordflow">if</span> (isset($base_hook_info[<span class="stringliteral">&#39;preprocess functions&#39;</span>]) || isset($base_hook_info[<span class="stringliteral">&#39;process functions&#39;</span>])) {
<a name="l01093"></a>01093       $variables[<span class="stringliteral">&#39;theme_hook_suggestion&#39;</span>] = $hook;
<a name="l01094"></a>01094       $hook = $base_hook;
<a name="l01095"></a>01095       $info = $base_hook_info;
<a name="l01096"></a>01096     }
<a name="l01097"></a>01097   }
<a name="l01098"></a>01098   <span class="keywordflow">if</span> (isset($info[<span class="stringliteral">&#39;preprocess functions&#39;</span>]) || isset($info[<span class="stringliteral">&#39;process functions&#39;</span>])) {
<a name="l01099"></a>01099     $variables[<span class="stringliteral">&#39;theme_hook_suggestions&#39;</span>] = array();
<a name="l01100"></a>01100     <span class="keywordflow">foreach</span> (array(<span class="stringliteral">&#39;preprocess functions&#39;</span>, <span class="stringliteral">&#39;process functions&#39;</span>) as $phase) {
<a name="l01101"></a>01101       <span class="keywordflow">if</span> (!empty($info[$phase])) {
<a name="l01102"></a>01102         <span class="keywordflow">foreach</span> ($info[$phase] as $processor_function) {
<a name="l01103"></a>01103           <span class="keywordflow">if</span> (function_exists($processor_function)) {
<a name="l01104"></a>01104             <span class="comment">// We don&#39;t want a poorly behaved process function changing $hook.</span>
<a name="l01105"></a>01105             $hook_clone = $hook;
<a name="l01106"></a>01106             $processor_function($variables, $hook_clone);
<a name="l01107"></a>01107           }
<a name="l01108"></a>01108         }
<a name="l01109"></a>01109       }
<a name="l01110"></a>01110     }
<a name="l01111"></a>01111     <span class="comment">// If the preprocess/process functions specified hook suggestions, and the</span>
<a name="l01112"></a>01112     <span class="comment">// suggestion exists in the theme registry, use it instead of the hook that</span>
<a name="l01113"></a>01113     <span class="comment">// theme() was called with. This allows the preprocess/process step to</span>
<a name="l01114"></a>01114     <span class="comment">// route to a more specific theme hook. For example, a function may call</span>
<a name="l01115"></a>01115     <span class="comment">// theme(&#39;node&#39;, ...), but a preprocess function can add &#39;node__article&#39; as</span>
<a name="l01116"></a>01116     <span class="comment">// a suggestion, enabling a theme to have an alternate template file for</span>
<a name="l01117"></a>01117     <span class="comment">// article nodes. Suggestions are checked in the following order:</span>
<a name="l01118"></a>01118     <span class="comment">// - The &#39;theme_hook_suggestion&#39; variable is checked first. It overrides</span>
<a name="l01119"></a>01119     <span class="comment">//   all others.</span>
<a name="l01120"></a>01120     <span class="comment">// - The &#39;theme_hook_suggestions&#39; variable is checked in FILO order, so the</span>
<a name="l01121"></a>01121     <span class="comment">//   last suggestion added to the array takes precedence over suggestions</span>
<a name="l01122"></a>01122     <span class="comment">//   added earlier.</span>
<a name="l01123"></a>01123     $suggestions = array();
<a name="l01124"></a>01124     <span class="keywordflow">if</span> (!empty($variables[<span class="stringliteral">&#39;theme_hook_suggestions&#39;</span>])) {
<a name="l01125"></a>01125       $suggestions = $variables[<span class="stringliteral">&#39;theme_hook_suggestions&#39;</span>];
<a name="l01126"></a>01126     }
<a name="l01127"></a>01127     <span class="keywordflow">if</span> (!empty($variables[<span class="stringliteral">&#39;theme_hook_suggestion&#39;</span>])) {
<a name="l01128"></a>01128       $suggestions[] = $variables[<span class="stringliteral">&#39;theme_hook_suggestion&#39;</span>];
<a name="l01129"></a>01129     }
<a name="l01130"></a>01130     <span class="keywordflow">foreach</span> (array_reverse($suggestions) as $suggestion) {
<a name="l01131"></a>01131       <span class="keywordflow">if</span> (isset($hooks[$suggestion])) {
<a name="l01132"></a>01132         $info = $hooks[$suggestion];
<a name="l01133"></a>01133         <span class="keywordflow">break</span>;
<a name="l01134"></a>01134       }
<a name="l01135"></a>01135     }
<a name="l01136"></a>01136   }
<a name="l01137"></a>01137 
<a name="l01138"></a>01138   <span class="comment">// Generate the output using either a function or a template.</span>
<a name="l01139"></a>01139   <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01140"></a>01140   <span class="keywordflow">if</span> (isset($info[<span class="stringliteral">&#39;function&#39;</span>])) {
<a name="l01141"></a>01141     <span class="keywordflow">if</span> (function_exists($info[<span class="stringliteral">&#39;function&#39;</span>])) {
<a name="l01142"></a>01142       <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = $info[<span class="stringliteral">&#39;function&#39;</span>]($variables);
<a name="l01143"></a>01143     }
<a name="l01144"></a>01144   }
<a name="l01145"></a>01145   <span class="keywordflow">else</span> {
<a name="l01146"></a>01146     <span class="comment">// Default render function and extension.</span>
<a name="l01147"></a>01147     $render_function = <span class="stringliteral">&#39;theme_render_template&#39;</span>;
<a name="l01148"></a>01148     $extension = <span class="stringliteral">&#39;.tpl.php&#39;</span>;
<a name="l01149"></a>01149 
<a name="l01150"></a>01150     <span class="comment">// The theme engine may use a different extension and a different renderer.</span>
<a name="l01151"></a>01151     global $theme_engine;
<a name="l01152"></a>01152     <span class="keywordflow">if</span> (isset($theme_engine)) {
<a name="l01153"></a>01153       <span class="keywordflow">if</span> ($info[<span class="stringliteral">&#39;type&#39;</span>] != <span class="stringliteral">&#39;module&#39;</span>) {
<a name="l01154"></a>01154         <span class="keywordflow">if</span> (function_exists($theme_engine . <span class="stringliteral">&#39;_render_template&#39;</span>)) {
<a name="l01155"></a>01155           $render_function = $theme_engine . <span class="stringliteral">&#39;_render_template&#39;</span>;
<a name="l01156"></a>01156         }
<a name="l01157"></a>01157         $extension_function = $theme_engine . <span class="stringliteral">&#39;_extension&#39;</span>;
<a name="l01158"></a>01158         <span class="keywordflow">if</span> (function_exists($extension_function)) {
<a name="l01159"></a>01159           $extension = $extension_function();
<a name="l01160"></a>01160         }
<a name="l01161"></a>01161       }
<a name="l01162"></a>01162     }
<a name="l01163"></a>01163 
<a name="l01164"></a>01164     <span class="comment">// In some cases, a template implementation may not have had</span>
<a name="l01165"></a>01165     <span class="comment">// template_preprocess() run (for example, if the default implementation is</span>
<a name="l01166"></a>01166     <span class="comment">// a function, but a template overrides that default implementation). In</span>
<a name="l01167"></a>01167     <span class="comment">// these cases, a template should still be able to expect to have access to</span>
<a name="l01168"></a>01168     <span class="comment">// the variables provided by template_preprocess(), so we add them here if</span>
<a name="l01169"></a>01169     <span class="comment">// they don&#39;t already exist. We don&#39;t want to run template_preprocess()</span>
<a name="l01170"></a>01170     <span class="comment">// twice (it would be inefficient and mess up zebra striping), so we use the</span>
<a name="l01171"></a>01171     <span class="comment">// &#39;directory&#39; variable to determine if it has already run, which while not</span>
<a name="l01172"></a>01172     <span class="comment">// completely intuitive, is reasonably safe, and allows us to save on the</span>
<a name="l01173"></a>01173     <span class="comment">// overhead of adding some new variable to track that.</span>
<a name="l01174"></a>01174     <span class="keywordflow">if</span> (!isset($variables[<span class="stringliteral">&#39;directory&#39;</span>])) {
<a name="l01175"></a>01175       $default_template_variables = array();
<a name="l01176"></a>01176       <a class="code" href="theme_8inc_a3eeb7bcdba7ef4859f99586da264d347.html#a3eeb7bcdba7ef4859f99586da264d347" title="Adds a default set of helper variables for variable processors and templates.">template_preprocess</a>($default_template_variables, $hook);
<a name="l01177"></a>01177       $variables += $default_template_variables;
<a name="l01178"></a>01178     }
<a name="l01179"></a>01179 
<a name="l01180"></a>01180     <span class="comment">// Render the output using the template file.</span>
<a name="l01181"></a>01181     $template_file = $info[<span class="stringliteral">&#39;template&#39;</span>] . $extension;
<a name="l01182"></a>01182     <span class="keywordflow">if</span> (isset($info[<span class="stringliteral">&#39;path&#39;</span>])) {
<a name="l01183"></a>01183       $template_file = $info[<span class="stringliteral">&#39;path&#39;</span>] . <span class="charliteral">&#39;/&#39;</span> . $template_file;
<a name="l01184"></a>01184     }
<a name="l01185"></a>01185     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = $render_function($template_file, $variables);
<a name="l01186"></a>01186   }
<a name="l01187"></a>01187 
<a name="l01188"></a>01188   <span class="comment">// restore path_to_theme()</span>
<a name="l01189"></a>01189   $theme_path = $temp;
<a name="l01190"></a>01190   <span class="keywordflow">return</span> <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a>;
<a name="l01191"></a>01191 }
<a name="l01192"></a>01192 
<a name="l01203"></a><a class="code" href="theme_8inc_a8fd73902b4d3a2d476e5b1324506b5e1.html#a8fd73902b4d3a2d476e5b1324506b5e1">01203</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a8fd73902b4d3a2d476e5b1324506b5e1.html#a8fd73902b4d3a2d476e5b1324506b5e1" title="Return the path to the current themed element.">path_to_theme</a>() {
<a name="l01204"></a>01204   global $theme_path;
<a name="l01205"></a>01205 
<a name="l01206"></a>01206   <span class="keywordflow">if</span> (!isset($theme_path)) {
<a name="l01207"></a>01207     <a class="code" href="theme_8inc_a9e48961b3be3ca78f434b047fbb8463f.html#a9e48961b3be3ca78f434b047fbb8463f" title="Initialize the theme system by loading the theme.">drupal_theme_initialize</a>();
<a name="l01208"></a>01208   }
<a name="l01209"></a>01209 
<a name="l01210"></a>01210   <span class="keywordflow">return</span> $theme_path;
<a name="l01211"></a>01211 }
<a name="l01212"></a>01212 
<a name="l01224"></a><a class="code" href="theme_8inc_a38b3ec5ba23e776b29f3f907a75711f1.html#a38b3ec5ba23e776b29f3f907a75711f1">01224</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a38b3ec5ba23e776b29f3f907a75711f1.html#a38b3ec5ba23e776b29f3f907a75711f1" title="Allow themes and/or theme engines to easily discover overridden theme functions.">drupal_find_theme_functions</a>($cache, $prefixes) {
<a name="l01225"></a>01225   $implementations = array();
<a name="l01226"></a>01226   $functions = get_defined_functions();
<a name="l01227"></a>01227 
<a name="l01228"></a>01228   <span class="keywordflow">foreach</span> ($cache as $hook =&gt; $info) {
<a name="l01229"></a>01229     <span class="keywordflow">foreach</span> ($prefixes as $prefix) {
<a name="l01230"></a>01230       <span class="comment">// Find theme functions that implement possible &quot;suggestion&quot; variants of</span>
<a name="l01231"></a>01231       <span class="comment">// registered theme hooks and add those as new registered theme hooks.</span>
<a name="l01232"></a>01232       <span class="comment">// The &#39;pattern&#39; key defines a common prefix that all suggestions must</span>
<a name="l01233"></a>01233       <span class="comment">// start with. The default is the name of the hook followed by &#39;__&#39;. An</span>
<a name="l01234"></a>01234       <span class="comment">// &#39;base hook&#39; key is added to each entry made for a found suggestion,</span>
<a name="l01235"></a>01235       <span class="comment">// so that common functionality can be implemented for all suggestions of</span>
<a name="l01236"></a>01236       <span class="comment">// the same base hook. To keep things simple, deep hierarchy of</span>
<a name="l01237"></a>01237       <span class="comment">// suggestions is not supported: each suggestion&#39;s &#39;base hook&#39; key</span>
<a name="l01238"></a>01238       <span class="comment">// refers to a base hook, not to another suggestion, and all suggestions</span>
<a name="l01239"></a>01239       <span class="comment">// are found using the base hook&#39;s pattern, not a pattern from an</span>
<a name="l01240"></a>01240       <span class="comment">// intermediary suggestion.</span>
<a name="l01241"></a>01241       $pattern = isset($info[<span class="stringliteral">&#39;pattern&#39;</span>]) ? $info[<span class="stringliteral">&#39;pattern&#39;</span>] : ($hook . <span class="stringliteral">&#39;__&#39;</span>);
<a name="l01242"></a>01242       <span class="keywordflow">if</span> (!isset($info[<span class="stringliteral">&#39;base hook&#39;</span>]) &amp;&amp; !empty($pattern)) {
<a name="l01243"></a>01243         $matches = preg_grep(<span class="stringliteral">&#39;/^&#39;</span> . $prefix . <span class="charliteral">&#39;_&#39;</span> . $pattern . <span class="charliteral">&#39;/&#39;</span>, $functions[<span class="stringliteral">&#39;user&#39;</span>]);
<a name="l01244"></a>01244         <span class="keywordflow">if</span> ($matches) {
<a name="l01245"></a>01245           <span class="keywordflow">foreach</span> ($matches as $match) {
<a name="l01246"></a>01246             $new_hook = substr($match, strlen($prefix) + 1);
<a name="l01247"></a>01247             $arg_name = isset($info[<span class="stringliteral">&#39;variables&#39;</span>]) ? <span class="stringliteral">&#39;variables&#39;</span> : <span class="stringliteral">&#39;render element&#39;</span>;
<a name="l01248"></a>01248             $implementations[$new_hook] = array(
<a name="l01249"></a>01249               <span class="stringliteral">&#39;function&#39;</span> =&gt; $match,
<a name="l01250"></a>01250               $arg_name =&gt; $info[$arg_name],
<a name="l01251"></a>01251               <span class="stringliteral">&#39;base hook&#39;</span> =&gt; $hook,
<a name="l01252"></a>01252             );
<a name="l01253"></a>01253           }
<a name="l01254"></a>01254         }
<a name="l01255"></a>01255       }
<a name="l01256"></a>01256       <span class="comment">// Find theme functions that implement registered theme hooks and include</span>
<a name="l01257"></a>01257       <span class="comment">// that in what is returned so that the registry knows that the theme has</span>
<a name="l01258"></a>01258       <span class="comment">// this implementation.</span>
<a name="l01259"></a>01259       <span class="keywordflow">if</span> (function_exists($prefix . <span class="charliteral">&#39;_&#39;</span> . $hook)) {
<a name="l01260"></a>01260         $implementations[$hook] = array(
<a name="l01261"></a>01261           <span class="stringliteral">&#39;function&#39;</span> =&gt; $prefix . <span class="charliteral">&#39;_&#39;</span> . $hook,
<a name="l01262"></a>01262         );
<a name="l01263"></a>01263       }
<a name="l01264"></a>01264     }
<a name="l01265"></a>01265   }
<a name="l01266"></a>01266 
<a name="l01267"></a>01267   <span class="keywordflow">return</span> $implementations;
<a name="l01268"></a>01268 }
<a name="l01269"></a>01269 
<a name="l01280"></a><a class="code" href="theme_8inc_aa755f6e8f11a62c9e90a6d7af55145b1.html#aa755f6e8f11a62c9e90a6d7af55145b1">01280</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_aa755f6e8f11a62c9e90a6d7af55145b1.html#aa755f6e8f11a62c9e90a6d7af55145b1" title="Allow themes and/or theme engines to easily discover overridden templates.">drupal_find_theme_templates</a>($cache, $extension, $path) {
<a name="l01281"></a>01281   $implementations = array();
<a name="l01282"></a>01282 
<a name="l01283"></a>01283   <span class="comment">// Collect paths to all sub-themes grouped by base themes. These will be</span>
<a name="l01284"></a>01284   <span class="comment">// used for filtering. This allows base themes to have sub-themes in its</span>
<a name="l01285"></a>01285   <span class="comment">// folder hierarchy without affecting the base themes template discovery.</span>
<a name="l01286"></a>01286   $theme_paths = array();
<a name="l01287"></a>01287   <span class="keywordflow">foreach</span> (<a class="code" href="theme_8inc_a48d5521b10139d745626435d804353a4.html#a48d5521b10139d745626435d804353a4" title="Return a list of all currently available themes.">list_themes</a>() as $theme_info) {
<a name="l01288"></a>01288     <span class="keywordflow">if</span> (!empty($theme_info-&gt;base_theme)) {
<a name="l01289"></a>01289       $theme_paths[$theme_info-&gt;base_theme][$theme_info-&gt;name] = dirname($theme_info-&gt;filename);
<a name="l01290"></a>01290     }
<a name="l01291"></a>01291   }
<a name="l01292"></a>01292   <span class="keywordflow">foreach</span> ($theme_paths as $basetheme =&gt; $subthemes) {
<a name="l01293"></a>01293     <span class="keywordflow">foreach</span> ($subthemes as $subtheme =&gt; $subtheme_path) {
<a name="l01294"></a>01294       <span class="keywordflow">if</span> (isset($theme_paths[$subtheme])) {
<a name="l01295"></a>01295         $theme_paths[$basetheme] = array_merge($theme_paths[$basetheme], $theme_paths[$subtheme]);
<a name="l01296"></a>01296       }
<a name="l01297"></a>01297     }
<a name="l01298"></a>01298   }
<a name="l01299"></a>01299   global $theme;
<a name="l01300"></a>01300   $subtheme_paths = isset($theme_paths[$theme]) ? $theme_paths[$theme] : array();
<a name="l01301"></a>01301 
<a name="l01302"></a>01302   <span class="comment">// Escape the periods in the extension.</span>
<a name="l01303"></a>01303   $regex = <span class="charliteral">&#39;/&#39;</span> . str_replace(<span class="charliteral">&#39;.&#39;</span>, <span class="charliteral">&#39;\.&#39;</span>, $extension) . <span class="stringliteral">&#39;$/&#39;</span>;
<a name="l01304"></a>01304   <span class="comment">// Get a listing of all template files in the path to search.</span>
<a name="l01305"></a>01305   $files = <a class="code" href="common_8inc_a60d1237b23d4e84a59656003596add4b.html#a60d1237b23d4e84a59656003596add4b" title="Returns information about system object files (modules, themes, etc.).">drupal_system_listing</a>($regex, $path, <span class="stringliteral">&#39;name&#39;</span>, 0);
<a name="l01306"></a>01306 
<a name="l01307"></a>01307   <span class="comment">// Find templates that implement registered theme hooks and include that in</span>
<a name="l01308"></a>01308   <span class="comment">// what is returned so that the registry knows that the theme has this</span>
<a name="l01309"></a>01309   <span class="comment">// implementation.</span>
<a name="l01310"></a>01310   <span class="keywordflow">foreach</span> ($files as $template =&gt; $file) {
<a name="l01311"></a>01311     <span class="comment">// Ignore sub-theme templates for the current theme.</span>
<a name="l01312"></a>01312     <span class="keywordflow">if</span> (strpos($file-&gt;uri, str_replace($subtheme_paths, <span class="stringliteral">&#39;&#39;</span>, $file-&gt;uri)) !== 0) {
<a name="l01313"></a>01313       <span class="keywordflow">continue</span>;
<a name="l01314"></a>01314     }
<a name="l01315"></a>01315     <span class="comment">// Chop off the remaining extensions if there are any. $template already</span>
<a name="l01316"></a>01316     <span class="comment">// has the rightmost extension removed, but there might still be more,</span>
<a name="l01317"></a>01317     <span class="comment">// such as with .tpl.php, which still has .tpl in $template at this point.</span>
<a name="l01318"></a>01318     <span class="keywordflow">if</span> (($pos = strpos($template, <span class="charliteral">&#39;.&#39;</span>)) !== FALSE) {
<a name="l01319"></a>01319       $template = substr($template, 0, $pos);
<a name="l01320"></a>01320     }
<a name="l01321"></a>01321     <span class="comment">// Transform - in filenames to _ to match function naming scheme</span>
<a name="l01322"></a>01322     <span class="comment">// for the purposes of searching.</span>
<a name="l01323"></a>01323     $hook = strtr($template, <span class="charliteral">&#39;-&#39;</span>, <span class="charliteral">&#39;_&#39;</span>);
<a name="l01324"></a>01324     <span class="keywordflow">if</span> (isset($cache[$hook])) {
<a name="l01325"></a>01325       $implementations[$hook] = array(
<a name="l01326"></a>01326         <span class="stringliteral">&#39;template&#39;</span> =&gt; $template,
<a name="l01327"></a>01327         <span class="stringliteral">&#39;path&#39;</span> =&gt; dirname($file-&gt;uri),
<a name="l01328"></a>01328       );
<a name="l01329"></a>01329     }
<a name="l01330"></a>01330   }
<a name="l01331"></a>01331 
<a name="l01332"></a>01332   <span class="comment">// Find templates that implement possible &quot;suggestion&quot; variants of registered</span>
<a name="l01333"></a>01333   <span class="comment">// theme hooks and add those as new registered theme hooks. See</span>
<a name="l01334"></a>01334   <span class="comment">// drupal_find_theme_functions() for more information about suggestions and</span>
<a name="l01335"></a>01335   <span class="comment">// the use of &#39;pattern&#39; and &#39;base hook&#39;.</span>
<a name="l01336"></a>01336   $patterns = array_keys($files);
<a name="l01337"></a>01337   <span class="keywordflow">foreach</span> ($cache as $hook =&gt; $info) {
<a name="l01338"></a>01338     $pattern = isset($info[<span class="stringliteral">&#39;pattern&#39;</span>]) ? $info[<span class="stringliteral">&#39;pattern&#39;</span>] : ($hook . <span class="stringliteral">&#39;__&#39;</span>);
<a name="l01339"></a>01339     <span class="keywordflow">if</span> (!isset($info[<span class="stringliteral">&#39;base hook&#39;</span>]) &amp;&amp; !empty($pattern)) {
<a name="l01340"></a>01340       <span class="comment">// Transform _ in pattern to - to match file naming scheme</span>
<a name="l01341"></a>01341       <span class="comment">// for the purposes of searching.</span>
<a name="l01342"></a>01342       $pattern = strtr($pattern, <span class="charliteral">&#39;_&#39;</span>, <span class="charliteral">&#39;-&#39;</span>);
<a name="l01343"></a>01343 
<a name="l01344"></a>01344       $matches = preg_grep(<span class="stringliteral">&#39;/^&#39;</span> . $pattern . <span class="charliteral">&#39;/&#39;</span>, $patterns);
<a name="l01345"></a>01345       <span class="keywordflow">if</span> ($matches) {
<a name="l01346"></a>01346         <span class="keywordflow">foreach</span> ($matches as $match) {
<a name="l01347"></a>01347           $file = substr($match, 0, strpos($match, <span class="charliteral">&#39;.&#39;</span>));
<a name="l01348"></a>01348           <span class="comment">// Put the underscores back in for the hook name and register this pattern.</span>
<a name="l01349"></a>01349           $arg_name = isset($info[<span class="stringliteral">&#39;variables&#39;</span>]) ? <span class="stringliteral">&#39;variables&#39;</span> : <span class="stringliteral">&#39;render element&#39;</span>;
<a name="l01350"></a>01350           $implementations[strtr($file, <span class="charliteral">&#39;-&#39;</span>, <span class="charliteral">&#39;_&#39;</span>)] = array(
<a name="l01351"></a>01351             <span class="stringliteral">&#39;template&#39;</span> =&gt; $file,
<a name="l01352"></a>01352             <span class="stringliteral">&#39;path&#39;</span> =&gt; dirname($files[$match]-&gt;uri),
<a name="l01353"></a>01353             $arg_name =&gt; $info[$arg_name],
<a name="l01354"></a>01354             <span class="stringliteral">&#39;base hook&#39;</span> =&gt; $hook,
<a name="l01355"></a>01355           );
<a name="l01356"></a>01356         }
<a name="l01357"></a>01357       }
<a name="l01358"></a>01358     }
<a name="l01359"></a>01359   }
<a name="l01360"></a>01360   <span class="keywordflow">return</span> $implementations;
<a name="l01361"></a>01361 }
<a name="l01362"></a>01362 
<a name="l01384"></a><a class="code" href="theme_8inc_a7cb0fd8d3be02b386d3bd88a3f1dcf1f.html#a7cb0fd8d3be02b386d3bd88a3f1dcf1f">01384</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a7cb0fd8d3be02b386d3bd88a3f1dcf1f.html#a7cb0fd8d3be02b386d3bd88a3f1dcf1f" title="Retrieve a setting for the current theme or for a given theme.">theme_get_setting</a>($setting_name, $theme = NULL) {
<a name="l01385"></a>01385   $cache = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__, array());
<a name="l01386"></a>01386 
<a name="l01387"></a>01387   <span class="comment">// If no key is given, use the current theme if we can determine it.</span>
<a name="l01388"></a>01388   <span class="keywordflow">if</span> (!isset($theme)) {
<a name="l01389"></a>01389     $theme = !empty($GLOBALS[<span class="stringliteral">&#39;theme_key&#39;</span>]) ? $GLOBALS[<span class="stringliteral">&#39;theme_key&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>;
<a name="l01390"></a>01390   }
<a name="l01391"></a>01391 
<a name="l01392"></a>01392   <span class="keywordflow">if</span> (empty($cache[$theme])) {
<a name="l01393"></a>01393     <span class="comment">// Set the default values for each global setting.</span>
<a name="l01394"></a>01394     <span class="comment">// To add new global settings, add their default values below, and then</span>
<a name="l01395"></a>01395     <span class="comment">// add form elements to system_theme_settings() in system.admin.inc.</span>
<a name="l01396"></a>01396     $cache[$theme] = array(
<a name="l01397"></a>01397       <span class="stringliteral">&#39;default_logo&#39;</span>                     =&gt;  1,
<a name="l01398"></a>01398       <span class="stringliteral">&#39;logo_path&#39;</span>                        =&gt;  <span class="stringliteral">&#39;&#39;</span>,
<a name="l01399"></a>01399       <span class="stringliteral">&#39;default_favicon&#39;</span>                  =&gt;  1,
<a name="l01400"></a>01400       <span class="stringliteral">&#39;favicon_path&#39;</span>                     =&gt;  <span class="stringliteral">&#39;&#39;</span>,
<a name="l01401"></a>01401       <span class="comment">// Use the IANA-registered MIME type for ICO files as default.</span>
<a name="l01402"></a>01402       <span class="stringliteral">&#39;favicon_mimetype&#39;</span>                 =&gt;  <span class="stringliteral">&#39;image/vnd.microsoft.icon&#39;</span>,
<a name="l01403"></a>01403     );
<a name="l01404"></a>01404     <span class="comment">// Turn on all default features.</span>
<a name="l01405"></a>01405     $features = _system_default_theme_features();
<a name="l01406"></a>01406     <span class="keywordflow">foreach</span> ($features as $feature) {
<a name="l01407"></a>01407       $cache[$theme][<span class="stringliteral">&#39;toggle_&#39;</span> . $feature] = 1;
<a name="l01408"></a>01408     }
<a name="l01409"></a>01409 
<a name="l01410"></a>01410     <span class="comment">// Get the values for the theme-specific settings from the .info files of</span>
<a name="l01411"></a>01411     <span class="comment">// the theme and all its base themes.</span>
<a name="l01412"></a>01412     <span class="keywordflow">if</span> ($theme) {
<a name="l01413"></a>01413       $themes = <a class="code" href="theme_8inc_a48d5521b10139d745626435d804353a4.html#a48d5521b10139d745626435d804353a4" title="Return a list of all currently available themes.">list_themes</a>();
<a name="l01414"></a>01414       $theme_object = $themes[$theme];
<a name="l01415"></a>01415 
<a name="l01416"></a>01416       <span class="comment">// Create a list which includes the current theme and all its base themes.</span>
<a name="l01417"></a>01417       <span class="keywordflow">if</span> (isset($theme_object-&gt;base_themes)) {
<a name="l01418"></a>01418         $theme_keys = array_keys($theme_object-&gt;base_themes);
<a name="l01419"></a>01419         $theme_keys[] = $theme;
<a name="l01420"></a>01420       }
<a name="l01421"></a>01421       <span class="keywordflow">else</span> {
<a name="l01422"></a>01422         $theme_keys = array($theme);
<a name="l01423"></a>01423       }
<a name="l01424"></a>01424       <span class="keywordflow">foreach</span> ($theme_keys as $theme_key) {
<a name="l01425"></a>01425         <span class="keywordflow">if</span> (!empty($themes[$theme_key]-&gt;info[<span class="stringliteral">&#39;settings&#39;</span>])) {
<a name="l01426"></a>01426           $cache[$theme] = array_merge($cache[$theme], $themes[$theme_key]-&gt;info[<span class="stringliteral">&#39;settings&#39;</span>]);
<a name="l01427"></a>01427         }
<a name="l01428"></a>01428       }
<a name="l01429"></a>01429     }
<a name="l01430"></a>01430 
<a name="l01431"></a>01431     <span class="comment">// Get the saved global settings from the database.</span>
<a name="l01432"></a>01432     $cache[$theme] = array_merge($cache[$theme], <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;theme_settings&#39;</span>, array()));
<a name="l01433"></a>01433 
<a name="l01434"></a>01434     <span class="keywordflow">if</span> ($theme) {
<a name="l01435"></a>01435       <span class="comment">// Get the saved theme-specific settings from the database.</span>
<a name="l01436"></a>01436       $cache[$theme] = array_merge($cache[$theme], <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;theme_&#39;</span> . $theme . <span class="stringliteral">&#39;_settings&#39;</span>, array()));
<a name="l01437"></a>01437 
<a name="l01438"></a>01438       <span class="comment">// If the theme does not support a particular feature, override the global</span>
<a name="l01439"></a>01439       <span class="comment">// setting and set the value to NULL.</span>
<a name="l01440"></a>01440       <span class="keywordflow">if</span> (!empty($theme_object-&gt;info[<span class="stringliteral">&#39;features&#39;</span>])) {
<a name="l01441"></a>01441         <span class="keywordflow">foreach</span> ($features as $feature) {
<a name="l01442"></a>01442           <span class="keywordflow">if</span> (!in_array($feature, $theme_object-&gt;info[<span class="stringliteral">&#39;features&#39;</span>])) {
<a name="l01443"></a>01443             $cache[$theme][<span class="stringliteral">&#39;toggle_&#39;</span> . $feature] = NULL;
<a name="l01444"></a>01444           }
<a name="l01445"></a>01445         }
<a name="l01446"></a>01446       }
<a name="l01447"></a>01447 
<a name="l01448"></a>01448       <span class="comment">// Generate the path to the logo image.</span>
<a name="l01449"></a>01449       <span class="keywordflow">if</span> ($cache[$theme][<span class="stringliteral">&#39;toggle_logo&#39;</span>]) {
<a name="l01450"></a>01450         <span class="keywordflow">if</span> ($cache[$theme][<span class="stringliteral">&#39;default_logo&#39;</span>]) {
<a name="l01451"></a>01451           $cache[$theme][<span class="stringliteral">&#39;logo&#39;</span>] = <a class="code" href="group__file_gaee57f47d60bda90961a2e19d580d4908.html#gaee57f47d60bda90961a2e19d580d4908" title="Creates a web-accessible URL for a stream to an external or local file.">file_create_url</a>(dirname($theme_object-&gt;filename) . <span class="stringliteral">&#39;/logo.png&#39;</span>);
<a name="l01452"></a>01452         }
<a name="l01453"></a>01453         elseif ($cache[$theme][<span class="stringliteral">&#39;logo_path&#39;</span>]) {
<a name="l01454"></a>01454           $cache[$theme][<span class="stringliteral">&#39;logo&#39;</span>] = <a class="code" href="group__file_gaee57f47d60bda90961a2e19d580d4908.html#gaee57f47d60bda90961a2e19d580d4908" title="Creates a web-accessible URL for a stream to an external or local file.">file_create_url</a>($cache[$theme][<span class="stringliteral">&#39;logo_path&#39;</span>]);
<a name="l01455"></a>01455         }
<a name="l01456"></a>01456       }
<a name="l01457"></a>01457 
<a name="l01458"></a>01458       <span class="comment">// Generate the path to the favicon.</span>
<a name="l01459"></a>01459       <span class="keywordflow">if</span> ($cache[$theme][<span class="stringliteral">&#39;toggle_favicon&#39;</span>]) {
<a name="l01460"></a>01460         <span class="keywordflow">if</span> ($cache[$theme][<span class="stringliteral">&#39;default_favicon&#39;</span>]) {
<a name="l01461"></a>01461           <span class="keywordflow">if</span> (file_exists($favicon = dirname($theme_object-&gt;filename) . <span class="stringliteral">&#39;/favicon.ico&#39;</span>)) {
<a name="l01462"></a>01462             $cache[$theme][<span class="stringliteral">&#39;favicon&#39;</span>] = <a class="code" href="group__file_gaee57f47d60bda90961a2e19d580d4908.html#gaee57f47d60bda90961a2e19d580d4908" title="Creates a web-accessible URL for a stream to an external or local file.">file_create_url</a>($favicon);
<a name="l01463"></a>01463           }
<a name="l01464"></a>01464           <span class="keywordflow">else</span> {
<a name="l01465"></a>01465             $cache[$theme][<span class="stringliteral">&#39;favicon&#39;</span>] = <a class="code" href="group__file_gaee57f47d60bda90961a2e19d580d4908.html#gaee57f47d60bda90961a2e19d580d4908" title="Creates a web-accessible URL for a stream to an external or local file.">file_create_url</a>(<span class="stringliteral">&#39;misc/favicon.ico&#39;</span>);
<a name="l01466"></a>01466           }
<a name="l01467"></a>01467         }
<a name="l01468"></a>01468         elseif ($cache[$theme][<span class="stringliteral">&#39;favicon_path&#39;</span>]) {
<a name="l01469"></a>01469           $cache[$theme][<span class="stringliteral">&#39;favicon&#39;</span>] = <a class="code" href="group__file_gaee57f47d60bda90961a2e19d580d4908.html#gaee57f47d60bda90961a2e19d580d4908" title="Creates a web-accessible URL for a stream to an external or local file.">file_create_url</a>($cache[$theme][<span class="stringliteral">&#39;favicon_path&#39;</span>]);
<a name="l01470"></a>01470         }
<a name="l01471"></a>01471         <span class="keywordflow">else</span> {
<a name="l01472"></a>01472           $cache[$theme][<span class="stringliteral">&#39;toggle_favicon&#39;</span>] = FALSE;
<a name="l01473"></a>01473         }
<a name="l01474"></a>01474       }
<a name="l01475"></a>01475     }
<a name="l01476"></a>01476   }
<a name="l01477"></a>01477 
<a name="l01478"></a>01478   <span class="keywordflow">return</span> isset($cache[$theme][$setting_name]) ? $cache[$theme][$setting_name] : NULL;
<a name="l01479"></a>01479 }
<a name="l01480"></a>01480 
<a name="l01492"></a><a class="code" href="theme_8inc_a726ca00e65b455bb895c8abf1dfb1df2.html#a726ca00e65b455bb895c8abf1dfb1df2">01492</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a726ca00e65b455bb895c8abf1dfb1df2.html#a726ca00e65b455bb895c8abf1dfb1df2" title="Render a system default template, which is essentially a PHP template.">theme_render_template</a>($template_file, $variables) {
<a name="l01493"></a>01493   extract($variables, EXTR_SKIP);               <span class="comment">// Extract the variables to a local namespace</span>
<a name="l01494"></a>01494   ob_start();                                   <span class="comment">// Start output buffering</span>
<a name="l01495"></a>01495   include <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $template_file;   <span class="comment">// Include the template file</span>
<a name="l01496"></a>01496   <span class="keywordflow">return</span> ob_get_clean();                        <span class="comment">// End buffering and return its contents</span>
<a name="l01497"></a>01497 }
<a name="l01498"></a>01498 
<a name="l01505"></a><a class="code" href="theme_8inc_a145f4abe8c30a0c1bc012ce634448c79.html#a145f4abe8c30a0c1bc012ce634448c79">01505</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a145f4abe8c30a0c1bc012ce634448c79.html#a145f4abe8c30a0c1bc012ce634448c79" title="Enable a given list of themes.">theme_enable</a>($theme_list) {
<a name="l01506"></a>01506   <a class="code" href="common_8inc_ae89dbd2b41a6623be2ed704d039a5c7c.html#ae89dbd2b41a6623be2ed704d039a5c7c" title="Deletes old cached CSS files.">drupal_clear_css_cache</a>();
<a name="l01507"></a>01507 
<a name="l01508"></a>01508   <span class="keywordflow">foreach</span> ($theme_list as $key) {
<a name="l01509"></a>01509     <a class="code" href="group__database_ga40967197ee5d6a23a5c5a77e627067fe.html#ga40967197ee5d6a23a5c5a77e627067fe" title="Returns a new UpdateQuery object for the active database.">db_update</a>(<span class="stringliteral">&#39;system&#39;</span>)
<a name="l01510"></a>01510       -&gt;fields(array(<span class="stringliteral">&#39;status&#39;</span> =&gt; 1))
<a name="l01511"></a>01511       -&gt;condition(<span class="stringliteral">&#39;type&#39;</span>, <span class="stringliteral">&#39;theme&#39;</span>)
<a name="l01512"></a>01512       -&gt;condition(<span class="stringliteral">&#39;name&#39;</span>, $key)
<a name="l01513"></a>01513       -&gt;execute();
<a name="l01514"></a>01514   }
<a name="l01515"></a>01515 
<a name="l01516"></a>01516   <a class="code" href="theme_8inc_a48d5521b10139d745626435d804353a4.html#a48d5521b10139d745626435d804353a4" title="Return a list of all currently available themes.">list_themes</a>(TRUE);
<a name="l01517"></a>01517   <a class="code" href="group__menu_gaf36dcb9d5491ef5e7d2cf22c1f5c69f4.html#gaf36dcb9d5491ef5e7d2cf22c1f5c69f4" title="(Re)populate the database tables used by various menu functions.">menu_rebuild</a>();
<a name="l01518"></a>01518   <a class="code" href="theme_8inc_a39fec3ccb5c90369be7b5df7961d47ed.html#a39fec3ccb5c90369be7b5df7961d47ed" title="Force the system to rebuild the theme registry; this should be called when modules are added to the s...">drupal_theme_rebuild</a>();
<a name="l01519"></a>01519 
<a name="l01520"></a>01520   <span class="comment">// Invoke hook_themes_enabled() after the themes have been enabled.</span>
<a name="l01521"></a>01521   <a class="code" href="group__hooks_gabedb5f566ef5faaa5768dd15125b111c.html#gabedb5f566ef5faaa5768dd15125b111c" title="Invoke a hook in all enabled modules that implement it.">module_invoke_all</a>(<span class="stringliteral">&#39;themes_enabled&#39;</span>, $theme_list);
<a name="l01522"></a>01522 }
<a name="l01523"></a>01523 
<a name="l01530"></a><a class="code" href="theme_8inc_a03fbdb816d1b0a97b0e65291831c0cdb.html#a03fbdb816d1b0a97b0e65291831c0cdb">01530</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a03fbdb816d1b0a97b0e65291831c0cdb.html#a03fbdb816d1b0a97b0e65291831c0cdb" title="Disable a given list of themes.">theme_disable</a>($theme_list) {
<a name="l01531"></a>01531   <span class="comment">// Don&#39;t disable the default theme.</span>
<a name="l01532"></a>01532   <span class="keywordflow">if</span> ($pos = array_search(<a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;theme_default&#39;</span>, <span class="stringliteral">&#39;bartik&#39;</span>), $theme_list) !== FALSE) {
<a name="l01533"></a>01533     unset($theme_list[$pos]);
<a name="l01534"></a>01534     <span class="keywordflow">if</span> (empty($theme_list)) {
<a name="l01535"></a>01535       <span class="keywordflow">return</span>;
<a name="l01536"></a>01536     }
<a name="l01537"></a>01537   }
<a name="l01538"></a>01538 
<a name="l01539"></a>01539   <a class="code" href="common_8inc_ae89dbd2b41a6623be2ed704d039a5c7c.html#ae89dbd2b41a6623be2ed704d039a5c7c" title="Deletes old cached CSS files.">drupal_clear_css_cache</a>();
<a name="l01540"></a>01540 
<a name="l01541"></a>01541   <span class="keywordflow">foreach</span> ($theme_list as $key) {
<a name="l01542"></a>01542     <a class="code" href="group__database_ga40967197ee5d6a23a5c5a77e627067fe.html#ga40967197ee5d6a23a5c5a77e627067fe" title="Returns a new UpdateQuery object for the active database.">db_update</a>(<span class="stringliteral">&#39;system&#39;</span>)
<a name="l01543"></a>01543       -&gt;fields(array(<span class="stringliteral">&#39;status&#39;</span> =&gt; 0))
<a name="l01544"></a>01544       -&gt;condition(<span class="stringliteral">&#39;type&#39;</span>, <span class="stringliteral">&#39;theme&#39;</span>)
<a name="l01545"></a>01545       -&gt;condition(<span class="stringliteral">&#39;name&#39;</span>, $key)
<a name="l01546"></a>01546       -&gt;execute();
<a name="l01547"></a>01547   }
<a name="l01548"></a>01548 
<a name="l01549"></a>01549   <a class="code" href="theme_8inc_a48d5521b10139d745626435d804353a4.html#a48d5521b10139d745626435d804353a4" title="Return a list of all currently available themes.">list_themes</a>(TRUE);
<a name="l01550"></a>01550   <a class="code" href="group__menu_gaf36dcb9d5491ef5e7d2cf22c1f5c69f4.html#gaf36dcb9d5491ef5e7d2cf22c1f5c69f4" title="(Re)populate the database tables used by various menu functions.">menu_rebuild</a>();
<a name="l01551"></a>01551   <a class="code" href="theme_8inc_a39fec3ccb5c90369be7b5df7961d47ed.html#a39fec3ccb5c90369be7b5df7961d47ed" title="Force the system to rebuild the theme registry; this should be called when modules are added to the s...">drupal_theme_rebuild</a>();
<a name="l01552"></a>01552 
<a name="l01553"></a>01553   <span class="comment">// Invoke hook_themes_disabled after the themes have been disabled.</span>
<a name="l01554"></a>01554   <a class="code" href="group__hooks_gabedb5f566ef5faaa5768dd15125b111c.html#gabedb5f566ef5faaa5768dd15125b111c" title="Invoke a hook in all enabled modules that implement it.">module_invoke_all</a>(<span class="stringliteral">&#39;themes_disabled&#39;</span>, $theme_list);
<a name="l01555"></a>01555 }
<a name="l01556"></a>01556 
<a name="l01574"></a><a class="code" href="group__themeable_gad29a18ad4d19a5fc0a3c75a8804f0331.html#gad29a18ad4d19a5fc0a3c75a8804f0331">01574</a> <span class="keyword">function</span> <a class="code" href="group__themeable_gad29a18ad4d19a5fc0a3c75a8804f0331.html#gad29a18ad4d19a5fc0a3c75a8804f0331" title="Returns HTML for status and/or error messages, grouped by type.">theme_status_messages</a>($variables) {
<a name="l01575"></a>01575   $display = $variables[<span class="stringliteral">&#39;display&#39;</span>];
<a name="l01576"></a>01576   <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01577"></a>01577 
<a name="l01578"></a>01578   $status_heading = array(
<a name="l01579"></a>01579     <span class="stringliteral">&#39;status&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;Status message&#39;</span>),
<a name="l01580"></a>01580     <span class="stringliteral">&#39;error&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;Error message&#39;</span>),
<a name="l01581"></a>01581     <span class="stringliteral">&#39;warning&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;Warning message&#39;</span>),
<a name="l01582"></a>01582   );
<a name="l01583"></a>01583   <span class="keywordflow">foreach</span> (<a class="code" href="bootstrap_8inc_a2c9915d030bad8c5bacf6de25e6fd14c.html#a2c9915d030bad8c5bacf6de25e6fd14c" title="Returns all messages that have been set.">drupal_get_messages</a>($display) as $type =&gt; $messages) {
<a name="l01584"></a>01584     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&quot;&lt;div class=\&quot;messages $type\&quot;&gt;\n&quot;</span>;
<a name="l01585"></a>01585     <span class="keywordflow">if</span> (!empty($status_heading[$type])) {
<a name="l01586"></a>01586       <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39;&lt;h2 class=&quot;element-invisible&quot;&gt;&#39;</span> . $status_heading[$type] . <span class="stringliteral">&quot;&lt;/h2&gt;\n&quot;</span>;
<a name="l01587"></a>01587     }
<a name="l01588"></a>01588     <span class="keywordflow">if</span> (count($messages) &gt; 1) {
<a name="l01589"></a>01589       <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&quot; &lt;ul&gt;\n&quot;</span>;
<a name="l01590"></a>01590       <span class="keywordflow">foreach</span> ($messages as $message) {
<a name="l01591"></a>01591         <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39;  &lt;li&gt;&#39;</span> . $message . <span class="stringliteral">&quot;&lt;/li&gt;\n&quot;</span>;
<a name="l01592"></a>01592       }
<a name="l01593"></a>01593       <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&quot; &lt;/ul&gt;\n&quot;</span>;
<a name="l01594"></a>01594     }
<a name="l01595"></a>01595     <span class="keywordflow">else</span> {
<a name="l01596"></a>01596       <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= $messages[0];
<a name="l01597"></a>01597     }
<a name="l01598"></a>01598     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&quot;&lt;/div&gt;\n&quot;</span>;
<a name="l01599"></a>01599   }
<a name="l01600"></a>01600   <span class="keywordflow">return</span> <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a>;
<a name="l01601"></a>01601 }
<a name="l01602"></a>01602 
<a name="l01621"></a><a class="code" href="group__themeable_ga4ab7d25ecbea3d5367e75c965f7afe55.html#ga4ab7d25ecbea3d5367e75c965f7afe55">01621</a> <span class="keyword">function</span> <a class="code" href="group__themeable_ga4ab7d25ecbea3d5367e75c965f7afe55.html#ga4ab7d25ecbea3d5367e75c965f7afe55" title="Returns HTML for a link.">theme_link</a>($variables) {
<a name="l01622"></a>01622   <span class="keywordflow">return</span> <span class="stringliteral">&#39;&lt;a href=&quot;&#39;</span> . <a class="code" href="group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d.html#ga76fc67a30fd8d75ddd80565e6e65a13d" title="Encodes special characters in a plain-text string for display as HTML.">check_plain</a>(<a class="code" href="common_8inc_a43b2a0594431556db49df980801d8807.html#a43b2a0594431556db49df980801d8807" title="End of &quot;defgroup format&quot;.">url</a>($variables[<span class="stringliteral">&#39;path&#39;</span>], $variables[<span class="stringliteral">&#39;options&#39;</span>])) . <span class="charliteral">&#39;&quot;&#39;</span> . <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>($variables[<span class="stringliteral">&#39;options&#39;</span>][<span class="stringliteral">&#39;attributes&#39;</span>]) . <span class="charliteral">&#39;&gt;&#39;</span> . ($variables[<span class="stringliteral">&#39;options&#39;</span>][<span class="stringliteral">&#39;html&#39;</span>] ? $variables[<span class="stringliteral">&#39;text&#39;</span>] : <a class="code" href="group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d.html#ga76fc67a30fd8d75ddd80565e6e65a13d" title="Encodes special characters in a plain-text string for display as HTML.">check_plain</a>($variables[<span class="stringliteral">&#39;text&#39;</span>])) . <span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>;
<a name="l01623"></a>01623 }
<a name="l01624"></a>01624 
<a name="l01660"></a><a class="code" href="group__themeable_gab75b290dbc9541e2fb0d9e57cbcdda5c.html#gab75b290dbc9541e2fb0d9e57cbcdda5c">01660</a> <span class="keyword">function</span> <a class="code" href="group__themeable_gab75b290dbc9541e2fb0d9e57cbcdda5c.html#gab75b290dbc9541e2fb0d9e57cbcdda5c" title="Returns HTML for a set of links.">theme_links</a>($variables) {
<a name="l01661"></a>01661   $links = $variables[<span class="stringliteral">&#39;links&#39;</span>];
<a name="l01662"></a>01662   $attributes = $variables[<span class="stringliteral">&#39;attributes&#39;</span>];
<a name="l01663"></a>01663   $heading = $variables[<span class="stringliteral">&#39;heading&#39;</span>];
<a name="l01664"></a>01664   global $language_url;
<a name="l01665"></a>01665   <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01666"></a>01666 
<a name="l01667"></a>01667   <span class="keywordflow">if</span> (count($links) &gt; 0) {
<a name="l01668"></a>01668     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01669"></a>01669 
<a name="l01670"></a>01670     <span class="comment">// Treat the heading first if it is present to prepend it to the</span>
<a name="l01671"></a>01671     <span class="comment">// list of links.</span>
<a name="l01672"></a>01672     <span class="keywordflow">if</span> (!empty($heading)) {
<a name="l01673"></a>01673       <span class="keywordflow">if</span> (is_string($heading)) {
<a name="l01674"></a>01674         <span class="comment">// Prepare the array that will be used when the passed heading</span>
<a name="l01675"></a>01675         <span class="comment">// is a string.</span>
<a name="l01676"></a>01676         $heading = array(
<a name="l01677"></a>01677           <span class="stringliteral">&#39;text&#39;</span> =&gt; $heading,
<a name="l01678"></a>01678           <span class="comment">// Set the default level of the heading.</span>
<a name="l01679"></a>01679           <span class="stringliteral">&#39;level&#39;</span> =&gt; <span class="stringliteral">&#39;h2&#39;</span>,
<a name="l01680"></a>01680         );
<a name="l01681"></a>01681       }
<a name="l01682"></a>01682       <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="charliteral">&#39;&lt;&#39;</span> . $heading[<span class="stringliteral">&#39;level&#39;</span>];
<a name="l01683"></a>01683       <span class="keywordflow">if</span> (!empty($heading[<span class="stringliteral">&#39;class&#39;</span>])) {
<a name="l01684"></a>01684         <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>(array(<span class="stringliteral">&#39;class&#39;</span> =&gt; $heading[<span class="stringliteral">&#39;class&#39;</span>]));
<a name="l01685"></a>01685       }
<a name="l01686"></a>01686       <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="charliteral">&#39;&gt;&#39;</span> . <a class="code" href="group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d.html#ga76fc67a30fd8d75ddd80565e6e65a13d" title="Encodes special characters in a plain-text string for display as HTML.">check_plain</a>($heading[<span class="stringliteral">&#39;text&#39;</span>]) . <span class="stringliteral">&#39;&lt;/&#39;</span> . $heading[<span class="stringliteral">&#39;level&#39;</span>] . <span class="charliteral">&#39;&gt;&#39;</span>;
<a name="l01687"></a>01687     }
<a name="l01688"></a>01688 
<a name="l01689"></a>01689     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39;&lt;ul&#39;</span> . <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>($attributes) . <span class="charliteral">&#39;&gt;&#39;</span>;
<a name="l01690"></a>01690 
<a name="l01691"></a>01691     $num_links = count($links);
<a name="l01692"></a>01692     $i = 1;
<a name="l01693"></a>01693 
<a name="l01694"></a>01694     <span class="keywordflow">foreach</span> ($links as $key =&gt; $link) {
<a name="l01695"></a>01695       $class = array($key);
<a name="l01696"></a>01696 
<a name="l01697"></a>01697       <span class="comment">// Add first, last and active classes to the list of links to help out themers.</span>
<a name="l01698"></a>01698       <span class="keywordflow">if</span> ($i == 1) {
<a name="l01699"></a>01699         $class[] = <span class="stringliteral">&#39;first&#39;</span>;
<a name="l01700"></a>01700       }
<a name="l01701"></a>01701       <span class="keywordflow">if</span> ($i == $num_links) {
<a name="l01702"></a>01702         $class[] = <span class="stringliteral">&#39;last&#39;</span>;
<a name="l01703"></a>01703       }
<a name="l01704"></a>01704       <span class="keywordflow">if</span> (isset($link[<span class="stringliteral">&#39;href&#39;</span>]) &amp;&amp; ($link[<span class="stringliteral">&#39;href&#39;</span>] == $_GET[<span class="charliteral">&#39;q&#39;</span>] || ($link[<span class="stringliteral">&#39;href&#39;</span>] == <span class="stringliteral">&#39;&lt;front&gt;&#39;</span> &amp;&amp; <a class="code" href="path_8inc_a657eb4770879ad6f0dc19bfad2cd4a6d.html#a657eb4770879ad6f0dc19bfad2cd4a6d" title="Check if the current page is the front page.">drupal_is_front_page</a>()))
<a name="l01705"></a>01705           &amp;&amp; (empty($link[<span class="stringliteral">&#39;language&#39;</span>]) || $link[<span class="stringliteral">&#39;language&#39;</span>]-&gt;language == $language_url-&gt;language)) {
<a name="l01706"></a>01706         $class[] = <span class="stringliteral">&#39;active&#39;</span>;
<a name="l01707"></a>01707       }
<a name="l01708"></a>01708       <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39;&lt;li&#39;</span> . <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>(array(<span class="stringliteral">&#39;class&#39;</span> =&gt; $class)) . <span class="charliteral">&#39;&gt;&#39;</span>;
<a name="l01709"></a>01709 
<a name="l01710"></a>01710       <span class="keywordflow">if</span> (isset($link[<span class="stringliteral">&#39;href&#39;</span>])) {
<a name="l01711"></a>01711         <span class="comment">// Pass in $link as $options, they share the same keys.</span>
<a name="l01712"></a>01712         <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <a class="code" href="common_8inc_ad3b36c06dc46250b8d22b8d0d2e7bd97.html#ad3b36c06dc46250b8d22b8d0d2e7bd97" title="Formats an internal or external URL link as an HTML anchor tag.">l</a>($link[<span class="stringliteral">&#39;title&#39;</span>], $link[<span class="stringliteral">&#39;href&#39;</span>], $link);
<a name="l01713"></a>01713       }
<a name="l01714"></a>01714       elseif (!empty($link[<span class="stringliteral">&#39;title&#39;</span>])) {
<a name="l01715"></a>01715         <span class="comment">// Some links are actually not links, but we wrap these in &lt;span&gt; for adding title and class attributes.</span>
<a name="l01716"></a>01716         <span class="keywordflow">if</span> (empty($link[<span class="stringliteral">&#39;html&#39;</span>])) {
<a name="l01717"></a>01717           $link[<span class="stringliteral">&#39;title&#39;</span>] = <a class="code" href="group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d.html#ga76fc67a30fd8d75ddd80565e6e65a13d" title="Encodes special characters in a plain-text string for display as HTML.">check_plain</a>($link[<span class="stringliteral">&#39;title&#39;</span>]);
<a name="l01718"></a>01718         }
<a name="l01719"></a>01719         $span_attributes = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01720"></a>01720         <span class="keywordflow">if</span> (isset($link[<span class="stringliteral">&#39;attributes&#39;</span>])) {
<a name="l01721"></a>01721           $span_attributes = <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>($link[<span class="stringliteral">&#39;attributes&#39;</span>]);
<a name="l01722"></a>01722         }
<a name="l01723"></a>01723         <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39;&lt;span&#39;</span> . $span_attributes . <span class="charliteral">&#39;&gt;&#39;</span> . $link[<span class="stringliteral">&#39;title&#39;</span>] . <span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;
<a name="l01724"></a>01724       }
<a name="l01725"></a>01725 
<a name="l01726"></a>01726       $i++;
<a name="l01727"></a>01727       <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&quot;&lt;/li&gt;\n&quot;</span>;
<a name="l01728"></a>01728     }
<a name="l01729"></a>01729 
<a name="l01730"></a>01730     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39;&lt;/ul&gt;&#39;</span>;
<a name="l01731"></a>01731   }
<a name="l01732"></a>01732 
<a name="l01733"></a>01733   <span class="keywordflow">return</span> <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a>;
<a name="l01734"></a>01734 }
<a name="l01735"></a>01735 
<a name="l01759"></a><a class="code" href="group__themeable_gae97e7e2541a9eb4e69e72b6945fec32c.html#gae97e7e2541a9eb4e69e72b6945fec32c">01759</a> <span class="keyword">function</span> <a class="code" href="group__themeable_gae97e7e2541a9eb4e69e72b6945fec32c.html#gae97e7e2541a9eb4e69e72b6945fec32c" title="Returns HTML for an image.">theme_image</a>($variables) {
<a name="l01760"></a>01760   $attributes = $variables[<span class="stringliteral">&#39;attributes&#39;</span>];
<a name="l01761"></a>01761   $attributes[<span class="stringliteral">&#39;src&#39;</span>] = <a class="code" href="group__file_gaee57f47d60bda90961a2e19d580d4908.html#gaee57f47d60bda90961a2e19d580d4908" title="Creates a web-accessible URL for a stream to an external or local file.">file_create_url</a>($variables[<span class="stringliteral">&#39;path&#39;</span>]);
<a name="l01762"></a>01762 
<a name="l01763"></a>01763   <span class="keywordflow">foreach</span> (array(<span class="stringliteral">&#39;width&#39;</span>, <span class="stringliteral">&#39;height&#39;</span>, <span class="stringliteral">&#39;alt&#39;</span>, <span class="stringliteral">&#39;title&#39;</span>) as $key) {
<a name="l01764"></a>01764 
<a name="l01765"></a>01765     <span class="keywordflow">if</span> (isset($variables[$key])) {
<a name="l01766"></a>01766       $attributes[$key] = $variables[$key];
<a name="l01767"></a>01767     }
<a name="l01768"></a>01768   }
<a name="l01769"></a>01769 
<a name="l01770"></a>01770   <span class="keywordflow">return</span> <span class="stringliteral">&#39;&lt;img&#39;</span> . <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>($attributes) . <span class="stringliteral">&#39; /&gt;&#39;</span>;
<a name="l01771"></a>01771 }
<a name="l01772"></a>01772 
<a name="l01780"></a><a class="code" href="group__themeable_gaf05700c211b33b8ae6b258e2946b782c.html#gaf05700c211b33b8ae6b258e2946b782c">01780</a> <span class="keyword">function</span> <a class="code" href="group__themeable_gaf05700c211b33b8ae6b258e2946b782c.html#gaf05700c211b33b8ae6b258e2946b782c" title="Returns HTML for a breadcrumb trail.">theme_breadcrumb</a>($variables) {
<a name="l01781"></a>01781   $breadcrumb = $variables[<span class="stringliteral">&#39;breadcrumb&#39;</span>];
<a name="l01782"></a>01782 
<a name="l01783"></a>01783   <span class="keywordflow">if</span> (!empty($breadcrumb)) {
<a name="l01784"></a>01784     <span class="comment">// Provide a navigational heading to give context for breadcrumb links to</span>
<a name="l01785"></a>01785     <span class="comment">// screen-reader users. Make the heading invisible with .element-invisible.</span>
<a name="l01786"></a>01786     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = <span class="stringliteral">&#39;&lt;h2 class=&quot;element-invisible&quot;&gt;&#39;</span> . <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;You are here&#39;</span>) . <span class="stringliteral">&#39;&lt;/h2&gt;&#39;</span>;
<a name="l01787"></a>01787 
<a name="l01788"></a>01788     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39;&lt;div class=&quot;breadcrumb&quot;&gt;&#39;</span> . implode(<span class="stringliteral">&#39;  &#39;</span>, $breadcrumb) . <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;
<a name="l01789"></a>01789     <span class="keywordflow">return</span> <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a>;
<a name="l01790"></a>01790   }
<a name="l01791"></a>01791 }
<a name="l01792"></a>01792 
<a name="l01868"></a><a class="code" href="group__themeable_ga9e35aa108c35f87b588197138a51823d.html#ga9e35aa108c35f87b588197138a51823d">01868</a> <span class="keyword">function</span> <a class="code" href="group__themeable_ga9e35aa108c35f87b588197138a51823d.html#ga9e35aa108c35f87b588197138a51823d" title="Returns HTML for a table.">theme_table</a>($variables) {
<a name="l01869"></a>01869   $header = $variables[<span class="stringliteral">&#39;header&#39;</span>];
<a name="l01870"></a>01870   $rows = $variables[<span class="stringliteral">&#39;rows&#39;</span>];
<a name="l01871"></a>01871   $attributes = $variables[<span class="stringliteral">&#39;attributes&#39;</span>];
<a name="l01872"></a>01872   $caption = $variables[<span class="stringliteral">&#39;caption&#39;</span>];
<a name="l01873"></a>01873   $colgroups = $variables[<span class="stringliteral">&#39;colgroups&#39;</span>];
<a name="l01874"></a>01874   $sticky = $variables[<span class="stringliteral">&#39;sticky&#39;</span>];
<a name="l01875"></a>01875   $empty = $variables[<span class="stringliteral">&#39;empty&#39;</span>];
<a name="l01876"></a>01876 
<a name="l01877"></a>01877   <span class="comment">// Add sticky headers, if applicable.</span>
<a name="l01878"></a>01878   <span class="keywordflow">if</span> (count($header) &amp;&amp; $sticky) {
<a name="l01879"></a>01879     <a class="code" href="common_8inc_a623370a2c3c2de0390dab078d17dca02.html#a623370a2c3c2de0390dab078d17dca02" title="Adds a JavaScript file, setting, or inline code to the page.">drupal_add_js</a>(<span class="stringliteral">&#39;misc/tableheader.js&#39;</span>);
<a name="l01880"></a>01880     <span class="comment">// Add &#39;sticky-enabled&#39; class to the table to identify it for JS.</span>
<a name="l01881"></a>01881     <span class="comment">// This is needed to target tables constructed by this function.</span>
<a name="l01882"></a>01882     $attributes[<span class="stringliteral">&#39;class&#39;</span>][] = <span class="stringliteral">&#39;sticky-enabled&#39;</span>;
<a name="l01883"></a>01883   }
<a name="l01884"></a>01884 
<a name="l01885"></a>01885   <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = <span class="stringliteral">&#39;&lt;table&#39;</span> . <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>($attributes) . <span class="stringliteral">&quot;&gt;\n&quot;</span>;
<a name="l01886"></a>01886 
<a name="l01887"></a>01887   <span class="keywordflow">if</span> (isset($caption)) {
<a name="l01888"></a>01888     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39;&lt;caption&gt;&#39;</span> . $caption . <span class="stringliteral">&quot;&lt;/caption&gt;\n&quot;</span>;
<a name="l01889"></a>01889   }
<a name="l01890"></a>01890 
<a name="l01891"></a>01891   <span class="comment">// Format the table columns:</span>
<a name="l01892"></a>01892   <span class="keywordflow">if</span> (count($colgroups)) {
<a name="l01893"></a>01893     <span class="keywordflow">foreach</span> ($colgroups as $number =&gt; $colgroup) {
<a name="l01894"></a>01894       $attributes = array();
<a name="l01895"></a>01895 
<a name="l01896"></a>01896       <span class="comment">// Check if we&#39;re dealing with a simple or complex column</span>
<a name="l01897"></a>01897       <span class="keywordflow">if</span> (isset($colgroup[<span class="stringliteral">&#39;data&#39;</span>])) {
<a name="l01898"></a>01898         <span class="keywordflow">foreach</span> ($colgroup as $key =&gt; $value) {
<a name="l01899"></a>01899           <span class="keywordflow">if</span> ($key == <span class="stringliteral">&#39;data&#39;</span>) {
<a name="l01900"></a>01900             $cols = $value;
<a name="l01901"></a>01901           }
<a name="l01902"></a>01902           <span class="keywordflow">else</span> {
<a name="l01903"></a>01903             $attributes[$key] = $value;
<a name="l01904"></a>01904           }
<a name="l01905"></a>01905         }
<a name="l01906"></a>01906       }
<a name="l01907"></a>01907       <span class="keywordflow">else</span> {
<a name="l01908"></a>01908         $cols = $colgroup;
<a name="l01909"></a>01909       }
<a name="l01910"></a>01910 
<a name="l01911"></a>01911       <span class="comment">// Build colgroup</span>
<a name="l01912"></a>01912       <span class="keywordflow">if</span> (is_array($cols) &amp;&amp; count($cols)) {
<a name="l01913"></a>01913         <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39; &lt;colgroup&#39;</span> . <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>($attributes) . <span class="charliteral">&#39;&gt;&#39;</span>;
<a name="l01914"></a>01914         $i = 0;
<a name="l01915"></a>01915         <span class="keywordflow">foreach</span> ($cols as $col) {
<a name="l01916"></a>01916           <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39; &lt;col&#39;</span> . <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>($col) . <span class="stringliteral">&#39; /&gt;&#39;</span>;
<a name="l01917"></a>01917         }
<a name="l01918"></a>01918         <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&quot; &lt;/colgroup&gt;\n&quot;</span>;
<a name="l01919"></a>01919       }
<a name="l01920"></a>01920       <span class="keywordflow">else</span> {
<a name="l01921"></a>01921         <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39; &lt;colgroup&#39;</span> . <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>($attributes) . <span class="stringliteral">&quot; /&gt;\n&quot;</span>;
<a name="l01922"></a>01922       }
<a name="l01923"></a>01923     }
<a name="l01924"></a>01924   }
<a name="l01925"></a>01925 
<a name="l01926"></a>01926   <span class="comment">// Add the &#39;empty&#39; row message if available.</span>
<a name="l01927"></a>01927   <span class="keywordflow">if</span> (!count($rows) &amp;&amp; $empty) {
<a name="l01928"></a>01928     $header_count = 0;
<a name="l01929"></a>01929     <span class="keywordflow">foreach</span> ($header as $header_cell) {
<a name="l01930"></a>01930       <span class="keywordflow">if</span> (is_array($header_cell)) {
<a name="l01931"></a>01931         $header_count += isset($header_cell[<span class="stringliteral">&#39;colspan&#39;</span>]) ? $header_cell[<span class="stringliteral">&#39;colspan&#39;</span>] : 1;
<a name="l01932"></a>01932       }
<a name="l01933"></a>01933       <span class="keywordflow">else</span> {
<a name="l01934"></a>01934         $header_count++;
<a name="l01935"></a>01935       }
<a name="l01936"></a>01936     }
<a name="l01937"></a>01937     $rows[] = array(array(<span class="stringliteral">&#39;data&#39;</span> =&gt; $empty, <span class="stringliteral">&#39;colspan&#39;</span> =&gt; $header_count, <span class="stringliteral">&#39;class&#39;</span> =&gt; array(<span class="stringliteral">&#39;empty&#39;</span>, <span class="stringliteral">&#39;message&#39;</span>)));
<a name="l01938"></a>01938   }
<a name="l01939"></a>01939 
<a name="l01940"></a>01940   <span class="comment">// Format the table header:</span>
<a name="l01941"></a>01941   <span class="keywordflow">if</span> (count($header)) {
<a name="l01942"></a>01942     $ts = <a class="code" href="tablesort_8inc_afee7fc97d83c8e51399e9b41ccbae927.html#afee7fc97d83c8e51399e9b41ccbae927" title="Initialize the table sort context.">tablesort_init</a>($header);
<a name="l01943"></a>01943     <span class="comment">// HTML requires that the thead tag has tr tags in it followed by tbody</span>
<a name="l01944"></a>01944     <span class="comment">// tags. Using ternary operator to check and see if we have any rows.</span>
<a name="l01945"></a>01945     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= (count($rows) ? <span class="stringliteral">&#39; &lt;thead&gt;&lt;tr&gt;&#39;</span> : <span class="stringliteral">&#39; &lt;tr&gt;&#39;</span>);
<a name="l01946"></a>01946     <span class="keywordflow">foreach</span> ($header as $cell) {
<a name="l01947"></a>01947       $cell = <a class="code" href="tablesort_8inc_a9c93c8e235c5013f0f494ba207ec1bdf.html#a9c93c8e235c5013f0f494ba207ec1bdf" title="Format a column header.">tablesort_header</a>($cell, $header, $ts);
<a name="l01948"></a>01948       <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <a class="code" href="theme_8inc_adf2a29e2c6631b7c0ecd833cafda9b40.html#adf2a29e2c6631b7c0ecd833cafda9b40" title="End of &quot;addtogroup themeable&quot;.">_theme_table_cell</a>($cell, TRUE);
<a name="l01949"></a>01949     }
<a name="l01950"></a>01950     <span class="comment">// Using ternary operator to close the tags based on whether or not there are rows</span>
<a name="l01951"></a>01951     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= (count($rows) ? <span class="stringliteral">&quot; &lt;/tr&gt;&lt;/thead&gt;\n&quot;</span> : <span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l01952"></a>01952   }
<a name="l01953"></a>01953   <span class="keywordflow">else</span> {
<a name="l01954"></a>01954     $ts = array();
<a name="l01955"></a>01955   }
<a name="l01956"></a>01956 
<a name="l01957"></a>01957   <span class="comment">// Format the table rows:</span>
<a name="l01958"></a>01958   <span class="keywordflow">if</span> (count($rows)) {
<a name="l01959"></a>01959     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&quot;&lt;tbody&gt;\n&quot;</span>;
<a name="l01960"></a>01960     $flip = array(<span class="stringliteral">&#39;even&#39;</span> =&gt; <span class="stringliteral">&#39;odd&#39;</span>, <span class="stringliteral">&#39;odd&#39;</span> =&gt; <span class="stringliteral">&#39;even&#39;</span>);
<a name="l01961"></a>01961     $class = <span class="stringliteral">&#39;even&#39;</span>;
<a name="l01962"></a>01962     <span class="keywordflow">foreach</span> ($rows as $number =&gt; $row) {
<a name="l01963"></a>01963       $attributes = array();
<a name="l01964"></a>01964 
<a name="l01965"></a>01965       <span class="comment">// Check if we&#39;re dealing with a simple or complex row</span>
<a name="l01966"></a>01966       <span class="keywordflow">if</span> (isset($row[<span class="stringliteral">&#39;data&#39;</span>])) {
<a name="l01967"></a>01967         <span class="keywordflow">foreach</span> ($row as $key =&gt; $value) {
<a name="l01968"></a>01968           <span class="keywordflow">if</span> ($key == <span class="stringliteral">&#39;data&#39;</span>) {
<a name="l01969"></a>01969             $cells = $value;
<a name="l01970"></a>01970           }
<a name="l01971"></a>01971           <span class="keywordflow">else</span> {
<a name="l01972"></a>01972             $attributes[$key] = $value;
<a name="l01973"></a>01973           }
<a name="l01974"></a>01974         }
<a name="l01975"></a>01975       }
<a name="l01976"></a>01976       <span class="keywordflow">else</span> {
<a name="l01977"></a>01977         $cells = $row;
<a name="l01978"></a>01978       }
<a name="l01979"></a>01979       <span class="keywordflow">if</span> (count($cells)) {
<a name="l01980"></a>01980         <span class="comment">// Add odd/even class</span>
<a name="l01981"></a>01981         <span class="keywordflow">if</span> (empty($row[<span class="stringliteral">&#39;no_striping&#39;</span>])) {
<a name="l01982"></a>01982           $class = $flip[$class];
<a name="l01983"></a>01983           $attributes[<span class="stringliteral">&#39;class&#39;</span>][] = $class;
<a name="l01984"></a>01984         }
<a name="l01985"></a>01985 
<a name="l01986"></a>01986         <span class="comment">// Build row</span>
<a name="l01987"></a>01987         <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39; &lt;tr&#39;</span> . <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>($attributes) . <span class="charliteral">&#39;&gt;&#39;</span>;
<a name="l01988"></a>01988         $i = 0;
<a name="l01989"></a>01989         <span class="keywordflow">foreach</span> ($cells as $cell) {
<a name="l01990"></a>01990           $cell = <a class="code" href="tablesort_8inc_a32db61218906caa4bd22dffeb6bd5e00.html#a32db61218906caa4bd22dffeb6bd5e00" title="Format a table cell.">tablesort_cell</a>($cell, $header, $ts, $i++);
<a name="l01991"></a>01991           <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <a class="code" href="theme_8inc_adf2a29e2c6631b7c0ecd833cafda9b40.html#adf2a29e2c6631b7c0ecd833cafda9b40" title="End of &quot;addtogroup themeable&quot;.">_theme_table_cell</a>($cell);
<a name="l01992"></a>01992         }
<a name="l01993"></a>01993         <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&quot; &lt;/tr&gt;\n&quot;</span>;
<a name="l01994"></a>01994       }
<a name="l01995"></a>01995     }
<a name="l01996"></a>01996     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&quot;&lt;/tbody&gt;\n&quot;</span>;
<a name="l01997"></a>01997   }
<a name="l01998"></a>01998 
<a name="l01999"></a>01999   <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>;
<a name="l02000"></a>02000   <span class="keywordflow">return</span> <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a>;
<a name="l02001"></a>02001 }
<a name="l02002"></a>02002 
<a name="l02010"></a><a class="code" href="group__themeable_ga06cbe52fad2dac8196f8c89118c3975d.html#ga06cbe52fad2dac8196f8c89118c3975d">02010</a> <span class="keyword">function</span> <a class="code" href="group__themeable_ga06cbe52fad2dac8196f8c89118c3975d.html#ga06cbe52fad2dac8196f8c89118c3975d" title="Returns HTML for a sort icon.">theme_tablesort_indicator</a>($variables) {
<a name="l02011"></a>02011   <span class="keywordflow">if</span> ($variables[<span class="stringliteral">&#39;style&#39;</span>] == <span class="stringliteral">&quot;asc&quot;</span>) {
<a name="l02012"></a>02012     <span class="keywordflow">return</span> <a class="code" href="theme_8inc_a7c25609a935874541a19657affd30fff.html#a7c25609a935874541a19657affd30fff" title="Generates themed output.">theme</a>(<span class="stringliteral">&#39;image&#39;</span>, array(<span class="stringliteral">&#39;path&#39;</span> =&gt; <span class="stringliteral">&#39;misc/arrow-asc.png&#39;</span>, <span class="stringliteral">&#39;width&#39;</span> =&gt; 13, <span class="stringliteral">&#39;height&#39;</span> =&gt; 13, <span class="stringliteral">&#39;alt&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;sort ascending&#39;</span>), <span class="stringliteral">&#39;title&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;sort ascending&#39;</span>)));
<a name="l02013"></a>02013   }
<a name="l02014"></a>02014   <span class="keywordflow">else</span> {
<a name="l02015"></a>02015     <span class="keywordflow">return</span> <a class="code" href="theme_8inc_a7c25609a935874541a19657affd30fff.html#a7c25609a935874541a19657affd30fff" title="Generates themed output.">theme</a>(<span class="stringliteral">&#39;image&#39;</span>, array(<span class="stringliteral">&#39;path&#39;</span> =&gt; <span class="stringliteral">&#39;misc/arrow-desc.png&#39;</span>, <span class="stringliteral">&#39;width&#39;</span> =&gt; 13, <span class="stringliteral">&#39;height&#39;</span> =&gt; 13, <span class="stringliteral">&#39;alt&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;sort descending&#39;</span>), <span class="stringliteral">&#39;title&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;sort descending&#39;</span>)));
<a name="l02016"></a>02016   }
<a name="l02017"></a>02017 }
<a name="l02018"></a>02018 
<a name="l02027"></a><a class="code" href="group__themeable_ga10b9e641d13efcf0ed3e55fd03bc4f54.html#ga10b9e641d13efcf0ed3e55fd03bc4f54">02027</a> <span class="keyword">function</span> <a class="code" href="group__themeable_ga10b9e641d13efcf0ed3e55fd03bc4f54.html#ga10b9e641d13efcf0ed3e55fd03bc4f54" title="Returns HTML for a marker for new or updated content.">theme_mark</a>($variables) {
<a name="l02028"></a>02028   $type = $variables[<span class="stringliteral">&#39;type&#39;</span>];
<a name="l02029"></a>02029   global $user;
<a name="l02030"></a>02030   <span class="keywordflow">if</span> ($user-&gt;uid) {
<a name="l02031"></a>02031     <span class="keywordflow">if</span> ($type == <a class="code" href="group__content__flags_ga44d42cbfa50b553ad2439e19478d0d3d.html#ga44d42cbfa50b553ad2439e19478d0d3d" title="Mark content as being new.">MARK_NEW</a>) {
<a name="l02032"></a>02032       <span class="keywordflow">return</span> <span class="stringliteral">&#39; &lt;span class=&quot;marker&quot;&gt;&#39;</span> . <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;new&#39;</span>) . <span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;
<a name="l02033"></a>02033     }
<a name="l02034"></a>02034     elseif ($type == <a class="code" href="group__content__flags_ga6e9f0d9282433b9f08f025aaca43e1fe.html#ga6e9f0d9282433b9f08f025aaca43e1fe" title="Mark content as being updated.">MARK_UPDATED</a>) {
<a name="l02035"></a>02035       <span class="keywordflow">return</span> <span class="stringliteral">&#39; &lt;span class=&quot;marker&quot;&gt;&#39;</span> . <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;updated&#39;</span>) . <span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;
<a name="l02036"></a>02036     }
<a name="l02037"></a>02037   }
<a name="l02038"></a>02038 }
<a name="l02039"></a>02039 
<a name="l02055"></a><a class="code" href="group__themeable_ga515afdc4832483a813cd09ba4786fdfe.html#ga515afdc4832483a813cd09ba4786fdfe">02055</a> <span class="keyword">function</span> <a class="code" href="group__themeable_ga515afdc4832483a813cd09ba4786fdfe.html#ga515afdc4832483a813cd09ba4786fdfe" title="Returns HTML for a list or nested list of items.">theme_item_list</a>($variables) {
<a name="l02056"></a>02056   $items = $variables[<span class="stringliteral">&#39;items&#39;</span>];
<a name="l02057"></a>02057   $title = $variables[<span class="stringliteral">&#39;title&#39;</span>];
<a name="l02058"></a>02058   $type = $variables[<span class="stringliteral">&#39;type&#39;</span>];
<a name="l02059"></a>02059   $attributes = $variables[<span class="stringliteral">&#39;attributes&#39;</span>];
<a name="l02060"></a>02060 
<a name="l02061"></a>02061   <span class="comment">// Only output the list container and title, if there are any list items.</span>
<a name="l02062"></a>02062   <span class="comment">// Check to see whether the block title exists before adding a header.</span>
<a name="l02063"></a>02063   <span class="comment">// Empty headers are not semantic and present accessibility challenges.</span>
<a name="l02064"></a>02064   <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = <span class="stringliteral">&#39;&lt;div class=&quot;item-list&quot;&gt;&#39;</span>;
<a name="l02065"></a>02065   <span class="keywordflow">if</span> (isset($title) &amp;&amp; $title !== <span class="stringliteral">&#39;&#39;</span>) {
<a name="l02066"></a>02066     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39;&lt;h3&gt;&#39;</span> . $title . <span class="stringliteral">&#39;&lt;/h3&gt;&#39;</span>;
<a name="l02067"></a>02067   }
<a name="l02068"></a>02068 
<a name="l02069"></a>02069   <span class="keywordflow">if</span> (!empty($items)) {
<a name="l02070"></a>02070     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&quot;&lt;$type&quot;</span> . <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>($attributes) . <span class="charliteral">&#39;&gt;&#39;</span>;
<a name="l02071"></a>02071     $num_items = count($items);
<a name="l02072"></a>02072     <span class="keywordflow">foreach</span> ($items as $i =&gt; $item) {
<a name="l02073"></a>02073       $attributes = array();
<a name="l02074"></a>02074       $children = array();
<a name="l02075"></a>02075       $data = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02076"></a>02076       <span class="keywordflow">if</span> (is_array($item)) {
<a name="l02077"></a>02077         <span class="keywordflow">foreach</span> ($item as $key =&gt; $value) {
<a name="l02078"></a>02078           <span class="keywordflow">if</span> ($key == <span class="stringliteral">&#39;data&#39;</span>) {
<a name="l02079"></a>02079             $data = $value;
<a name="l02080"></a>02080           }
<a name="l02081"></a>02081           elseif ($key == <span class="stringliteral">&#39;children&#39;</span>) {
<a name="l02082"></a>02082             $children = $value;
<a name="l02083"></a>02083           }
<a name="l02084"></a>02084           <span class="keywordflow">else</span> {
<a name="l02085"></a>02085             $attributes[$key] = $value;
<a name="l02086"></a>02086           }
<a name="l02087"></a>02087         }
<a name="l02088"></a>02088       }
<a name="l02089"></a>02089       <span class="keywordflow">else</span> {
<a name="l02090"></a>02090         $data = $item;
<a name="l02091"></a>02091       }
<a name="l02092"></a>02092       <span class="keywordflow">if</span> (count($children) &gt; 0) {
<a name="l02093"></a>02093         <span class="comment">// Render nested list.</span>
<a name="l02094"></a>02094         $data .= <a class="code" href="group__themeable_ga515afdc4832483a813cd09ba4786fdfe.html#ga515afdc4832483a813cd09ba4786fdfe" title="Returns HTML for a list or nested list of items.">theme_item_list</a>(array(<span class="stringliteral">&#39;items&#39;</span> =&gt; $children, <span class="stringliteral">&#39;title&#39;</span> =&gt; NULL, <span class="stringliteral">&#39;type&#39;</span> =&gt; $type, <span class="stringliteral">&#39;attributes&#39;</span> =&gt; $attributes));
<a name="l02095"></a>02095       }
<a name="l02096"></a>02096       <span class="keywordflow">if</span> ($i == 0) {
<a name="l02097"></a>02097         $attributes[<span class="stringliteral">&#39;class&#39;</span>][] = <span class="stringliteral">&#39;first&#39;</span>;
<a name="l02098"></a>02098       }
<a name="l02099"></a>02099       <span class="keywordflow">if</span> ($i == $num_items - 1) {
<a name="l02100"></a>02100         $attributes[<span class="stringliteral">&#39;class&#39;</span>][] = <span class="stringliteral">&#39;last&#39;</span>;
<a name="l02101"></a>02101       }
<a name="l02102"></a>02102       <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39;&lt;li&#39;</span> . <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>($attributes) . <span class="charliteral">&#39;&gt;&#39;</span> . $data . <span class="stringliteral">&quot;&lt;/li&gt;\n&quot;</span>;
<a name="l02103"></a>02103     }
<a name="l02104"></a>02104     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&quot;&lt;/$type&gt;&quot;</span>;
<a name="l02105"></a>02105   }
<a name="l02106"></a>02106   <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;
<a name="l02107"></a>02107   <span class="keywordflow">return</span> <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a>;
<a name="l02108"></a>02108 }
<a name="l02109"></a>02109 
<a name="l02117"></a><a class="code" href="group__themeable_ga59ab4d425ab4c43d94c26538fbe3e9aa.html#ga59ab4d425ab4c43d94c26538fbe3e9aa">02117</a> <span class="keyword">function</span> <a class="code" href="group__themeable_ga59ab4d425ab4c43d94c26538fbe3e9aa.html#ga59ab4d425ab4c43d94c26538fbe3e9aa" title="Returns HTML for a &quot;more help&quot; link.">theme_more_help_link</a>($variables) {
<a name="l02118"></a>02118   <span class="keywordflow">return</span> <span class="stringliteral">&#39;&lt;div class=&quot;more-help-link&quot;&gt;&#39;</span> . <a class="code" href="common_8inc_ad3b36c06dc46250b8d22b8d0d2e7bd97.html#ad3b36c06dc46250b8d22b8d0d2e7bd97" title="Formats an internal or external URL link as an HTML anchor tag.">l</a>(<a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;More help&#39;</span>), $variables[<span class="stringliteral">&#39;url&#39;</span>]) . <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;
<a name="l02119"></a>02119 }
<a name="l02120"></a>02120 
<a name="l02130"></a><a class="code" href="group__themeable_gaf7ed9df27bf344443ce927e3650adfbd.html#gaf7ed9df27bf344443ce927e3650adfbd">02130</a> <span class="keyword">function</span> <a class="code" href="group__themeable_gaf7ed9df27bf344443ce927e3650adfbd.html#gaf7ed9df27bf344443ce927e3650adfbd" title="Returns HTML for a feed icon.">theme_feed_icon</a>($variables) {
<a name="l02131"></a>02131   $text = <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;Subscribe to @feed-title&#39;</span>, array(<span class="stringliteral">&#39;@feed-title&#39;</span> =&gt; $variables[<span class="stringliteral">&#39;title&#39;</span>]));
<a name="l02132"></a>02132   <span class="keywordflow">if</span> ($image = <a class="code" href="theme_8inc_a7c25609a935874541a19657affd30fff.html#a7c25609a935874541a19657affd30fff" title="Generates themed output.">theme</a>(<span class="stringliteral">&#39;image&#39;</span>, array(<span class="stringliteral">&#39;path&#39;</span> =&gt; <span class="stringliteral">&#39;misc/feed.png&#39;</span>, <span class="stringliteral">&#39;width&#39;</span> =&gt; 16, <span class="stringliteral">&#39;height&#39;</span> =&gt; 16, <span class="stringliteral">&#39;alt&#39;</span> =&gt; $text))) {
<a name="l02133"></a>02133     <span class="keywordflow">return</span> <a class="code" href="common_8inc_ad3b36c06dc46250b8d22b8d0d2e7bd97.html#ad3b36c06dc46250b8d22b8d0d2e7bd97" title="Formats an internal or external URL link as an HTML anchor tag.">l</a>($image, $variables[<span class="stringliteral">&#39;url&#39;</span>], array(<span class="stringliteral">&#39;html&#39;</span> =&gt; TRUE, <span class="stringliteral">&#39;attributes&#39;</span> =&gt; array(<span class="stringliteral">&#39;class&#39;</span> =&gt; array(<span class="stringliteral">&#39;feed-icon&#39;</span>), <span class="stringliteral">&#39;title&#39;</span> =&gt; $text)));
<a name="l02134"></a>02134   }
<a name="l02135"></a>02135 }
<a name="l02136"></a>02136 
<a name="l02155"></a><a class="code" href="group__themeable_ga553aba4a879c7a0b01a85486ca0cea33.html#ga553aba4a879c7a0b01a85486ca0cea33">02155</a> <span class="keyword">function</span> <a class="code" href="group__themeable_ga553aba4a879c7a0b01a85486ca0cea33.html#ga553aba4a879c7a0b01a85486ca0cea33" title="Returns HTML for a generic HTML tag with attributes.">theme_html_tag</a>($variables) {
<a name="l02156"></a>02156   $element = $variables[<span class="stringliteral">&#39;element&#39;</span>];
<a name="l02157"></a>02157   $attributes = isset($element[<span class="stringliteral">&#39;#attributes&#39;</span>]) ? <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>($element[<span class="stringliteral">&#39;#attributes&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l02158"></a>02158   <span class="keywordflow">if</span> (!isset($element[<span class="stringliteral">&#39;#value&#39;</span>])) {
<a name="l02159"></a>02159     <span class="keywordflow">return</span> <span class="charliteral">&#39;&lt;&#39;</span> . $element[<span class="stringliteral">&#39;#tag&#39;</span>] . $attributes . <span class="stringliteral">&quot; /&gt;\n&quot;</span>;
<a name="l02160"></a>02160   }
<a name="l02161"></a>02161   <span class="keywordflow">else</span> {
<a name="l02162"></a>02162     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = <span class="charliteral">&#39;&lt;&#39;</span> . $element[<span class="stringliteral">&#39;#tag&#39;</span>] . $attributes . <span class="charliteral">&#39;&gt;&#39;</span>;
<a name="l02163"></a>02163     <span class="keywordflow">if</span> (isset($element[<span class="stringliteral">&#39;#value_prefix&#39;</span>])) {
<a name="l02164"></a>02164       <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= $element[<span class="stringliteral">&#39;#value_prefix&#39;</span>];
<a name="l02165"></a>02165     }
<a name="l02166"></a>02166     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= $element[<span class="stringliteral">&#39;#value&#39;</span>];
<a name="l02167"></a>02167     <span class="keywordflow">if</span> (isset($element[<span class="stringliteral">&#39;#value_suffix&#39;</span>])) {
<a name="l02168"></a>02168       <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= $element[<span class="stringliteral">&#39;#value_suffix&#39;</span>];
<a name="l02169"></a>02169     }
<a name="l02170"></a>02170     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39;&lt;/&#39;</span> . $element[<span class="stringliteral">&#39;#tag&#39;</span>] . <span class="stringliteral">&quot;&gt;\n&quot;</span>;
<a name="l02171"></a>02171     <span class="keywordflow">return</span> <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a>;
<a name="l02172"></a>02172   }
<a name="l02173"></a>02173 }
<a name="l02174"></a>02174 
<a name="l02183"></a><a class="code" href="group__themeable_ga1f35c4f1e512ae423df22c7a33edf043.html#ga1f35c4f1e512ae423df22c7a33edf043">02183</a> <span class="keyword">function</span> <a class="code" href="group__themeable_ga1f35c4f1e512ae423df22c7a33edf043.html#ga1f35c4f1e512ae423df22c7a33edf043" title="Returns HTML for a &quot;more&quot; link, like those used in blocks.">theme_more_link</a>($variables) {
<a name="l02184"></a>02184   <span class="keywordflow">return</span> <span class="stringliteral">&#39;&lt;div class=&quot;more-link&quot;&gt;&#39;</span> . <a class="code" href="common_8inc_ad3b36c06dc46250b8d22b8d0d2e7bd97.html#ad3b36c06dc46250b8d22b8d0d2e7bd97" title="Formats an internal or external URL link as an HTML anchor tag.">l</a>(<a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;More&#39;</span>), $variables[<span class="stringliteral">&#39;url&#39;</span>], array(<span class="stringliteral">&#39;attributes&#39;</span> =&gt; array(<span class="stringliteral">&#39;title&#39;</span> =&gt; $variables[<span class="stringliteral">&#39;title&#39;</span>]))) . <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;
<a name="l02185"></a>02185 }
<a name="l02186"></a>02186 
<a name="l02205"></a><a class="code" href="group__themeable_ga94b6d36f659ae6bf42e7971682cd24eb.html#ga94b6d36f659ae6bf42e7971682cd24eb">02205</a> <span class="keyword">function</span> <a class="code" href="group__themeable_ga94b6d36f659ae6bf42e7971682cd24eb.html#ga94b6d36f659ae6bf42e7971682cd24eb" title="Returns HTML for a username, potentially linked to the user&#39;s page.">theme_username</a>($variables) {
<a name="l02206"></a>02206   <span class="keywordflow">if</span> (isset($variables[<span class="stringliteral">&#39;link_path&#39;</span>])) {
<a name="l02207"></a>02207     <span class="comment">// We have a link path, so we should generate a link using l().</span>
<a name="l02208"></a>02208     <span class="comment">// Additional classes may be added as array elements like</span>
<a name="l02209"></a>02209     <span class="comment">// $variables[&#39;link_options&#39;][&#39;attributes&#39;][&#39;class&#39;][] = &#39;myclass&#39;;</span>
<a name="l02210"></a>02210     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = <a class="code" href="common_8inc_ad3b36c06dc46250b8d22b8d0d2e7bd97.html#ad3b36c06dc46250b8d22b8d0d2e7bd97" title="Formats an internal or external URL link as an HTML anchor tag.">l</a>($variables[<span class="stringliteral">&#39;name&#39;</span>] . $variables[<span class="stringliteral">&#39;extra&#39;</span>], $variables[<span class="stringliteral">&#39;link_path&#39;</span>], $variables[<span class="stringliteral">&#39;link_options&#39;</span>]);
<a name="l02211"></a>02211   }
<a name="l02212"></a>02212   <span class="keywordflow">else</span> {
<a name="l02213"></a>02213     <span class="comment">// Modules may have added important attributes so they must be included</span>
<a name="l02214"></a>02214     <span class="comment">// in the output. Additional classes may be added as array elements like</span>
<a name="l02215"></a>02215     <span class="comment">// $variables[&#39;attributes_array&#39;][&#39;class&#39;][] = &#39;myclass&#39;;</span>
<a name="l02216"></a>02216     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = <span class="stringliteral">&#39;&lt;span&#39;</span> . <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>($variables[<span class="stringliteral">&#39;attributes_array&#39;</span>]) . <span class="charliteral">&#39;&gt;&#39;</span> . $variables[<span class="stringliteral">&#39;name&#39;</span>] . $variables[<span class="stringliteral">&#39;extra&#39;</span>] . <span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;
<a name="l02217"></a>02217   }
<a name="l02218"></a>02218   <span class="keywordflow">return</span> <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a>;
<a name="l02219"></a>02219 }
<a name="l02220"></a>02220 
<a name="l02231"></a><a class="code" href="group__themeable_ga9892ce57f458f8e372fb04b7a05bbc73.html#ga9892ce57f458f8e372fb04b7a05bbc73">02231</a> <span class="keyword">function</span> <a class="code" href="group__themeable_ga9892ce57f458f8e372fb04b7a05bbc73.html#ga9892ce57f458f8e372fb04b7a05bbc73" title="Returns HTML for a progress bar.">theme_progress_bar</a>($variables) {
<a name="l02232"></a>02232   <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = <span class="stringliteral">&#39;&lt;div id=&quot;progress&quot; class=&quot;progress&quot;&gt;&#39;</span>;
<a name="l02233"></a>02233   <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39;&lt;div class=&quot;bar&quot;&gt;&lt;div class=&quot;filled&quot; style=&quot;width: &#39;</span> . $variables[<span class="stringliteral">&#39;percent&#39;</span>] . <span class="stringliteral">&#39;%&quot;&gt;&lt;/div&gt;&lt;/div&gt;&#39;</span>;
<a name="l02234"></a>02234   <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39;&lt;div class=&quot;percentage&quot;&gt;&#39;</span> . $variables[<span class="stringliteral">&#39;percent&#39;</span>] . <span class="stringliteral">&#39;%&lt;/div&gt;&#39;</span>;
<a name="l02235"></a>02235   <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39;&lt;div class=&quot;message&quot;&gt;&#39;</span> . $variables[<span class="stringliteral">&#39;message&#39;</span>] . <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;
<a name="l02236"></a>02236   <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39;&lt;/div&gt;&#39;</span>;
<a name="l02237"></a>02237 
<a name="l02238"></a>02238   <span class="keywordflow">return</span> <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a>;
<a name="l02239"></a>02239 }
<a name="l02240"></a>02240 
<a name="l02248"></a><a class="code" href="group__themeable_ga045159ba9e2be46a91a8883328963b2c.html#ga045159ba9e2be46a91a8883328963b2c">02248</a> <span class="keyword">function</span> <a class="code" href="group__themeable_ga045159ba9e2be46a91a8883328963b2c.html#ga045159ba9e2be46a91a8883328963b2c" title="Returns HTML for an indentation div; used for drag and drop tables.">theme_indentation</a>($variables) {
<a name="l02249"></a>02249   <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02250"></a>02250   <span class="keywordflow">for</span> ($n = 0; $n &lt; $variables[<span class="stringliteral">&#39;size&#39;</span>]; $n++) {
<a name="l02251"></a>02251     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39;&lt;div class=&quot;indentation&quot;&gt;&amp;nbsp;&lt;/div&gt;&#39;</span>;
<a name="l02252"></a>02252   }
<a name="l02253"></a>02253   <span class="keywordflow">return</span> <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a>;
<a name="l02254"></a>02254 }
<a name="l02255"></a>02255 
<a name="l02273"></a><a class="code" href="theme_8inc_adf2a29e2c6631b7c0ecd833cafda9b40.html#adf2a29e2c6631b7c0ecd833cafda9b40">02273</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_adf2a29e2c6631b7c0ecd833cafda9b40.html#adf2a29e2c6631b7c0ecd833cafda9b40" title="End of &quot;addtogroup themeable&quot;.">_theme_table_cell</a>($cell, $header = FALSE) {
<a name="l02274"></a>02274   $attributes = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02275"></a>02275 
<a name="l02276"></a>02276   <span class="keywordflow">if</span> (is_array($cell)) {
<a name="l02277"></a>02277     $data = isset($cell[<span class="stringliteral">&#39;data&#39;</span>]) ? $cell[<span class="stringliteral">&#39;data&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>;
<a name="l02278"></a>02278     <span class="comment">// Cell&#39;s data property can be a string or a renderable array.</span>
<a name="l02279"></a>02279     <span class="keywordflow">if</span> (is_array($data)) {
<a name="l02280"></a>02280       $data = <a class="code" href="common_8inc_a05798b44e8d6c496d4bee5cc32fa7851.html#a05798b44e8d6c496d4bee5cc32fa7851" title="Renders HTML given a structured array tree.">drupal_render</a>($data);
<a name="l02281"></a>02281     }
<a name="l02282"></a>02282     $header |= isset($cell[<span class="stringliteral">&#39;header&#39;</span>]);
<a name="l02283"></a>02283     unset($cell[<span class="stringliteral">&#39;data&#39;</span>]);
<a name="l02284"></a>02284     unset($cell[<span class="stringliteral">&#39;header&#39;</span>]);
<a name="l02285"></a>02285     $attributes = <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>($cell);
<a name="l02286"></a>02286   }
<a name="l02287"></a>02287   <span class="keywordflow">else</span> {
<a name="l02288"></a>02288     $data = $cell;
<a name="l02289"></a>02289   }
<a name="l02290"></a>02290 
<a name="l02291"></a>02291   <span class="keywordflow">if</span> ($header) {
<a name="l02292"></a>02292     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = <span class="stringliteral">&quot;&lt;th$attributes&gt;$data&lt;/th&gt;&quot;</span>;
<a name="l02293"></a>02293   }
<a name="l02294"></a>02294   <span class="keywordflow">else</span> {
<a name="l02295"></a>02295     <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = <span class="stringliteral">&quot;&lt;td$attributes&gt;$data&lt;/td&gt;&quot;</span>;
<a name="l02296"></a>02296   }
<a name="l02297"></a>02297 
<a name="l02298"></a>02298   <span class="keywordflow">return</span> <a class="code" href="authorize_8php_a73004ce9cd673c1bfafd1dc351134797.html#a73004ce9cd673c1bfafd1dc351134797">$output</a>;
<a name="l02299"></a>02299 }
<a name="l02300"></a>02300 
<a name="l02313"></a><a class="code" href="theme_8inc_a3eeb7bcdba7ef4859f99586da264d347.html#a3eeb7bcdba7ef4859f99586da264d347">02313</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a3eeb7bcdba7ef4859f99586da264d347.html#a3eeb7bcdba7ef4859f99586da264d347" title="Adds a default set of helper variables for variable processors and templates.">template_preprocess</a>(&amp;$variables, $hook) {
<a name="l02314"></a>02314   global $user;
<a name="l02315"></a>02315   <span class="keyword">static</span> $count = array();
<a name="l02316"></a>02316 
<a name="l02317"></a>02317   <span class="comment">// Track run count for each hook to provide zebra striping.</span>
<a name="l02318"></a>02318   <span class="comment">// See &quot;template_preprocess_block()&quot; which provides the same feature specific to blocks.</span>
<a name="l02319"></a>02319   $count[$hook] = isset($count[$hook]) &amp;&amp; is_int($count[$hook]) ? $count[$hook] : 1;
<a name="l02320"></a>02320   $variables[<span class="stringliteral">&#39;zebra&#39;</span>] = ($count[$hook] % 2) ? <span class="stringliteral">&#39;odd&#39;</span> : <span class="stringliteral">&#39;even&#39;</span>;
<a name="l02321"></a>02321   $variables[<span class="stringliteral">&#39;id&#39;</span>] = $count[$hook]++;
<a name="l02322"></a>02322 
<a name="l02323"></a>02323   <span class="comment">// Tell all templates where they are located.</span>
<a name="l02324"></a>02324   $variables[<span class="stringliteral">&#39;directory&#39;</span>] = <a class="code" href="theme_8inc_a8fd73902b4d3a2d476e5b1324506b5e1.html#a8fd73902b4d3a2d476e5b1324506b5e1" title="Return the path to the current themed element.">path_to_theme</a>();
<a name="l02325"></a>02325 
<a name="l02326"></a>02326   <span class="comment">// Initialize html class attribute for the current hook.</span>
<a name="l02327"></a>02327   $variables[<span class="stringliteral">&#39;classes_array&#39;</span>] = array(<a class="code" href="common_8inc_aba9dd2b04e8c797c0f0edc9098cbbd48.html#aba9dd2b04e8c797c0f0edc9098cbbd48" title="Prepares a string for use as a valid class name.">drupal_html_class</a>($hook));
<a name="l02328"></a>02328 
<a name="l02329"></a>02329   <span class="comment">// Merge in variables that don&#39;t depend on hook and don&#39;t change during a</span>
<a name="l02330"></a>02330   <span class="comment">// single page request.</span>
<a name="l02331"></a>02331   <span class="comment">// Use the advanced drupal_static() pattern, since this is called very often.</span>
<a name="l02332"></a>02332   <span class="keyword">static</span> $drupal_static_fast;
<a name="l02333"></a>02333   <span class="keywordflow">if</span> (!isset($drupal_static_fast)) {
<a name="l02334"></a>02334     $drupal_static_fast[<span class="stringliteral">&#39;default_variables&#39;</span>] = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__);
<a name="l02335"></a>02335   }
<a name="l02336"></a>02336   $default_variables = &amp;$drupal_static_fast[<span class="stringliteral">&#39;default_variables&#39;</span>];
<a name="l02337"></a>02337   <span class="comment">// Global $user object shouldn&#39;t change during a page request once rendering</span>
<a name="l02338"></a>02338   <span class="comment">// has started, but if there&#39;s an edge case where it does, re-fetch the</span>
<a name="l02339"></a>02339   <span class="comment">// variables appropriate for the new user.</span>
<a name="l02340"></a>02340   <span class="keywordflow">if</span> (!isset($default_variables) || ($user !== $default_variables[<span class="stringliteral">&#39;user&#39;</span>])) {
<a name="l02341"></a>02341     $default_variables = <a class="code" href="theme_8inc_a1c517bff2855f9fb2b2949c66d1685db.html#a1c517bff2855f9fb2b2949c66d1685db" title="Returns hook-independent variables to template_preprocess().">_template_preprocess_default_variables</a>();
<a name="l02342"></a>02342   }
<a name="l02343"></a>02343   $variables += $default_variables;
<a name="l02344"></a>02344 }
<a name="l02345"></a>02345 
<a name="l02349"></a><a class="code" href="theme_8inc_a1c517bff2855f9fb2b2949c66d1685db.html#a1c517bff2855f9fb2b2949c66d1685db">02349</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a1c517bff2855f9fb2b2949c66d1685db.html#a1c517bff2855f9fb2b2949c66d1685db" title="Returns hook-independent variables to template_preprocess().">_template_preprocess_default_variables</a>() {
<a name="l02350"></a>02350   global $user;
<a name="l02351"></a>02351 
<a name="l02352"></a>02352   <span class="comment">// Variables that don&#39;t depend on a database connection.</span>
<a name="l02353"></a>02353   $variables = array(
<a name="l02354"></a>02354     <span class="stringliteral">&#39;attributes_array&#39;</span> =&gt; array(),
<a name="l02355"></a>02355     <span class="stringliteral">&#39;title_attributes_array&#39;</span> =&gt; array(),
<a name="l02356"></a>02356     <span class="stringliteral">&#39;content_attributes_array&#39;</span> =&gt; array(),
<a name="l02357"></a>02357     <span class="stringliteral">&#39;title_prefix&#39;</span> =&gt; array(),
<a name="l02358"></a>02358     <span class="stringliteral">&#39;title_suffix&#39;</span> =&gt; array(),
<a name="l02359"></a>02359     <span class="stringliteral">&#39;user&#39;</span> =&gt; $user,
<a name="l02360"></a>02360     <span class="stringliteral">&#39;db_is_active&#39;</span> =&gt; !defined(<span class="stringliteral">&#39;MAINTENANCE_MODE&#39;</span>),
<a name="l02361"></a>02361     <span class="stringliteral">&#39;is_admin&#39;</span> =&gt; FALSE,
<a name="l02362"></a>02362     <span class="stringliteral">&#39;logged_in&#39;</span> =&gt; FALSE,
<a name="l02363"></a>02363   );
<a name="l02364"></a>02364 
<a name="l02365"></a>02365   <span class="comment">// The user object has no uid property when the database does not exist during</span>
<a name="l02366"></a>02366   <span class="comment">// install. The user_access() check deals with issues when in maintenance mode</span>
<a name="l02367"></a>02367   <span class="comment">// as uid is set but the user.module has not been included.</span>
<a name="l02368"></a>02368   <span class="keywordflow">if</span> (isset($user-&gt;uid) &amp;&amp; function_exists(<span class="stringliteral">&#39;user_access&#39;</span>)) {
<a name="l02369"></a>02369     $variables[<span class="stringliteral">&#39;is_admin&#39;</span>] = user_access(<span class="stringliteral">&#39;access administration pages&#39;</span>);
<a name="l02370"></a>02370     $variables[<span class="stringliteral">&#39;logged_in&#39;</span>] = ($user-&gt;uid &gt; 0);
<a name="l02371"></a>02371   }
<a name="l02372"></a>02372 
<a name="l02373"></a>02373   <span class="comment">// drupal_is_front_page() might throw an exception.</span>
<a name="l02374"></a>02374   <span class="keywordflow">try</span> {
<a name="l02375"></a>02375     $variables[<span class="stringliteral">&#39;is_front&#39;</span>] = <a class="code" href="path_8inc_a657eb4770879ad6f0dc19bfad2cd4a6d.html#a657eb4770879ad6f0dc19bfad2cd4a6d" title="Check if the current page is the front page.">drupal_is_front_page</a>();
<a name="l02376"></a>02376   }
<a name="l02377"></a>02377   <span class="keywordflow">catch</span> (<a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> $e) {
<a name="l02378"></a>02378     <span class="comment">// If the database is not yet available, set default values for these</span>
<a name="l02379"></a>02379     <span class="comment">// variables.</span>
<a name="l02380"></a>02380     $variables[<span class="stringliteral">&#39;is_front&#39;</span>] = FALSE;
<a name="l02381"></a>02381     $variables[<span class="stringliteral">&#39;db_is_active&#39;</span>] = FALSE;
<a name="l02382"></a>02382   }
<a name="l02383"></a>02383 
<a name="l02384"></a>02384   <span class="keywordflow">return</span> $variables;
<a name="l02385"></a>02385 }
<a name="l02386"></a>02386 
<a name="l02402"></a><a class="code" href="theme_8inc_a9b4d56c55dab2c59b7af6f71d6b1a940.html#a9b4d56c55dab2c59b7af6f71d6b1a940">02402</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a9b4d56c55dab2c59b7af6f71d6b1a940.html#a9b4d56c55dab2c59b7af6f71d6b1a940" title="Adds helper variables derived from variables defined during preprocessing.">template_process</a>(&amp;$variables, $hook) {
<a name="l02403"></a>02403   <span class="comment">// Flatten out classes.</span>
<a name="l02404"></a>02404   $variables[<span class="stringliteral">&#39;classes&#39;</span>] = implode(<span class="charliteral">&#39; &#39;</span>, $variables[<span class="stringliteral">&#39;classes_array&#39;</span>]);
<a name="l02405"></a>02405 
<a name="l02406"></a>02406   <span class="comment">// Flatten out attributes, title_attributes, and content_attributes.</span>
<a name="l02407"></a>02407   <span class="comment">// Because this function can be called very often, and often with empty</span>
<a name="l02408"></a>02408   <span class="comment">// attributes, optimize performance by only calling drupal_attributes() if</span>
<a name="l02409"></a>02409   <span class="comment">// necessary.</span>
<a name="l02410"></a>02410   $variables[<span class="stringliteral">&#39;attributes&#39;</span>] = $variables[<span class="stringliteral">&#39;attributes_array&#39;</span>] ? <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>($variables[<span class="stringliteral">&#39;attributes_array&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l02411"></a>02411   $variables[<span class="stringliteral">&#39;title_attributes&#39;</span>] = $variables[<span class="stringliteral">&#39;title_attributes_array&#39;</span>] ? <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>($variables[<span class="stringliteral">&#39;title_attributes_array&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l02412"></a>02412   $variables[<span class="stringliteral">&#39;content_attributes&#39;</span>] = $variables[<span class="stringliteral">&#39;content_attributes_array&#39;</span>] ? <a class="code" href="group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a.html#gacf11629fb3d1ebf200863e2d15380b4a" title="Converts an associative array to an XML/HTML tag attribute string.">drupal_attributes</a>($variables[<span class="stringliteral">&#39;content_attributes_array&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l02413"></a>02413 }
<a name="l02414"></a>02414 
<a name="l02421"></a><a class="code" href="theme_8inc_a5bc9f37111330a160833274482ad866a.html#a5bc9f37111330a160833274482ad866a">02421</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a5bc9f37111330a160833274482ad866a.html#a5bc9f37111330a160833274482ad866a" title="Preprocess variables for html.tpl.php.">template_preprocess_html</a>(&amp;$variables) {
<a name="l02422"></a>02422   <span class="comment">// Compile a list of classes that are going to be applied to the body element.</span>
<a name="l02423"></a>02423   <span class="comment">// This allows advanced theming based on context (home page, node of certain type, etc.).</span>
<a name="l02424"></a>02424   <span class="comment">// Add a class that tells us whether we&#39;re on the front page or not.</span>
<a name="l02425"></a>02425   $variables[<span class="stringliteral">&#39;classes_array&#39;</span>][] = $variables[<span class="stringliteral">&#39;is_front&#39;</span>] ? <span class="stringliteral">&#39;front&#39;</span> : <span class="stringliteral">&#39;not-front&#39;</span>;
<a name="l02426"></a>02426   <span class="comment">// Add a class that tells us whether the page is viewed by an authenticated user or not.</span>
<a name="l02427"></a>02427   $variables[<span class="stringliteral">&#39;classes_array&#39;</span>][] = $variables[<span class="stringliteral">&#39;logged_in&#39;</span>] ? <span class="stringliteral">&#39;logged-in&#39;</span> : <span class="stringliteral">&#39;not-logged-in&#39;</span>;
<a name="l02428"></a>02428 
<a name="l02429"></a>02429   <span class="comment">// Add information about the number of sidebars.</span>
<a name="l02430"></a>02430   <span class="keywordflow">if</span> (!empty($variables[<span class="stringliteral">&#39;page&#39;</span>][<span class="stringliteral">&#39;sidebar_first&#39;</span>]) &amp;&amp; !empty($variables[<span class="stringliteral">&#39;page&#39;</span>][<span class="stringliteral">&#39;sidebar_second&#39;</span>])) {
<a name="l02431"></a>02431     $variables[<span class="stringliteral">&#39;classes_array&#39;</span>][] = <span class="stringliteral">&#39;two-sidebars&#39;</span>;
<a name="l02432"></a>02432   }
<a name="l02433"></a>02433   elseif (!empty($variables[<span class="stringliteral">&#39;page&#39;</span>][<span class="stringliteral">&#39;sidebar_first&#39;</span>])) {
<a name="l02434"></a>02434     $variables[<span class="stringliteral">&#39;classes_array&#39;</span>][] = <span class="stringliteral">&#39;one-sidebar sidebar-first&#39;</span>;
<a name="l02435"></a>02435   }
<a name="l02436"></a>02436   elseif (!empty($variables[<span class="stringliteral">&#39;page&#39;</span>][<span class="stringliteral">&#39;sidebar_second&#39;</span>])) {
<a name="l02437"></a>02437     $variables[<span class="stringliteral">&#39;classes_array&#39;</span>][] = <span class="stringliteral">&#39;one-sidebar sidebar-second&#39;</span>;
<a name="l02438"></a>02438   }
<a name="l02439"></a>02439   <span class="keywordflow">else</span> {
<a name="l02440"></a>02440     $variables[<span class="stringliteral">&#39;classes_array&#39;</span>][] = <span class="stringliteral">&#39;no-sidebars&#39;</span>;
<a name="l02441"></a>02441   }
<a name="l02442"></a>02442 
<a name="l02443"></a>02443   <span class="comment">// Populate the body classes.</span>
<a name="l02444"></a>02444   <span class="keywordflow">if</span> ($suggestions = <a class="code" href="theme_8inc_af13ff730d76e46395bc8bd8298bfa724.html#af13ff730d76e46395bc8bd8298bfa724" title="Generate an array of suggestions from path arguments.">theme_get_suggestions</a>(<a class="code" href="bootstrap_8inc_afd40bf1dc5dc1f68fb326a8f6e0b88da.html#afd40bf1dc5dc1f68fb326a8f6e0b88da" title="Returns a component of the current Drupal path.">arg</a>(), <span class="stringliteral">&#39;page&#39;</span>, <span class="charliteral">&#39;-&#39;</span>)) {
<a name="l02445"></a>02445     <span class="keywordflow">foreach</span> ($suggestions as $suggestion) {
<a name="l02446"></a>02446       <span class="keywordflow">if</span> ($suggestion != <span class="stringliteral">&#39;page-front&#39;</span>) {
<a name="l02447"></a>02447         <span class="comment">// Add current suggestion to page classes to make it possible to theme</span>
<a name="l02448"></a>02448         <span class="comment">// the page depending on the current page type (e.g. node, admin, user,</span>
<a name="l02449"></a>02449         <span class="comment">// etc.) as well as more specific data like node-12 or node-edit.</span>
<a name="l02450"></a>02450         $variables[<span class="stringliteral">&#39;classes_array&#39;</span>][] = <a class="code" href="common_8inc_aba9dd2b04e8c797c0f0edc9098cbbd48.html#aba9dd2b04e8c797c0f0edc9098cbbd48" title="Prepares a string for use as a valid class name.">drupal_html_class</a>($suggestion);
<a name="l02451"></a>02451       }
<a name="l02452"></a>02452     }
<a name="l02453"></a>02453   }
<a name="l02454"></a>02454 
<a name="l02455"></a>02455   <span class="comment">// If on an individual node page, add the node type to body classes.</span>
<a name="l02456"></a>02456   <span class="keywordflow">if</span> ($node = <a class="code" href="group__menu_ga8b1c8825ae7b6ae31b50cadaa1f7c920.html#ga8b1c8825ae7b6ae31b50cadaa1f7c920" title="Get a loaded object from a router item.">menu_get_object</a>()) {
<a name="l02457"></a>02457     $variables[<span class="stringliteral">&#39;classes_array&#39;</span>][] = <a class="code" href="common_8inc_aba9dd2b04e8c797c0f0edc9098cbbd48.html#aba9dd2b04e8c797c0f0edc9098cbbd48" title="Prepares a string for use as a valid class name.">drupal_html_class</a>(<span class="stringliteral">&#39;node-type-&#39;</span> . $node-&gt;type);
<a name="l02458"></a>02458   }
<a name="l02459"></a>02459 
<a name="l02460"></a>02460   <span class="comment">// RDFa allows annotation of XHTML pages with RDF data, while GRDDL provides</span>
<a name="l02461"></a>02461   <span class="comment">// mechanisms for extraction of this RDF content via XSLT transformation</span>
<a name="l02462"></a>02462   <span class="comment">// using an associated GRDDL profile.</span>
<a name="l02463"></a>02463   $variables[<span class="stringliteral">&#39;rdf_namespaces&#39;</span>]    = <a class="code" href="common_8inc_aa9c5659618a108b2b031a4fd3438a420.html#aa9c5659618a108b2b031a4fd3438a420" title="Returns a string containing RDF namespace declarations for use in XML and XHTML output.">drupal_get_rdf_namespaces</a>();
<a name="l02464"></a>02464   $variables[<span class="stringliteral">&#39;grddl_profile&#39;</span>]     = <span class="stringliteral">&#39;http://www.w3.org/1999/xhtml/vocab&#39;</span>;
<a name="l02465"></a>02465   $variables[<span class="stringliteral">&#39;language&#39;</span>]          = $GLOBALS[<span class="stringliteral">&#39;language&#39;</span>];
<a name="l02466"></a>02466   $variables[<span class="stringliteral">&#39;language&#39;</span>]-&gt;dir     = $GLOBALS[<span class="stringliteral">&#39;language&#39;</span>]-&gt;direction ? <span class="stringliteral">&#39;rtl&#39;</span> : <span class="stringliteral">&#39;ltr&#39;</span>;
<a name="l02467"></a>02467 
<a name="l02468"></a>02468   <span class="comment">// Add favicon.</span>
<a name="l02469"></a>02469   <span class="keywordflow">if</span> (<a class="code" href="theme_8inc_a7cb0fd8d3be02b386d3bd88a3f1dcf1f.html#a7cb0fd8d3be02b386d3bd88a3f1dcf1f" title="Retrieve a setting for the current theme or for a given theme.">theme_get_setting</a>(<span class="stringliteral">&#39;toggle_favicon&#39;</span>)) {
<a name="l02470"></a>02470     $favicon = <a class="code" href="theme_8inc_a7cb0fd8d3be02b386d3bd88a3f1dcf1f.html#a7cb0fd8d3be02b386d3bd88a3f1dcf1f" title="Retrieve a setting for the current theme or for a given theme.">theme_get_setting</a>(<span class="stringliteral">&#39;favicon&#39;</span>);
<a name="l02471"></a>02471     $type = <a class="code" href="theme_8inc_a7cb0fd8d3be02b386d3bd88a3f1dcf1f.html#a7cb0fd8d3be02b386d3bd88a3f1dcf1f" title="Retrieve a setting for the current theme or for a given theme.">theme_get_setting</a>(<span class="stringliteral">&#39;favicon_mimetype&#39;</span>);
<a name="l02472"></a>02472     <a class="code" href="common_8inc_aad501b017775a67b155fe5e441f1ad9d.html#aad501b017775a67b155fe5e441f1ad9d" title="Adds a LINK tag with a distinct &#39;rel&#39; attribute to the page&#39;s HEAD.">drupal_add_html_head_link</a>(array(<span class="stringliteral">&#39;rel&#39;</span> =&gt; <span class="stringliteral">&#39;shortcut icon&#39;</span>, <span class="stringliteral">&#39;href&#39;</span> =&gt; <a class="code" href="group__sanitization_ga46ff2822d576a77317f9045d65317b4f.html#ga46ff2822d576a77317f9045d65317b4f" title="Strips dangerous protocols (e.g.">drupal_strip_dangerous_protocols</a>($favicon), <span class="stringliteral">&#39;type&#39;</span> =&gt; $type));
<a name="l02473"></a>02473   }
<a name="l02474"></a>02474 
<a name="l02475"></a>02475   <span class="comment">// Construct page title.</span>
<a name="l02476"></a>02476   <span class="keywordflow">if</span> (<a class="code" href="bootstrap_8inc_a88f660bf675e572de22a8469841bbd08.html#a88f660bf675e572de22a8469841bbd08" title="Gets the title of the current page.">drupal_get_title</a>()) {
<a name="l02477"></a>02477     $head_title = array(
<a name="l02478"></a>02478       <span class="stringliteral">&#39;title&#39;</span> =&gt; strip_tags(<a class="code" href="bootstrap_8inc_a88f660bf675e572de22a8469841bbd08.html#a88f660bf675e572de22a8469841bbd08" title="Gets the title of the current page.">drupal_get_title</a>()),
<a name="l02479"></a>02479       <span class="stringliteral">&#39;name&#39;</span> =&gt; <a class="code" href="group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d.html#ga76fc67a30fd8d75ddd80565e6e65a13d" title="Encodes special characters in a plain-text string for display as HTML.">check_plain</a>(<a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;site_name&#39;</span>, <span class="stringliteral">&#39;Drupal&#39;</span>)),
<a name="l02480"></a>02480     );
<a name="l02481"></a>02481   }
<a name="l02482"></a>02482   <span class="keywordflow">else</span> {
<a name="l02483"></a>02483     $head_title = array(<span class="stringliteral">&#39;name&#39;</span> =&gt; <a class="code" href="group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d.html#ga76fc67a30fd8d75ddd80565e6e65a13d" title="Encodes special characters in a plain-text string for display as HTML.">check_plain</a>(<a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;site_name&#39;</span>, <span class="stringliteral">&#39;Drupal&#39;</span>)));
<a name="l02484"></a>02484     <span class="keywordflow">if</span> (<a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;site_slogan&#39;</span>, <span class="stringliteral">&#39;&#39;</span>)) {
<a name="l02485"></a>02485       $head_title[<span class="stringliteral">&#39;slogan&#39;</span>] = <a class="code" href="group__sanitization_ga97dcceb77b76539219af2a85eacbe18d.html#ga97dcceb77b76539219af2a85eacbe18d" title="Applies a very permissive XSS/HTML filter for admin-only use.">filter_xss_admin</a>(<a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;site_slogan&#39;</span>, <span class="stringliteral">&#39;&#39;</span>));
<a name="l02486"></a>02486     }
<a name="l02487"></a>02487   }
<a name="l02488"></a>02488   $variables[<span class="stringliteral">&#39;head_title_array&#39;</span>] = $head_title;
<a name="l02489"></a>02489   $variables[<span class="stringliteral">&#39;head_title&#39;</span>] = implode(<span class="stringliteral">&#39; | &#39;</span>, $head_title);
<a name="l02490"></a>02490 
<a name="l02491"></a>02491   <span class="comment">// Populate the page template suggestions.</span>
<a name="l02492"></a>02492   <span class="keywordflow">if</span> ($suggestions = <a class="code" href="theme_8inc_af13ff730d76e46395bc8bd8298bfa724.html#af13ff730d76e46395bc8bd8298bfa724" title="Generate an array of suggestions from path arguments.">theme_get_suggestions</a>(<a class="code" href="bootstrap_8inc_afd40bf1dc5dc1f68fb326a8f6e0b88da.html#afd40bf1dc5dc1f68fb326a8f6e0b88da" title="Returns a component of the current Drupal path.">arg</a>(), <span class="stringliteral">&#39;html&#39;</span>)) {
<a name="l02493"></a>02493     $variables[<span class="stringliteral">&#39;theme_hook_suggestions&#39;</span>] = $suggestions;
<a name="l02494"></a>02494   }
<a name="l02495"></a>02495 }
<a name="l02496"></a>02496 
<a name="l02514"></a><a class="code" href="theme_8inc_a128dae24f990d8ba4710ac78b0584c11.html#a128dae24f990d8ba4710ac78b0584c11">02514</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a128dae24f990d8ba4710ac78b0584c11.html#a128dae24f990d8ba4710ac78b0584c11" title="Preprocess variables for page.tpl.php.">template_preprocess_page</a>(&amp;$variables) {
<a name="l02515"></a>02515   <span class="comment">// Move some variables to the top level for themer convenience and template cleanliness.</span>
<a name="l02516"></a>02516   $variables[<span class="stringliteral">&#39;show_messages&#39;</span>] = $variables[<span class="stringliteral">&#39;page&#39;</span>][<span class="stringliteral">&#39;#show_messages&#39;</span>];
<a name="l02517"></a>02517 
<a name="l02518"></a>02518   <span class="keywordflow">foreach</span> (system_region_list($GLOBALS[<span class="stringliteral">&#39;theme&#39;</span>]) as $region_key =&gt; $region_name) {
<a name="l02519"></a>02519     <span class="keywordflow">if</span> (!isset($variables[<span class="stringliteral">&#39;page&#39;</span>][$region_key])) {
<a name="l02520"></a>02520       $variables[<span class="stringliteral">&#39;page&#39;</span>][$region_key] = array();
<a name="l02521"></a>02521     }
<a name="l02522"></a>02522   }
<a name="l02523"></a>02523 
<a name="l02524"></a>02524   <span class="comment">// Set up layout variable.</span>
<a name="l02525"></a>02525   $variables[<span class="stringliteral">&#39;layout&#39;</span>] = <span class="stringliteral">&#39;none&#39;</span>;
<a name="l02526"></a>02526   <span class="keywordflow">if</span> (!empty($variables[<span class="stringliteral">&#39;page&#39;</span>][<span class="stringliteral">&#39;sidebar_first&#39;</span>])) {
<a name="l02527"></a>02527     $variables[<span class="stringliteral">&#39;layout&#39;</span>] = <span class="stringliteral">&#39;first&#39;</span>;
<a name="l02528"></a>02528   }
<a name="l02529"></a>02529   <span class="keywordflow">if</span> (!empty($variables[<span class="stringliteral">&#39;page&#39;</span>][<span class="stringliteral">&#39;sidebar_second&#39;</span>])) {
<a name="l02530"></a>02530     $variables[<span class="stringliteral">&#39;layout&#39;</span>] = ($variables[<span class="stringliteral">&#39;layout&#39;</span>] == <span class="stringliteral">&#39;first&#39;</span>) ? <span class="stringliteral">&#39;both&#39;</span> : <span class="stringliteral">&#39;second&#39;</span>;
<a name="l02531"></a>02531   }
<a name="l02532"></a>02532 
<a name="l02533"></a>02533   $variables[<span class="stringliteral">&#39;base_path&#39;</span>]         = <a class="code" href="common_8inc_ae227697e9c239f09fd7e36f71afde771.html#ae227697e9c239f09fd7e36f71afde771" title="Returns the base URL path (i.e., directory) of the Drupal installation.">base_path</a>();
<a name="l02534"></a>02534   $variables[<span class="stringliteral">&#39;front_page&#39;</span>]        = <a class="code" href="common_8inc_a43b2a0594431556db49df980801d8807.html#a43b2a0594431556db49df980801d8807" title="End of &quot;defgroup format&quot;.">url</a>();
<a name="l02535"></a>02535   $variables[<span class="stringliteral">&#39;feed_icons&#39;</span>]        = <a class="code" href="common_8inc_ac7df9703641369003434d49cf917c16e.html#ac7df9703641369003434d49cf917c16e" title="Gets the feed URLs for the current page.">drupal_get_feeds</a>();
<a name="l02536"></a>02536   $variables[<span class="stringliteral">&#39;language&#39;</span>]          = $GLOBALS[<span class="stringliteral">&#39;language&#39;</span>];
<a name="l02537"></a>02537   $variables[<span class="stringliteral">&#39;language&#39;</span>]-&gt;dir     = $GLOBALS[<span class="stringliteral">&#39;language&#39;</span>]-&gt;direction ? <span class="stringliteral">&#39;rtl&#39;</span> : <span class="stringliteral">&#39;ltr&#39;</span>;
<a name="l02538"></a>02538   $variables[<span class="stringliteral">&#39;logo&#39;</span>]              = <a class="code" href="theme_8inc_a7cb0fd8d3be02b386d3bd88a3f1dcf1f.html#a7cb0fd8d3be02b386d3bd88a3f1dcf1f" title="Retrieve a setting for the current theme or for a given theme.">theme_get_setting</a>(<span class="stringliteral">&#39;logo&#39;</span>);
<a name="l02539"></a>02539   $variables[<span class="stringliteral">&#39;main_menu&#39;</span>]         = <a class="code" href="theme_8inc_a7cb0fd8d3be02b386d3bd88a3f1dcf1f.html#a7cb0fd8d3be02b386d3bd88a3f1dcf1f" title="Retrieve a setting for the current theme or for a given theme.">theme_get_setting</a>(<span class="stringliteral">&#39;toggle_main_menu&#39;</span>) ? <a class="code" href="group__menu_ga47957cf684d4a76b6e8a5eac09d2db94.html#ga47957cf684d4a76b6e8a5eac09d2db94" title="Return an array of links to be rendered as the Main menu.">menu_main_menu</a>() : array();
<a name="l02540"></a>02540   $variables[<span class="stringliteral">&#39;secondary_menu&#39;</span>]    = <a class="code" href="theme_8inc_a7cb0fd8d3be02b386d3bd88a3f1dcf1f.html#a7cb0fd8d3be02b386d3bd88a3f1dcf1f" title="Retrieve a setting for the current theme or for a given theme.">theme_get_setting</a>(<span class="stringliteral">&#39;toggle_secondary_menu&#39;</span>) ? <a class="code" href="group__menu_gaf4a8dad6070035a498c598c5fe9ca255.html#gaf4a8dad6070035a498c598c5fe9ca255" title="Return an array of links to be rendered as the Secondary links.">menu_secondary_menu</a>() : array();
<a name="l02541"></a>02541   $variables[<span class="stringliteral">&#39;action_links&#39;</span>]      = <a class="code" href="group__menu_ga150a37ede061833b2b9fde658d005426.html#ga150a37ede061833b2b9fde658d005426" title="Returns the rendered local actions at the current level.">menu_local_actions</a>();
<a name="l02542"></a>02542   $variables[<span class="stringliteral">&#39;site_name&#39;</span>]         = (<a class="code" href="theme_8inc_a7cb0fd8d3be02b386d3bd88a3f1dcf1f.html#a7cb0fd8d3be02b386d3bd88a3f1dcf1f" title="Retrieve a setting for the current theme or for a given theme.">theme_get_setting</a>(<span class="stringliteral">&#39;toggle_name&#39;</span>) ? <a class="code" href="group__sanitization_ga97dcceb77b76539219af2a85eacbe18d.html#ga97dcceb77b76539219af2a85eacbe18d" title="Applies a very permissive XSS/HTML filter for admin-only use.">filter_xss_admin</a>(<a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;site_name&#39;</span>, <span class="stringliteral">&#39;Drupal&#39;</span>)) : <span class="stringliteral">&#39;&#39;</span>);
<a name="l02543"></a>02543   $variables[<span class="stringliteral">&#39;site_slogan&#39;</span>]       = (<a class="code" href="theme_8inc_a7cb0fd8d3be02b386d3bd88a3f1dcf1f.html#a7cb0fd8d3be02b386d3bd88a3f1dcf1f" title="Retrieve a setting for the current theme or for a given theme.">theme_get_setting</a>(<span class="stringliteral">&#39;toggle_slogan&#39;</span>) ? <a class="code" href="group__sanitization_ga97dcceb77b76539219af2a85eacbe18d.html#ga97dcceb77b76539219af2a85eacbe18d" title="Applies a very permissive XSS/HTML filter for admin-only use.">filter_xss_admin</a>(<a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;site_slogan&#39;</span>, <span class="stringliteral">&#39;&#39;</span>)) : <span class="stringliteral">&#39;&#39;</span>);
<a name="l02544"></a>02544   $variables[<span class="stringliteral">&#39;tabs&#39;</span>]              = <a class="code" href="group__menu_ga9fe648c89a4e94e63c7a88076ed12a94.html#ga9fe648c89a4e94e63c7a88076ed12a94" title="Returns a renderable element for the primary and secondary tabs.">menu_local_tabs</a>();
<a name="l02545"></a>02545 
<a name="l02546"></a>02546   <span class="keywordflow">if</span> ($node = <a class="code" href="group__menu_ga8b1c8825ae7b6ae31b50cadaa1f7c920.html#ga8b1c8825ae7b6ae31b50cadaa1f7c920" title="Get a loaded object from a router item.">menu_get_object</a>()) {
<a name="l02547"></a>02547     $variables[<span class="stringliteral">&#39;node&#39;</span>] = $node;
<a name="l02548"></a>02548   }
<a name="l02549"></a>02549 
<a name="l02550"></a>02550   <span class="comment">// Populate the page template suggestions.</span>
<a name="l02551"></a>02551   <span class="keywordflow">if</span> ($suggestions = <a class="code" href="theme_8inc_af13ff730d76e46395bc8bd8298bfa724.html#af13ff730d76e46395bc8bd8298bfa724" title="Generate an array of suggestions from path arguments.">theme_get_suggestions</a>(<a class="code" href="bootstrap_8inc_afd40bf1dc5dc1f68fb326a8f6e0b88da.html#afd40bf1dc5dc1f68fb326a8f6e0b88da" title="Returns a component of the current Drupal path.">arg</a>(), <span class="stringliteral">&#39;page&#39;</span>)) {
<a name="l02552"></a>02552     $variables[<span class="stringliteral">&#39;theme_hook_suggestions&#39;</span>] = $suggestions;
<a name="l02553"></a>02553   }
<a name="l02554"></a>02554 }
<a name="l02555"></a>02555 
<a name="l02565"></a><a class="code" href="theme_8inc_aa9c8d115ebdc2baeae402b3d7e6b392b.html#aa9c8d115ebdc2baeae402b3d7e6b392b">02565</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_aa9c8d115ebdc2baeae402b3d7e6b392b.html#aa9c8d115ebdc2baeae402b3d7e6b392b" title="Process variables for page.tpl.php.">template_process_page</a>(&amp;$variables) {
<a name="l02566"></a>02566   <span class="keywordflow">if</span> (!isset($variables[<span class="stringliteral">&#39;breadcrumb&#39;</span>])) {
<a name="l02567"></a>02567     <span class="comment">// Build the breadcrumb last, so as to increase the chance of being able to</span>
<a name="l02568"></a>02568     <span class="comment">// re-use the cache of an already rendered menu containing the active link</span>
<a name="l02569"></a>02569     <span class="comment">// for the current page.</span>
<a name="l02570"></a>02570     <span class="comment">// @see menu_tree_page_data()</span>
<a name="l02571"></a>02571     $variables[<span class="stringliteral">&#39;breadcrumb&#39;</span>] = <a class="code" href="theme_8inc_a7c25609a935874541a19657affd30fff.html#a7c25609a935874541a19657affd30fff" title="Generates themed output.">theme</a>(<span class="stringliteral">&#39;breadcrumb&#39;</span>, array(<span class="stringliteral">&#39;breadcrumb&#39;</span> =&gt; <a class="code" href="common_8inc_af1e9626192d1d2e5e63b370e88c03c7c.html#af1e9626192d1d2e5e63b370e88c03c7c" title="Gets the breadcrumb trail for the current page.">drupal_get_breadcrumb</a>()));
<a name="l02572"></a>02572   }
<a name="l02573"></a>02573   <span class="keywordflow">if</span> (!isset($variables[<span class="stringliteral">&#39;title&#39;</span>])) {
<a name="l02574"></a>02574     $variables[<span class="stringliteral">&#39;title&#39;</span>] = <a class="code" href="bootstrap_8inc_a88f660bf675e572de22a8469841bbd08.html#a88f660bf675e572de22a8469841bbd08" title="Gets the title of the current page.">drupal_get_title</a>();
<a name="l02575"></a>02575   }
<a name="l02576"></a>02576 
<a name="l02577"></a>02577   <span class="comment">// Generate messages last in order to capture as many as possible for the</span>
<a name="l02578"></a>02578   <span class="comment">// current page.</span>
<a name="l02579"></a>02579   <span class="keywordflow">if</span> (!isset($variables[<span class="stringliteral">&#39;messages&#39;</span>])) {
<a name="l02580"></a>02580     $variables[<span class="stringliteral">&#39;messages&#39;</span>] = $variables[<span class="stringliteral">&#39;show_messages&#39;</span>] ? <a class="code" href="theme_8inc_a7c25609a935874541a19657affd30fff.html#a7c25609a935874541a19657affd30fff" title="Generates themed output.">theme</a>(<span class="stringliteral">&#39;status_messages&#39;</span>) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l02581"></a>02581   }
<a name="l02582"></a>02582 }
<a name="l02583"></a>02583 
<a name="l02594"></a><a class="code" href="theme_8inc_abccf98b29e23c1a9249068558d687da7.html#abccf98b29e23c1a9249068558d687da7">02594</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_abccf98b29e23c1a9249068558d687da7.html#abccf98b29e23c1a9249068558d687da7" title="Process variables for html.tpl.php.">template_process_html</a>(&amp;$variables) {
<a name="l02595"></a>02595   <span class="comment">// Render page_top and page_bottom into top level variables.</span>
<a name="l02596"></a>02596   $variables[<span class="stringliteral">&#39;page_top&#39;</span>] = <a class="code" href="common_8inc_a05798b44e8d6c496d4bee5cc32fa7851.html#a05798b44e8d6c496d4bee5cc32fa7851" title="Renders HTML given a structured array tree.">drupal_render</a>($variables[<span class="stringliteral">&#39;page&#39;</span>][<span class="stringliteral">&#39;page_top&#39;</span>]);
<a name="l02597"></a>02597   $variables[<span class="stringliteral">&#39;page_bottom&#39;</span>] = <a class="code" href="common_8inc_a05798b44e8d6c496d4bee5cc32fa7851.html#a05798b44e8d6c496d4bee5cc32fa7851" title="Renders HTML given a structured array tree.">drupal_render</a>($variables[<span class="stringliteral">&#39;page&#39;</span>][<span class="stringliteral">&#39;page_bottom&#39;</span>]);
<a name="l02598"></a>02598   <span class="comment">// Place the rendered HTML for the page body into a top level variable.</span>
<a name="l02599"></a>02599   $variables[<span class="stringliteral">&#39;page&#39;</span>]              = $variables[<span class="stringliteral">&#39;page&#39;</span>][<span class="stringliteral">&#39;#children&#39;</span>];
<a name="l02600"></a>02600   $variables[<span class="stringliteral">&#39;page_bottom&#39;</span>] .= <a class="code" href="common_8inc_ac4d279ffd40eae67ace8459cd3e6e3b5.html#ac4d279ffd40eae67ace8459cd3e6e3b5" title="Returns a themed presentation of all JavaScript code for the current page.">drupal_get_js</a>(<span class="stringliteral">&#39;footer&#39;</span>);
<a name="l02601"></a>02601 
<a name="l02602"></a>02602   $variables[<span class="stringliteral">&#39;head&#39;</span>]    = <a class="code" href="common_8inc_acdee011d76859a5a9280209df1175188.html#acdee011d76859a5a9280209df1175188" title="Retrieves output to be displayed in the HEAD tag of the HTML page.">drupal_get_html_head</a>();
<a name="l02603"></a>02603   $variables[<span class="stringliteral">&#39;css&#39;</span>]     = <a class="code" href="common_8inc_a2c5bb2667efb44b02f1a105c0bfdebe5.html#a2c5bb2667efb44b02f1a105c0bfdebe5" title="Adds a cascading stylesheet to the stylesheet queue.">drupal_add_css</a>();
<a name="l02604"></a>02604   $variables[<span class="stringliteral">&#39;styles&#39;</span>]  = <a class="code" href="common_8inc_a2e308371f339fbb54967045ccbe4e88c.html#a2e308371f339fbb54967045ccbe4e88c" title="Returns a themed representation of all stylesheets to attach to the page.">drupal_get_css</a>();
<a name="l02605"></a>02605   $variables[<span class="stringliteral">&#39;scripts&#39;</span>] = <a class="code" href="common_8inc_ac4d279ffd40eae67ace8459cd3e6e3b5.html#ac4d279ffd40eae67ace8459cd3e6e3b5" title="Returns a themed presentation of all JavaScript code for the current page.">drupal_get_js</a>();
<a name="l02606"></a>02606 }
<a name="l02607"></a>02607 
<a name="l02630"></a><a class="code" href="theme_8inc_af13ff730d76e46395bc8bd8298bfa724.html#af13ff730d76e46395bc8bd8298bfa724">02630</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_af13ff730d76e46395bc8bd8298bfa724.html#af13ff730d76e46395bc8bd8298bfa724" title="Generate an array of suggestions from path arguments.">theme_get_suggestions</a>($args, $base, $delimiter = <span class="stringliteral">&#39;__&#39;</span>) {
<a name="l02631"></a>02631 
<a name="l02632"></a>02632   <span class="comment">// Build a list of suggested theme hooks or body classes in order of</span>
<a name="l02633"></a>02633   <span class="comment">// specificity. One suggestion is made for every element of the current path,</span>
<a name="l02634"></a>02634   <span class="comment">// though numeric elements are not carried to subsequent suggestions. For</span>
<a name="l02635"></a>02635   <span class="comment">// example, for $base=&#39;page&#39;, http://www.example.com/node/1/edit would result</span>
<a name="l02636"></a>02636   <span class="comment">// in the following suggestions and body classes:</span>
<a name="l02637"></a>02637   <span class="comment">//</span>
<a name="l02638"></a>02638   <span class="comment">// page__node              page-node</span>
<a name="l02639"></a>02639   <span class="comment">// page__node__%           page-node-%</span>
<a name="l02640"></a>02640   <span class="comment">// page__node__1           page-node-1</span>
<a name="l02641"></a>02641   <span class="comment">// page__node__edit        page-node-edit</span>
<a name="l02642"></a>02642 
<a name="l02643"></a>02643   $suggestions = array();
<a name="l02644"></a>02644   $prefix = $base;
<a name="l02645"></a>02645   <span class="keywordflow">foreach</span> ($args as $arg) {
<a name="l02646"></a>02646     <span class="comment">// Remove slashes or null per SA-CORE-2009-003 and change - (hyphen) to _</span>
<a name="l02647"></a>02647     <span class="comment">// (underscore).</span>
<a name="l02648"></a>02648     <span class="comment">//</span>
<a name="l02649"></a>02649     <span class="comment">// When we discover templates in @see drupal_find_theme_templates,</span>
<a name="l02650"></a>02650     <span class="comment">// hyphens (-) are converted to underscores (_) before the theme hook</span>
<a name="l02651"></a>02651     <span class="comment">// is registered. We do this because the hyphens used for delimiters</span>
<a name="l02652"></a>02652     <span class="comment">// in hook suggestions cannot be used in the function names of the</span>
<a name="l02653"></a>02653     <span class="comment">// associated preprocess functions. Any page templates designed to be used</span>
<a name="l02654"></a>02654     <span class="comment">// on paths that contain a hyphen are also registered with these hyphens</span>
<a name="l02655"></a>02655     <span class="comment">// converted to underscores so here we must convert any hyphens in path</span>
<a name="l02656"></a>02656     <span class="comment">// arguments to underscores here before fetching theme hook suggestions</span>
<a name="l02657"></a>02657     <span class="comment">// to ensure the templates are appropriately recognized.</span>
<a name="l02658"></a>02658     $arg = str_replace(array(<span class="stringliteral">&quot;/&quot;</span>, <span class="stringliteral">&quot;\\&quot;</span>, <span class="stringliteral">&quot;\0&quot;</span>, <span class="charliteral">&#39;-&#39;</span>), array(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="charliteral">&#39;_&#39;</span>), $arg);
<a name="l02659"></a>02659     <span class="comment">// The percent acts as a wildcard for numeric arguments since</span>
<a name="l02660"></a>02660     <span class="comment">// asterisks are not valid filename characters on many filesystems.</span>
<a name="l02661"></a>02661     <span class="keywordflow">if</span> (is_numeric($arg)) {
<a name="l02662"></a>02662       $suggestions[] = $prefix . $delimiter . <span class="charliteral">&#39;%&#39;</span>;
<a name="l02663"></a>02663     }
<a name="l02664"></a>02664     $suggestions[] = $prefix . $delimiter . $arg;
<a name="l02665"></a>02665     <span class="keywordflow">if</span> (!is_numeric($arg)) {
<a name="l02666"></a>02666       $prefix .= $delimiter . $arg;
<a name="l02667"></a>02667     }
<a name="l02668"></a>02668   }
<a name="l02669"></a>02669   <span class="keywordflow">if</span> (<a class="code" href="path_8inc_a657eb4770879ad6f0dc19bfad2cd4a6d.html#a657eb4770879ad6f0dc19bfad2cd4a6d" title="Check if the current page is the front page.">drupal_is_front_page</a>()) {
<a name="l02670"></a>02670     <span class="comment">// Front templates should be based on root only, not prefixed arguments.</span>
<a name="l02671"></a>02671     $suggestions[] = $base . $delimiter . <span class="stringliteral">&#39;front&#39;</span>;
<a name="l02672"></a>02672   }
<a name="l02673"></a>02673 
<a name="l02674"></a>02674   <span class="keywordflow">return</span> $suggestions;
<a name="l02675"></a>02675 }
<a name="l02676"></a>02676 
<a name="l02691"></a><a class="code" href="theme_8inc_a14a92df5f5e74cebcf7fb680885e58a5.html#a14a92df5f5e74cebcf7fb680885e58a5">02691</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a14a92df5f5e74cebcf7fb680885e58a5.html#a14a92df5f5e74cebcf7fb680885e58a5" title="The variables array generated here is a mirror of template_preprocess_page().">template_preprocess_maintenance_page</a>(&amp;$variables) {
<a name="l02692"></a>02692   <span class="comment">// Add favicon</span>
<a name="l02693"></a>02693   <span class="keywordflow">if</span> (<a class="code" href="theme_8inc_a7cb0fd8d3be02b386d3bd88a3f1dcf1f.html#a7cb0fd8d3be02b386d3bd88a3f1dcf1f" title="Retrieve a setting for the current theme or for a given theme.">theme_get_setting</a>(<span class="stringliteral">&#39;toggle_favicon&#39;</span>)) {
<a name="l02694"></a>02694     $favicon = <a class="code" href="theme_8inc_a7cb0fd8d3be02b386d3bd88a3f1dcf1f.html#a7cb0fd8d3be02b386d3bd88a3f1dcf1f" title="Retrieve a setting for the current theme or for a given theme.">theme_get_setting</a>(<span class="stringliteral">&#39;favicon&#39;</span>);
<a name="l02695"></a>02695     $type = <a class="code" href="theme_8inc_a7cb0fd8d3be02b386d3bd88a3f1dcf1f.html#a7cb0fd8d3be02b386d3bd88a3f1dcf1f" title="Retrieve a setting for the current theme or for a given theme.">theme_get_setting</a>(<span class="stringliteral">&#39;favicon_mimetype&#39;</span>);
<a name="l02696"></a>02696     <a class="code" href="common_8inc_aad501b017775a67b155fe5e441f1ad9d.html#aad501b017775a67b155fe5e441f1ad9d" title="Adds a LINK tag with a distinct &#39;rel&#39; attribute to the page&#39;s HEAD.">drupal_add_html_head_link</a>(array(<span class="stringliteral">&#39;rel&#39;</span> =&gt; <span class="stringliteral">&#39;shortcut icon&#39;</span>, <span class="stringliteral">&#39;href&#39;</span> =&gt; <a class="code" href="group__sanitization_ga46ff2822d576a77317f9045d65317b4f.html#ga46ff2822d576a77317f9045d65317b4f" title="Strips dangerous protocols (e.g.">drupal_strip_dangerous_protocols</a>($favicon), <span class="stringliteral">&#39;type&#39;</span> =&gt; $type));
<a name="l02697"></a>02697   }
<a name="l02698"></a>02698 
<a name="l02699"></a>02699   global $theme;
<a name="l02700"></a>02700   <span class="comment">// Retrieve the theme data to list all available regions.</span>
<a name="l02701"></a>02701   $theme_data = <a class="code" href="theme_8inc_a48d5521b10139d745626435d804353a4.html#a48d5521b10139d745626435d804353a4" title="Return a list of all currently available themes.">list_themes</a>();
<a name="l02702"></a>02702   $regions = $theme_data[$theme]-&gt;info[<span class="stringliteral">&#39;regions&#39;</span>];
<a name="l02703"></a>02703 
<a name="l02704"></a>02704   <span class="comment">// Get all region content set with drupal_add_region_content().</span>
<a name="l02705"></a>02705   <span class="keywordflow">foreach</span> (array_keys($regions) as $region) {
<a name="l02706"></a>02706     <span class="comment">// Assign region to a region variable.</span>
<a name="l02707"></a>02707     $region_content = <a class="code" href="common_8inc_a3e5f6ebc1abb928bf1634b6813f46dca.html#a3e5f6ebc1abb928bf1634b6813f46dca" title="Gets assigned content for a given region.">drupal_get_region_content</a>($region);
<a name="l02708"></a>02708     isset($variables[$region]) ? $variables[$region] .= $region_content : $variables[$region] = $region_content;
<a name="l02709"></a>02709   }
<a name="l02710"></a>02710 
<a name="l02711"></a>02711   <span class="comment">// Setup layout variable.</span>
<a name="l02712"></a>02712   $variables[<span class="stringliteral">&#39;layout&#39;</span>] = <span class="stringliteral">&#39;none&#39;</span>;
<a name="l02713"></a>02713   <span class="keywordflow">if</span> (!empty($variables[<span class="stringliteral">&#39;sidebar_first&#39;</span>])) {
<a name="l02714"></a>02714     $variables[<span class="stringliteral">&#39;layout&#39;</span>] = <span class="stringliteral">&#39;first&#39;</span>;
<a name="l02715"></a>02715   }
<a name="l02716"></a>02716   <span class="keywordflow">if</span> (!empty($variables[<span class="stringliteral">&#39;sidebar_second&#39;</span>])) {
<a name="l02717"></a>02717     $variables[<span class="stringliteral">&#39;layout&#39;</span>] = ($variables[<span class="stringliteral">&#39;layout&#39;</span>] == <span class="stringliteral">&#39;first&#39;</span>) ? <span class="stringliteral">&#39;both&#39;</span> : <span class="stringliteral">&#39;second&#39;</span>;
<a name="l02718"></a>02718   }
<a name="l02719"></a>02719 
<a name="l02720"></a>02720   <span class="comment">// Construct page title</span>
<a name="l02721"></a>02721   <span class="keywordflow">if</span> (<a class="code" href="bootstrap_8inc_a88f660bf675e572de22a8469841bbd08.html#a88f660bf675e572de22a8469841bbd08" title="Gets the title of the current page.">drupal_get_title</a>()) {
<a name="l02722"></a>02722     $head_title = array(
<a name="l02723"></a>02723       <span class="stringliteral">&#39;title&#39;</span> =&gt; strip_tags(<a class="code" href="bootstrap_8inc_a88f660bf675e572de22a8469841bbd08.html#a88f660bf675e572de22a8469841bbd08" title="Gets the title of the current page.">drupal_get_title</a>()),
<a name="l02724"></a>02724       <span class="stringliteral">&#39;name&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;site_name&#39;</span>, <span class="stringliteral">&#39;Drupal&#39;</span>),
<a name="l02725"></a>02725     );
<a name="l02726"></a>02726   }
<a name="l02727"></a>02727   <span class="keywordflow">else</span> {
<a name="l02728"></a>02728     $head_title = array(<span class="stringliteral">&#39;name&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;site_name&#39;</span>, <span class="stringliteral">&#39;Drupal&#39;</span>));
<a name="l02729"></a>02729     <span class="keywordflow">if</span> (<a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;site_slogan&#39;</span>, <span class="stringliteral">&#39;&#39;</span>)) {
<a name="l02730"></a>02730       $head_title[<span class="stringliteral">&#39;slogan&#39;</span>] = <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;site_slogan&#39;</span>, <span class="stringliteral">&#39;&#39;</span>);
<a name="l02731"></a>02731     }
<a name="l02732"></a>02732   }
<a name="l02733"></a>02733 
<a name="l02734"></a>02734   <span class="comment">// set the default language if necessary</span>
<a name="l02735"></a>02735   $language = isset($GLOBALS[<span class="stringliteral">&#39;language&#39;</span>]) ? $GLOBALS[<span class="stringliteral">&#39;language&#39;</span>] : <a class="code" href="bootstrap_8inc_a336c0878074791056c62640cd95d8067.html#a336c0878074791056c62640cd95d8067" title="Returns the default language used on the site.">language_default</a>();
<a name="l02736"></a>02736 
<a name="l02737"></a>02737   $variables[<span class="stringliteral">&#39;head_title_array&#39;</span>]  = $head_title;
<a name="l02738"></a>02738   $variables[<span class="stringliteral">&#39;head_title&#39;</span>]        = implode(<span class="stringliteral">&#39; | &#39;</span>, $head_title);
<a name="l02739"></a>02739   $variables[<span class="stringliteral">&#39;base_path&#39;</span>]         = <a class="code" href="common_8inc_ae227697e9c239f09fd7e36f71afde771.html#ae227697e9c239f09fd7e36f71afde771" title="Returns the base URL path (i.e., directory) of the Drupal installation.">base_path</a>();
<a name="l02740"></a>02740   $variables[<span class="stringliteral">&#39;front_page&#39;</span>]        = <a class="code" href="common_8inc_a43b2a0594431556db49df980801d8807.html#a43b2a0594431556db49df980801d8807" title="End of &quot;defgroup format&quot;.">url</a>();
<a name="l02741"></a>02741   $variables[<span class="stringliteral">&#39;breadcrumb&#39;</span>]        = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02742"></a>02742   $variables[<span class="stringliteral">&#39;feed_icons&#39;</span>]        = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02743"></a>02743   $variables[<span class="stringliteral">&#39;help&#39;</span>]              = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02744"></a>02744   $variables[<span class="stringliteral">&#39;language&#39;</span>]          = $language;
<a name="l02745"></a>02745   $variables[<span class="stringliteral">&#39;language&#39;</span>]-&gt;dir     = $language-&gt;direction ? <span class="stringliteral">&#39;rtl&#39;</span> : <span class="stringliteral">&#39;ltr&#39;</span>;
<a name="l02746"></a>02746   $variables[<span class="stringliteral">&#39;logo&#39;</span>]              = <a class="code" href="theme_8inc_a7cb0fd8d3be02b386d3bd88a3f1dcf1f.html#a7cb0fd8d3be02b386d3bd88a3f1dcf1f" title="Retrieve a setting for the current theme or for a given theme.">theme_get_setting</a>(<span class="stringliteral">&#39;logo&#39;</span>);
<a name="l02747"></a>02747   $variables[<span class="stringliteral">&#39;messages&#39;</span>]          = $variables[<span class="stringliteral">&#39;show_messages&#39;</span>] ? <a class="code" href="theme_8inc_a7c25609a935874541a19657affd30fff.html#a7c25609a935874541a19657affd30fff" title="Generates themed output.">theme</a>(<span class="stringliteral">&#39;status_messages&#39;</span>) : <span class="stringliteral">&#39;&#39;</span>;
<a name="l02748"></a>02748   $variables[<span class="stringliteral">&#39;main_menu&#39;</span>]         = array();
<a name="l02749"></a>02749   $variables[<span class="stringliteral">&#39;secondary_menu&#39;</span>]    = array();
<a name="l02750"></a>02750   $variables[<span class="stringliteral">&#39;site_name&#39;</span>]         = (<a class="code" href="theme_8inc_a7cb0fd8d3be02b386d3bd88a3f1dcf1f.html#a7cb0fd8d3be02b386d3bd88a3f1dcf1f" title="Retrieve a setting for the current theme or for a given theme.">theme_get_setting</a>(<span class="stringliteral">&#39;toggle_name&#39;</span>) ? <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;site_name&#39;</span>, <span class="stringliteral">&#39;Drupal&#39;</span>) : <span class="stringliteral">&#39;&#39;</span>);
<a name="l02751"></a>02751   $variables[<span class="stringliteral">&#39;site_slogan&#39;</span>]       = (<a class="code" href="theme_8inc_a7cb0fd8d3be02b386d3bd88a3f1dcf1f.html#a7cb0fd8d3be02b386d3bd88a3f1dcf1f" title="Retrieve a setting for the current theme or for a given theme.">theme_get_setting</a>(<span class="stringliteral">&#39;toggle_slogan&#39;</span>) ? <a class="code" href="bootstrap_8inc_a1be2160d5e5a1a9b9a0c90944c4f5252.html#a1be2160d5e5a1a9b9a0c90944c4f5252" title="Returns a persistent variable.">variable_get</a>(<span class="stringliteral">&#39;site_slogan&#39;</span>, <span class="stringliteral">&#39;&#39;</span>) : <span class="stringliteral">&#39;&#39;</span>);
<a name="l02752"></a>02752   $variables[<span class="stringliteral">&#39;tabs&#39;</span>]              = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02753"></a>02753   $variables[<span class="stringliteral">&#39;title&#39;</span>]             = <a class="code" href="bootstrap_8inc_a88f660bf675e572de22a8469841bbd08.html#a88f660bf675e572de22a8469841bbd08" title="Gets the title of the current page.">drupal_get_title</a>();
<a name="l02754"></a>02754 
<a name="l02755"></a>02755   <span class="comment">// Compile a list of classes that are going to be applied to the body element.</span>
<a name="l02756"></a>02756   $variables[<span class="stringliteral">&#39;classes_array&#39;</span>][] = <span class="stringliteral">&#39;in-maintenance&#39;</span>;
<a name="l02757"></a>02757   <span class="keywordflow">if</span> (isset($variables[<span class="stringliteral">&#39;db_is_active&#39;</span>]) &amp;&amp; !$variables[<span class="stringliteral">&#39;db_is_active&#39;</span>]) {
<a name="l02758"></a>02758     $variables[<span class="stringliteral">&#39;classes_array&#39;</span>][] = <span class="stringliteral">&#39;db-offline&#39;</span>;
<a name="l02759"></a>02759   }
<a name="l02760"></a>02760   <span class="keywordflow">if</span> ($variables[<span class="stringliteral">&#39;layout&#39;</span>] == <span class="stringliteral">&#39;both&#39;</span>) {
<a name="l02761"></a>02761     $variables[<span class="stringliteral">&#39;classes_array&#39;</span>][] = <span class="stringliteral">&#39;two-sidebars&#39;</span>;
<a name="l02762"></a>02762   }
<a name="l02763"></a>02763   elseif ($variables[<span class="stringliteral">&#39;layout&#39;</span>] == <span class="stringliteral">&#39;none&#39;</span>) {
<a name="l02764"></a>02764     $variables[<span class="stringliteral">&#39;classes_array&#39;</span>][] = <span class="stringliteral">&#39;no-sidebars&#39;</span>;
<a name="l02765"></a>02765   }
<a name="l02766"></a>02766   <span class="keywordflow">else</span> {
<a name="l02767"></a>02767     $variables[<span class="stringliteral">&#39;classes_array&#39;</span>][] = <span class="stringliteral">&#39;one-sidebar sidebar-&#39;</span> . $variables[<span class="stringliteral">&#39;layout&#39;</span>];
<a name="l02768"></a>02768   }
<a name="l02769"></a>02769 
<a name="l02770"></a>02770   <span class="comment">// Dead databases will show error messages so supplying this template will</span>
<a name="l02771"></a>02771   <span class="comment">// allow themers to override the page and the content completely.</span>
<a name="l02772"></a>02772   <span class="keywordflow">if</span> (isset($variables[<span class="stringliteral">&#39;db_is_active&#39;</span>]) &amp;&amp; !$variables[<span class="stringliteral">&#39;db_is_active&#39;</span>]) {
<a name="l02773"></a>02773     $variables[<span class="stringliteral">&#39;theme_hook_suggestion&#39;</span>] = <span class="stringliteral">&#39;maintenance_page__offline&#39;</span>;
<a name="l02774"></a>02774   }
<a name="l02775"></a>02775 }
<a name="l02776"></a>02776 
<a name="l02783"></a><a class="code" href="theme_8inc_a00d988137020fd53ecaab7dfd4d9b1a5.html#a00d988137020fd53ecaab7dfd4d9b1a5">02783</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a00d988137020fd53ecaab7dfd4d9b1a5.html#a00d988137020fd53ecaab7dfd4d9b1a5" title="The variables array generated here is a mirror of template_process_html().">template_process_maintenance_page</a>(&amp;$variables) {
<a name="l02784"></a>02784   $variables[<span class="stringliteral">&#39;head&#39;</span>]    = <a class="code" href="common_8inc_acdee011d76859a5a9280209df1175188.html#acdee011d76859a5a9280209df1175188" title="Retrieves output to be displayed in the HEAD tag of the HTML page.">drupal_get_html_head</a>();
<a name="l02785"></a>02785   $variables[<span class="stringliteral">&#39;css&#39;</span>]     = <a class="code" href="common_8inc_a2c5bb2667efb44b02f1a105c0bfdebe5.html#a2c5bb2667efb44b02f1a105c0bfdebe5" title="Adds a cascading stylesheet to the stylesheet queue.">drupal_add_css</a>();
<a name="l02786"></a>02786   $variables[<span class="stringliteral">&#39;styles&#39;</span>]  = <a class="code" href="common_8inc_a2e308371f339fbb54967045ccbe4e88c.html#a2e308371f339fbb54967045ccbe4e88c" title="Returns a themed representation of all stylesheets to attach to the page.">drupal_get_css</a>();
<a name="l02787"></a>02787   $variables[<span class="stringliteral">&#39;scripts&#39;</span>] = <a class="code" href="common_8inc_ac4d279ffd40eae67ace8459cd3e6e3b5.html#ac4d279ffd40eae67ace8459cd3e6e3b5" title="Returns a themed presentation of all JavaScript code for the current page.">drupal_get_js</a>();
<a name="l02788"></a>02788 }
<a name="l02789"></a>02789 
<a name="l02800"></a><a class="code" href="theme_8inc_a587933392ed2e45a220b08c5708ecaab.html#a587933392ed2e45a220b08c5708ecaab">02800</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a587933392ed2e45a220b08c5708ecaab.html#a587933392ed2e45a220b08c5708ecaab" title="Preprocess variables for region.tpl.php.">template_preprocess_region</a>(&amp;$variables) {
<a name="l02801"></a>02801   <span class="comment">// Create the $content variable that templates expect.</span>
<a name="l02802"></a>02802   $variables[<span class="stringliteral">&#39;content&#39;</span>] = $variables[<span class="stringliteral">&#39;elements&#39;</span>][<span class="stringliteral">&#39;#children&#39;</span>];
<a name="l02803"></a>02803   $variables[<span class="stringliteral">&#39;region&#39;</span>] = $variables[<span class="stringliteral">&#39;elements&#39;</span>][<span class="stringliteral">&#39;#region&#39;</span>];
<a name="l02804"></a>02804 
<a name="l02805"></a>02805   $variables[<span class="stringliteral">&#39;classes_array&#39;</span>][] = <a class="code" href="common_8inc_a601489210268565d75adb9af61643e6c.html#a601489210268565d75adb9af61643e6c" title="Provides a standard HTML class name that identifies a page region.">drupal_region_class</a>($variables[<span class="stringliteral">&#39;region&#39;</span>]);
<a name="l02806"></a>02806   $variables[<span class="stringliteral">&#39;theme_hook_suggestions&#39;</span>][] = <span class="stringliteral">&#39;region__&#39;</span> . $variables[<span class="stringliteral">&#39;region&#39;</span>];
<a name="l02807"></a>02807 }
<a name="l02808"></a>02808 
<a name="l02818"></a><a class="code" href="theme_8inc_a102e6392077c4dc3810ec48fdf60fd8c.html#a102e6392077c4dc3810ec48fdf60fd8c">02818</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_a102e6392077c4dc3810ec48fdf60fd8c.html#a102e6392077c4dc3810ec48fdf60fd8c" title="Preprocesses variables for theme_username().">template_preprocess_username</a>(&amp;$variables) {
<a name="l02819"></a>02819   $account = $variables[<span class="stringliteral">&#39;account&#39;</span>];
<a name="l02820"></a>02820 
<a name="l02821"></a>02821   $variables[<span class="stringliteral">&#39;extra&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02822"></a>02822   <span class="keywordflow">if</span> (empty($account-&gt;uid)) {
<a name="l02823"></a>02823    $variables[<span class="stringliteral">&#39;uid&#39;</span>] = 0;
<a name="l02824"></a>02824    <span class="keywordflow">if</span> (<a class="code" href="theme_8inc_a7cb0fd8d3be02b386d3bd88a3f1dcf1f.html#a7cb0fd8d3be02b386d3bd88a3f1dcf1f" title="Retrieve a setting for the current theme or for a given theme.">theme_get_setting</a>(<span class="stringliteral">&#39;toggle_comment_user_verification&#39;</span>)) {
<a name="l02825"></a>02825      $variables[<span class="stringliteral">&#39;extra&#39;</span>] = <span class="stringliteral">&#39; (&#39;</span> . <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;not verified&#39;</span>) . <span class="charliteral">&#39;)&#39;</span>;
<a name="l02826"></a>02826    }
<a name="l02827"></a>02827   }
<a name="l02828"></a>02828   <span class="keywordflow">else</span> {
<a name="l02829"></a>02829     $variables[<span class="stringliteral">&#39;uid&#39;</span>] = (int) $account-&gt;uid;
<a name="l02830"></a>02830   }
<a name="l02831"></a>02831 
<a name="l02832"></a>02832   <span class="comment">// Set the name to a formatted name that is safe for printing and</span>
<a name="l02833"></a>02833   <span class="comment">// that won&#39;t break tables by being too long. Keep an unshortened,</span>
<a name="l02834"></a>02834   <span class="comment">// unsanitized version, in case other preprocess functions want to implement</span>
<a name="l02835"></a>02835   <span class="comment">// their own shortening logic or add markup. If they do so, they must ensure</span>
<a name="l02836"></a>02836   <span class="comment">// that $variables[&#39;name&#39;] is safe for printing.</span>
<a name="l02837"></a>02837   $name = $variables[<span class="stringliteral">&#39;name_raw&#39;</span>] = <a class="code" href="group__format_ga7124a026ecfacc51c57a75fcc083f136.html#ga7124a026ecfacc51c57a75fcc083f136" title="Format a username.">format_username</a>($account);
<a name="l02838"></a>02838   <span class="keywordflow">if</span> (<a class="code" href="group__php__wrappers_gae8a4670a2f9b1c67d02259a49ee3ec7e.html#gae8a4670a2f9b1c67d02259a49ee3ec7e" title="Count the amount of characters in a UTF-8 string.">drupal_strlen</a>($name) &gt; 20) {
<a name="l02839"></a>02839     $name = <a class="code" href="group__php__wrappers_gabe05f7e9107211f3ad82b564b1d7d598.html#gabe05f7e9107211f3ad82b564b1d7d598" title="Cut off a piece of a string based on character indices and counts.">drupal_substr</a>($name, 0, 15) . <span class="stringliteral">&#39;...&#39;</span>;
<a name="l02840"></a>02840   }
<a name="l02841"></a>02841   $variables[<span class="stringliteral">&#39;name&#39;</span>] = <a class="code" href="group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d.html#ga76fc67a30fd8d75ddd80565e6e65a13d" title="Encodes special characters in a plain-text string for display as HTML.">check_plain</a>($name);
<a name="l02842"></a>02842 
<a name="l02843"></a>02843   $variables[<span class="stringliteral">&#39;profile_access&#39;</span>] = user_access(<span class="stringliteral">&#39;access user profiles&#39;</span>);
<a name="l02844"></a>02844   $variables[<span class="stringliteral">&#39;link_attributes&#39;</span>] = array();
<a name="l02845"></a>02845   <span class="comment">// Populate link path and attributes if appropriate.</span>
<a name="l02846"></a>02846   <span class="keywordflow">if</span> ($variables[<span class="stringliteral">&#39;uid&#39;</span>] &amp;&amp; $variables[<span class="stringliteral">&#39;profile_access&#39;</span>]) {
<a name="l02847"></a>02847     <span class="comment">// We are linking to a local user.</span>
<a name="l02848"></a>02848     $variables[<span class="stringliteral">&#39;link_attributes&#39;</span>] = array(<span class="stringliteral">&#39;title&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;View user profile.&#39;</span>));
<a name="l02849"></a>02849     $variables[<span class="stringliteral">&#39;link_path&#39;</span>] = <span class="stringliteral">&#39;user/&#39;</span> . $variables[<span class="stringliteral">&#39;uid&#39;</span>];
<a name="l02850"></a>02850   }
<a name="l02851"></a>02851   elseif (!empty($account-&gt;homepage)) {
<a name="l02852"></a>02852     <span class="comment">// Like the &#39;class&#39; attribute, the &#39;rel&#39; attribute can hold a</span>
<a name="l02853"></a>02853     <span class="comment">// space-separated set of values, so initialize it as an array to make it</span>
<a name="l02854"></a>02854     <span class="comment">// easier for other preprocess functions to append to it.</span>
<a name="l02855"></a>02855     $variables[<span class="stringliteral">&#39;link_attributes&#39;</span>] = array(<span class="stringliteral">&#39;rel&#39;</span> =&gt; array(<span class="stringliteral">&#39;nofollow&#39;</span>));
<a name="l02856"></a>02856     $variables[<span class="stringliteral">&#39;link_path&#39;</span>] = $account-&gt;homepage;
<a name="l02857"></a>02857     $variables[<span class="stringliteral">&#39;homepage&#39;</span>] = $account-&gt;homepage;
<a name="l02858"></a>02858   }
<a name="l02859"></a>02859   <span class="comment">// We do not want the l() function to check_plain() a second time.</span>
<a name="l02860"></a>02860   $variables[<span class="stringliteral">&#39;link_options&#39;</span>][<span class="stringliteral">&#39;html&#39;</span>] = TRUE;
<a name="l02861"></a>02861   <span class="comment">// Set a default class.</span>
<a name="l02862"></a>02862   $variables[<span class="stringliteral">&#39;attributes_array&#39;</span>] = array(<span class="stringliteral">&#39;class&#39;</span> =&gt; array(<span class="stringliteral">&#39;username&#39;</span>));
<a name="l02863"></a>02863 }
<a name="l02864"></a>02864 
<a name="l02870"></a><a class="code" href="theme_8inc_abc04f244a6775dd537c6dd2a7397060c.html#abc04f244a6775dd537c6dd2a7397060c">02870</a> <span class="keyword">function</span> <a class="code" href="theme_8inc_abc04f244a6775dd537c6dd2a7397060c.html#abc04f244a6775dd537c6dd2a7397060c" title="Processes variables for theme_username().">template_process_username</a>(&amp;$variables) {
<a name="l02871"></a>02871   <span class="comment">// Finalize the link_options array for passing to the l() function.</span>
<a name="l02872"></a>02872   <span class="comment">// This is done in the process phase so that attributes may be added by</span>
<a name="l02873"></a>02873   <span class="comment">// modules or the theme during the preprocess phase.</span>
<a name="l02874"></a>02874   <span class="keywordflow">if</span> (isset($variables[<span class="stringliteral">&#39;link_path&#39;</span>])) {
<a name="l02875"></a>02875     <span class="comment">// $variables[&#39;attributes_array&#39;] contains attributes that should be applied</span>
<a name="l02876"></a>02876     <span class="comment">// regardless of whether a link is being rendered or not.</span>
<a name="l02877"></a>02877     <span class="comment">// $variables[&#39;link_attributes&#39;] contains attributes that should only be</span>
<a name="l02878"></a>02878     <span class="comment">// applied if a link is being rendered. Preprocess functions are encouraged</span>
<a name="l02879"></a>02879     <span class="comment">// to use the former unless they want to add attributes on the link only.</span>
<a name="l02880"></a>02880     <span class="comment">// If a link is being rendered, these need to be merged. Some attributes are</span>
<a name="l02881"></a>02881     <span class="comment">// themselves arrays, so the merging needs to be recursive.</span>
<a name="l02882"></a>02882     $variables[<span class="stringliteral">&#39;link_options&#39;</span>][<span class="stringliteral">&#39;attributes&#39;</span>] = array_merge_recursive($variables[<span class="stringliteral">&#39;link_attributes&#39;</span>], $variables[<span class="stringliteral">&#39;attributes_array&#39;</span>]);
<a name="l02883"></a>02883   }
<a name="l02884"></a>02884 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 22 2012 16:46:14 for Shopcart by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
