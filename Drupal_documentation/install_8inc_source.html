<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Shopcart: includes/install.inc Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Shopcart
   &#160;<span id="projectnumber">version2.0</span>
   </div>
   <div id="projectbrief">Shoppingcart</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_5b89693129504707d608c5412e7b88d4.html">includes</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">install.inc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="install_8inc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00006"></a><a class="code" href="install_8inc_ab2f11b038ed6a537bfdd257be863075f.html#ab2f11b038ed6a537bfdd257be863075f">00006</a> define(<span class="stringliteral">&#39;SCHEMA_UNINSTALLED&#39;</span>, -1);
<a name="l00007"></a>00007 
<a name="l00011"></a><a class="code" href="install_8inc_aaa1b441be0b54ef62f6ea8d391f9cc99.html#aaa1b441be0b54ef62f6ea8d391f9cc99">00011</a> define(<span class="stringliteral">&#39;SCHEMA_INSTALLED&#39;</span>, 0);
<a name="l00012"></a>00012 
<a name="l00016"></a><a class="code" href="install_8inc_ab679de0810b6a879525b822fa33e3d75.html#ab679de0810b6a879525b822fa33e3d75">00016</a> define(<span class="stringliteral">&#39;REQUIREMENT_INFO&#39;</span>, -1);
<a name="l00017"></a>00017 
<a name="l00021"></a><a class="code" href="install_8inc_add48d60abb0dc390c50bf824f1751cc2.html#add48d60abb0dc390c50bf824f1751cc2">00021</a> define(<span class="stringliteral">&#39;REQUIREMENT_OK&#39;</span>, 0);
<a name="l00022"></a>00022 
<a name="l00026"></a><a class="code" href="install_8inc_a2879fcef075548b2dceeeaa9571dcf8d.html#a2879fcef075548b2dceeeaa9571dcf8d">00026</a> define(<span class="stringliteral">&#39;REQUIREMENT_WARNING&#39;</span>, 1);
<a name="l00027"></a>00027 
<a name="l00031"></a><a class="code" href="install_8inc_aeddf02286107904721cb582bd430581d.html#aeddf02286107904721cb582bd430581d">00031</a> define(<span class="stringliteral">&#39;REQUIREMENT_ERROR&#39;</span>, 2);
<a name="l00032"></a>00032 
<a name="l00036"></a><a class="code" href="install_8inc_ae627ec3bb64949659adbc8cac5ae063e.html#ae627ec3bb64949659adbc8cac5ae063e">00036</a> define(<span class="stringliteral">&#39;FILE_EXIST&#39;</span>, 1);
<a name="l00037"></a>00037 
<a name="l00041"></a><a class="code" href="install_8inc_a5a3ab6bb8b0df419dff1d9c741e5ca56.html#a5a3ab6bb8b0df419dff1d9c741e5ca56">00041</a> define(<span class="stringliteral">&#39;FILE_READABLE&#39;</span>, 2);
<a name="l00042"></a>00042 
<a name="l00046"></a><a class="code" href="install_8inc_a18edb581d332bd2fe379104a39e3b1a2.html#a18edb581d332bd2fe379104a39e3b1a2">00046</a> define(<span class="stringliteral">&#39;FILE_WRITABLE&#39;</span>, 4);
<a name="l00047"></a>00047 
<a name="l00051"></a><a class="code" href="install_8inc_a03399711a43d84ee8783b8b1214dd429.html#a03399711a43d84ee8783b8b1214dd429">00051</a> define(<span class="stringliteral">&#39;FILE_EXECUTABLE&#39;</span>, 8);
<a name="l00052"></a>00052 
<a name="l00056"></a><a class="code" href="install_8inc_a2d02367d8fd76c70b1ffb77b24e62db9.html#a2d02367d8fd76c70b1ffb77b24e62db9">00056</a> define(<span class="stringliteral">&#39;FILE_NOT_EXIST&#39;</span>, 16);
<a name="l00057"></a>00057 
<a name="l00061"></a><a class="code" href="install_8inc_ab09b4a70a73804ec35333d43a878a572.html#ab09b4a70a73804ec35333d43a878a572">00061</a> define(<span class="stringliteral">&#39;FILE_NOT_READABLE&#39;</span>, 32);
<a name="l00062"></a>00062 
<a name="l00066"></a><a class="code" href="install_8inc_a01939e1b55bf40d1ac3556eded13a353.html#a01939e1b55bf40d1ac3556eded13a353">00066</a> define(<span class="stringliteral">&#39;FILE_NOT_WRITABLE&#39;</span>, 64);
<a name="l00067"></a>00067 
<a name="l00071"></a><a class="code" href="install_8inc_a3c1acd6083afd2e6d977616f227fcf26.html#a3c1acd6083afd2e6d977616f227fcf26">00071</a> define(<span class="stringliteral">&#39;FILE_NOT_EXECUTABLE&#39;</span>, 128);
<a name="l00072"></a>00072 
<a name="l00076"></a><a class="code" href="install_8inc_a0c6d0aed425d08e6001378191d6bc1d9.html#a0c6d0aed425d08e6001378191d6bc1d9">00076</a> <span class="keyword">function</span> <a class="code" href="install_8inc_a0c6d0aed425d08e6001378191d6bc1d9.html#a0c6d0aed425d08e6001378191d6bc1d9" title="Initialize the update system by loading all installed module&#39;s .install files.">drupal_load_updates</a>() {
<a name="l00077"></a>00077   <span class="keywordflow">foreach</span> (<a class="code" href="install_8inc_a7702ece36adbef6e165e6f9c2bde5953.html#a7702ece36adbef6e165e6f9c2bde5953" title="Returns the currently installed schema version for a module.">drupal_get_installed_schema_version</a>(NULL, FALSE, TRUE) as $module =&gt; $schema_version) {
<a name="l00078"></a>00078     <span class="keywordflow">if</span> ($schema_version &gt; -1) {
<a name="l00079"></a>00079       <a class="code" href="module_8inc_a77a6101f363c066eafbe29b26af5bfd3.html#a77a6101f363c066eafbe29b26af5bfd3" title="Load a module&#39;s installation hooks.">module_load_install</a>($module);
<a name="l00080"></a>00080     }
<a name="l00081"></a>00081   }
<a name="l00082"></a>00082 }
<a name="l00083"></a>00083 
<a name="l00093"></a><a class="code" href="install_8inc_a1e68a61662f821bde8606568fda7bf58.html#a1e68a61662f821bde8606568fda7bf58">00093</a> <span class="keyword">function</span> <a class="code" href="install_8inc_a1e68a61662f821bde8606568fda7bf58.html#a1e68a61662f821bde8606568fda7bf58" title="Returns an array of available schema versions for a module.">drupal_get_schema_versions</a>($module) {
<a name="l00094"></a>00094   $updates = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__, NULL);
<a name="l00095"></a>00095   <span class="keywordflow">if</span> (!isset($updates[$module])) {
<a name="l00096"></a>00096     $updates = array();
<a name="l00097"></a>00097 
<a name="l00098"></a>00098     <span class="keywordflow">foreach</span> (<a class="code" href="module_8inc_ad4ef444bbb8e56724e12908cf9b6e1aa.html#ad4ef444bbb8e56724e12908cf9b6e1aa" title="Returns a list of currently active modules.">module_list</a>() as $loaded_module) {
<a name="l00099"></a>00099       $updates[$loaded_module] = array();
<a name="l00100"></a>00100     }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102     <span class="comment">// Prepare regular expression to match all possible defined hook_update_N().</span>
<a name="l00103"></a>00103     $regexp = <span class="stringliteral">&#39;/^(?P&lt;module&gt;.+)_update_(?P&lt;version&gt;\d+)$/&#39;</span>;
<a name="l00104"></a>00104     $functions = get_defined_functions();
<a name="l00105"></a>00105     <span class="comment">// Narrow this down to functions ending with an integer, since all</span>
<a name="l00106"></a>00106     <span class="comment">// hook_update_N() functions end this way, and there are other</span>
<a name="l00107"></a>00107     <span class="comment">// possible functions which match &#39;_update_&#39;. We use preg_grep() here</span>
<a name="l00108"></a>00108     <span class="comment">// instead of foreaching through all defined functions, since the loop</span>
<a name="l00109"></a>00109     <span class="comment">// through all PHP functions can take significant page execution time</span>
<a name="l00110"></a>00110     <span class="comment">// and this function is called on every administrative page via</span>
<a name="l00111"></a>00111     <span class="comment">// system_requirements().</span>
<a name="l00112"></a>00112     <span class="keywordflow">foreach</span> (preg_grep(<span class="stringliteral">&#39;/_\d+$/&#39;</span>, $functions[<span class="stringliteral">&#39;user&#39;</span>]) as $function) {
<a name="l00113"></a>00113       <span class="comment">// If this function is a module update function, add it to the list of</span>
<a name="l00114"></a>00114       <span class="comment">// module updates.</span>
<a name="l00115"></a>00115       <span class="keywordflow">if</span> (preg_match($regexp, $function, $matches)) {
<a name="l00116"></a>00116         $updates[$matches[<span class="stringliteral">&#39;module&#39;</span>]][] = $matches[<span class="stringliteral">&#39;version&#39;</span>];
<a name="l00117"></a>00117       }
<a name="l00118"></a>00118     }
<a name="l00119"></a>00119     <span class="comment">// Ensure that updates are applied in numerical order.</span>
<a name="l00120"></a>00120     <span class="keywordflow">foreach</span> ($updates as &amp;$module_updates) {
<a name="l00121"></a>00121       sort($module_updates, SORT_NUMERIC);
<a name="l00122"></a>00122     }
<a name="l00123"></a>00123   }
<a name="l00124"></a>00124   <span class="keywordflow">return</span> empty($updates[$module]) ? FALSE : $updates[$module];
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00141"></a><a class="code" href="install_8inc_a7702ece36adbef6e165e6f9c2bde5953.html#a7702ece36adbef6e165e6f9c2bde5953">00141</a> <span class="keyword">function</span> <a class="code" href="install_8inc_a7702ece36adbef6e165e6f9c2bde5953.html#a7702ece36adbef6e165e6f9c2bde5953" title="Returns the currently installed schema version for a module.">drupal_get_installed_schema_version</a>($module, $reset = FALSE, $array = FALSE) {
<a name="l00142"></a>00142   <span class="keyword">static</span> $versions = array();
<a name="l00143"></a>00143 
<a name="l00144"></a>00144   <span class="keywordflow">if</span> ($reset) {
<a name="l00145"></a>00145     $versions = array();
<a name="l00146"></a>00146   }
<a name="l00147"></a>00147 
<a name="l00148"></a>00148   <span class="keywordflow">if</span> (!$versions) {
<a name="l00149"></a>00149     $versions = array();
<a name="l00150"></a>00150     $result = <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>(<span class="stringliteral">&quot;SELECT name, schema_version FROM {system} WHERE type = :type&quot;</span>, array(<span class="stringliteral">&#39;:type&#39;</span> =&gt; <span class="stringliteral">&#39;module&#39;</span>));
<a name="l00151"></a>00151     <span class="keywordflow">foreach</span> ($result as $row) {
<a name="l00152"></a>00152       $versions[$row-&gt;name] = $row-&gt;schema_version;
<a name="l00153"></a>00153     }
<a name="l00154"></a>00154   }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156   <span class="keywordflow">if</span> ($array) {
<a name="l00157"></a>00157     <span class="keywordflow">return</span> $versions;
<a name="l00158"></a>00158   }
<a name="l00159"></a>00159   <span class="keywordflow">else</span> {
<a name="l00160"></a>00160     <span class="keywordflow">return</span> isset($versions[$module]) ? $versions[$module] : <a class="code" href="install_8inc_ab2f11b038ed6a537bfdd257be863075f.html#ab2f11b038ed6a537bfdd257be863075f" title="Indicates that a module has not been installed yet.">SCHEMA_UNINSTALLED</a>;
<a name="l00161"></a>00161   }
<a name="l00162"></a>00162 }
<a name="l00163"></a>00163 
<a name="l00172"></a><a class="code" href="install_8inc_a2bc19b43e5872bf61c359839ccaec97b.html#a2bc19b43e5872bf61c359839ccaec97b">00172</a> <span class="keyword">function</span> <a class="code" href="install_8inc_a2bc19b43e5872bf61c359839ccaec97b.html#a2bc19b43e5872bf61c359839ccaec97b" title="Update the installed version information for a module.">drupal_set_installed_schema_version</a>($module, $version) {
<a name="l00173"></a>00173   <a class="code" href="group__database_ga40967197ee5d6a23a5c5a77e627067fe.html#ga40967197ee5d6a23a5c5a77e627067fe" title="Returns a new UpdateQuery object for the active database.">db_update</a>(<span class="stringliteral">&#39;system&#39;</span>)
<a name="l00174"></a>00174     -&gt;fields(array(<span class="stringliteral">&#39;schema_version&#39;</span> =&gt; $version))
<a name="l00175"></a>00175     -&gt;condition(<span class="stringliteral">&#39;name&#39;</span>, $module)
<a name="l00176"></a>00176     -&gt;execute();
<a name="l00177"></a>00177 
<a name="l00178"></a>00178   <span class="comment">// Reset the static cache of module schema versions.</span>
<a name="l00179"></a>00179   <a class="code" href="install_8inc_a7702ece36adbef6e165e6f9c2bde5953.html#a7702ece36adbef6e165e6f9c2bde5953" title="Returns the currently installed schema version for a module.">drupal_get_installed_schema_version</a>(NULL, TRUE);
<a name="l00180"></a>00180 }
<a name="l00181"></a>00181 
<a name="l00191"></a><a class="code" href="install_8inc_a52c56958ff42269107b5a678e8d95ddc.html#a52c56958ff42269107b5a678e8d95ddc">00191</a> <span class="keyword">function</span> <a class="code" href="install_8inc_a52c56958ff42269107b5a678e8d95ddc.html#a52c56958ff42269107b5a678e8d95ddc" title="Loads the install profile, extracting its defined distribution name.">drupal_install_profile_distribution_name</a>() {
<a name="l00192"></a>00192   <span class="comment">// During installation, the profile information is stored in the global</span>
<a name="l00193"></a>00193   <span class="comment">// installation state (it might not be saved anywhere yet).</span>
<a name="l00194"></a>00194   <span class="keywordflow">if</span> (<a class="code" href="bootstrap_8inc_ac9902394c447118612c3a71191151f2c.html#ac9902394c447118612c3a71191151f2c" title="Returns TRUE if a Drupal installation is currently being attempted.">drupal_installation_attempted</a>()) {
<a name="l00195"></a>00195     global $install_state;
<a name="l00196"></a>00196     <span class="keywordflow">return</span> $install_state[<span class="stringliteral">&#39;profile_info&#39;</span>][<span class="stringliteral">&#39;distribution_name&#39;</span>];
<a name="l00197"></a>00197   }
<a name="l00198"></a>00198   <span class="comment">// At all other times, we load the profile via standard methods.</span>
<a name="l00199"></a>00199   <span class="keywordflow">else</span> {
<a name="l00200"></a>00200     $profile = <a class="code" href="common_8inc_a4128f0023ccec2d1a9a40987f0131d83.html#a4128f0023ccec2d1a9a40987f0131d83" title="Gets the name of the currently active install profile.">drupal_get_profile</a>();
<a name="l00201"></a>00201     $info = system_get_info(<span class="stringliteral">&#39;module&#39;</span>, $profile);
<a name="l00202"></a>00202     <span class="keywordflow">return</span> $info[<span class="stringliteral">&#39;distribution_name&#39;</span>];
<a name="l00203"></a>00203   }
<a name="l00204"></a>00204 }
<a name="l00205"></a>00205 
<a name="l00215"></a><a class="code" href="install_8inc_a1b5de87184840c5b386aa8f109271b9e.html#a1b5de87184840c5b386aa8f109271b9e">00215</a> <span class="keyword">function</span> <a class="code" href="install_8inc_a1b5de87184840c5b386aa8f109271b9e.html#a1b5de87184840c5b386aa8f109271b9e" title="Auto detect the base_url with PHP predefined variables.">drupal_detect_baseurl</a>($file = <span class="stringliteral">&#39;install.php&#39;</span>) {
<a name="l00216"></a>00216   $proto = $_SERVER[<span class="stringliteral">&#39;HTTPS&#39;</span>] ? <span class="stringliteral">&#39;https://&#39;</span> : <span class="stringliteral">&#39;http://&#39;</span>;
<a name="l00217"></a>00217   $host = $_SERVER[<span class="stringliteral">&#39;SERVER_NAME&#39;</span>];
<a name="l00218"></a>00218   $port = ($_SERVER[<span class="stringliteral">&#39;SERVER_PORT&#39;</span>] == 80 ? <span class="stringliteral">&#39;&#39;</span> : <span class="charliteral">&#39;:&#39;</span> . $_SERVER[<span class="stringliteral">&#39;SERVER_PORT&#39;</span>]);
<a name="l00219"></a>00219   $uri = preg_replace(<span class="stringliteral">&quot;/\?.*/&quot;</span>, <span class="stringliteral">&#39;&#39;</span>, $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>]);
<a name="l00220"></a>00220   $dir = str_replace(<span class="stringliteral">&quot;/$file&quot;</span>, <span class="stringliteral">&#39;&#39;</span>, $uri);
<a name="l00221"></a>00221 
<a name="l00222"></a>00222   <span class="keywordflow">return</span> <span class="stringliteral">&quot;$proto$host$port$dir&quot;</span>;
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 
<a name="l00231"></a><a class="code" href="install_8inc_a714eb7ff779f55f4b330a995f9f92cd4.html#a714eb7ff779f55f4b330a995f9f92cd4">00231</a> <span class="keyword">function</span> <a class="code" href="install_8inc_a714eb7ff779f55f4b330a995f9f92cd4.html#a714eb7ff779f55f4b330a995f9f92cd4" title="Detect all supported databases that are compiled into PHP.">drupal_detect_database_types</a>() {
<a name="l00232"></a>00232   <a class="code" href="default_8settings_8php_a97cde67402a68697692531e8b067f86f.html#a97cde67402a68697692531e8b067f86f" title="Database settings:">$databases</a> = <a class="code" href="install_8inc_acc31c9690e30c375bba969c4e5584c71.html#acc31c9690e30c375bba969c4e5584c71" title="Return all supported database installer objects that are compiled into PHP.">drupal_get_database_types</a>();
<a name="l00233"></a>00233 
<a name="l00234"></a>00234   <span class="keywordflow">foreach</span> (<a class="code" href="default_8settings_8php_a97cde67402a68697692531e8b067f86f.html#a97cde67402a68697692531e8b067f86f" title="Database settings:">$databases</a> as $driver =&gt; $installer) {
<a name="l00235"></a>00235     <a class="code" href="default_8settings_8php_a97cde67402a68697692531e8b067f86f.html#a97cde67402a68697692531e8b067f86f" title="Database settings:">$databases</a>[$driver] = $installer-&gt;name();
<a name="l00236"></a>00236   }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238   <span class="keywordflow">return</span> <a class="code" href="default_8settings_8php_a97cde67402a68697692531e8b067f86f.html#a97cde67402a68697692531e8b067f86f" title="Database settings:">$databases</a>;
<a name="l00239"></a>00239 }
<a name="l00240"></a>00240 
<a name="l00247"></a><a class="code" href="install_8inc_acc31c9690e30c375bba969c4e5584c71.html#acc31c9690e30c375bba969c4e5584c71">00247</a> <span class="keyword">function</span> <a class="code" href="install_8inc_acc31c9690e30c375bba969c4e5584c71.html#acc31c9690e30c375bba969c4e5584c71" title="Return all supported database installer objects that are compiled into PHP.">drupal_get_database_types</a>() {
<a name="l00248"></a>00248   <a class="code" href="default_8settings_8php_a97cde67402a68697692531e8b067f86f.html#a97cde67402a68697692531e8b067f86f" title="Database settings:">$databases</a> = array();
<a name="l00249"></a>00249 
<a name="l00250"></a>00250   <span class="comment">// We define a driver as a directory in /includes/database that in turn</span>
<a name="l00251"></a>00251   <span class="comment">// contains a database.inc file. That allows us to drop in additional drivers</span>
<a name="l00252"></a>00252   <span class="comment">// without modifying the installer.</span>
<a name="l00253"></a>00253   <span class="comment">// Because we have no registry yet, we need to also include the install.inc</span>
<a name="l00254"></a>00254   <span class="comment">// file for the driver explicitly.</span>
<a name="l00255"></a>00255   require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/database/database.inc&#39;</span>;
<a name="l00256"></a>00256   <span class="keywordflow">foreach</span> (<a class="code" href="group__file_ga363e988787ffa45bff69ff051eed0615.html#ga363e988787ffa45bff69ff051eed0615" title="Finds all files that match a given mask in a given directory.">file_scan_directory</a>(<a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/database&#39;</span>, <span class="stringliteral">&#39;/^[a-z]*$/i&#39;</span>, array(<span class="stringliteral">&#39;recurse&#39;</span> =&gt; FALSE)) as $file) {
<a name="l00257"></a>00257     <span class="keywordflow">if</span> (file_exists($file-&gt;uri . <span class="stringliteral">&#39;/database.inc&#39;</span>) &amp;&amp; file_exists($file-&gt;uri . <span class="stringliteral">&#39;/install.inc&#39;</span>)) {
<a name="l00258"></a>00258       $drivers[$file-&gt;filename] = $file-&gt;uri;
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260   }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262   <span class="keywordflow">foreach</span> ($drivers as $driver =&gt; $file) {
<a name="l00263"></a>00263     $installer = <a class="code" href="install_8inc_aae9b6ee5100acd83eabbb2b2c2ab02c6.html#aae9b6ee5100acd83eabbb2b2c2ab02c6" title="Returns a database installer object.">db_installer_object</a>($driver);
<a name="l00264"></a>00264     <span class="keywordflow">if</span> ($installer-&gt;installable()) {
<a name="l00265"></a>00265       <a class="code" href="default_8settings_8php_a97cde67402a68697692531e8b067f86f.html#a97cde67402a68697692531e8b067f86f" title="Database settings:">$databases</a>[$driver] = $installer;
<a name="l00266"></a>00266     }
<a name="l00267"></a>00267   }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269   <span class="comment">// Usability: unconditionally put the MySQL driver on top.</span>
<a name="l00270"></a>00270   <span class="keywordflow">if</span> (isset(<a class="code" href="default_8settings_8php_a97cde67402a68697692531e8b067f86f.html#a97cde67402a68697692531e8b067f86f" title="Database settings:">$databases</a>[<span class="stringliteral">&#39;mysql&#39;</span>])) {
<a name="l00271"></a>00271     $mysql_database = <a class="code" href="default_8settings_8php_a97cde67402a68697692531e8b067f86f.html#a97cde67402a68697692531e8b067f86f" title="Database settings:">$databases</a>[<span class="stringliteral">&#39;mysql&#39;</span>];
<a name="l00272"></a>00272     unset(<a class="code" href="default_8settings_8php_a97cde67402a68697692531e8b067f86f.html#a97cde67402a68697692531e8b067f86f" title="Database settings:">$databases</a>[<span class="stringliteral">&#39;mysql&#39;</span>]);
<a name="l00273"></a>00273     <a class="code" href="default_8settings_8php_a97cde67402a68697692531e8b067f86f.html#a97cde67402a68697692531e8b067f86f" title="Database settings:">$databases</a> = array(<span class="stringliteral">&#39;mysql&#39;</span> =&gt; $mysql_database) + <a class="code" href="default_8settings_8php_a97cde67402a68697692531e8b067f86f.html#a97cde67402a68697692531e8b067f86f" title="Database settings:">$databases</a>;
<a name="l00274"></a>00274   }
<a name="l00275"></a>00275 
<a name="l00276"></a>00276   <span class="keywordflow">return</span> <a class="code" href="default_8settings_8php_a97cde67402a68697692531e8b067f86f.html#a97cde67402a68697692531e8b067f86f" title="Database settings:">$databases</a>;
<a name="l00277"></a>00277 }
<a name="l00278"></a>00278 
<a name="l00284"></a><a class="code" href="classDatabaseTasks.html">00284</a> <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="classDatabaseTasks.html" title="Database installer structure.">DatabaseTasks</a> {
<a name="l00285"></a>00285 
<a name="l00294"></a><a class="code" href="classDatabaseTasks_abe98e1901f232f60a8690b0af4b2b8ab.html#abe98e1901f232f60a8690b0af4b2b8ab">00294</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseTasks_abe98e1901f232f60a8690b0af4b2b8ab.html#abe98e1901f232f60a8690b0af4b2b8ab">$tasks</a> = array(
<a name="l00295"></a>00295     array(
<a name="l00296"></a>00296       <span class="stringliteral">&#39;function&#39;</span>    =&gt; <span class="stringliteral">&#39;checkEngineVersion&#39;</span>,
<a name="l00297"></a>00297       <span class="stringliteral">&#39;arguments&#39;</span>   =&gt; array(),
<a name="l00298"></a>00298     ),
<a name="l00299"></a>00299     array(
<a name="l00300"></a>00300       <span class="stringliteral">&#39;arguments&#39;</span>   =&gt; array(
<a name="l00301"></a>00301         <span class="stringliteral">&#39;CREATE TABLE {drupal_install_test} (id int NULL)&#39;</span>,
<a name="l00302"></a>00302         <span class="stringliteral">&#39;Drupal can use CREATE TABLE database commands.&#39;</span>,
<a name="l00303"></a>00303         <span class="stringliteral">&#39;Failed to &lt;strong&gt;CREATE&lt;/strong&gt; a test table on your database server with the command %query. The server reports the following message: %error.&lt;p&gt;Are you sure the configured username has the necessary permissions to create tables in the database?&lt;/p&gt;&#39;</span>,
<a name="l00304"></a>00304         TRUE,
<a name="l00305"></a>00305       ),
<a name="l00306"></a>00306     ),
<a name="l00307"></a>00307     array(
<a name="l00308"></a>00308       <span class="stringliteral">&#39;arguments&#39;</span>   =&gt; array(
<a name="l00309"></a>00309         <span class="stringliteral">&#39;INSERT INTO {drupal_install_test} (id) VALUES (1)&#39;</span>,
<a name="l00310"></a>00310         <span class="stringliteral">&#39;Drupal can use INSERT database commands.&#39;</span>,
<a name="l00311"></a>00311         <span class="stringliteral">&#39;Failed to &lt;strong&gt;INSERT&lt;/strong&gt; a value into a test table on your database server. We tried inserting a value with the command %query and the server reported the following error: %error.&#39;</span>,
<a name="l00312"></a>00312       ),
<a name="l00313"></a>00313     ),
<a name="l00314"></a>00314     array(
<a name="l00315"></a>00315       <span class="stringliteral">&#39;arguments&#39;</span>   =&gt; array(
<a name="l00316"></a>00316         <span class="stringliteral">&#39;UPDATE {drupal_install_test} SET id = 2&#39;</span>,
<a name="l00317"></a>00317         <span class="stringliteral">&#39;Drupal can use UPDATE database commands.&#39;</span>,
<a name="l00318"></a>00318         <span class="stringliteral">&#39;Failed to &lt;strong&gt;UPDATE&lt;/strong&gt; a value in a test table on your database server. We tried updating a value with the command %query and the server reported the following error: %error.&#39;</span>,
<a name="l00319"></a>00319       ),
<a name="l00320"></a>00320     ),
<a name="l00321"></a>00321     array(
<a name="l00322"></a>00322       <span class="stringliteral">&#39;arguments&#39;</span>   =&gt; array(
<a name="l00323"></a>00323         <span class="stringliteral">&#39;DELETE FROM {drupal_install_test}&#39;</span>,
<a name="l00324"></a>00324         <span class="stringliteral">&#39;Drupal can use DELETE database commands.&#39;</span>,
<a name="l00325"></a>00325         <span class="stringliteral">&#39;Failed to &lt;strong&gt;DELETE&lt;/strong&gt; a value from a test table on your database server. We tried deleting a value with the command %query and the server reported the following error: %error.&#39;</span>,
<a name="l00326"></a>00326       ),
<a name="l00327"></a>00327     ),
<a name="l00328"></a>00328     array(
<a name="l00329"></a>00329       <span class="stringliteral">&#39;arguments&#39;</span>   =&gt; array(
<a name="l00330"></a>00330         <span class="stringliteral">&#39;DROP TABLE {drupal_install_test}&#39;</span>,
<a name="l00331"></a>00331         <span class="stringliteral">&#39;Drupal can use DROP TABLE database commands.&#39;</span>,
<a name="l00332"></a>00332         <span class="stringliteral">&#39;Failed to &lt;strong&gt;DROP&lt;/strong&gt; a test table from your database server. We tried dropping a table with the command %query and the server reported the following error %error.&#39;</span>,
<a name="l00333"></a>00333       ),
<a name="l00334"></a>00334     ),
<a name="l00335"></a>00335   );
<a name="l00336"></a>00336 
<a name="l00342"></a><a class="code" href="classDatabaseTasks_ac218754419e471c1523a4e56d36899dc.html#ac218754419e471c1523a4e56d36899dc">00342</a>   <span class="keyword">protected</span> <a class="code" href="classDatabaseTasks_ac218754419e471c1523a4e56d36899dc.html#ac218754419e471c1523a4e56d36899dc">$results</a> = array();
<a name="l00343"></a>00343 
<a name="l00347"></a><a class="code" href="classDatabaseTasks_a04d6c3b18630c969106bb890a0156e34.html#a04d6c3b18630c969106bb890a0156e34">00347</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classDatabaseTasks_a04d6c3b18630c969106bb890a0156e34.html#a04d6c3b18630c969106bb890a0156e34" title="Ensure the PDO driver is supported by the version of PHP in use.">hasPdoDriver</a>() {
<a name="l00348"></a>00348     <span class="keywordflow">return</span> in_array($this-&gt;pdoDriver, PDO::getAvailableDrivers());
<a name="l00349"></a>00349   }
<a name="l00350"></a>00350 
<a name="l00354"></a><a class="code" href="classDatabaseTasks_a97dfb29bafb3aeca1eeba6caec27f203.html#a97dfb29bafb3aeca1eeba6caec27f203">00354</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classDatabaseTasks_a97dfb29bafb3aeca1eeba6caec27f203.html#a97dfb29bafb3aeca1eeba6caec27f203" title="Assert test as failed.">fail</a>($message) {
<a name="l00355"></a>00355     $this-&gt;results[$message] = FALSE;
<a name="l00356"></a>00356   }
<a name="l00357"></a>00357 
<a name="l00361"></a><a class="code" href="classDatabaseTasks_ab95a2718467b938c7116b5d2feeb9a4c.html#ab95a2718467b938c7116b5d2feeb9a4c">00361</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classDatabaseTasks_ab95a2718467b938c7116b5d2feeb9a4c.html#ab95a2718467b938c7116b5d2feeb9a4c" title="Assert test as a pass.">pass</a>($message) {
<a name="l00362"></a>00362     $this-&gt;results[$message] = TRUE;
<a name="l00363"></a>00363   }
<a name="l00364"></a>00364 
<a name="l00368"></a><a class="code" href="classDatabaseTasks_aea31e0c70a1870a0290ab2ee06f364e1.html#aea31e0c70a1870a0290ab2ee06f364e1">00368</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseTasks_aea31e0c70a1870a0290ab2ee06f364e1.html#aea31e0c70a1870a0290ab2ee06f364e1" title="Check whether Drupal is installable on the database.">installable</a>() {
<a name="l00369"></a>00369     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classDatabaseTasks_a04d6c3b18630c969106bb890a0156e34.html#a04d6c3b18630c969106bb890a0156e34" title="Ensure the PDO driver is supported by the version of PHP in use.">hasPdoDriver</a>() &amp;&amp; empty($this-&gt;error);
<a name="l00370"></a>00370   }
<a name="l00371"></a>00371 
<a name="l00375"></a>00375   <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseTasks_ae582e57b43461aad87f47ad0d37b6c9a.html#ae582e57b43461aad87f47ad0d37b6c9a" title="Return the human-readable name of the driver.">name</a>();
<a name="l00376"></a>00376 
<a name="l00384"></a><a class="code" href="classDatabaseTasks_a840dd551944911605ee2e139a434efea.html#a840dd551944911605ee2e139a434efea">00384</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseTasks_a840dd551944911605ee2e139a434efea.html#a840dd551944911605ee2e139a434efea" title="Return the minimum required version of the engine.">minimumVersion</a>() {
<a name="l00385"></a>00385     <span class="keywordflow">return</span> NULL;
<a name="l00386"></a>00386   }
<a name="l00387"></a>00387 
<a name="l00391"></a><a class="code" href="classDatabaseTasks_a02a8ac31c7ed2c7798732ef5cf8482d0.html#a02a8ac31c7ed2c7798732ef5cf8482d0">00391</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseTasks_a02a8ac31c7ed2c7798732ef5cf8482d0.html#a02a8ac31c7ed2c7798732ef5cf8482d0" title="Run database tasks and tests to see if Drupal can run on the database.">runTasks</a>() {
<a name="l00392"></a>00392     <span class="comment">// We need to establish a connection before we can run tests.</span>
<a name="l00393"></a>00393     <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classDatabaseTasks_a64f74ab2f1de175c8b472223a9267ce7.html#a64f74ab2f1de175c8b472223a9267ce7" title="Check if we can connect to the database.">connect</a>()) {
<a name="l00394"></a>00394       <span class="keywordflow">foreach</span> ($this-&gt;tasks as $task) {
<a name="l00395"></a>00395         <span class="keywordflow">if</span> (!isset($task[<span class="stringliteral">&#39;function&#39;</span>])) {
<a name="l00396"></a>00396           $task[<span class="stringliteral">&#39;function&#39;</span>] = <span class="stringliteral">&#39;runTestQuery&#39;</span>;
<a name="l00397"></a>00397         }
<a name="l00398"></a>00398         <span class="keywordflow">if</span> (method_exists($this, $task[<span class="stringliteral">&#39;function&#39;</span>])) {
<a name="l00399"></a>00399           <span class="comment">// Returning false is fatal. No other tasks can run.</span>
<a name="l00400"></a>00400           <span class="keywordflow">if</span> (FALSE === call_user_func_array(array($this, $task[<span class="stringliteral">&#39;function&#39;</span>]), $task[<span class="stringliteral">&#39;arguments&#39;</span>])) {
<a name="l00401"></a>00401             <span class="keywordflow">break</span>;
<a name="l00402"></a>00402           }
<a name="l00403"></a>00403         }
<a name="l00404"></a>00404         <span class="keywordflow">else</span> {
<a name="l00405"></a>00405           <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDatabaseTaskException.html" title="Exception thrown if the database installer fails.">DatabaseTaskException</a>(<a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&quot;Failed to run all tasks against the database server. The task %task wasn&#39;t found.&quot;</span>, array(<span class="stringliteral">&#39;%task&#39;</span> =&gt; $task[<span class="stringliteral">&#39;function&#39;</span>])));
<a name="l00406"></a>00406         }
<a name="l00407"></a>00407       }
<a name="l00408"></a>00408     }
<a name="l00409"></a>00409     <span class="comment">// Check for failed results and compile message</span>
<a name="l00410"></a>00410     $message = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00411"></a>00411     <span class="keywordflow">foreach</span> ($this-&gt;results as $result =&gt; $success) {
<a name="l00412"></a>00412       <span class="keywordflow">if</span> (!$success) {
<a name="l00413"></a>00413         $message .= <span class="stringliteral">&#39;&lt;p class=&quot;error&quot;&gt;&#39;</span> . $result  . <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;
<a name="l00414"></a>00414       }
<a name="l00415"></a>00415     }
<a name="l00416"></a>00416     <span class="keywordflow">if</span> (!empty($message)) {
<a name="l00417"></a>00417       $message = <span class="stringliteral">&#39;&lt;p&gt;In order for Drupal to work, and to continue with the installation process, you must resolve all issues reported below. For more help with configuring your database server, see the &lt;a href=&quot;http://drupal.org/getting-started/install&quot;&gt;installation handbook&lt;/a&gt;. If you are unsure what any of this means you should probably contact your hosting provider.&lt;/p&gt;&#39;</span> . $message;
<a name="l00418"></a>00418       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classDatabaseTaskException.html" title="Exception thrown if the database installer fails.">DatabaseTaskException</a>($message);
<a name="l00419"></a>00419     }
<a name="l00420"></a>00420   }
<a name="l00421"></a>00421 
<a name="l00425"></a><a class="code" href="classDatabaseTasks_a64f74ab2f1de175c8b472223a9267ce7.html#a64f74ab2f1de175c8b472223a9267ce7">00425</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classDatabaseTasks_a64f74ab2f1de175c8b472223a9267ce7.html#a64f74ab2f1de175c8b472223a9267ce7" title="Check if we can connect to the database.">connect</a>() {
<a name="l00426"></a>00426     <span class="keywordflow">try</span> {
<a name="l00427"></a>00427       <span class="comment">// This doesn&#39;t actually test the connection.</span>
<a name="l00428"></a>00428       <a class="code" href="group__database_ga954d1bbb12742f285927e43f9489fdaf.html#ga954d1bbb12742f285927e43f9489fdaf" title="Sets a new active database.">db_set_active</a>();
<a name="l00429"></a>00429       <span class="comment">// Now actually do a check.</span>
<a name="l00430"></a>00430       <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>();
<a name="l00431"></a>00431       $this-&gt;<a class="code" href="classDatabaseTasks_ab95a2718467b938c7116b5d2feeb9a4c.html#ab95a2718467b938c7116b5d2feeb9a4c" title="Assert test as a pass.">pass</a>(<span class="stringliteral">&#39;Drupal can CONNECT to the database ok.&#39;</span>);
<a name="l00432"></a>00432     }
<a name="l00433"></a>00433     <span class="keywordflow">catch</span> (<a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> $e) {
<a name="l00434"></a>00434       $this-&gt;<a class="code" href="classDatabaseTasks_a97dfb29bafb3aeca1eeba6caec27f203.html#a97dfb29bafb3aeca1eeba6caec27f203" title="Assert test as failed.">fail</a>(<a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;Failed to connect to your database server. The server reports the following message: %error.&lt;ul&gt;&lt;li&gt;Is the database server running?&lt;/li&gt;&lt;li&gt;Does the database exist, and have you entered the correct database name?&lt;/li&gt;&lt;li&gt;Have you entered the correct username and password?&lt;/li&gt;&lt;li&gt;Have you entered the correct database hostname?&lt;/li&gt;&lt;/ul&gt;&#39;</span>, array(<span class="stringliteral">&#39;%error&#39;</span> =&gt; $e-&gt;getMessage())));
<a name="l00435"></a>00435       <span class="keywordflow">return</span> FALSE;
<a name="l00436"></a>00436     }
<a name="l00437"></a>00437     <span class="keywordflow">return</span> TRUE;
<a name="l00438"></a>00438   }
<a name="l00439"></a>00439 
<a name="l00443"></a><a class="code" href="classDatabaseTasks_a53da139c1b17ae90a0f6df6dd003c0ca.html#a53da139c1b17ae90a0f6df6dd003c0ca">00443</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classDatabaseTasks_a53da139c1b17ae90a0f6df6dd003c0ca.html#a53da139c1b17ae90a0f6df6dd003c0ca" title="Run SQL tests to ensure the database can execute commands with the current user.">runTestQuery</a>($query, $pass, $fail, $fatal = FALSE) {
<a name="l00444"></a>00444     <span class="keywordflow">try</span> {
<a name="l00445"></a>00445       <a class="code" href="group__database_gafa3b6cb2b2f61479cc63a4150c62da9b.html#gafa3b6cb2b2f61479cc63a4150c62da9b" title="The following utility functions are simply convenience wrappers.">db_query</a>($query);
<a name="l00446"></a>00446       $this-&gt;<a class="code" href="classDatabaseTasks_ab95a2718467b938c7116b5d2feeb9a4c.html#ab95a2718467b938c7116b5d2feeb9a4c" title="Assert test as a pass.">pass</a>(<a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>($pass));
<a name="l00447"></a>00447     }
<a name="l00448"></a>00448     <span class="keywordflow">catch</span> (<a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> $e) {
<a name="l00449"></a>00449       $this-&gt;<a class="code" href="classDatabaseTasks_a97dfb29bafb3aeca1eeba6caec27f203.html#a97dfb29bafb3aeca1eeba6caec27f203" title="Assert test as failed.">fail</a>(<a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>($fail, array(<span class="stringliteral">&#39;%query&#39;</span> =&gt; $query, <span class="stringliteral">&#39;%error&#39;</span> =&gt; $e-&gt;getMessage(), <span class="stringliteral">&#39;%name&#39;</span> =&gt; $this-&gt;<a class="code" href="classDatabaseTasks_ae582e57b43461aad87f47ad0d37b6c9a.html#ae582e57b43461aad87f47ad0d37b6c9a" title="Return the human-readable name of the driver.">name</a>())));
<a name="l00450"></a>00450       <span class="keywordflow">return</span> !$fatal;
<a name="l00451"></a>00451     }
<a name="l00452"></a>00452   }
<a name="l00453"></a>00453 
<a name="l00457"></a><a class="code" href="classDatabaseTasks_a0e94441f09146aa9d6a991f7483f19d1.html#a0e94441f09146aa9d6a991f7483f19d1">00457</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classDatabaseTasks_a0e94441f09146aa9d6a991f7483f19d1.html#a0e94441f09146aa9d6a991f7483f19d1" title="Check the engine version.">checkEngineVersion</a>() {
<a name="l00458"></a>00458     <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classDatabaseTasks_a840dd551944911605ee2e139a434efea.html#a840dd551944911605ee2e139a434efea" title="Return the minimum required version of the engine.">minimumVersion</a>() &amp;&amp; version_compare(<a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;version(), $this-&gt;<a class="code" href="classDatabaseTasks_a840dd551944911605ee2e139a434efea.html#a840dd551944911605ee2e139a434efea" title="Return the minimum required version of the engine.">minimumVersion</a>(), <span class="charliteral">&#39;&lt;&#39;</span>)) {
<a name="l00459"></a>00459       $this-&gt;<a class="code" href="classDatabaseTasks_a97dfb29bafb3aeca1eeba6caec27f203.html#a97dfb29bafb3aeca1eeba6caec27f203" title="Assert test as failed.">fail</a>(<a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&quot;The database version %version is less than the minimum required version %minimum_version.&quot;</span>, array(<span class="stringliteral">&#39;%version&#39;</span> =&gt; <a class="code" href="classDatabase_aa8e4f73dfd6ad94a166a6fa3e44351cf.html#aa8e4f73dfd6ad94a166a6fa3e44351cf" title="Gets the connection object for the specified database key and target.">Database::getConnection</a>()-&gt;version(), <span class="stringliteral">&#39;%minimum_version&#39;</span> =&gt; $this-&gt;<a class="code" href="classDatabaseTasks_a840dd551944911605ee2e139a434efea.html#a840dd551944911605ee2e139a434efea" title="Return the minimum required version of the engine.">minimumVersion</a>())));
<a name="l00460"></a>00460     }
<a name="l00461"></a>00461   }
<a name="l00462"></a>00462 
<a name="l00472"></a><a class="code" href="classDatabaseTasks_a97968c7dd7807a65a301a27ea3d15480.html#a97968c7dd7807a65a301a27ea3d15480">00472</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseTasks_a97968c7dd7807a65a301a27ea3d15480.html#a97968c7dd7807a65a301a27ea3d15480" title="Return driver specific configuration options.">getFormOptions</a>($database) {
<a name="l00473"></a>00473     $form[<span class="stringliteral">&#39;database&#39;</span>] = array(
<a name="l00474"></a>00474       <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;textfield&#39;</span>,
<a name="l00475"></a>00475       <span class="stringliteral">&#39;#title&#39;</span> =&gt; <a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;Database name&#39;</span>),
<a name="l00476"></a>00476       <span class="stringliteral">&#39;#default_value&#39;</span> =&gt; empty($database[<span class="stringliteral">&#39;database&#39;</span>]) ? <span class="stringliteral">&#39;&#39;</span> : $database[<span class="stringliteral">&#39;database&#39;</span>],
<a name="l00477"></a>00477       <span class="stringliteral">&#39;#size&#39;</span> =&gt; 45,
<a name="l00478"></a>00478       <span class="stringliteral">&#39;#required&#39;</span> =&gt; TRUE,
<a name="l00479"></a>00479       <span class="stringliteral">&#39;#description&#39;</span> =&gt; <a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;The name of the database your @drupal data will be stored in. It must exist on your server before @drupal can be installed.&#39;</span>, array(<span class="stringliteral">&#39;@drupal&#39;</span> =&gt; <a class="code" href="install_8inc_a52c56958ff42269107b5a678e8d95ddc.html#a52c56958ff42269107b5a678e8d95ddc" title="Loads the install profile, extracting its defined distribution name.">drupal_install_profile_distribution_name</a>())),
<a name="l00480"></a>00480     );
<a name="l00481"></a>00481 
<a name="l00482"></a>00482     $form[<span class="stringliteral">&#39;username&#39;</span>] = array(
<a name="l00483"></a>00483       <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;textfield&#39;</span>,
<a name="l00484"></a>00484       <span class="stringliteral">&#39;#title&#39;</span> =&gt; <a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;Database username&#39;</span>),
<a name="l00485"></a>00485       <span class="stringliteral">&#39;#default_value&#39;</span> =&gt; empty($database[<span class="stringliteral">&#39;username&#39;</span>]) ? <span class="stringliteral">&#39;&#39;</span> : $database[<span class="stringliteral">&#39;username&#39;</span>],
<a name="l00486"></a>00486       <span class="stringliteral">&#39;#required&#39;</span> =&gt; TRUE,
<a name="l00487"></a>00487       <span class="stringliteral">&#39;#size&#39;</span> =&gt; 45,
<a name="l00488"></a>00488     );
<a name="l00489"></a>00489 
<a name="l00490"></a>00490     $form[<span class="stringliteral">&#39;password&#39;</span>] = array(
<a name="l00491"></a>00491       <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;password&#39;</span>,
<a name="l00492"></a>00492       <span class="stringliteral">&#39;#title&#39;</span> =&gt; <a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;Database password&#39;</span>),
<a name="l00493"></a>00493       <span class="stringliteral">&#39;#default_value&#39;</span> =&gt; empty($database[<span class="stringliteral">&#39;password&#39;</span>]) ? <span class="stringliteral">&#39;&#39;</span> : $database[<span class="stringliteral">&#39;password&#39;</span>],
<a name="l00494"></a>00494       <span class="stringliteral">&#39;#required&#39;</span> =&gt; FALSE,
<a name="l00495"></a>00495       <span class="stringliteral">&#39;#size&#39;</span> =&gt; 45,
<a name="l00496"></a>00496     );
<a name="l00497"></a>00497 
<a name="l00498"></a>00498     $form[<span class="stringliteral">&#39;advanced_options&#39;</span>] = array(
<a name="l00499"></a>00499       <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;fieldset&#39;</span>,
<a name="l00500"></a>00500       <span class="stringliteral">&#39;#title&#39;</span> =&gt; <a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;Advanced options&#39;</span>),
<a name="l00501"></a>00501       <span class="stringliteral">&#39;#collapsible&#39;</span> =&gt; TRUE,
<a name="l00502"></a>00502       <span class="stringliteral">&#39;#collapsed&#39;</span> =&gt; TRUE,
<a name="l00503"></a>00503       <span class="stringliteral">&#39;#description&#39;</span> =&gt; <a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&quot;These options are only necessary for some sites. If you&#39;re not sure what you should enter here, leave the default settings or check with your hosting provider.&quot;</span>),
<a name="l00504"></a>00504       <span class="stringliteral">&#39;#weight&#39;</span> =&gt; 10,
<a name="l00505"></a>00505     );
<a name="l00506"></a>00506 
<a name="l00507"></a>00507     $profile = <a class="code" href="common_8inc_a4128f0023ccec2d1a9a40987f0131d83.html#a4128f0023ccec2d1a9a40987f0131d83" title="Gets the name of the currently active install profile.">drupal_get_profile</a>();
<a name="l00508"></a>00508     $db_prefix = ($profile == <span class="stringliteral">&#39;standard&#39;</span>) ? <span class="stringliteral">&#39;drupal_&#39;</span> : $profile . <span class="charliteral">&#39;_&#39;</span>;
<a name="l00509"></a>00509     $form[<span class="stringliteral">&#39;advanced_options&#39;</span>][<span class="stringliteral">&#39;db_prefix&#39;</span>] = array(
<a name="l00510"></a>00510       <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;textfield&#39;</span>,
<a name="l00511"></a>00511       <span class="stringliteral">&#39;#title&#39;</span> =&gt; <a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;Table prefix&#39;</span>),
<a name="l00512"></a>00512       <span class="stringliteral">&#39;#default_value&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l00513"></a>00513       <span class="stringliteral">&#39;#size&#39;</span> =&gt; 45,
<a name="l00514"></a>00514       <span class="stringliteral">&#39;#description&#39;</span> =&gt; <a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;If more than one application will be sharing this database, enter a table prefix such as %prefix for your @drupal site here.&#39;</span>, array(<span class="stringliteral">&#39;@drupal&#39;</span> =&gt; <a class="code" href="install_8inc_a52c56958ff42269107b5a678e8d95ddc.html#a52c56958ff42269107b5a678e8d95ddc" title="Loads the install profile, extracting its defined distribution name.">drupal_install_profile_distribution_name</a>(), <span class="stringliteral">&#39;%prefix&#39;</span> =&gt; $db_prefix)),
<a name="l00515"></a>00515       <span class="stringliteral">&#39;#weight&#39;</span> =&gt; 10,
<a name="l00516"></a>00516     );
<a name="l00517"></a>00517 
<a name="l00518"></a>00518     $form[<span class="stringliteral">&#39;advanced_options&#39;</span>][<span class="stringliteral">&#39;host&#39;</span>] = array(
<a name="l00519"></a>00519       <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;textfield&#39;</span>,
<a name="l00520"></a>00520       <span class="stringliteral">&#39;#title&#39;</span> =&gt; <a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;Database host&#39;</span>),
<a name="l00521"></a>00521       <span class="stringliteral">&#39;#default_value&#39;</span> =&gt; empty($database[<span class="stringliteral">&#39;host&#39;</span>]) ? <span class="stringliteral">&#39;localhost&#39;</span> : $database[<span class="stringliteral">&#39;host&#39;</span>],
<a name="l00522"></a>00522       <span class="stringliteral">&#39;#size&#39;</span> =&gt; 45,
<a name="l00523"></a>00523       <span class="comment">// Hostnames can be 255 characters long.</span>
<a name="l00524"></a>00524       <span class="stringliteral">&#39;#maxlength&#39;</span> =&gt; 255,
<a name="l00525"></a>00525       <span class="stringliteral">&#39;#required&#39;</span> =&gt; TRUE,
<a name="l00526"></a>00526       <span class="stringliteral">&#39;#description&#39;</span> =&gt; <a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;If your database is located on a different server, change this.&#39;</span>),
<a name="l00527"></a>00527     );
<a name="l00528"></a>00528 
<a name="l00529"></a>00529     $form[<span class="stringliteral">&#39;advanced_options&#39;</span>][<span class="stringliteral">&#39;port&#39;</span>] = array(
<a name="l00530"></a>00530       <span class="stringliteral">&#39;#type&#39;</span> =&gt; <span class="stringliteral">&#39;textfield&#39;</span>,
<a name="l00531"></a>00531       <span class="stringliteral">&#39;#title&#39;</span> =&gt; <a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;Database port&#39;</span>),
<a name="l00532"></a>00532       <span class="stringliteral">&#39;#default_value&#39;</span> =&gt; empty($database[<span class="stringliteral">&#39;port&#39;</span>]) ? <span class="stringliteral">&#39;&#39;</span> : $database[<span class="stringliteral">&#39;port&#39;</span>],
<a name="l00533"></a>00533       <span class="stringliteral">&#39;#size&#39;</span> =&gt; 45,
<a name="l00534"></a>00534       <span class="comment">// The maximum port number is 65536, 5 digits.</span>
<a name="l00535"></a>00535       <span class="stringliteral">&#39;#maxlength&#39;</span> =&gt; 5,
<a name="l00536"></a>00536       <span class="stringliteral">&#39;#description&#39;</span> =&gt; <a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;If your database server is listening to a non-standard port, enter its number.&#39;</span>),
<a name="l00537"></a>00537     );
<a name="l00538"></a>00538 
<a name="l00539"></a>00539     <span class="keywordflow">return</span> $form;
<a name="l00540"></a>00540   }
<a name="l00541"></a>00541 
<a name="l00554"></a><a class="code" href="classDatabaseTasks_a44116b4f564f8fcfdd5ade73853419b8.html#a44116b4f564f8fcfdd5ade73853419b8">00554</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classDatabaseTasks_a44116b4f564f8fcfdd5ade73853419b8.html#a44116b4f564f8fcfdd5ade73853419b8" title="Validates driver specific configuration settings.">validateDatabaseSettings</a>($database) {
<a name="l00555"></a>00555     $errors = array();
<a name="l00556"></a>00556 
<a name="l00557"></a>00557     <span class="comment">// Verify the table prefix.</span>
<a name="l00558"></a>00558     <span class="keywordflow">if</span> (!empty($database[<span class="stringliteral">&#39;prefix&#39;</span>]) &amp;&amp; is_string($database[<span class="stringliteral">&#39;prefix&#39;</span>]) &amp;&amp; !preg_match(<span class="stringliteral">&#39;/^[A-Za-z0-9_.]+$/&#39;</span>, $database[<span class="stringliteral">&#39;prefix&#39;</span>])) {
<a name="l00559"></a>00559       $errors[$database[<span class="stringliteral">&#39;driver&#39;</span>] . <span class="stringliteral">&#39;][advanced_options][db_prefix&#39;</span>] = <a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;The database table prefix you have entered, %prefix, is invalid. The table prefix can only contain alphanumeric characters, periods, or underscores.&#39;</span>, array(<span class="stringliteral">&#39;%prefix&#39;</span> =&gt; $database[<span class="stringliteral">&#39;prefix&#39;</span>]));
<a name="l00560"></a>00560     }
<a name="l00561"></a>00561 
<a name="l00562"></a>00562     <span class="comment">// Verify the database port.</span>
<a name="l00563"></a>00563     <span class="keywordflow">if</span> (!empty($database[<span class="stringliteral">&#39;port&#39;</span>]) &amp;&amp; !is_numeric($database[<span class="stringliteral">&#39;port&#39;</span>])) {
<a name="l00564"></a>00564       $errors[$database[<span class="stringliteral">&#39;driver&#39;</span>] . <span class="stringliteral">&#39;][advanced_options][port&#39;</span>] =  <a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;Database port must be a number.&#39;</span>);
<a name="l00565"></a>00565     }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567     <span class="keywordflow">return</span> $errors;
<a name="l00568"></a>00568   }
<a name="l00569"></a>00569 
<a name="l00570"></a>00570 }
<a name="l00571"></a>00571 
<a name="l00575"></a><a class="code" href="classDatabaseTaskException.html">00575</a> <span class="keyword">class </span><a class="code" href="classDatabaseTaskException.html" title="Exception thrown if the database installer fails.">DatabaseTaskException</a> <span class="keyword">extends</span> <a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a> {
<a name="l00576"></a>00576 }
<a name="l00577"></a>00577 
<a name="l00584"></a><a class="code" href="install_8inc_ad99864750a734251d0a39fffe620ff53.html#ad99864750a734251d0a39fffe620ff53">00584</a> <span class="keyword">function</span> <a class="code" href="install_8inc_ad99864750a734251d0a39fffe620ff53.html#ad99864750a734251d0a39fffe620ff53" title="Replace values in settings.php with values in the submitted array.">drupal_rewrite_settings</a>($settings = array(), $prefix = <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00585"></a>00585   $default_settings = <span class="stringliteral">&#39;sites/default/default.settings.php&#39;</span>;
<a name="l00586"></a>00586   <a class="code" href="group__schemaapi_ga714b5ed0b14c43b61eef0c895598c5c4.html#ga714b5ed0b14c43b61eef0c895598c5c4" title="Resets one or all centrally stored static variable(s).">drupal_static_reset</a>(<span class="stringliteral">&#39;conf_path&#39;</span>);
<a name="l00587"></a>00587   $settings_file = <a class="code" href="bootstrap_8inc_acef612ef19c49f6259531f0bee5c26cc.html#acef612ef19c49f6259531f0bee5c26cc" title="Finds the appropriate configuration directory.">conf_path</a>(FALSE) . <span class="charliteral">&#39;/&#39;</span> . $prefix . <span class="stringliteral">&#39;settings.php&#39;</span>;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589   <span class="comment">// Build list of setting names and insert the values into the global namespace.</span>
<a name="l00590"></a>00590   $keys = array();
<a name="l00591"></a>00591   <span class="keywordflow">foreach</span> ($settings as $setting =&gt; $data) {
<a name="l00592"></a>00592     $GLOBALS[$setting] = $data[<span class="stringliteral">&#39;value&#39;</span>];
<a name="l00593"></a>00593     $keys[] = $setting;
<a name="l00594"></a>00594   }
<a name="l00595"></a>00595 
<a name="l00596"></a>00596   $buffer = NULL;
<a name="l00597"></a>00597   $first = TRUE;
<a name="l00598"></a>00598   <span class="keywordflow">if</span> ($fp = fopen(<a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $default_settings, <span class="charliteral">&#39;r&#39;</span>)) {
<a name="l00599"></a>00599     <span class="comment">// Step line by line through settings.php.</span>
<a name="l00600"></a>00600     <span class="keywordflow">while</span> (!feof($fp)) {
<a name="l00601"></a>00601       $line = fgets($fp);
<a name="l00602"></a>00602       <span class="keywordflow">if</span> ($first &amp;&amp; substr($line, 0, 5) != <span class="stringliteral">&#39;&lt;?php&#39;</span>) {
<a name="l00603"></a>00603         $buffer = <span class="stringliteral">&quot;&lt;?php\n\n&quot;</span>;
<a name="l00604"></a>00604       }
<a name="l00605"></a>00605       $first = FALSE;
<a name="l00606"></a>00606       <span class="comment">// Check for constants.</span>
<a name="l00607"></a>00607       <span class="keywordflow">if</span> (substr($line, 0, 7) == <span class="stringliteral">&#39;define(&#39;</span>) {
<a name="l00608"></a>00608         preg_match(<span class="stringliteral">&#39;/define\(\s*[\&#39;&quot;]([A-Z_-]+)[\&#39;&quot;]\s*,(.*?)\);/&#39;</span>, $line, $variable);
<a name="l00609"></a>00609         <span class="keywordflow">if</span> (in_array($variable[1], $keys)) {
<a name="l00610"></a>00610           $setting = $settings[$variable[1]];
<a name="l00611"></a>00611           $buffer .= str_replace($variable[2], <span class="stringliteral">&quot; &#39;&quot;</span> . $setting[<span class="stringliteral">&#39;value&#39;</span>] . <span class="stringliteral">&quot;&#39;&quot;</span>, $line);
<a name="l00612"></a>00612           unset($settings[$variable[1]]);
<a name="l00613"></a>00613           unset($settings[$variable[2]]);
<a name="l00614"></a>00614         }
<a name="l00615"></a>00615         <span class="keywordflow">else</span> {
<a name="l00616"></a>00616           $buffer .= $line;
<a name="l00617"></a>00617         }
<a name="l00618"></a>00618       }
<a name="l00619"></a>00619       <span class="comment">// Check for variables.</span>
<a name="l00620"></a>00620       elseif (substr($line, 0, 1) == <span class="charliteral">&#39;$&#39;</span>) {
<a name="l00621"></a>00621         preg_match(<span class="stringliteral">&#39;/\$([^ ]*) /&#39;</span>, $line, $variable);
<a name="l00622"></a>00622         <span class="keywordflow">if</span> (in_array($variable[1], $keys)) {
<a name="l00623"></a>00623           <span class="comment">// Write new value to settings.php in the following format:</span>
<a name="l00624"></a>00624           <span class="comment">//    $&#39;setting&#39; = &#39;value&#39;; // &#39;comment&#39;</span>
<a name="l00625"></a>00625           $setting = $settings[$variable[1]];
<a name="l00626"></a>00626           $buffer .= <span class="charliteral">&#39;$&#39;</span> . $variable[1] . <span class="stringliteral">&quot; = &quot;</span> . var_export($setting[<span class="stringliteral">&#39;value&#39;</span>], TRUE) . <span class="stringliteral">&quot;;&quot;</span> . (!empty($setting[<span class="stringliteral">&#39;comment&#39;</span>]) ? <span class="stringliteral">&#39; // &#39;</span> . $setting[<span class="stringliteral">&#39;comment&#39;</span>] . <span class="stringliteral">&quot;\n&quot;</span> : <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00627"></a>00627           unset($settings[$variable[1]]);
<a name="l00628"></a>00628         }
<a name="l00629"></a>00629         <span class="keywordflow">else</span> {
<a name="l00630"></a>00630           $buffer .= $line;
<a name="l00631"></a>00631         }
<a name="l00632"></a>00632       }
<a name="l00633"></a>00633       <span class="keywordflow">else</span> {
<a name="l00634"></a>00634         $buffer .= $line;
<a name="l00635"></a>00635       }
<a name="l00636"></a>00636     }
<a name="l00637"></a>00637     fclose($fp);
<a name="l00638"></a>00638 
<a name="l00639"></a>00639     <span class="comment">// Add required settings that were missing from settings.php.</span>
<a name="l00640"></a>00640     <span class="keywordflow">foreach</span> ($settings as $setting =&gt; $data) {
<a name="l00641"></a>00641       <span class="keywordflow">if</span> ($data[<span class="stringliteral">&#39;required&#39;</span>]) {
<a name="l00642"></a>00642         $buffer .= <span class="stringliteral">&quot;\$$setting = &quot;</span> . var_export($data[<span class="stringliteral">&#39;value&#39;</span>], TRUE) . <span class="stringliteral">&quot;;\n&quot;</span>;
<a name="l00643"></a>00643       }
<a name="l00644"></a>00644     }
<a name="l00645"></a>00645 
<a name="l00646"></a>00646     $fp = fopen(<a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $settings_file, <span class="charliteral">&#39;w&#39;</span>);
<a name="l00647"></a>00647     <span class="keywordflow">if</span> ($fp &amp;&amp; fwrite($fp, $buffer) === FALSE) {
<a name="l00648"></a>00648       <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a>(<a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;Failed to modify %settings. Verify the file permissions.&#39;</span>, array(<span class="stringliteral">&#39;%settings&#39;</span> =&gt; $settings_file)));
<a name="l00649"></a>00649     }
<a name="l00650"></a>00650   }
<a name="l00651"></a>00651   <span class="keywordflow">else</span> {
<a name="l00652"></a>00652     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a>(<a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;Failed to open %settings. Verify the file permissions.&#39;</span>, array(<span class="stringliteral">&#39;%settings&#39;</span> =&gt; $default_settings)));
<a name="l00653"></a>00653   }
<a name="l00654"></a>00654 }
<a name="l00655"></a>00655 
<a name="l00664"></a><a class="code" href="install_8inc_aa29b37a58b07628a4fd9714c2f9817ab.html#aa29b37a58b07628a4fd9714c2f9817ab">00664</a> <span class="keyword">function</span> <a class="code" href="install_8inc_aa29b37a58b07628a4fd9714c2f9817ab.html#aa29b37a58b07628a4fd9714c2f9817ab" title="Verify an install profile for installation.">drupal_verify_profile</a>($install_state) {
<a name="l00665"></a>00665   $profile = $install_state[<span class="stringliteral">&#39;parameters&#39;</span>][<span class="stringliteral">&#39;profile&#39;</span>];
<a name="l00666"></a>00666   $locale = $install_state[<span class="stringliteral">&#39;parameters&#39;</span>][<span class="stringliteral">&#39;locale&#39;</span>];
<a name="l00667"></a>00667 
<a name="l00668"></a>00668   include_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/file.inc&#39;</span>;
<a name="l00669"></a>00669   include_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/common.inc&#39;</span>;
<a name="l00670"></a>00670 
<a name="l00671"></a>00671   $profile_file = <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&quot;/profiles/$profile/$profile.profile&quot;</span>;
<a name="l00672"></a>00672 
<a name="l00673"></a>00673   <span class="keywordflow">if</span> (!isset($profile) || !file_exists($profile_file)) {
<a name="l00674"></a>00674     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a>(<a class="code" href="install_8core_8inc_a78dd97fe8667cff59641b2adc55436cf.html#a78dd97fe8667cff59641b2adc55436cf" title="Indicates that there are no profiles available.">install_no_profile_error</a>());
<a name="l00675"></a>00675   }
<a name="l00676"></a>00676   $info = $install_state[<span class="stringliteral">&#39;profile_info&#39;</span>];
<a name="l00677"></a>00677 
<a name="l00678"></a>00678   <span class="comment">// Get a list of modules that exist in Drupal&#39;s assorted subdirectories.</span>
<a name="l00679"></a>00679   $present_modules = array();
<a name="l00680"></a>00680   <span class="keywordflow">foreach</span> (<a class="code" href="common_8inc_a60d1237b23d4e84a59656003596add4b.html#a60d1237b23d4e84a59656003596add4b" title="Returns information about system object files (modules, themes, etc.).">drupal_system_listing</a>(<span class="stringliteral">&#39;/^&#39;</span> . <a class="code" href="bootstrap_8inc_ac2b8a8a3549cb6839c538ebc812ecf8c.html#ac2b8a8a3549cb6839c538ebc812ecf8c" title="Regular expression to match PHP function names.">DRUPAL_PHP_FUNCTION_PATTERN</a> . <span class="stringliteral">&#39;\.module$/&#39;</span>, <span class="stringliteral">&#39;modules&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>, 0) as $present_module) {
<a name="l00681"></a>00681     $present_modules[] = $present_module-&gt;name;
<a name="l00682"></a>00682   }
<a name="l00683"></a>00683 
<a name="l00684"></a>00684   <span class="comment">// The install profile is also a module, which needs to be installed after all the other dependencies</span>
<a name="l00685"></a>00685   <span class="comment">// have been installed.</span>
<a name="l00686"></a>00686   $present_modules[] = <a class="code" href="common_8inc_a4128f0023ccec2d1a9a40987f0131d83.html#a4128f0023ccec2d1a9a40987f0131d83" title="Gets the name of the currently active install profile.">drupal_get_profile</a>();
<a name="l00687"></a>00687 
<a name="l00688"></a>00688   <span class="comment">// Verify that all of the profile&#39;s required modules are present.</span>
<a name="l00689"></a>00689   $missing_modules = array_diff($info[<span class="stringliteral">&#39;dependencies&#39;</span>], $present_modules);
<a name="l00690"></a>00690 
<a name="l00691"></a>00691   $requirements = array();
<a name="l00692"></a>00692 
<a name="l00693"></a>00693   <span class="keywordflow">if</span> (count($missing_modules)) {
<a name="l00694"></a>00694     $modules = array();
<a name="l00695"></a>00695     <span class="keywordflow">foreach</span> ($missing_modules as $module) {
<a name="l00696"></a>00696       $modules[] = <span class="stringliteral">&#39;&lt;span class=&quot;admin-missing&quot;&gt;&#39;</span> . <a class="code" href="group__php__wrappers_ga15c15887a3e78bd69a50439373823517.html#ga15c15887a3e78bd69a50439373823517" title="Capitalize the first letter of a UTF-8 string.">drupal_ucfirst</a>($module) . <span class="stringliteral">&#39;&lt;/span&gt;&#39;</span>;
<a name="l00697"></a>00697     }
<a name="l00698"></a>00698     $requirements[<span class="stringliteral">&#39;required_modules&#39;</span>] = array(
<a name="l00699"></a>00699       <span class="stringliteral">&#39;title&#39;</span>       =&gt; <a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;Required modules&#39;</span>),
<a name="l00700"></a>00700       <span class="stringliteral">&#39;value&#39;</span>       =&gt; <a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;Required modules not found.&#39;</span>),
<a name="l00701"></a>00701       <span class="stringliteral">&#39;severity&#39;</span>    =&gt; <a class="code" href="install_8inc_aeddf02286107904721cb582bd430581d.html#aeddf02286107904721cb582bd430581d" title="Requirement severity -- Error condition; abort installation.">REQUIREMENT_ERROR</a>,
<a name="l00702"></a>00702       <span class="stringliteral">&#39;description&#39;</span> =&gt; <a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>(<span class="stringliteral">&#39;The following modules are required but were not found. Move them into the appropriate modules subdirectory, such as &lt;em&gt;sites/all/modules&lt;/em&gt;. Missing modules: !modules&#39;</span>, array(<span class="stringliteral">&#39;!modules&#39;</span> =&gt; implode(<span class="stringliteral">&#39;, &#39;</span>, $modules))),
<a name="l00703"></a>00703     );
<a name="l00704"></a>00704   }
<a name="l00705"></a>00705   <span class="keywordflow">return</span> $requirements;
<a name="l00706"></a>00706 }
<a name="l00707"></a>00707 
<a name="l00714"></a><a class="code" href="install_8inc_aab1545a3102caedc018c7d571d6ebf1b.html#aab1545a3102caedc018c7d571d6ebf1b">00714</a> <span class="keyword">function</span> <a class="code" href="install_8inc_aab1545a3102caedc018c7d571d6ebf1b.html#aab1545a3102caedc018c7d571d6ebf1b" title="Callback to install the system module.">drupal_install_system</a>() {
<a name="l00715"></a>00715   $system_path = <a class="code" href="common_8inc_ae3bbe8f97bf07bb0eaf4580c98f9bf94.html#ae3bbe8f97bf07bb0eaf4580c98f9bf94" title="Returns the path to a system item (module, theme, etc.).">drupal_get_path</a>(<span class="stringliteral">&#39;module&#39;</span>, <span class="stringliteral">&#39;system&#39;</span>);
<a name="l00716"></a>00716   require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="charliteral">&#39;/&#39;</span> . $system_path . <span class="stringliteral">&#39;/system.install&#39;</span>;
<a name="l00717"></a>00717   <a class="code" href="group__hooks_ga7547905cff161d057f9e71088ec67f05.html#ga7547905cff161d057f9e71088ec67f05" title="Invoke a hook in a particular module.">module_invoke</a>(<span class="stringliteral">&#39;system&#39;</span>, <span class="stringliteral">&#39;install&#39;</span>);
<a name="l00718"></a>00718 
<a name="l00719"></a>00719   $system_versions = <a class="code" href="install_8inc_a1e68a61662f821bde8606568fda7bf58.html#a1e68a61662f821bde8606568fda7bf58" title="Returns an array of available schema versions for a module.">drupal_get_schema_versions</a>(<span class="stringliteral">&#39;system&#39;</span>);
<a name="l00720"></a>00720   $system_version = $system_versions ? max($system_versions) : <a class="code" href="install_8inc_aaa1b441be0b54ef62f6ea8d391f9cc99.html#aaa1b441be0b54ef62f6ea8d391f9cc99" title="Indicates that a module has been installed.">SCHEMA_INSTALLED</a>;
<a name="l00721"></a>00721   <a class="code" href="group__database_gaadfbffaf30ff5eb14f1bd88619351345.html#gaadfbffaf30ff5eb14f1bd88619351345" title="Returns a new InsertQuery object for the active database.">db_insert</a>(<span class="stringliteral">&#39;system&#39;</span>)
<a name="l00722"></a>00722     -&gt;fields(array(<span class="stringliteral">&#39;filename&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>, <span class="stringliteral">&#39;type&#39;</span>, <span class="stringliteral">&#39;owner&#39;</span>, <span class="stringliteral">&#39;status&#39;</span>, <span class="stringliteral">&#39;schema_version&#39;</span>, <span class="stringliteral">&#39;bootstrap&#39;</span>))
<a name="l00723"></a>00723     -&gt;values(array(
<a name="l00724"></a>00724         <span class="stringliteral">&#39;filename&#39;</span> =&gt; $system_path . <span class="stringliteral">&#39;/system.module&#39;</span>,
<a name="l00725"></a>00725         <span class="stringliteral">&#39;name&#39;</span> =&gt; <span class="stringliteral">&#39;system&#39;</span>,
<a name="l00726"></a>00726         <span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;module&#39;</span>,
<a name="l00727"></a>00727         <span class="stringliteral">&#39;owner&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l00728"></a>00728         <span class="stringliteral">&#39;status&#39;</span> =&gt; 1,
<a name="l00729"></a>00729         <span class="stringliteral">&#39;schema_version&#39;</span> =&gt; $system_version,
<a name="l00730"></a>00730         <span class="stringliteral">&#39;bootstrap&#39;</span> =&gt; 0,
<a name="l00731"></a>00731       ))
<a name="l00732"></a>00732     -&gt;execute();
<a name="l00733"></a>00733   system_rebuild_module_data();
<a name="l00734"></a>00734 }
<a name="l00735"></a>00735 
<a name="l00752"></a><a class="code" href="install_8inc_a70bce70ff13aafba3367e81737b85b62.html#a70bce70ff13aafba3367e81737b85b62">00752</a> <span class="keyword">function</span> <a class="code" href="install_8inc_a70bce70ff13aafba3367e81737b85b62.html#a70bce70ff13aafba3367e81737b85b62" title="Uninstalls a given list of modules.">drupal_uninstall_modules</a>(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a> = array(), $uninstall_dependents = TRUE) {
<a name="l00753"></a>00753   <span class="keywordflow">if</span> ($uninstall_dependents) {
<a name="l00754"></a>00754     <span class="comment">// Get all module data so we can find dependents and sort.</span>
<a name="l00755"></a>00755     $module_data = system_rebuild_module_data();
<a name="l00756"></a>00756     <span class="comment">// Create an associative array with weights as values.</span>
<a name="l00757"></a>00757     <a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a> = array_flip(array_values(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>));
<a name="l00758"></a>00758 
<a name="l00759"></a>00759     $profile = <a class="code" href="common_8inc_a4128f0023ccec2d1a9a40987f0131d83.html#a4128f0023ccec2d1a9a40987f0131d83" title="Gets the name of the currently active install profile.">drupal_get_profile</a>();
<a name="l00760"></a>00760     <span class="keywordflow">while</span> (list($module) = each(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>)) {
<a name="l00761"></a>00761       <span class="keywordflow">if</span> (!isset($module_data[$module]) || <a class="code" href="install_8inc_a7702ece36adbef6e165e6f9c2bde5953.html#a7702ece36adbef6e165e6f9c2bde5953" title="Returns the currently installed schema version for a module.">drupal_get_installed_schema_version</a>($module) == <a class="code" href="install_8inc_ab2f11b038ed6a537bfdd257be863075f.html#ab2f11b038ed6a537bfdd257be863075f" title="Indicates that a module has not been installed yet.">SCHEMA_UNINSTALLED</a>) {
<a name="l00762"></a>00762         <span class="comment">// This module doesn&#39;t exist or is already uninstalled, skip it.</span>
<a name="l00763"></a>00763         unset(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>[$module]);
<a name="l00764"></a>00764         <span class="keywordflow">continue</span>;
<a name="l00765"></a>00765       }
<a name="l00766"></a>00766       <a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>[$module] = $module_data[$module]-&gt;sort;
<a name="l00767"></a>00767 
<a name="l00768"></a>00768       <span class="comment">// If the module has any dependents which are not already uninstalled and</span>
<a name="l00769"></a>00769       <span class="comment">// not included in the passed-in list, abort. It is not safe to uninstall</span>
<a name="l00770"></a>00770       <span class="comment">// them automatically because uninstalling a module is a destructive</span>
<a name="l00771"></a>00771       <span class="comment">// operation.</span>
<a name="l00772"></a>00772       <span class="keywordflow">foreach</span> (array_keys($module_data[$module]-&gt;required_by) as $dependent) {
<a name="l00773"></a>00773         <span class="keywordflow">if</span> (!isset(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>[$dependent]) &amp;&amp; <a class="code" href="install_8inc_a7702ece36adbef6e165e6f9c2bde5953.html#a7702ece36adbef6e165e6f9c2bde5953" title="Returns the currently installed schema version for a module.">drupal_get_installed_schema_version</a>($dependent) != <a class="code" href="install_8inc_ab2f11b038ed6a537bfdd257be863075f.html#ab2f11b038ed6a537bfdd257be863075f" title="Indicates that a module has not been installed yet.">SCHEMA_UNINSTALLED</a> &amp;&amp; $dependent != $profile) {
<a name="l00774"></a>00774           <span class="keywordflow">return</span> FALSE;
<a name="l00775"></a>00775         }
<a name="l00776"></a>00776       }
<a name="l00777"></a>00777     }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779     <span class="comment">// Sort the module list by pre-calculated weights.</span>
<a name="l00780"></a>00780     asort(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>);
<a name="l00781"></a>00781     <a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a> = array_keys(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>);
<a name="l00782"></a>00782   }
<a name="l00783"></a>00783 
<a name="l00784"></a>00784   <span class="keywordflow">foreach</span> (<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a> as $module) {
<a name="l00785"></a>00785     <span class="comment">// Uninstall the module.</span>
<a name="l00786"></a>00786     <a class="code" href="module_8inc_a77a6101f363c066eafbe29b26af5bfd3.html#a77a6101f363c066eafbe29b26af5bfd3" title="Load a module&#39;s installation hooks.">module_load_install</a>($module);
<a name="l00787"></a>00787     <a class="code" href="group__hooks_ga7547905cff161d057f9e71088ec67f05.html#ga7547905cff161d057f9e71088ec67f05" title="Invoke a hook in a particular module.">module_invoke</a>($module, <span class="stringliteral">&#39;uninstall&#39;</span>);
<a name="l00788"></a>00788     <a class="code" href="group__schemaapi_ga0688b6627af9dc05f2618f81489c3db0.html#ga0688b6627af9dc05f2618f81489c3db0" title="Removes all tables defined in a module&#39;s hook_schema().">drupal_uninstall_schema</a>($module);
<a name="l00789"></a>00789 
<a name="l00790"></a>00790     <a class="code" href="bootstrap_8inc_acb7338e6740302727043d64e3ae1257b.html#acb7338e6740302727043d64e3ae1257b" title="Logs a system message.">watchdog</a>(<span class="stringliteral">&#39;system&#39;</span>, <span class="stringliteral">&#39;%module module uninstalled.&#39;</span>, array(<span class="stringliteral">&#39;%module&#39;</span> =&gt; $module), <a class="code" href="group__logging__severity__levels_ga9629ff808fd20ce4abb297db5976af4d.html#ga9629ff808fd20ce4abb297db5976af4d" title="Log message severity -- Informational messages.">WATCHDOG_INFO</a>);
<a name="l00791"></a>00791     <a class="code" href="install_8inc_a2bc19b43e5872bf61c359839ccaec97b.html#a2bc19b43e5872bf61c359839ccaec97b" title="Update the installed version information for a module.">drupal_set_installed_schema_version</a>($module, <a class="code" href="install_8inc_ab2f11b038ed6a537bfdd257be863075f.html#ab2f11b038ed6a537bfdd257be863075f" title="Indicates that a module has not been installed yet.">SCHEMA_UNINSTALLED</a>);
<a name="l00792"></a>00792   }
<a name="l00793"></a>00793 
<a name="l00794"></a>00794   <span class="keywordflow">if</span> (!empty(<a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>)) {
<a name="l00795"></a>00795     <span class="comment">// Call hook_module_uninstall to let other modules act</span>
<a name="l00796"></a>00796     <a class="code" href="group__hooks_gabedb5f566ef5faaa5768dd15125b111c.html#gabedb5f566ef5faaa5768dd15125b111c" title="Invoke a hook in all enabled modules that implement it.">module_invoke_all</a>(<span class="stringliteral">&#39;modules_uninstalled&#39;</span>, <a class="code" href="authorize_8php_acf0330c113447a7ab0d77159f9370222.html#acf0330c113447a7ab0d77159f9370222">$module_list</a>);
<a name="l00797"></a>00797   }
<a name="l00798"></a>00798 
<a name="l00799"></a>00799   <span class="keywordflow">return</span> TRUE;
<a name="l00800"></a>00800 }
<a name="l00801"></a>00801 
<a name="l00814"></a><a class="code" href="install_8inc_a604165f37803cd10ac32534e3f8796ed.html#a604165f37803cd10ac32534e3f8796ed">00814</a> <span class="keyword">function</span> <a class="code" href="install_8inc_a604165f37803cd10ac32534e3f8796ed.html#a604165f37803cd10ac32534e3f8796ed" title="Verify the state of the specified file.">drupal_verify_install_file</a>($file, $mask = NULL, $type = <span class="stringliteral">&#39;file&#39;</span>) {
<a name="l00815"></a>00815   $return = TRUE;
<a name="l00816"></a>00816   <span class="comment">// Check for files that shouldn&#39;t be there.</span>
<a name="l00817"></a>00817   <span class="keywordflow">if</span> (isset($mask) &amp;&amp; ($mask &amp; <a class="code" href="install_8inc_a2d02367d8fd76c70b1ffb77b24e62db9.html#a2d02367d8fd76c70b1ffb77b24e62db9" title="File permission check -- File does not exist.">FILE_NOT_EXIST</a>) &amp;&amp; file_exists($file)) {
<a name="l00818"></a>00818     <span class="keywordflow">return</span> FALSE;
<a name="l00819"></a>00819   }
<a name="l00820"></a>00820   <span class="comment">// Verify that the file is the type of file it is supposed to be.</span>
<a name="l00821"></a>00821   <span class="keywordflow">if</span> (isset($type) &amp;&amp; file_exists($file)) {
<a name="l00822"></a>00822     $check = <span class="stringliteral">&#39;is_&#39;</span> . $type;
<a name="l00823"></a>00823     <span class="keywordflow">if</span> (!function_exists($check) || !$check($file)) {
<a name="l00824"></a>00824       $return = FALSE;
<a name="l00825"></a>00825     }
<a name="l00826"></a>00826   }
<a name="l00827"></a>00827 
<a name="l00828"></a>00828   <span class="comment">// Verify file permissions.</span>
<a name="l00829"></a>00829   <span class="keywordflow">if</span> (isset($mask)) {
<a name="l00830"></a>00830     $masks = array(<a class="code" href="install_8inc_ae627ec3bb64949659adbc8cac5ae063e.html#ae627ec3bb64949659adbc8cac5ae063e" title="File permission check -- File exists.">FILE_EXIST</a>, <a class="code" href="install_8inc_a5a3ab6bb8b0df419dff1d9c741e5ca56.html#a5a3ab6bb8b0df419dff1d9c741e5ca56" title="File permission check -- File is readable.">FILE_READABLE</a>, <a class="code" href="install_8inc_a18edb581d332bd2fe379104a39e3b1a2.html#a18edb581d332bd2fe379104a39e3b1a2" title="File permission check -- File is writable.">FILE_WRITABLE</a>, <a class="code" href="install_8inc_a03399711a43d84ee8783b8b1214dd429.html#a03399711a43d84ee8783b8b1214dd429" title="File permission check -- File is executable.">FILE_EXECUTABLE</a>, <a class="code" href="install_8inc_ab09b4a70a73804ec35333d43a878a572.html#ab09b4a70a73804ec35333d43a878a572" title="File permission check -- File is not readable.">FILE_NOT_READABLE</a>, <a class="code" href="install_8inc_a01939e1b55bf40d1ac3556eded13a353.html#a01939e1b55bf40d1ac3556eded13a353" title="File permission check -- File is not writable.">FILE_NOT_WRITABLE</a>, <a class="code" href="install_8inc_a3c1acd6083afd2e6d977616f227fcf26.html#a3c1acd6083afd2e6d977616f227fcf26" title="File permission check -- File is not executable.">FILE_NOT_EXECUTABLE</a>);
<a name="l00831"></a>00831     <span class="keywordflow">foreach</span> ($masks as $current_mask) {
<a name="l00832"></a>00832       <span class="keywordflow">if</span> ($mask &amp; $current_mask) {
<a name="l00833"></a>00833         <span class="keywordflow">switch</span> ($current_mask) {
<a name="l00834"></a>00834           <span class="keywordflow">case</span> <a class="code" href="install_8inc_ae627ec3bb64949659adbc8cac5ae063e.html#ae627ec3bb64949659adbc8cac5ae063e" title="File permission check -- File exists.">FILE_EXIST</a>:
<a name="l00835"></a>00835             <span class="keywordflow">if</span> (!file_exists($file)) {
<a name="l00836"></a>00836               <span class="keywordflow">if</span> ($type == <span class="stringliteral">&#39;dir&#39;</span>) {
<a name="l00837"></a>00837                 <a class="code" href="install_8inc_a125c230acb8711702d23b46feab26820.html#a125c230acb8711702d23b46feab26820" title="Create a directory with specified permissions.">drupal_install_mkdir</a>($file, $mask);
<a name="l00838"></a>00838               }
<a name="l00839"></a>00839               <span class="keywordflow">if</span> (!file_exists($file)) {
<a name="l00840"></a>00840                 $return = FALSE;
<a name="l00841"></a>00841               }
<a name="l00842"></a>00842             }
<a name="l00843"></a>00843             <span class="keywordflow">break</span>;
<a name="l00844"></a>00844           <span class="keywordflow">case</span> <a class="code" href="install_8inc_a5a3ab6bb8b0df419dff1d9c741e5ca56.html#a5a3ab6bb8b0df419dff1d9c741e5ca56" title="File permission check -- File is readable.">FILE_READABLE</a>:
<a name="l00845"></a>00845             <span class="keywordflow">if</span> (!is_readable($file) &amp;&amp; !<a class="code" href="install_8inc_a41db1d979ed589c0d16bceb773e113fa.html#a41db1d979ed589c0d16bceb773e113fa" title="Attempt to fix file permissions.">drupal_install_fix_file</a>($file, $mask)) {
<a name="l00846"></a>00846               $return = FALSE;
<a name="l00847"></a>00847             }
<a name="l00848"></a>00848             <span class="keywordflow">break</span>;
<a name="l00849"></a>00849           <span class="keywordflow">case</span> <a class="code" href="install_8inc_a18edb581d332bd2fe379104a39e3b1a2.html#a18edb581d332bd2fe379104a39e3b1a2" title="File permission check -- File is writable.">FILE_WRITABLE</a>:
<a name="l00850"></a>00850             <span class="keywordflow">if</span> (!is_writable($file) &amp;&amp; !<a class="code" href="install_8inc_a41db1d979ed589c0d16bceb773e113fa.html#a41db1d979ed589c0d16bceb773e113fa" title="Attempt to fix file permissions.">drupal_install_fix_file</a>($file, $mask)) {
<a name="l00851"></a>00851               $return = FALSE;
<a name="l00852"></a>00852             }
<a name="l00853"></a>00853             <span class="keywordflow">break</span>;
<a name="l00854"></a>00854           <span class="keywordflow">case</span> <a class="code" href="install_8inc_a03399711a43d84ee8783b8b1214dd429.html#a03399711a43d84ee8783b8b1214dd429" title="File permission check -- File is executable.">FILE_EXECUTABLE</a>:
<a name="l00855"></a>00855             <span class="keywordflow">if</span> (!is_executable($file) &amp;&amp; !<a class="code" href="install_8inc_a41db1d979ed589c0d16bceb773e113fa.html#a41db1d979ed589c0d16bceb773e113fa" title="Attempt to fix file permissions.">drupal_install_fix_file</a>($file, $mask)) {
<a name="l00856"></a>00856               $return = FALSE;
<a name="l00857"></a>00857             }
<a name="l00858"></a>00858             <span class="keywordflow">break</span>;
<a name="l00859"></a>00859           <span class="keywordflow">case</span> <a class="code" href="install_8inc_ab09b4a70a73804ec35333d43a878a572.html#ab09b4a70a73804ec35333d43a878a572" title="File permission check -- File is not readable.">FILE_NOT_READABLE</a>:
<a name="l00860"></a>00860             <span class="keywordflow">if</span> (is_readable($file) &amp;&amp; !<a class="code" href="install_8inc_a41db1d979ed589c0d16bceb773e113fa.html#a41db1d979ed589c0d16bceb773e113fa" title="Attempt to fix file permissions.">drupal_install_fix_file</a>($file, $mask)) {
<a name="l00861"></a>00861               $return = FALSE;
<a name="l00862"></a>00862             }
<a name="l00863"></a>00863             <span class="keywordflow">break</span>;
<a name="l00864"></a>00864           <span class="keywordflow">case</span> <a class="code" href="install_8inc_a01939e1b55bf40d1ac3556eded13a353.html#a01939e1b55bf40d1ac3556eded13a353" title="File permission check -- File is not writable.">FILE_NOT_WRITABLE</a>:
<a name="l00865"></a>00865             <span class="keywordflow">if</span> (is_writable($file) &amp;&amp; !<a class="code" href="install_8inc_a41db1d979ed589c0d16bceb773e113fa.html#a41db1d979ed589c0d16bceb773e113fa" title="Attempt to fix file permissions.">drupal_install_fix_file</a>($file, $mask)) {
<a name="l00866"></a>00866               $return = FALSE;
<a name="l00867"></a>00867             }
<a name="l00868"></a>00868             <span class="keywordflow">break</span>;
<a name="l00869"></a>00869           <span class="keywordflow">case</span> <a class="code" href="install_8inc_a3c1acd6083afd2e6d977616f227fcf26.html#a3c1acd6083afd2e6d977616f227fcf26" title="File permission check -- File is not executable.">FILE_NOT_EXECUTABLE</a>:
<a name="l00870"></a>00870             <span class="keywordflow">if</span> (is_executable($file) &amp;&amp; !<a class="code" href="install_8inc_a41db1d979ed589c0d16bceb773e113fa.html#a41db1d979ed589c0d16bceb773e113fa" title="Attempt to fix file permissions.">drupal_install_fix_file</a>($file, $mask)) {
<a name="l00871"></a>00871               $return = FALSE;
<a name="l00872"></a>00872             }
<a name="l00873"></a>00873             <span class="keywordflow">break</span>;
<a name="l00874"></a>00874         }
<a name="l00875"></a>00875       }
<a name="l00876"></a>00876     }
<a name="l00877"></a>00877   }
<a name="l00878"></a>00878   <span class="keywordflow">return</span> $return;
<a name="l00879"></a>00879 }
<a name="l00880"></a>00880 
<a name="l00893"></a><a class="code" href="install_8inc_a125c230acb8711702d23b46feab26820.html#a125c230acb8711702d23b46feab26820">00893</a> <span class="keyword">function</span> <a class="code" href="install_8inc_a125c230acb8711702d23b46feab26820.html#a125c230acb8711702d23b46feab26820" title="Create a directory with specified permissions.">drupal_install_mkdir</a>($file, $mask, $message = TRUE) {
<a name="l00894"></a>00894   $mod = 0;
<a name="l00895"></a>00895   $masks = array(<a class="code" href="install_8inc_a5a3ab6bb8b0df419dff1d9c741e5ca56.html#a5a3ab6bb8b0df419dff1d9c741e5ca56" title="File permission check -- File is readable.">FILE_READABLE</a>, <a class="code" href="install_8inc_a18edb581d332bd2fe379104a39e3b1a2.html#a18edb581d332bd2fe379104a39e3b1a2" title="File permission check -- File is writable.">FILE_WRITABLE</a>, <a class="code" href="install_8inc_a03399711a43d84ee8783b8b1214dd429.html#a03399711a43d84ee8783b8b1214dd429" title="File permission check -- File is executable.">FILE_EXECUTABLE</a>, <a class="code" href="install_8inc_ab09b4a70a73804ec35333d43a878a572.html#ab09b4a70a73804ec35333d43a878a572" title="File permission check -- File is not readable.">FILE_NOT_READABLE</a>, <a class="code" href="install_8inc_a01939e1b55bf40d1ac3556eded13a353.html#a01939e1b55bf40d1ac3556eded13a353" title="File permission check -- File is not writable.">FILE_NOT_WRITABLE</a>, <a class="code" href="install_8inc_a3c1acd6083afd2e6d977616f227fcf26.html#a3c1acd6083afd2e6d977616f227fcf26" title="File permission check -- File is not executable.">FILE_NOT_EXECUTABLE</a>);
<a name="l00896"></a>00896   <span class="keywordflow">foreach</span> ($masks as $m) {
<a name="l00897"></a>00897     <span class="keywordflow">if</span> ($mask &amp; $m) {
<a name="l00898"></a>00898       <span class="keywordflow">switch</span> ($m) {
<a name="l00899"></a>00899         <span class="keywordflow">case</span> <a class="code" href="install_8inc_a5a3ab6bb8b0df419dff1d9c741e5ca56.html#a5a3ab6bb8b0df419dff1d9c741e5ca56" title="File permission check -- File is readable.">FILE_READABLE</a>:
<a name="l00900"></a>00900           $mod |= 0444;
<a name="l00901"></a>00901           <span class="keywordflow">break</span>;
<a name="l00902"></a>00902         <span class="keywordflow">case</span> <a class="code" href="install_8inc_a18edb581d332bd2fe379104a39e3b1a2.html#a18edb581d332bd2fe379104a39e3b1a2" title="File permission check -- File is writable.">FILE_WRITABLE</a>:
<a name="l00903"></a>00903           $mod |= 0222;
<a name="l00904"></a>00904           <span class="keywordflow">break</span>;
<a name="l00905"></a>00905         <span class="keywordflow">case</span> <a class="code" href="install_8inc_a03399711a43d84ee8783b8b1214dd429.html#a03399711a43d84ee8783b8b1214dd429" title="File permission check -- File is executable.">FILE_EXECUTABLE</a>:
<a name="l00906"></a>00906           $mod |= 0111;
<a name="l00907"></a>00907           <span class="keywordflow">break</span>;
<a name="l00908"></a>00908       }
<a name="l00909"></a>00909     }
<a name="l00910"></a>00910   }
<a name="l00911"></a>00911 
<a name="l00912"></a>00912   <span class="keywordflow">if</span> (@<a class="code" href="group__php__wrappers_ga0cd03adb94eea525f87fb061c9a33340.html#ga0cd03adb94eea525f87fb061c9a33340" title="Creates a directory using Drupal&#39;s default mode.">drupal_mkdir</a>($file, $mod)) {
<a name="l00913"></a>00913     <span class="keywordflow">return</span> TRUE;
<a name="l00914"></a>00914   }
<a name="l00915"></a>00915   <span class="keywordflow">else</span> {
<a name="l00916"></a>00916     <span class="keywordflow">return</span> FALSE;
<a name="l00917"></a>00917   }
<a name="l00918"></a>00918 }
<a name="l00919"></a>00919 
<a name="l00941"></a><a class="code" href="install_8inc_a41db1d979ed589c0d16bceb773e113fa.html#a41db1d979ed589c0d16bceb773e113fa">00941</a> <span class="keyword">function</span> <a class="code" href="install_8inc_a41db1d979ed589c0d16bceb773e113fa.html#a41db1d979ed589c0d16bceb773e113fa" title="Attempt to fix file permissions.">drupal_install_fix_file</a>($file, $mask, $message = TRUE) {
<a name="l00942"></a>00942   <span class="comment">// If $file does not exist, fileperms() issues a PHP warning.</span>
<a name="l00943"></a>00943   <span class="keywordflow">if</span> (!file_exists($file)) {
<a name="l00944"></a>00944     <span class="keywordflow">return</span> FALSE;
<a name="l00945"></a>00945   }
<a name="l00946"></a>00946 
<a name="l00947"></a>00947   $mod = fileperms($file) &amp; 0777;
<a name="l00948"></a>00948   $masks = array(<a class="code" href="install_8inc_a5a3ab6bb8b0df419dff1d9c741e5ca56.html#a5a3ab6bb8b0df419dff1d9c741e5ca56" title="File permission check -- File is readable.">FILE_READABLE</a>, <a class="code" href="install_8inc_a18edb581d332bd2fe379104a39e3b1a2.html#a18edb581d332bd2fe379104a39e3b1a2" title="File permission check -- File is writable.">FILE_WRITABLE</a>, <a class="code" href="install_8inc_a03399711a43d84ee8783b8b1214dd429.html#a03399711a43d84ee8783b8b1214dd429" title="File permission check -- File is executable.">FILE_EXECUTABLE</a>, <a class="code" href="install_8inc_ab09b4a70a73804ec35333d43a878a572.html#ab09b4a70a73804ec35333d43a878a572" title="File permission check -- File is not readable.">FILE_NOT_READABLE</a>, <a class="code" href="install_8inc_a01939e1b55bf40d1ac3556eded13a353.html#a01939e1b55bf40d1ac3556eded13a353" title="File permission check -- File is not writable.">FILE_NOT_WRITABLE</a>, <a class="code" href="install_8inc_a3c1acd6083afd2e6d977616f227fcf26.html#a3c1acd6083afd2e6d977616f227fcf26" title="File permission check -- File is not executable.">FILE_NOT_EXECUTABLE</a>);
<a name="l00949"></a>00949 
<a name="l00950"></a>00950   <span class="comment">// FILE_READABLE, FILE_WRITABLE, and FILE_EXECUTABLE permission strings</span>
<a name="l00951"></a>00951   <span class="comment">// can theoretically be 0400, 0200, and 0100 respectively, but to be safe</span>
<a name="l00952"></a>00952   <span class="comment">// we set all three access types in case the administrator intends to</span>
<a name="l00953"></a>00953   <span class="comment">// change the owner of settings.php after installation.</span>
<a name="l00954"></a>00954   <span class="keywordflow">foreach</span> ($masks as $m) {
<a name="l00955"></a>00955     <span class="keywordflow">if</span> ($mask &amp; $m) {
<a name="l00956"></a>00956       <span class="keywordflow">switch</span> ($m) {
<a name="l00957"></a>00957         <span class="keywordflow">case</span> <a class="code" href="install_8inc_a5a3ab6bb8b0df419dff1d9c741e5ca56.html#a5a3ab6bb8b0df419dff1d9c741e5ca56" title="File permission check -- File is readable.">FILE_READABLE</a>:
<a name="l00958"></a>00958           <span class="keywordflow">if</span> (!is_readable($file)) {
<a name="l00959"></a>00959             $mod |= 0444;
<a name="l00960"></a>00960           }
<a name="l00961"></a>00961           <span class="keywordflow">break</span>;
<a name="l00962"></a>00962         <span class="keywordflow">case</span> <a class="code" href="install_8inc_a18edb581d332bd2fe379104a39e3b1a2.html#a18edb581d332bd2fe379104a39e3b1a2" title="File permission check -- File is writable.">FILE_WRITABLE</a>:
<a name="l00963"></a>00963           <span class="keywordflow">if</span> (!is_writable($file)) {
<a name="l00964"></a>00964             $mod |= 0222;
<a name="l00965"></a>00965           }
<a name="l00966"></a>00966           <span class="keywordflow">break</span>;
<a name="l00967"></a>00967         <span class="keywordflow">case</span> <a class="code" href="install_8inc_a03399711a43d84ee8783b8b1214dd429.html#a03399711a43d84ee8783b8b1214dd429" title="File permission check -- File is executable.">FILE_EXECUTABLE</a>:
<a name="l00968"></a>00968           <span class="keywordflow">if</span> (!is_executable($file)) {
<a name="l00969"></a>00969             $mod |= 0111;
<a name="l00970"></a>00970           }
<a name="l00971"></a>00971           <span class="keywordflow">break</span>;
<a name="l00972"></a>00972         <span class="keywordflow">case</span> <a class="code" href="install_8inc_ab09b4a70a73804ec35333d43a878a572.html#ab09b4a70a73804ec35333d43a878a572" title="File permission check -- File is not readable.">FILE_NOT_READABLE</a>:
<a name="l00973"></a>00973           <span class="keywordflow">if</span> (is_readable($file)) {
<a name="l00974"></a>00974             $mod &amp;= ~0444;
<a name="l00975"></a>00975           }
<a name="l00976"></a>00976           <span class="keywordflow">break</span>;
<a name="l00977"></a>00977         <span class="keywordflow">case</span> <a class="code" href="install_8inc_a01939e1b55bf40d1ac3556eded13a353.html#a01939e1b55bf40d1ac3556eded13a353" title="File permission check -- File is not writable.">FILE_NOT_WRITABLE</a>:
<a name="l00978"></a>00978           <span class="keywordflow">if</span> (is_writable($file)) {
<a name="l00979"></a>00979             $mod &amp;= ~0222;
<a name="l00980"></a>00980           }
<a name="l00981"></a>00981           <span class="keywordflow">break</span>;
<a name="l00982"></a>00982         <span class="keywordflow">case</span> <a class="code" href="install_8inc_a3c1acd6083afd2e6d977616f227fcf26.html#a3c1acd6083afd2e6d977616f227fcf26" title="File permission check -- File is not executable.">FILE_NOT_EXECUTABLE</a>:
<a name="l00983"></a>00983           <span class="keywordflow">if</span> (is_executable($file)) {
<a name="l00984"></a>00984             $mod &amp;= ~0111;
<a name="l00985"></a>00985           }
<a name="l00986"></a>00986           <span class="keywordflow">break</span>;
<a name="l00987"></a>00987       }
<a name="l00988"></a>00988     }
<a name="l00989"></a>00989   }
<a name="l00990"></a>00990 
<a name="l00991"></a>00991   <span class="comment">// chmod() will work if the web server is running as owner of the file.</span>
<a name="l00992"></a>00992   <span class="comment">// If PHP safe_mode is enabled the currently executing script must also</span>
<a name="l00993"></a>00993   <span class="comment">// have the same owner.</span>
<a name="l00994"></a>00994   <span class="keywordflow">if</span> (@chmod($file, $mod)) {
<a name="l00995"></a>00995     <span class="keywordflow">return</span> TRUE;
<a name="l00996"></a>00996   }
<a name="l00997"></a>00997   <span class="keywordflow">else</span> {
<a name="l00998"></a>00998     <span class="keywordflow">return</span> FALSE;
<a name="l00999"></a>00999   }
<a name="l01000"></a>01000 }
<a name="l01001"></a>01001 
<a name="l01010"></a><a class="code" href="install_8inc_a8500b736c9651e3947265d35fc6ab920.html#a8500b736c9651e3947265d35fc6ab920">01010</a> <span class="keyword">function</span> <a class="code" href="install_8inc_a8500b736c9651e3947265d35fc6ab920.html#a8500b736c9651e3947265d35fc6ab920" title="Send the user to a different installer page.">install_goto</a>($path) {
<a name="l01011"></a>01011   global $base_url;
<a name="l01012"></a>01012   include_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/common.inc&#39;</span>;
<a name="l01013"></a>01013   header(<span class="stringliteral">&#39;Location: &#39;</span> . $base_url . <span class="charliteral">&#39;/&#39;</span> . $path);
<a name="l01014"></a>01014   header(<span class="stringliteral">&#39;Cache-Control: no-cache&#39;</span>); <span class="comment">// Not a permanent redirect.</span>
<a name="l01015"></a>01015   <a class="code" href="common_8inc_abe82fff35edd9a4da0d3fe4ef1a95614.html#abe82fff35edd9a4da0d3fe4ef1a95614" title="Performs end-of-request tasks.">drupal_exit</a>();
<a name="l01016"></a>01016 }
<a name="l01017"></a>01017 
<a name="l01043"></a><a class="code" href="install_8inc_a75c4f99a27a5a65328abc0eaa1f928e3.html#a75c4f99a27a5a65328abc0eaa1f928e3">01043</a> <span class="keyword">function</span> <a class="code" href="install_8inc_a75c4f99a27a5a65328abc0eaa1f928e3.html#a75c4f99a27a5a65328abc0eaa1f928e3" title="Returns the URL of the current script, with modified query parameters.">drupal_current_script_url</a>($query = array()) {
<a name="l01044"></a>01044   $uri = $_SERVER[<span class="stringliteral">&#39;SCRIPT_NAME&#39;</span>];
<a name="l01045"></a>01045   $query = array_merge(<a class="code" href="group__http__handling_ga2e632373cf469e513c0b6b7095f0e4dd.html#ga2e632373cf469e513c0b6b7095f0e4dd" title="Processes a URL query parameter array to remove unwanted elements.">drupal_get_query_parameters</a>(), $query);
<a name="l01046"></a>01046   <span class="keywordflow">if</span> (!empty($query)) {
<a name="l01047"></a>01047     $uri .= <span class="charliteral">&#39;?&#39;</span> . <a class="code" href="group__php__wrappers_gada763092b76d70856870eb3afa2ad265.html#gada763092b76d70856870eb3afa2ad265" title="Parses an array into a valid, rawurlencoded query string.">drupal_http_build_query</a>($query);
<a name="l01048"></a>01048   }
<a name="l01049"></a>01049   <span class="keywordflow">return</span> $uri;
<a name="l01050"></a>01050 }
<a name="l01051"></a>01051 
<a name="l01070"></a><a class="code" href="install_8inc_aa26d690c87ca7a7a2aedd9cd4679274a.html#aa26d690c87ca7a7a2aedd9cd4679274a">01070</a> <span class="keyword">function</span> <a class="code" href="install_8inc_aa26d690c87ca7a7a2aedd9cd4679274a.html#aa26d690c87ca7a7a2aedd9cd4679274a" title="Returns a URL for proceeding to the next page after a requirements problem.">drupal_requirements_url</a>($severity) {
<a name="l01071"></a>01071   $query = array();
<a name="l01072"></a>01072   <span class="comment">// If there are no errors, only warnings, append &#39;continue=1&#39; to the URL so</span>
<a name="l01073"></a>01073   <span class="comment">// the user can bypass this screen on the next page load.</span>
<a name="l01074"></a>01074   <span class="keywordflow">if</span> ($severity == <a class="code" href="install_8inc_a2879fcef075548b2dceeeaa9571dcf8d.html#a2879fcef075548b2dceeeaa9571dcf8d" title="Requirement severity -- Warning condition; proceed but flag warning.">REQUIREMENT_WARNING</a>) {
<a name="l01075"></a>01075     $query[<span class="stringliteral">&#39;continue&#39;</span>] = 1;
<a name="l01076"></a>01076   }
<a name="l01077"></a>01077   <span class="keywordflow">return</span> <a class="code" href="install_8inc_a75c4f99a27a5a65328abc0eaa1f928e3.html#a75c4f99a27a5a65328abc0eaa1f928e3" title="Returns the URL of the current script, with modified query parameters.">drupal_current_script_url</a>($query);
<a name="l01078"></a>01078 }
<a name="l01079"></a>01079 
<a name="l01094"></a><a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c">01094</a> <span class="keyword">function</span> <a class="code" href="group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c.html#gabc78d1b88aa8081093abbbf71a516c7c" title="Functional equivalent of t(), used when some systems are not available.">st</a>($string, array $args = array(), array $options = array()) {
<a name="l01095"></a>01095   <span class="keyword">static</span> $locale_strings = NULL;
<a name="l01096"></a>01096   global $install_state;
<a name="l01097"></a>01097 
<a name="l01098"></a>01098   <span class="keywordflow">if</span> (empty($options[<span class="stringliteral">&#39;context&#39;</span>])) {
<a name="l01099"></a>01099     $options[<span class="stringliteral">&#39;context&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01100"></a>01100   }
<a name="l01101"></a>01101 
<a name="l01102"></a>01102   <span class="keywordflow">if</span> (!isset($locale_strings)) {
<a name="l01103"></a>01103     $locale_strings = array();
<a name="l01104"></a>01104     <span class="keywordflow">if</span> (isset($install_state[<span class="stringliteral">&#39;parameters&#39;</span>][<span class="stringliteral">&#39;profile&#39;</span>]) &amp;&amp; isset($install_state[<span class="stringliteral">&#39;parameters&#39;</span>][<span class="stringliteral">&#39;locale&#39;</span>])) {
<a name="l01105"></a>01105       <span class="comment">// If the given locale was selected, there should be at least one .po file</span>
<a name="l01106"></a>01106       <span class="comment">// with its name ending in {$install_state[&#39;parameters&#39;][&#39;locale&#39;]}.po</span>
<a name="l01107"></a>01107       <span class="comment">// This might or might not be the entire filename. It is also possible</span>
<a name="l01108"></a>01108       <span class="comment">// that multiple files end with the same extension, even if unlikely.</span>
<a name="l01109"></a>01109       $po_files = <a class="code" href="group__file_ga363e988787ffa45bff69ff051eed0615.html#ga363e988787ffa45bff69ff051eed0615" title="Finds all files that match a given mask in a given directory.">file_scan_directory</a>(<span class="stringliteral">&#39;./profiles/&#39;</span> . $install_state[<span class="stringliteral">&#39;parameters&#39;</span>][<span class="stringliteral">&#39;profile&#39;</span>] . <span class="stringliteral">&#39;/translations&#39;</span>, <span class="charliteral">&#39;/&#39;</span>. $install_state[<span class="stringliteral">&#39;parameters&#39;</span>][<span class="stringliteral">&#39;locale&#39;</span>] .<span class="stringliteral">&#39;\.po$/&#39;</span>, array(<span class="stringliteral">&#39;recurse&#39;</span> =&gt; FALSE));
<a name="l01110"></a>01110       <span class="keywordflow">if</span> (count($po_files)) {
<a name="l01111"></a>01111         require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/locale.inc&#39;</span>;
<a name="l01112"></a>01112         <span class="keywordflow">foreach</span> ($po_files as $po_file) {
<a name="l01113"></a>01113           <a class="code" href="group__locale-api-import-export_ga97099fd0b115843fd4d443686a3ca35d.html#ga97099fd0b115843fd4d443686a3ca35d" title="Parses Gettext Portable Object file into an array.">_locale_import_read_po</a>(<span class="stringliteral">&#39;mem-store&#39;</span>, $po_file);
<a name="l01114"></a>01114         }
<a name="l01115"></a>01115         $locale_strings = <a class="code" href="group__locale-api-import-export_gac065dc774e2258493b661c45c455c709.html#gac065dc774e2258493b661c45c455c709" title="Imports a string into the database.">_locale_import_one_string</a>(<span class="stringliteral">&#39;mem-report&#39;</span>);
<a name="l01116"></a>01116       }
<a name="l01117"></a>01117     }
<a name="l01118"></a>01118   }
<a name="l01119"></a>01119 
<a name="l01120"></a>01120   require_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/theme.inc&#39;</span>;
<a name="l01121"></a>01121   <span class="comment">// Transform arguments before inserting them</span>
<a name="l01122"></a>01122   <span class="keywordflow">foreach</span> ($args as $key =&gt; $value) {
<a name="l01123"></a>01123     <span class="keywordflow">switch</span> ($key[0]) {
<a name="l01124"></a>01124       <span class="comment">// Escaped only</span>
<a name="l01125"></a>01125       <span class="keywordflow">case</span> <span class="charliteral">&#39;@&#39;</span>:
<a name="l01126"></a>01126         $args[$key] = <a class="code" href="group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d.html#ga76fc67a30fd8d75ddd80565e6e65a13d" title="Encodes special characters in a plain-text string for display as HTML.">check_plain</a>($value);
<a name="l01127"></a>01127         <span class="keywordflow">break</span>;
<a name="l01128"></a>01128       <span class="comment">// Escaped and placeholder</span>
<a name="l01129"></a>01129       <span class="keywordflow">case</span> <span class="charliteral">&#39;%&#39;</span>:
<a name="l01130"></a>01130       <span class="keywordflow">default</span>:
<a name="l01131"></a>01131         $args[$key] = <span class="stringliteral">&#39;&lt;em&gt;&#39;</span> . <a class="code" href="group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d.html#ga76fc67a30fd8d75ddd80565e6e65a13d" title="Encodes special characters in a plain-text string for display as HTML.">check_plain</a>($value) . <span class="stringliteral">&#39;&lt;/em&gt;&#39;</span>;
<a name="l01132"></a>01132         <span class="keywordflow">break</span>;
<a name="l01133"></a>01133       <span class="comment">// Pass-through</span>
<a name="l01134"></a>01134       <span class="keywordflow">case</span> <span class="charliteral">&#39;!&#39;</span>:
<a name="l01135"></a>01135     }
<a name="l01136"></a>01136   }
<a name="l01137"></a>01137   <span class="keywordflow">return</span> strtr((!empty($locale_strings[$options[<span class="stringliteral">&#39;context&#39;</span>]][$string]) ? $locale_strings[$options[<span class="stringliteral">&#39;context&#39;</span>]][$string] : $string), $args);
<a name="l01138"></a>01138 }
<a name="l01139"></a>01139 
<a name="l01148"></a><a class="code" href="install_8inc_a836bd8c91fc428e6d7c5bc6306dc6f5c.html#a836bd8c91fc428e6d7c5bc6306dc6f5c">01148</a> <span class="keyword">function</span> <a class="code" href="install_8inc_a836bd8c91fc428e6d7c5bc6306dc6f5c.html#a836bd8c91fc428e6d7c5bc6306dc6f5c" title="Check an install profile&#39;s requirements.">drupal_check_profile</a>($profile) {
<a name="l01149"></a>01149   include_once <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&#39;/includes/file.inc&#39;</span>;
<a name="l01150"></a>01150 
<a name="l01151"></a>01151   $profile_file = <a class="code" href="authorize_8php_a21cf187d162beffb1fbc5a1d1098f4f9.html#a21cf187d162beffb1fbc5a1d1098f4f9" title="Root directory of Drupal installation.">DRUPAL_ROOT</a> . <span class="stringliteral">&quot;/profiles/$profile/$profile.profile&quot;</span>;
<a name="l01152"></a>01152 
<a name="l01153"></a>01153   <span class="keywordflow">if</span> (!isset($profile) || !file_exists($profile_file)) {
<a name="l01154"></a>01154     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classException.html" title="to throw error if a module update fails.">Exception</a>(<a class="code" href="install_8core_8inc_a78dd97fe8667cff59641b2adc55436cf.html#a78dd97fe8667cff59641b2adc55436cf" title="Indicates that there are no profiles available.">install_no_profile_error</a>());
<a name="l01155"></a>01155   }
<a name="l01156"></a>01156 
<a name="l01157"></a>01157   $info = <a class="code" href="install_8inc_ad035099993d5a0dc4bad7ce81264c88d.html#ad035099993d5a0dc4bad7ce81264c88d" title="Retrieve info about an install profile from its .info file.">install_profile_info</a>($profile);
<a name="l01158"></a>01158 
<a name="l01159"></a>01159   <span class="comment">// Collect requirement testing results.</span>
<a name="l01160"></a>01160   $requirements = array();
<a name="l01161"></a>01161   <span class="keywordflow">foreach</span> ($info[<span class="stringliteral">&#39;dependencies&#39;</span>] as $module) {
<a name="l01162"></a>01162     <a class="code" href="module_8inc_a77a6101f363c066eafbe29b26af5bfd3.html#a77a6101f363c066eafbe29b26af5bfd3" title="Load a module&#39;s installation hooks.">module_load_install</a>($module);
<a name="l01163"></a>01163     $function = $module . <span class="stringliteral">&#39;_requirements&#39;</span>;
<a name="l01164"></a>01164     <span class="keywordflow">if</span> (function_exists($function)) {
<a name="l01165"></a>01165       $requirements = array_merge($requirements, $function(<span class="stringliteral">&#39;install&#39;</span>));
<a name="l01166"></a>01166     }
<a name="l01167"></a>01167   }
<a name="l01168"></a>01168   <span class="keywordflow">return</span> $requirements;
<a name="l01169"></a>01169 }
<a name="l01170"></a>01170 
<a name="l01180"></a><a class="code" href="install_8inc_aa9ea0f7df004333efbdd03025f5a9c94.html#aa9ea0f7df004333efbdd03025f5a9c94">01180</a> <span class="keyword">function</span> <a class="code" href="install_8inc_aa9ea0f7df004333efbdd03025f5a9c94.html#aa9ea0f7df004333efbdd03025f5a9c94" title="Extract highest severity from requirements array.">drupal_requirements_severity</a>(&amp;$requirements) {
<a name="l01181"></a>01181   $severity = <a class="code" href="install_8inc_add48d60abb0dc390c50bf824f1751cc2.html#add48d60abb0dc390c50bf824f1751cc2" title="Requirement severity -- Requirement successfully met.">REQUIREMENT_OK</a>;
<a name="l01182"></a>01182   <span class="keywordflow">foreach</span> ($requirements as $requirement) {
<a name="l01183"></a>01183     <span class="keywordflow">if</span> (isset($requirement[<span class="stringliteral">&#39;severity&#39;</span>])) {
<a name="l01184"></a>01184       $severity = max($severity, $requirement[<span class="stringliteral">&#39;severity&#39;</span>]);
<a name="l01185"></a>01185     }
<a name="l01186"></a>01186   }
<a name="l01187"></a>01187   <span class="keywordflow">return</span> $severity;
<a name="l01188"></a>01188 }
<a name="l01189"></a>01189 
<a name="l01198"></a><a class="code" href="install_8inc_a3b9fc21890b0b9307383a1f6a813b859.html#a3b9fc21890b0b9307383a1f6a813b859">01198</a> <span class="keyword">function</span> <a class="code" href="install_8inc_a3b9fc21890b0b9307383a1f6a813b859.html#a3b9fc21890b0b9307383a1f6a813b859" title="Check a module&#39;s requirements.">drupal_check_module</a>($module) {
<a name="l01199"></a>01199   <a class="code" href="module_8inc_a77a6101f363c066eafbe29b26af5bfd3.html#a77a6101f363c066eafbe29b26af5bfd3" title="Load a module&#39;s installation hooks.">module_load_install</a>($module);
<a name="l01200"></a>01200   <span class="keywordflow">if</span> (<a class="code" href="group__hooks_ga0d7a0b03039c561b63424b2a6cf6103f.html#ga0d7a0b03039c561b63424b2a6cf6103f" title="Determine whether a module implements a hook.">module_hook</a>($module, <span class="stringliteral">&#39;requirements&#39;</span>)) {
<a name="l01201"></a>01201     <span class="comment">// Check requirements</span>
<a name="l01202"></a>01202     $requirements = <a class="code" href="group__hooks_ga7547905cff161d057f9e71088ec67f05.html#ga7547905cff161d057f9e71088ec67f05" title="Invoke a hook in a particular module.">module_invoke</a>($module, <span class="stringliteral">&#39;requirements&#39;</span>, <span class="stringliteral">&#39;install&#39;</span>);
<a name="l01203"></a>01203     <span class="keywordflow">if</span> (is_array($requirements) &amp;&amp; <a class="code" href="install_8inc_aa9ea0f7df004333efbdd03025f5a9c94.html#aa9ea0f7df004333efbdd03025f5a9c94" title="Extract highest severity from requirements array.">drupal_requirements_severity</a>($requirements) == <a class="code" href="install_8inc_aeddf02286107904721cb582bd430581d.html#aeddf02286107904721cb582bd430581d" title="Requirement severity -- Error condition; abort installation.">REQUIREMENT_ERROR</a>) {
<a name="l01204"></a>01204       <span class="comment">// Print any error messages</span>
<a name="l01205"></a>01205       <span class="keywordflow">foreach</span> ($requirements as $requirement) {
<a name="l01206"></a>01206         <span class="keywordflow">if</span> (isset($requirement[<span class="stringliteral">&#39;severity&#39;</span>]) &amp;&amp; $requirement[<span class="stringliteral">&#39;severity&#39;</span>] == <a class="code" href="install_8inc_aeddf02286107904721cb582bd430581d.html#aeddf02286107904721cb582bd430581d" title="Requirement severity -- Error condition; abort installation.">REQUIREMENT_ERROR</a>) {
<a name="l01207"></a>01207           $message = $requirement[<span class="stringliteral">&#39;description&#39;</span>];
<a name="l01208"></a>01208           <span class="keywordflow">if</span> (isset($requirement[<span class="stringliteral">&#39;value&#39;</span>]) &amp;&amp; $requirement[<span class="stringliteral">&#39;value&#39;</span>]) {
<a name="l01209"></a>01209             $message .= <span class="stringliteral">&#39; (&#39;</span> . <a class="code" href="bootstrap_8inc_a1be9937b04ff350b23d01fddef1e031a.html#a1be9937b04ff350b23d01fddef1e031a" title="Replaces placeholders with sanitized values in a string.">t</a>(<span class="stringliteral">&#39;Currently using !item !version&#39;</span>, array(<span class="stringliteral">&#39;!item&#39;</span> =&gt; $requirement[<span class="stringliteral">&#39;title&#39;</span>], <span class="stringliteral">&#39;!version&#39;</span> =&gt; $requirement[<span class="stringliteral">&#39;value&#39;</span>])) . <span class="charliteral">&#39;)&#39;</span>;
<a name="l01210"></a>01210           }
<a name="l01211"></a>01211           <a class="code" href="bootstrap_8inc_ad9223d86c7b08b1288274ce211d9bfa6.html#ad9223d86c7b08b1288274ce211d9bfa6" title="Sets a message to display to the user.">drupal_set_message</a>($message, <span class="stringliteral">&#39;error&#39;</span>);
<a name="l01212"></a>01212         }
<a name="l01213"></a>01213       }
<a name="l01214"></a>01214       <span class="keywordflow">return</span> FALSE;
<a name="l01215"></a>01215     }
<a name="l01216"></a>01216   }
<a name="l01217"></a>01217   <span class="keywordflow">return</span> TRUE;
<a name="l01218"></a>01218 }
<a name="l01219"></a>01219 
<a name="l01255"></a><a class="code" href="install_8inc_ad035099993d5a0dc4bad7ce81264c88d.html#ad035099993d5a0dc4bad7ce81264c88d">01255</a> <span class="keyword">function</span> <a class="code" href="install_8inc_ad035099993d5a0dc4bad7ce81264c88d.html#ad035099993d5a0dc4bad7ce81264c88d" title="Retrieve info about an install profile from its .info file.">install_profile_info</a>($profile, $locale = <span class="stringliteral">&#39;en&#39;</span>) {
<a name="l01256"></a>01256   $cache = &amp;<a class="code" href="group__schemaapi_ga498392997d598f196f35805de85d8b21.html#ga498392997d598f196f35805de85d8b21" title="End of &quot;addtogroup registry&quot;.">drupal_static</a>(__FUNCTION__, array());
<a name="l01257"></a>01257 
<a name="l01258"></a>01258   <span class="keywordflow">if</span> (!isset($cache[$profile])) {
<a name="l01259"></a>01259     <span class="comment">// Set defaults for module info.</span>
<a name="l01260"></a>01260     $defaults = array(
<a name="l01261"></a>01261       <span class="stringliteral">&#39;dependencies&#39;</span> =&gt; array(),
<a name="l01262"></a>01262       <span class="stringliteral">&#39;description&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l01263"></a>01263       <span class="stringliteral">&#39;distribution_name&#39;</span> =&gt; <span class="stringliteral">&#39;Drupal&#39;</span>,
<a name="l01264"></a>01264       <span class="stringliteral">&#39;version&#39;</span> =&gt; NULL,
<a name="l01265"></a>01265       <span class="stringliteral">&#39;hidden&#39;</span> =&gt; FALSE,
<a name="l01266"></a>01266       <span class="stringliteral">&#39;php&#39;</span> =&gt; <a class="code" href="bootstrap_8inc_a370c52d1679da96064df124c55f16ea8.html#a370c52d1679da96064df124c55f16ea8" title="Minimum supported version of PHP.">DRUPAL_MINIMUM_PHP</a>,
<a name="l01267"></a>01267     );
<a name="l01268"></a>01268     $info = <a class="code" href="common_8inc_a277955232059631211fcfde533ea89d6.html#a277955232059631211fcfde533ea89d6" title="End of &quot;addtogroup schemaapi&quot;.">drupal_parse_info_file</a>(<span class="stringliteral">&quot;profiles/$profile/$profile.info&quot;</span>) + $defaults;
<a name="l01269"></a>01269     $info[<span class="stringliteral">&#39;dependencies&#39;</span>] = array_unique(array_merge(
<a name="l01270"></a>01270       <a class="code" href="module_8inc_a029be29693701bd21b6810e8d047c5a8.html#a029be29693701bd21b6810e8d047c5a8" title="End of &quot;defgroup hooks&quot;.">drupal_required_modules</a>(),
<a name="l01271"></a>01271       $info[<span class="stringliteral">&#39;dependencies&#39;</span>],
<a name="l01272"></a>01272       ($locale != <span class="stringliteral">&#39;en&#39;</span> &amp;&amp; !empty($locale) ? array(<span class="stringliteral">&#39;locale&#39;</span>) : array()))
<a name="l01273"></a>01273     );
<a name="l01274"></a>01274 
<a name="l01275"></a>01275     <span class="comment">// drupal_required_modules() includes the current profile as a dependency.</span>
<a name="l01276"></a>01276     <span class="comment">// Since a module can&#39;t depend on itself we remove that element of the array.</span>
<a name="l01277"></a>01277     array_shift($info[<span class="stringliteral">&#39;dependencies&#39;</span>]);
<a name="l01278"></a>01278 
<a name="l01279"></a>01279     $cache[$profile] = $info;
<a name="l01280"></a>01280   }
<a name="l01281"></a>01281   <span class="keywordflow">return</span> $cache[$profile];
<a name="l01282"></a>01282 }
<a name="l01283"></a>01283 
<a name="l01292"></a><a class="code" href="install_8inc_a57bfe6a3b39d6f931fe965a93e7eec83.html#a57bfe6a3b39d6f931fe965a93e7eec83">01292</a> <span class="keyword">function</span> <a class="code" href="install_8inc_a57bfe6a3b39d6f931fe965a93e7eec83.html#a57bfe6a3b39d6f931fe965a93e7eec83" title="Ensures the environment for a Drupal database on a predefined connection.">db_run_tasks</a>($driver) {
<a name="l01293"></a>01293   <a class="code" href="install_8inc_aae9b6ee5100acd83eabbb2b2c2ab02c6.html#aae9b6ee5100acd83eabbb2b2c2ab02c6" title="Returns a database installer object.">db_installer_object</a>($driver)-&gt;runTasks();
<a name="l01294"></a>01294   <span class="keywordflow">return</span> TRUE;
<a name="l01295"></a>01295 }
<a name="l01296"></a>01296 
<a name="l01303"></a><a class="code" href="install_8inc_aae9b6ee5100acd83eabbb2b2c2ab02c6.html#aae9b6ee5100acd83eabbb2b2c2ab02c6">01303</a> <span class="keyword">function</span> <a class="code" href="install_8inc_aae9b6ee5100acd83eabbb2b2c2ab02c6.html#aae9b6ee5100acd83eabbb2b2c2ab02c6" title="Returns a database installer object.">db_installer_object</a>($driver) {
<a name="l01304"></a>01304   <a class="code" href="classDatabase_a25fe33ffa87aaf80ff680e356230d9e2.html#a25fe33ffa87aaf80ff680e356230d9e2" title="Load a file for the database that might hold a class.">Database::loadDriverFile</a>($driver, array(<span class="stringliteral">&#39;install.inc&#39;</span>));
<a name="l01305"></a>01305   $task_class = <span class="stringliteral">&#39;DatabaseTasks_&#39;</span> . $driver;
<a name="l01306"></a>01306   <span class="keywordflow">return</span> <span class="keyword">new</span> $task_class();
<a name="l01307"></a>01307 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 22 2012 16:46:14 for Shopcart by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
